"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof3=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports.ZarrPixelSource=exports.XRLayer=exports.XR3DLayer=exports.VolumeViewer=exports.VolumeView=exports.VolumeLayer=exports.VivViewer=exports.VivView=exports.TiffPixelSource=exports.SideBySideViewer=exports.SideBySideView=exports.ScaleBarLayer=exports.RENDERING_MODES=exports.PictureInPictureViewer=exports.OverviewView=exports.OverviewLayer=exports.OVERVIEW_VIEW_ID=exports.MultiscaleImageLayer=exports.MAX_CHANNELS=exports.LensExtension=exports.ImageLayer=exports.DetailView=exports.DTYPE_VALUES=exports.DETAIL_VIEW_ID=exports.ColorPaletteExtension=exports.ColorPalette3DExtensions=exports.COLORMAPS=exports.BitmapLayer=exports.AdditiveColormapExtension=exports.AdditiveColormap3DExtensions=void 0;exports.getChannelStats=getChannelStats;exports.getDefaultInitialViewState=getDefaultInitialViewState;exports.loadBioformatsZarr=loadBioformatsZarr;exports.loadOmeTiff=loadOmeTiff;exports.loadOmeZarr=loadOmeZarr;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _get2=_interopRequireDefault(require("@babel/runtime/helpers/get"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _core=require("@deck.gl/core");var _math=require("math.gl");var _constants=_interopRequireDefault(require("@luma.gl/constants"));var _geoLayers=require("@deck.gl/geo-layers");var _core2=require("@luma.gl/core");var _engine=require("@luma.gl/engine");var _webgl=require("@luma.gl/webgl");var _layers=require("@deck.gl/layers");var _quickselect=_interopRequireDefault(require("quickselect"));var _culling=require("@math.gl/culling");var _react=_interopRequireWildcard(require("react"));var _react2=_interopRequireDefault(require("@deck.gl/react"));var _fastDeepEqual=_interopRequireDefault(require("fast-deep-equal"));var _geotiff=require("geotiff");var _lzwTiffDecoder=require("lzw-tiff-decoder");var _fastXmlParser=_interopRequireDefault(require("fast-xml-parser"));var _zarr=require("zarr");var _RENDERING_MODES_BLEN,_RENDERING_MODES_COLO,_globalThis$navigator,_globalThis$navigator2;var _excluded=["props","oldProps","changeFlags"],_excluded2=["props","oldProps","changeFlags"],_excluded3=["props","oldProps","changeFlags"],_excluded4=["target","useFixedAxis"];function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof3(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var fs$7="#define SHADER_NAME xr-layer-fragment-shader\nprecision highp float;precision highp int;precision highp SAMPLER_TYPE;\n#define GLSLIFY 1\nuniform SAMPLER_TYPE channel0;uniform SAMPLER_TYPE channel1;uniform SAMPLER_TYPE channel2;uniform SAMPLER_TYPE channel3;uniform SAMPLER_TYPE channel4;uniform SAMPLER_TYPE channel5;in vec2 vTexCoord;uniform vec2 contrastLimits[6];uniform float minAlphaIntensity;void main(){float intensity0=float(texture(channel0,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity0,contrastLimits[0],minAlphaIntensity,0);float intensity1=float(texture(channel1,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity1,contrastLimits[1],minAlphaIntensity,1);float intensity2=float(texture(channel2,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity2,contrastLimits[2],minAlphaIntensity,2);float intensity3=float(texture(channel3,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity3,contrastLimits[3],minAlphaIntensity,3);float intensity4=float(texture(channel4,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity4,contrastLimits[4],minAlphaIntensity,4);float intensity5=float(texture(channel5,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity5,contrastLimits[5],minAlphaIntensity,5);DECKGL_MUTATE_COLOR(gl_FragColor,intensity0,intensity1,intensity2,intensity3,intensity4,intensity5,vTexCoord);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(gl_FragColor,geometry);}";// eslint-disable-line
var vs$1="#define GLSLIFY 1\n#define SHADER_NAME xr-layer-vertex-shader\nattribute vec2 texCoords;attribute vec3 positions;attribute vec3 positions64Low;attribute vec3 instancePickingColors;varying vec2 vTexCoord;void main(void){geometry.worldPosition=positions;geometry.uv=texCoords;geometry.pickingColor=instancePickingColors;gl_Position=project_position_to_clipspace(positions,positions64Low,vec3(0.),geometry.position);DECKGL_FILTER_GL_POSITION(gl_Position,geometry);vTexCoord=texCoords;vec4 color=vec4(0.);DECKGL_FILTER_COLOR(color,geometry);}";// eslint-disable-line
var fs$6="#define GLSLIFY 1\nfloat apply_contrast_limits(float intensity,vec2 contrastLimits,float minAlphaIntensity){float intensityMultiplier=0.;if(intensity>=minAlphaIntensity){intensityMultiplier=1.;}return max(0.,(intensityMultiplier*intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0])));}";// eslint-disable-line
var channels$1={name:'channel-intensity-module',defines:{SAMPLER_TYPE:'usampler2D',COLORMAP_FUNCTION:''},fs:fs$6};var MAX_COLOR_INTENSITY=255;var DEFAULT_COLOR_OFF=[0,0,0];var MAX_CHANNELS=6;exports.MAX_CHANNELS=MAX_CHANNELS;var DEFAULT_FONT_FAMILY="-apple-system, 'Helvetica Neue', Arial, sans-serif";var DTYPE_VALUES={Uint8:{format:_constants["default"].R8UI,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].UNSIGNED_BYTE,max:Math.pow(2,8)-1,sampler:"usampler2D"},Uint16:{format:_constants["default"].R16UI,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].UNSIGNED_SHORT,max:Math.pow(2,16)-1,sampler:"usampler2D"},Uint32:{format:_constants["default"].R32UI,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].UNSIGNED_INT,max:Math.pow(2,32)-1,sampler:"usampler2D"},Float32:{format:_constants["default"].R32F,dataFormat:_constants["default"].RED,type:_constants["default"].FLOAT,max:3.4*Math.pow(10,38),sampler:"sampler2D"},Int8:{format:_constants["default"].R8I,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].BYTE,max:Math.pow(2,8-1)-1,sampler:"isampler2D"},Int16:{format:_constants["default"].R16I,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].SHORT,max:Math.pow(2,16-1)-1,sampler:"isampler2D"},Int32:{format:_constants["default"].R32I,dataFormat:_constants["default"].RED_INTEGER,type:_constants["default"].INT,max:Math.pow(2,32-1)-1,sampler:"isampler2D"},Float64:{format:_constants["default"].R32F,dataFormat:_constants["default"].RED,type:_constants["default"].FLOAT,max:3.4*Math.pow(10,38),sampler:"sampler2D",cast:function cast(data){return new Float32Array(data);}}};exports.DTYPE_VALUES=DTYPE_VALUES;var COLORMAPS=["jet","hsv","hot","cool","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","alpha","viridis","inferno","magma","plasma","warm","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"];exports.COLORMAPS=COLORMAPS;var RENDERING_MODES=/* @__PURE__ */function(RENDERING_MODES2){RENDERING_MODES2["MAX_INTENSITY_PROJECTION"]="Maximum Intensity Projection";RENDERING_MODES2["MIN_INTENSITY_PROJECTION"]="Minimum Intensity Projection";RENDERING_MODES2["ADDITIVE"]="Additive";return RENDERING_MODES2;}(RENDERING_MODES||{});exports.RENDERING_MODES=RENDERING_MODES;function range(len){return(0,_toConsumableArray2["default"])(Array(len).keys());}function padWithDefault(arr,defaultValue,padWidth){for(var i=0;i<padWidth;i+=1){arr.push(defaultValue);}return arr;}/**
 * (Safely) get GL values for associated dtype.
 * @param {keyof typeof import('../constants').DTYPE_VALUES} dtype
 */function getDtypeValues(dtype){var values=DTYPE_VALUES[dtype];if(!values){var valid=Object.keys(DTYPE_VALUES);throw Error("Dtype not supported, got ".concat(dtype,". Must be one of ").concat(valid,"."));}return values;}function padContrastLimits(_ref){var _ref$contrastLimits=_ref.contrastLimits,contrastLimits=_ref$contrastLimits===void 0?[]:_ref$contrastLimits,channelsVisible=_ref.channelsVisible,domain=_ref.domain,dtype=_ref.dtype;var maxSliderValue=domain&&domain[1]||getDtypeValues(dtype).max;var newContrastLimits=contrastLimits.map(function(slider,i){return channelsVisible[i]?slider:[maxSliderValue,maxSliderValue];});// Need to pad contrastLimits and colors with default values (required by shader)
var padSize=MAX_CHANNELS-newContrastLimits.length;if(padSize<0){throw Error("".concat(newContrastLimits.lengths," channels passed in, but only 6 are allowed."));}var paddedContrastLimits=padWithDefault(newContrastLimits,[maxSliderValue,maxSliderValue],padSize).reduce(function(acc,val){return acc.concat(val);},[]);return paddedContrastLimits;}/**
 * Get physical size scaling Matrix4
 * @param {Object} loader PixelSource
 */function getPhysicalSizeScalingMatrix(loader){var _loader$meta$physical,_loader$meta;var _ref2=(_loader$meta$physical=loader===null||loader===void 0?void 0:(_loader$meta=loader.meta)===null||_loader$meta===void 0?void 0:_loader$meta.physicalSizes)!==null&&_loader$meta$physical!==void 0?_loader$meta$physical:{},x=_ref2.x,y=_ref2.y,z=_ref2.z;if(x!==null&&x!==void 0&&x.size&&y!==null&&y!==void 0&&y.size&&z!==null&&z!==void 0&&z.size){var min=Math.min(z.size,x.size,y.size);var ratio=[x.size/min,y.size/min,z.size/min];return new _math.Matrix4().scale(ratio);}return new _math.Matrix4().identity();}/* eslint-disable prefer-destructuring */var coreShaderModule={fs:fs$7,vs:vs$1};function validateWebGL2Filter(gl,interpolation){var canShowFloat=(0,_webgl.hasFeature)(gl,_webgl.FEATURES.TEXTURE_FLOAT);var canShowLinear=(0,_webgl.hasFeature)(gl,_webgl.FEATURES.TEXTURE_FILTER_LINEAR_FLOAT);if(!canShowFloat){throw new Error('WebGL1 context does not support floating point textures.  Unable to display raster data.');}if(!canShowLinear&&interpolation===_constants["default"].LINEAR){console.warn('LINEAR filtering not supported in WebGL1 context.  Falling back to NEAREST.');return _constants["default"].NEAREST;}return interpolation;}function getRenderingAttrs$1(dtype,gl,interpolation){if(!(0,_core2.isWebGL2)(gl)){return{format:_constants["default"].LUMINANCE,dataFormat:_constants["default"].LUMINANCE,type:_constants["default"].FLOAT,sampler:'sampler2D',shaderModule:coreShaderModule,filter:validateWebGL2Filter(gl,interpolation),cast:function cast(data){return new Float32Array(data);}};}// Linear filtering only works when the data type is cast to Float32.
var isLinear=interpolation===_constants["default"].LINEAR;// Need to add es version tag so that shaders work in WebGL2 since the tag is needed for using usampler2d with WebGL2.
// Very cursed!
var upgradedShaderModule=_objectSpread({},coreShaderModule);var version300str='#version 300 es\n';upgradedShaderModule.fs=version300str.concat(upgradedShaderModule.fs);upgradedShaderModule.vs=version300str.concat(upgradedShaderModule.vs);var values=getDtypeValues(isLinear?'Float32':dtype);// Check if a cast function is present in the returned data for the dtype
var identity=function identity(x){return x;};var cast=typeof values.cast==='function'?values.cast:identity;return _objectSpread(_objectSpread({},values),{},{shaderModule:upgradedShaderModule,filter:interpolation,cast:isLinear?function(data){return new Float32Array(data);}:cast});}var defaultProps$d={pickable:{type:'boolean',value:true,compare:true},coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,channelData:{type:'object',value:{},compare:true},bounds:{type:'array',value:[0,0,1,1],compare:true},contrastLimits:{type:'array',value:[],compare:true},channelsVisible:{type:'array',value:[],compare:true},dtype:{type:'string',value:'Uint16',compare:true},interpolation:{type:'number',value:_constants["default"].NEAREST,compare:true}};/**
 * @typedef LayerProps
 * @type {object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {string} dtype Dtype for the layer.
 * @property {Array.<number>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {String=} id Unique identifier for this layer.
 * @property {function=} onHover Hook function from deck.gl to handle hover objects.
 * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.
 * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.
 * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.
 * @property {number=} interpolation The TEXTURE_MIN_FILTER and TEXTURE_MAG_FILTER for WebGL rendering (see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter) - default is GL.NEAREST
 */ /**
 * @type {{ new (...props: import('../../types').Viv<LayerProps>[]) }}
 * @ignore
 */var XRLayer=/*#__PURE__*/function(_Layer){(0,_inherits2["default"])(XRLayer,_Layer);var _super=_createSuper(XRLayer);function XRLayer(){(0,_classCallCheck2["default"])(this,XRLayer);return _super.apply(this,arguments);}(0,_createClass2["default"])(XRLayer,[{key:"getShaders",value:/**
   * This function replaces `usampler` with `sampler` if the data is not an unsigned integer
   * and adds a standard ramp function default for DECKGL_PROCESS_INTENSITY.
   */function getShaders(){var _this$props=this.props,dtype=_this$props.dtype,interpolation=_this$props.interpolation;var _getRenderingAttrs$=getRenderingAttrs$1(dtype,this.context.gl,interpolation),shaderModule=_getRenderingAttrs$.shaderModule,sampler=_getRenderingAttrs$.sampler;var extensionDefinesDeckglProcessIntensity=this._isHookDefinedByExtensions('fs:DECKGL_PROCESS_INTENSITY');var newChannelsModule=_objectSpread(_objectSpread({},channels$1),{},{inject:{}});if(!extensionDefinesDeckglProcessIntensity){newChannelsModule.inject['fs:DECKGL_PROCESS_INTENSITY']="\n        intensity = apply_contrast_limits(intensity, contrastLimits, minAlphaIntensity);\n      ";}return(0,_get2["default"])((0,_getPrototypeOf2["default"])(XRLayer.prototype),"getShaders",this).call(this,_objectSpread(_objectSpread({},shaderModule),{},{defines:{SAMPLER_TYPE:sampler},modules:[_core.project32,_core.picking,newChannelsModule]}));}},{key:"_isHookDefinedByExtensions",value:function _isHookDefinedByExtensions(hookName){var extensions=this.props.extensions;return extensions===null||extensions===void 0?void 0:extensions.some(function(e){var shaders=e.getShaders();var _shaders$inject=shaders.inject,inject=_shaders$inject===void 0?{}:_shaders$inject,_shaders$modules=shaders.modules,modules=_shaders$modules===void 0?[]:_shaders$modules;var definesInjection=inject[hookName];var moduleDefinesInjection=modules.some(function(m){return m===null||m===void 0?void 0:m.inject[hookName];});return definesInjection||moduleDefinesInjection;});}/**
   * This function initializes the internal state.
   */},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;// This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so
// each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),
// we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).
// https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance
gl.pixelStorei(_constants["default"].UNPACK_ALIGNMENT,1);gl.pixelStorei(_constants["default"].PACK_ALIGNMENT,1);var attributeManager=this.getAttributeManager();attributeManager.add({positions:{size:3,type:_constants["default"].DOUBLE,fp64:this.use64bitPositions(),update:this.calculatePositions,noAlloc:true}});this.setState({numInstances:1,positions:new Float64Array(12)});var programManager=_engine.ProgramManager.getDefaultProgramManager(gl);var mutateStr='fs:DECKGL_MUTATE_COLOR(inout vec4 rgba, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5, vec2 vTexCoord)';var processStr="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, float minAlphaIntensity, int channelIndex)";// Only initialize shader hook functions _once globally_
// Since the program manager is shared across all layers, but many layers
// might be created, this solves the performance issue of always adding new
// hook functions.
// See https://github.com/kylebarron/deck.gl-raster/blob/2eb91626f0836558f0be4cd201ea18980d7f7f2d/src/deckgl/raster-layer/raster-layer.js#L21-L40
if(!programManager._hookFunctions.includes(mutateStr)){programManager.addShaderHook(mutateStr);}if(!programManager._hookFunctions.includes(processStr)){programManager.addShaderHook(processStr);}}/**
   * This function finalizes state by clearing all textures from the WebGL context
   */},{key:"finalizeState",value:function finalizeState(){(0,_get2["default"])((0,_getPrototypeOf2["default"])(XRLayer.prototype),"finalizeState",this).call(this);if(this.state.textures){Object.values(this.state.textures).forEach(function(tex){return tex&&tex["delete"]();});}}/**
   * This function updates state by retriggering model creation (shader compilation and attribute binding)
   * and loading any textures that need be loading.
   */},{key:"updateState",value:function updateState(_ref3){var _props$channelData,_oldProps$channelData;var props=_ref3.props,oldProps=_ref3.oldProps,changeFlags=_ref3.changeFlags,rest=(0,_objectWithoutProperties2["default"])(_ref3,_excluded);(0,_get2["default"])((0,_getPrototypeOf2["default"])(XRLayer.prototype),"updateState",this).call(this,_objectSpread({props:props,oldProps:oldProps,changeFlags:changeFlags},rest));// setup model first
if(changeFlags.extensionsChanged||props.interpolation!==oldProps.interpolation){var gl=this.context.gl;if(this.state.model){this.state.model["delete"]();}this.setState({model:this._getModel(gl)});this.getAttributeManager().invalidateAll();}if(props.channelData!==oldProps.channelData&&((_props$channelData=props.channelData)===null||_props$channelData===void 0?void 0:_props$channelData.data)!==((_oldProps$channelData=oldProps.channelData)===null||_oldProps$channelData===void 0?void 0:_oldProps$channelData.data)||props.interpolation!==oldProps.interpolation){this.loadChannelTextures(props.channelData);}var attributeManager=this.getAttributeManager();if(props.bounds!==oldProps.bounds){attributeManager.invalidate('positions');}}/**
   * This function creates the luma.gl model.
   */},{key:"_getModel",value:function _getModel(gl){if(!gl){return null;}/*
       0,0 --- 1,0
        |       |
       0,1 --- 1,1
     */return new _core2.Model(gl,_objectSpread(_objectSpread({},this.getShaders()),{},{id:this.props.id,geometry:new _core2.Geometry({drawMode:_constants["default"].TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,1,0,0,1,0,1,1])}}),isInstanced:false}));}/**
   * This function generates view positions for use as a vec3 in the shader
   */},{key:"calculatePositions",value:function calculatePositions(attributes){var positions=this.state.positions;var bounds=this.props.bounds;// bounds as [minX, minY, maxX, maxY]
/*
      (minX0, maxY3) ---- (maxX2, maxY3)
             |                  |
             |                  |
             |                  |
      (minX0, minY1) ---- (maxX2, minY1)
   */positions[0]=bounds[0];positions[1]=bounds[1];positions[2]=0;positions[3]=bounds[0];positions[4]=bounds[3];positions[5]=0;positions[6]=bounds[2];positions[7]=bounds[3];positions[8]=0;positions[9]=bounds[2];positions[10]=bounds[1];positions[11]=0;// eslint-disable-next-line  no-param-reassign
attributes.value=positions;}/**
   * This function runs the shaders and draws to the canvas
   */},{key:"draw",value:function draw(_ref4){var uniforms=_ref4.uniforms;var _this$state=this.state,textures=_this$state.textures,model=_this$state.model;if(textures&&model){var _this$props2=this.props,contrastLimits=_this$props2.contrastLimits,minAlphaIntensity=_this$props2.minAlphaIntensity,domain=_this$props2.domain,dtype=_this$props2.dtype,channelsVisible=_this$props2.channelsVisible;// Check number of textures not null.
var numTextures=Object.values(textures).filter(function(t){return t;}).length;// Slider values and color values can come in before textures since their data is async.
// Thus we pad based on the number of textures bound.
var paddedContrastLimits=padContrastLimits({contrastLimits:contrastLimits.slice(0,numTextures),channelsVisible:channelsVisible.slice(0,numTextures),domain:domain,dtype:dtype});model.setUniforms(_objectSpread(_objectSpread({},uniforms),{},{contrastLimits:paddedContrastLimits,minAlphaIntensity:minAlphaIntensity||0.},textures)).draw();}}/**
   * This function loads all channel textures from incoming resolved promises/data from the loaders by calling `dataToTexture`
   */},{key:"loadChannelTextures",value:function loadChannelTextures(channelData){var _this=this;var textures={channel0:null,channel1:null,channel2:null,channel3:null,channel4:null,channel5:null};if(this.state.textures){Object.values(this.state.textures).forEach(function(tex){return tex&&tex["delete"]();});}if(channelData&&Object.keys(channelData).length>0&&channelData.data){channelData.data.forEach(function(d,i){textures["channel".concat(i)]=_this.dataToTexture(d,channelData.width,channelData.height);},this);this.setState({textures:textures});}}/**
   * This function creates textures from the data
   */},{key:"dataToTexture",value:function dataToTexture(data,width,height){var _attrs$cast,_attrs$cast2,_parameters;var interpolation=this.props.interpolation;var attrs=getRenderingAttrs$1(this.props.dtype,this.context.gl,interpolation);return new _core2.Texture2D(this.context.gl,{width:width,height:height,data:(_attrs$cast=(_attrs$cast2=attrs.cast)===null||_attrs$cast2===void 0?void 0:_attrs$cast2.call(attrs,data))!==null&&_attrs$cast!==void 0?_attrs$cast:data,// we don't want or need mimaps
mipmaps:false,parameters:(_parameters={},(0,_defineProperty2["default"])(_parameters,_constants["default"].TEXTURE_MIN_FILTER,attrs.filter),(0,_defineProperty2["default"])(_parameters,_constants["default"].TEXTURE_MAG_FILTER,attrs.filter),(0,_defineProperty2["default"])(_parameters,_constants["default"].TEXTURE_WRAP_S,_constants["default"].CLAMP_TO_EDGE),(0,_defineProperty2["default"])(_parameters,_constants["default"].TEXTURE_WRAP_T,_constants["default"].CLAMP_TO_EDGE),_parameters),format:attrs.format,dataFormat:attrs.dataFormat,type:attrs.type});}}]);return XRLayer;}(_core.Layer);exports.XRLayer=XRLayer;XRLayer.layerName='XRLayer';XRLayer.defaultProps=defaultProps$d;// eslint-disable-next-line max-classes-per-file
var PHOTOMETRIC_INTERPRETATIONS={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9};var defaultProps$c=_objectSpread(_objectSpread({},_layers.BitmapLayer.defaultProps),{},{pickable:{type:'boolean',value:true,compare:true},coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN});var getPhotometricInterpretationShader=function getPhotometricInterpretationShader(photometricInterpretation,transparentColorInHook){var useTransparentColor=transparentColorInHook?'true':'false';var transparentColorVector="vec3(".concat((transparentColorInHook||[0,0,0]).map(function(i){return String(i/255);}).join(','),")");switch(photometricInterpretation){case PHOTOMETRIC_INTERPRETATIONS.RGB:return"color[3] = (".concat(useTransparentColor," && (color.rgb == ").concat(transparentColorVector,")) ? 0.0 : color.a;");case PHOTOMETRIC_INTERPRETATIONS.WhiteIsZero:return"          float value = 1.0 - (color.r / 256.0);\n          color = vec4(value, value, value, (".concat(useTransparentColor," && vec3(value, value, value) == ").concat(transparentColorVector,") ? 0.0 : color.a);\n        ");case PHOTOMETRIC_INTERPRETATIONS.BlackIsZero:return"          float value = (color.r / 256.0);\n          color = vec4(value, value, value, (".concat(useTransparentColor," && vec3(value, value, value) == ").concat(transparentColorVector,") ? 0.0 : color.a);\n        ");case PHOTOMETRIC_INTERPRETATIONS.YCbCr:// We need to use an epsilon because the conversion to RGB is not perfect.
return"          float y = color[0];\n          float cb = color[1];\n          float cr = color[2];\n          color[0] = (y + (1.40200 * (cr - .5)));\n          color[1] = (y - (0.34414 * (cb - .5)) - (0.71414 * (cr - .5)));\n          color[2] = (y + (1.77200 * (cb - .5)));\n          color[3] = (".concat(useTransparentColor," && distance(color.rgb, ").concat(transparentColorVector,") < 0.01) ? 0.0 : color.a;\n        ");default:console.error('Unsupported photometric interpretation or none provided.  No transformation will be done to image data');return'';}};var getTransparentColor=function getTransparentColor(photometricInterpretation){switch(photometricInterpretation){case PHOTOMETRIC_INTERPRETATIONS.RGB:return[0,0,0,0];case PHOTOMETRIC_INTERPRETATIONS.WhiteIsZero:return[255,255,255,0];case PHOTOMETRIC_INTERPRETATIONS.BlackIsZero:return[0,0,0,0];case PHOTOMETRIC_INTERPRETATIONS.YCbCr:return[16,128,128,0];default:console.error('Unsupported photometric interpretation or none provided.  No transformation will be done to image data');return[0,0,0,0];}};var BitmapLayerWrapper=/*#__PURE__*/function(_BitmapLayer$){(0,_inherits2["default"])(BitmapLayerWrapper,_BitmapLayer$);var _super2=_createSuper(BitmapLayerWrapper);function BitmapLayerWrapper(){(0,_classCallCheck2["default"])(this,BitmapLayerWrapper);return _super2.apply(this,arguments);}(0,_createClass2["default"])(BitmapLayerWrapper,[{key:"_getModel",value:function _getModel(gl){var _this$props3=this.props,photometricInterpretation=_this$props3.photometricInterpretation,transparentColorInHook=_this$props3.transparentColorInHook;// This is a port to the GPU of a subset of https://github.com/geotiffjs/geotiff.js/blob/master/src/rgb.js
// Safari was too slow doing this off of the GPU and it is noticably faster on other browsers as well.
var photometricInterpretationShader=getPhotometricInterpretationShader(photometricInterpretation,transparentColorInHook);if(!gl){return null;}/*
      0,0 --- 1,0
       |       |
      0,1 --- 1,1
    */return new _core2.Model(gl,_objectSpread(_objectSpread({},this.getShaders()),{},{id:this.props.id,geometry:new _core2.Geometry({drawMode:_constants["default"].TRIANGLES,vertexCount:6}),isInstanced:false,inject:{'fs:DECKGL_FILTER_COLOR':photometricInterpretationShader}}));}}]);return BitmapLayerWrapper;}(_layers.BitmapLayer);/**
 * @typedef LayerProps
 * @type {object}
 * @property {number=} opacity Opacity of the layer.
 * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.
 * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.
 * @property {number=} photometricInterpretation One of WhiteIsZero BlackIsZero YCbCr or RGB (default)
 * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered "transparent" if provided.
 * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.
 * This parameter only needs to be a truthy value when using colormaps because each colormap has its own transparent color that is calculated on the shader.
 * Thus setting this to a truthy value (with a colormap set) indicates that the shader should make that color transparent.
 * @property {String=} id Unique identifier for this layer.
 */ /**
 * @type {{ new (...props: import('../types').Viv<LayerProps>[]) }}
 * @ignore
 */var BitmapLayer=/*#__PURE__*/function(_CompositeLayer){(0,_inherits2["default"])(BitmapLayer,_CompositeLayer);var _super3=_createSuper(BitmapLayer);function BitmapLayer(){(0,_classCallCheck2["default"])(this,BitmapLayer);return _super3.apply(this,arguments);}(0,_createClass2["default"])(BitmapLayer,[{key:"initializeState",value:function initializeState(args){var gl=this.context.gl;// This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so
// each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),
// we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).
// https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance
// This needs to be called here and not in the BitmapLayerWrapper because the `image` prop is converted to a texture outside of the layer, as controlled by the `image` type.
// See: https://github.com/visgl/deck.gl/pull/5197
gl.pixelStorei(_constants["default"].UNPACK_ALIGNMENT,1);gl.pixelStorei(_constants["default"].PACK_ALIGNMENT,1);(0,_get2["default"])((0,_getPrototypeOf2["default"])(BitmapLayer.prototype),"initializeState",this).call(this,args);}},{key:"renderLayers",value:function renderLayers(){var _this$props4=this.props,photometricInterpretation=_this$props4.photometricInterpretation,transparentColorInHook=_this$props4.transparentColor;var transparentColor=getTransparentColor(photometricInterpretation);return new BitmapLayerWrapper(this.props,{// transparentColor is a prop applied to the original image data by deck.gl's
// BitmapLayer and needs to be in the original colorspace.  It is used to determine
// what color is "transparent" in the original color space (i.e what shows when opacity is 0).
transparentColor:transparentColor,// This is our transparentColor props which needs to be applied in the hook that converts to the RGB space.
transparentColorInHook:transparentColorInHook,id:"".concat(this.props.id,"-wrapped")});}}]);return BitmapLayer;}(_core.CompositeLayer);exports.BitmapLayer=BitmapLayer;BitmapLayer.layerName='BitmapLayer';// From https://github.com/geotiffjs/geotiff.js/blob/8ef472f41b51d18074aece2300b6a8ad91a21ae1/src/globals.js#L202-L213
BitmapLayer.PHOTOMETRIC_INTERPRETATIONS=PHOTOMETRIC_INTERPRETATIONS;BitmapLayer.defaultProps=_objectSpread(_objectSpread({},defaultProps$c),{},{// We don't want this layer to bind the texture so the type should not be `image`.
image:{type:'object',value:{},compare:true},transparentColor:{type:'array',value:[0,0,0],compare:true},photometricInterpretation:{type:'number',value:2,compare:true}});BitmapLayerWrapper.defaultProps=defaultProps$c;BitmapLayerWrapper.layerName='BitmapLayerWrapper';function getChannelStats(arr){var len=arr.length;var min=Infinity;var max=-Infinity;var total=0;while(len--){if(arr[len]<min){min=arr[len];}if(arr[len]>max){max=arr[len];}total+=arr[len];}var mean=total/arr.length;len=arr.length;var sumSquared=0;while(len--){sumSquared+=Math.pow(arr[len]-mean,2);}var sd=Math.pow(sumSquared/arr.length,0.5);var mid=Math.floor(arr.length/2);var firstQuartileLocation=Math.floor(arr.length/4);var thirdQuartileLocation=3*Math.floor(arr.length/4);(0,_quickselect["default"])(arr,mid);var median=arr[mid];(0,_quickselect["default"])(arr,firstQuartileLocation,0,mid);var q1=arr[firstQuartileLocation];(0,_quickselect["default"])(arr,thirdQuartileLocation,mid,arr.length-1);var q3=arr[thirdQuartileLocation];var cutoffArr=arr.filter(function(i){return i>0;});var cutoffPercentile=5e-4;var topCutoffLocation=Math.floor(cutoffArr.length*(1-cutoffPercentile));var bottomCutoffLocation=Math.floor(cutoffArr.length*cutoffPercentile);(0,_quickselect["default"])(cutoffArr,topCutoffLocation);(0,_quickselect["default"])(cutoffArr,bottomCutoffLocation,0,topCutoffLocation);var contrastLimits=[cutoffArr[bottomCutoffLocation]||0,cutoffArr[topCutoffLocation]||0];return{mean:mean,sd:sd,q1:q1,q3:q3,median:median,domain:[min,max],contrastLimits:contrastLimits};}function ensureArray(x){return Array.isArray(x)?x:[x];}function intToRgba(_int){if(!Number.isInteger(_int)){throw Error("Not an integer.");}var buffer=new ArrayBuffer(4);var view=new DataView(buffer);view.setInt32(0,_int,false);var bytes=new Uint8Array(buffer);return Array.from(bytes);}function isInterleaved(shape){var lastDimSize=shape[shape.length-1];return lastDimSize===3||lastDimSize===4;}function getLabels(dimOrder){return dimOrder.toLowerCase().split("").reverse();}function getDims(labels){var lookup=new Map(labels.map(function(name,i){return[name,i];}));if(lookup.size!==labels.length){throw Error("Labels must be unique, found duplicated label.");}return function(name){var index=lookup.get(name);if(index===void 0){throw Error("Invalid dimension.");}return index;};}function getImageSize(source){var interleaved=isInterleaved(source.shape);var _source$shape$slice=source.shape.slice(interleaved?-3:-2),_source$shape$slice2=(0,_slicedToArray2["default"])(_source$shape$slice,2),height=_source$shape$slice2[0],width=_source$shape$slice2[1];return{height:height,width:width};}function prevPowerOf2(x){return Math.pow(2,Math.floor(Math.log2(x)));}var SIGNAL_ABORTED="__vivSignalAborted";function renderSubLayers(props){var _props$tile=props.tile,_props$tile$bbox=_props$tile.bbox,left=_props$tile$bbox.left,top=_props$tile$bbox.top,right=_props$tile$bbox.right,bottom=_props$tile$bbox.bottom,x=_props$tile.x,y=_props$tile.y,z=_props$tile.z;var data=props.data,id=props.id,loader=props.loader,maxZoom=props.maxZoom;// Only render in positive coorinate system
if([left,bottom,right,top].some(function(v){return v<0;})||!data){return null;}var base=loader[0];var _getImageSize=getImageSize(base),height=_getImageSize.height,width=_getImageSize.width;// Tiles are exactly fitted to have height and width such that their bounds match that of the actual image (not some padded version).
// Thus the right/bottom given by deck.gl are incorrect since they assume tiles are of uniform sizes, which is not the case for us.
var bounds=[left,data.height<base.tileSize?height:bottom,data.width<base.tileSize?width:right,top];if(isInterleaved(base.shape)){var _base$meta$photometri=base.meta.photometricInterpretation,photometricInterpretation=_base$meta$photometri===void 0?2:_base$meta$photometri;return new BitmapLayer(props,{image:data,photometricInterpretation:photometricInterpretation,// Shared props with XRLayer:
bounds:bounds,id:"tile-sub-layer-".concat(bounds,"-").concat(id),tileId:{x:x,y:y,z:z},extensions:[]});}return new XRLayer(props,{channelData:data,// Uncomment to help debugging - shades the tile being hovered over.
// autoHighlight: true,
// highlightColor: [80, 80, 80, 50],
// Shared props with BitmapLayer:
bounds:bounds,id:"tile-sub-layer-".concat(bounds,"-").concat(id),tileId:{x:x,y:y,z:z},// The auto setting is NEAREST at the highest resolution but LINEAR otherwise.
interpolation:z===maxZoom?_constants["default"].NEAREST:_constants["default"].LINEAR});}var defaultProps$b={pickable:{type:'boolean',value:true,compare:true},coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,contrastLimits:{type:'array',value:[],compare:true},channelsVisible:{type:'array',value:[],compare:true},renderSubLayers:{type:'function',value:renderSubLayers,compare:false},dtype:{type:'string',value:'Uint16',compare:true},domain:{type:'array',value:[],compare:true},viewportId:{type:'string',value:'',compare:true},interpolation:{type:'number',value:null,compare:true}};/**
 * This layer serves as a proxy of sorts to the rendering done in renderSubLayers, reacting to viewport changes in a custom manner.
 */var MultiscaleImageLayerBase=/*#__PURE__*/function(_TileLayer){(0,_inherits2["default"])(MultiscaleImageLayerBase,_TileLayer);var _super4=_createSuper(MultiscaleImageLayerBase);function MultiscaleImageLayerBase(){(0,_classCallCheck2["default"])(this,MultiscaleImageLayerBase);return _super4.apply(this,arguments);}(0,_createClass2["default"])(MultiscaleImageLayerBase,[{key:"_updateTileset",value:/**
   * This function allows us to controls which viewport gets to update the Tileset2D.
   * This is a uniquely TileLayer issue since it updates based on viewport updates thanks
   * to its ability to handle zoom-pan loading.  Essentially, with a picture-in-picture,
   * this prevents it from detecting the update of some other viewport that is unwanted.
   */function _updateTileset(){if(!this.props.viewportId){(0,_get2["default"])((0,_getPrototypeOf2["default"])(MultiscaleImageLayerBase.prototype),"_updateTileset",this).call(this);}if(this.props.viewportId&&this.context.viewport.id===this.props.viewportId||// I don't know why, but DeckGL doesn't recognize multiple views on the first pass
// so we force update on the first pass by checking if there is a viewport in the tileset.
!this.state.tileset._viewport){(0,_get2["default"])((0,_getPrototypeOf2["default"])(MultiscaleImageLayerBase.prototype),"_updateTileset",this).call(this);}}}]);return MultiscaleImageLayerBase;}(_geoLayers.TileLayer);MultiscaleImageLayerBase.layerName='MultiscaleImageLayerBase';MultiscaleImageLayerBase.defaultProps=defaultProps$b;var fs$5="#define GLSLIFY 1\nuniform float majorLensAxis;uniform float minorLensAxis;uniform vec2 lensCenter;uniform bool lensEnabled;uniform int lensSelection;uniform vec3 lensBorderColor;uniform float lensBorderRadius;uniform vec3 colors[6];bool frag_in_lens_bounds(vec2 vTexCoord){return pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.)<(1.-lensBorderRadius);}bool frag_on_lens_bounds(vec2 vTexCoord){float ellipseDistance=pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.);return ellipseDistance<=1.&&ellipseDistance>=(1.-lensBorderRadius);}float get_use_color_float(vec2 vTexCoord,int channelIndex){bool isFragInLensBounds=frag_in_lens_bounds(vTexCoord);bool inLensAndUseLens=lensEnabled&&isFragInLensBounds;return float(int((inLensAndUseLens&&channelIndex==lensSelection)||(!inLensAndUseLens)));}void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5,vec2 vTexCoord){float useColorValue=0.;useColorValue=get_use_color_float(vTexCoord,0);rgb+=max(0.,min(1.,intensity0))*max(vec3(colors[0]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,1);rgb+=max(0.,min(1.,intensity1))*max(vec3(colors[1]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,2);rgb+=max(0.,min(1.,intensity2))*max(vec3(colors[2]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,3);rgb+=max(0.,min(1.,intensity3))*max(vec3(colors[3]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,4);rgb+=max(0.,min(1.,intensity4))*max(vec3(colors[4]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,5);rgb+=max(0.,min(1.,intensity5))*max(vec3(colors[5]),(1.-useColorValue)*vec3(1.,1.,1.));}";// eslint-disable-line
var lens={name:'lens-module',fs:fs$5,inject:{'fs:DECKGL_MUTATE_COLOR':"\n   vec3 rgb = rgba.rgb;\n   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5, vTexCoord);\n   rgba = vec4(rgb, 1.);\n  ",'fs:#main-end':"\n      bool isFragOnLensBounds = frag_on_lens_bounds(vTexCoord);\n     gl_FragColor = (lensEnabled && isFragOnLensBounds) ? vec4(lensBorderColor, 1.) : gl_FragColor;\n  "}};// prettier-ignore
var COLOR_PALETTE=[[0,0,255],// blue
[0,255,0],// green
[255,0,255],// magenta
[255,255,0],// yellow
[255,128,0],// orange
[0,255,255],// cyan
[255,255,255],// white
[255,0,0]// red
];function getDefaultPalette(n){if(n>COLOR_PALETTE.length){throw new Error('Too many colors');}return COLOR_PALETTE.slice(0,n);}function padColors(_ref5){var colors=_ref5.colors,channelsVisible=_ref5.channelsVisible;var newColors=colors.map(function(color,i){return channelsVisible[i]?color.map(function(c){return c/MAX_COLOR_INTENSITY;}):DEFAULT_COLOR_OFF;});var padSize=MAX_CHANNELS-newColors.length;var paddedColors=padWithDefault(newColors,DEFAULT_COLOR_OFF,padSize).reduce(function(acc,val){return acc.concat(val);},[]);return paddedColors;}var defaultProps$a={lensEnabled:{type:'boolean',value:false,compare:true},lensSelection:{type:'number',value:0,compare:true},lensRadius:{type:'number',value:100,compare:true},lensBorderColor:{type:'array',value:[255,255,255],compare:true},lensBorderRadius:{type:'number',value:0.02,compare:true},colors:{type:'array',value:null,compare:true}};/**
 * This deck.gl extension allows for a lens that selectively shows one channel in its chosen color and then the others in white.
 * @typedef LayerProps
 * @type {Object}
 * @property {boolean=} lensEnabled Whether or not to use the lens.
 * @property {number=} lensSelection Numeric index of the channel to be focused on by the lens.
 * @property {number=} lensRadius Pixel radius of the lens (default: 100).
 * @property {Array.<number>=} lensBorderColor RGB color of the border of the lens (default [255, 255, 255]).
 * @property {number=} lensBorderRadius Percentage of the radius of the lens for a border (default 0.02).
 * @property {Array<Array.<number>>=} colors Color palette to pseudo-color channels as.
 * */var LensExtension=/*#__PURE__*/function(_LayerExtension){(0,_inherits2["default"])(LensExtension,_LayerExtension);var _super5=_createSuper(LensExtension);function LensExtension(){(0,_classCallCheck2["default"])(this,LensExtension);return _super5.apply(this,arguments);}(0,_createClass2["default"])(LensExtension,[{key:"getShaders",value:function getShaders(){return _objectSpread(_objectSpread({},(0,_get2["default"])((0,_getPrototypeOf2["default"])(LensExtension.prototype),"getShaders",this).call(this)),{},{modules:[lens]});}},{key:"initializeState",value:function initializeState(){var _this2=this;var layer=this.getCurrentLayer();// No need to run this on layers that don't have a `draw` call.
if(layer.isComposite){return;}var onMouseMove=function onMouseMove(){var viewportId=layer.props.viewportId;var _this2$props$lensRadi=_this2.props.lensRadius,lensRadius=_this2$props$lensRadi===void 0?defaultProps$a.lensRadius.value:_this2$props$lensRadi;// If there is no viewportId, don't try to do anything.
if(!viewportId){layer.setState({unprojectLensBounds:[0,0,0,0]});return;}var mousePosition=layer.context.mousePosition;var layerView=layer.context.deck.viewManager.views.filter(function(view){return view.id===viewportId;})[0];var viewState=layer.context.deck.viewManager.viewState[viewportId];var viewport=layerView.makeViewport(_objectSpread(_objectSpread({},viewState),{},{viewState:viewState}));// If the mouse is in the viewport and the mousePosition exists, set
// the state with the bounding box of the circle that will render as a lens.
if(mousePosition&&viewport.containsPixel(mousePosition)){var offsetMousePosition={x:mousePosition.x-viewport.x,y:mousePosition.y-viewport.y};var mousePositionBounds=[// left
[offsetMousePosition.x-lensRadius,offsetMousePosition.y],// bottom
[offsetMousePosition.x,offsetMousePosition.y+lensRadius],// right
[offsetMousePosition.x+lensRadius,offsetMousePosition.y],// top
[offsetMousePosition.x,offsetMousePosition.y-lensRadius]];// Unproject from screen to world coordinates.
var unprojectLensBounds=mousePositionBounds.map(function(bounds,i){return viewport.unproject(bounds)[i%2];});layer.setState({unprojectLensBounds:unprojectLensBounds});}else{layer.setState({unprojectLensBounds:[0,0,0,0]});}};if(this.context.deck){this.context.deck.eventManager.on({pointermove:onMouseMove,pointerleave:onMouseMove,wheel:onMouseMove});}this.setState({onMouseMove:onMouseMove,unprojectLensBounds:[0,0,0,0]});}},{key:"draw",value:function draw(){var _this$state$model;var _this$state$unproject=this.state.unprojectLensBounds,unprojectLensBounds=_this$state$unproject===void 0?[0,0,0,0]:_this$state$unproject;var _this$props5=this.props,bounds=_this$props5.bounds,_this$props5$lensEnab=_this$props5.lensEnabled,lensEnabled=_this$props5$lensEnab===void 0?defaultProps$a.lensEnabled.value:_this$props5$lensEnab,_this$props5$lensSele=_this$props5.lensSelection,lensSelection=_this$props5$lensSele===void 0?defaultProps$a.lensSelection.value:_this$props5$lensSele,_this$props5$lensBord=_this$props5.lensBorderColor,lensBorderColor=_this$props5$lensBord===void 0?defaultProps$a.lensBorderColor.value:_this$props5$lensBord,_this$props5$lensBord2=_this$props5.lensBorderRadius,lensBorderRadius=_this$props5$lensBord2===void 0?defaultProps$a.lensBorderRadius.value:_this$props5$lensBord2,colors=_this$props5.colors,channelsVisible=_this$props5.channelsVisible;// Creating a unit-square scaled intersection box for rendering the lens.
// It is ok if these coordinates are outside the unit square since
// we check membership in or out of the lens on the fragment shader.
var _unprojectLensBounds=(0,_slicedToArray2["default"])(unprojectLensBounds,4),leftMouseBound=_unprojectLensBounds[0],bottomMouseBound=_unprojectLensBounds[1],rightMouseBound=_unprojectLensBounds[2],topMouseBound=_unprojectLensBounds[3];var _bounds=(0,_slicedToArray2["default"])(bounds,4),left=_bounds[0],bottom=_bounds[1],right=_bounds[2],top=_bounds[3];var leftMouseBoundScaled=(leftMouseBound-left)/(right-left);var bottomMouseBoundScaled=(bottomMouseBound-top)/(bottom-top);var rightMouseBoundScaled=(rightMouseBound-left)/(right-left);var topMouseBoundScaled=(topMouseBound-top)/(bottom-top);var paddedColors=padColors({channelsVisible:channelsVisible||this.selections.map(function(){return true;}),colors:colors||getDefaultPalette(this.props.selections.length)});var uniforms={majorLensAxis:(rightMouseBoundScaled-leftMouseBoundScaled)/2,minorLensAxis:(bottomMouseBoundScaled-topMouseBoundScaled)/2,lensCenter:[(rightMouseBoundScaled+leftMouseBoundScaled)/2,(bottomMouseBoundScaled+topMouseBoundScaled)/2],lensEnabled:lensEnabled,lensSelection:lensSelection,lensBorderColor:lensBorderColor,lensBorderRadius:lensBorderRadius,colors:paddedColors};// eslint-disable-next-line no-unused-expressions
(_this$state$model=this.state.model)===null||_this$state$model===void 0?void 0:_this$state$model.setUniforms(uniforms);}},{key:"finalizeState",value:function finalizeState(){// Remove event listeners
if(this.context.deck){var _this$state2,_this$state3,_this$state4;this.context.deck.eventManager.off({pointermove:(_this$state2=this.state)===null||_this$state2===void 0?void 0:_this$state2.onMouseMove,pointerleave:(_this$state3=this.state)===null||_this$state3===void 0?void 0:_this$state3.onMouseMove,wheel:(_this$state4=this.state)===null||_this$state4===void 0?void 0:_this$state4.onMouseMove});}}}]);return LensExtension;}(_core.LayerExtension);exports.LensExtension=LensExtension;LensExtension.extensionName='LensExtension';LensExtension.defaultProps=defaultProps$a;var fs$4="#define GLSLIFY 1\nvec4 apply_transparent_color_1540259130(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform vec3 transparentColor;uniform bool useTransparentColor;uniform float opacity;uniform vec3 colors[6];void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5){rgb+=max(0.0,min(1.0,intensity0))*vec3(colors[0]);rgb+=max(0.0,min(1.0,intensity1))*vec3(colors[1]);rgb+=max(0.0,min(1.0,intensity2))*vec3(colors[2]);rgb+=max(0.0,min(1.0,intensity3))*vec3(colors[3]);rgb+=max(0.0,min(1.0,intensity4))*vec3(colors[4]);rgb+=max(0.0,min(1.0,intensity5))*vec3(colors[5]);}vec4 apply_opacity(vec3 rgb){return vec4(apply_transparent_color_1540259130(rgb,transparentColor,useTransparentColor,opacity));}";// eslint-disable-line
var colorPalette={name:'color-palette-module',fs:fs$4,inject:{'fs:DECKGL_MUTATE_COLOR':"\n   vec3 rgb = rgba.rgb;\n   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5);\n   rgba = apply_opacity(rgb);\n  "}};var defaultProps$9={colors:{type:'array',value:null,compare:true},opacity:{type:'number',value:1.0,compare:true},transparentColor:{type:'array',value:null,compare:true},useTransparentColor:{type:'boolean',value:false,compare:true}};/**
 * This deck.gl extension allows for a color palette to be used for pseudo-coloring channels.
 * @typedef LayerProps
 * @type {object}
 * @property {Array<Array<number>>=} colors Array of colors to map channels to (RGB).
 * @property {number=} opacity Opacity of the layer.
 * @property {Array.<number>=} transparentColor An RGB (0-255 range) color to be considered "transparent" if provided.
 * In other words, any fragment shader output equal transparentColor (before applying opacity) will have opacity 0.
 * @property {Boolean=} useTransparentColor Whether or not to use the value provided to transparentColor.
 * */var ColorPaletteExtension=/*#__PURE__*/function(_LayerExtension2){(0,_inherits2["default"])(ColorPaletteExtension,_LayerExtension2);var _super6=_createSuper(ColorPaletteExtension);function ColorPaletteExtension(){(0,_classCallCheck2["default"])(this,ColorPaletteExtension);return _super6.apply(this,arguments);}(0,_createClass2["default"])(ColorPaletteExtension,[{key:"getShaders",value:function getShaders(){return _objectSpread(_objectSpread({},(0,_get2["default"])((0,_getPrototypeOf2["default"])(ColorPaletteExtension.prototype),"getShaders",this).call(this)),{},{modules:[colorPalette]});}},{key:"draw",value:function draw(){var _this$state$model2;var _this$props6=this.props,colors=_this$props6.colors,channelsVisible=_this$props6.channelsVisible,_this$props6$opacity=_this$props6.opacity,opacity=_this$props6$opacity===void 0?defaultProps$9.opacity.value:_this$props6$opacity,_this$props6$transpar=_this$props6.transparentColor,transparentColor=_this$props6$transpar===void 0?defaultProps$9.transparentColor.value:_this$props6$transpar,_this$props6$useTrans=_this$props6.useTransparentColor,useTransparentColor=_this$props6$useTrans===void 0?defaultProps$9.useTransparentColor.value:_this$props6$useTrans;var paddedColors=padColors({channelsVisible:channelsVisible||this.selections.map(function(){return true;}),colors:colors||getDefaultPalette(this.props.selections.length)});var uniforms={colors:paddedColors,opacity:opacity,transparentColor:(transparentColor||[0,0,0]).map(function(i){return i/255;}),useTransparentColor:Boolean(useTransparentColor)};// eslint-disable-next-line no-unused-expressions
(_this$state$model2=this.state.model)===null||_this$state$model2===void 0?void 0:_this$state$model2.setUniforms(uniforms);}}]);return ColorPaletteExtension;}(_core.LayerExtension);exports.ColorPaletteExtension=ColorPaletteExtension;ColorPaletteExtension.extensionName='ColorPaletteExtension';ColorPaletteExtension.defaultProps=defaultProps$9;var fs$3="#define GLSLIFY 1\nvec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}vec4 apply_transparent_color_452471729(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform float opacity;uniform bool useTransparentColor;vec4 colormap(float intensity){return vec4(apply_transparent_color_452471729(COLORMAP_FUNCTION(min(1.,intensity)).xyz,COLORMAP_FUNCTION(0.).xyz,useTransparentColor,opacity));}";// eslint-disable-line
var additiveColormap$1={name:'additive-colormap',fs:fs$3,inject:{'fs:DECKGL_MUTATE_COLOR':"\n  float intensityCombo = 0.;\n  intensityCombo += max(0.,intensity0);\n  intensityCombo += max(0.,intensity1);\n  intensityCombo += max(0.,intensity2);\n  intensityCombo += max(0.,intensity3);\n  intensityCombo += max(0.,intensity4);\n  intensityCombo += max(0.,intensity5);\n  rgba = colormap(intensityCombo);\n"}};var defaultProps$8={colormap:{type:'string',value:'viridis',compare:true},opacity:{type:'number',value:1.0,compare:true},useTransparentColor:{type:'boolean',value:false,compare:true}};/**
 * This deck.gl extension allows for an additive colormap like viridis or jet to be used for pseudo-coloring channels.
 * @typedef LayerProps
 * @type {object}
 * @property {number=} opacity Opacity of the layer.
 * @property {string=} colormap String indicating a colormap (default: 'viridis').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap
 * @property {boolean=} useTransparentColor Indicates whether the shader should make the output of colormap_function(0) color transparent
 * */var AdditiveColormapExtension=/*#__PURE__*/function(_LayerExtension3){(0,_inherits2["default"])(AdditiveColormapExtension,_LayerExtension3);var _super7=_createSuper(AdditiveColormapExtension);function AdditiveColormapExtension(){(0,_classCallCheck2["default"])(this,AdditiveColormapExtension);return _super7.apply(this,arguments);}(0,_createClass2["default"])(AdditiveColormapExtension,[{key:"getShaders",value:function getShaders(){var _this$props7;return{defines:{COLORMAP_FUNCTION:(this===null||this===void 0?void 0:(_this$props7=this.props)===null||_this$props7===void 0?void 0:_this$props7.colormap)||defaultProps$8.colormap.value},modules:[additiveColormap$1]};}},{key:"updateState",value:function updateState(_ref6){var props=_ref6.props,oldProps=_ref6.oldProps,changeFlags=_ref6.changeFlags,rest=(0,_objectWithoutProperties2["default"])(_ref6,_excluded2);(0,_get2["default"])((0,_getPrototypeOf2["default"])(AdditiveColormapExtension.prototype),"updateState",this).call(this,_objectSpread({props:props,oldProps:oldProps,changeFlags:changeFlags},rest));if(props.colormap!==oldProps.colormap){var gl=this.context.gl;if(this.state.model){this.state.model["delete"]();this.setState({model:this._getModel(gl)});}}}},{key:"draw",value:function draw(){var _this$state$model3;var _this$props8=this.props,_this$props8$useTrans=_this$props8.useTransparentColor,useTransparentColor=_this$props8$useTrans===void 0?defaultProps$8.useTransparentColor.value:_this$props8$useTrans,_this$props8$opacity=_this$props8.opacity,opacity=_this$props8$opacity===void 0?defaultProps$8.opacity.value:_this$props8$opacity;var uniforms={opacity:opacity,useTransparentColor:useTransparentColor};// eslint-disable-next-line no-unused-expressions
(_this$state$model3=this.state.model)===null||_this$state$model3===void 0?void 0:_this$state$model3.setUniforms(uniforms);}}]);return AdditiveColormapExtension;}(_core.LayerExtension);exports.AdditiveColormapExtension=AdditiveColormapExtension;AdditiveColormapExtension.extensionName='AdditiveColormapExtension';AdditiveColormapExtension.defaultProps=defaultProps$8;var defaultProps$7={colors:{type:'array',value:null,compare:true}};/**
 * This deck.gl extension allows for a color palette to be used for rendering in 3D.
 * @typedef LayerProps
 * @type {object}
 * @property {Array<Array<number>>=} colors Array of colors to map channels to (RGB).
 * */var BaseExtension$1=/*#__PURE__*/function(_LayerExtension4){(0,_inherits2["default"])(BaseExtension$1,_LayerExtension4);var _super8=_createSuper(BaseExtension$1);function BaseExtension$1(){(0,_classCallCheck2["default"])(this,BaseExtension$1);return _super8.apply(this,arguments);}(0,_createClass2["default"])(BaseExtension$1,[{key:"draw",value:function draw(){var _this$state$model4;var _this$props9=this.props,colors=_this$props9.colors,channelsVisible=_this$props9.channelsVisible;var paddedColors=padColors({channelsVisible:channelsVisible||this.selections.map(function(){return true;}),colors:colors||getDefaultPalette(this.props.selections.length)});var uniforms={colors:paddedColors};// eslint-disable-next-line no-unused-expressions
(_this$state$model4=this.state.model)===null||_this$state$model4===void 0?void 0:_this$state$model4.setUniforms(uniforms);}}]);return BaseExtension$1;}(_core.LayerExtension);BaseExtension$1.extensionName='BaseExtension';BaseExtension$1.defaultProps=defaultProps$7;var RENDERING_MODES_BLEND=(_RENDERING_MODES_BLEN={},(0,_defineProperty2["default"])(_RENDERING_MODES_BLEN,RENDERING_MODES.MAX_INTENSITY_PROJECTION,{_BEFORE_RENDER:"      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);\n    ",_RENDER:"    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] > maxVals[i]) {\n          maxVals[i] = intensityArray[i];\n        }\n      }\n    ",_AFTER_RENDER:"      vec3 rgbCombo = vec3(0.0);\n      for(int i = 0; i < 6; i++) {\n        rgbCombo += max(0.0, min(1.0, maxVals[i])) * vec3(colors[i]);\n      }\n      color = vec4(rgbCombo, 1.0);\n    "}),(0,_defineProperty2["default"])(_RENDERING_MODES_BLEN,RENDERING_MODES.MIN_INTENSITY_PROJECTION,{_BEFORE_RENDER:"      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);\n    ",_RENDER:"    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] < minVals[i]) {\n          minVals[i] = intensityArray[i];\n        }\n      }\n    ",_AFTER_RENDER:"      vec3 rgbCombo = vec3(0.0);\n      for(int i = 0; i < 6; i++) {\n        rgbCombo += max(0.0, min(1.0, minVals[i])) * vec3(colors[i]);\n      }\n      color = vec4(rgbCombo, 1.0);\n    "}),(0,_defineProperty2["default"])(_RENDERING_MODES_BLEN,RENDERING_MODES.ADDITIVE,{_BEFORE_RENDER:"",_RENDER:"      vec3 rgbCombo = vec3(0.0);\n      vec3 hsvCombo = vec3(0.0);\n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        float intensityValue = intensityArray[i];\n        rgbCombo += max(0.0, min(1.0, intensityValue)) * colors[i];\n        total += intensityValue;\n      }\n      // Do not go past 1 in opacity.\n      total = min(total, 1.0);\n      vec4 val_color = vec4(rgbCombo, total);\n      // Opacity correction\n      val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);\n      color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n      color.a += (1.0 - color.a) * val_color.a;\n      if (color.a >= 0.95) {\n        break;\n      }\n    ",_AFTER_RENDER:""}),_RENDERING_MODES_BLEN);/**
 * This deck.gl extension allows for a color palette to be used for rendering in 3D with additive blending.
 * */var AdditiveBlendExtension$1=/*#__PURE__*/function(_BaseExtension$){(0,_inherits2["default"])(AdditiveBlendExtension$1,_BaseExtension$);var _super9=_createSuper(AdditiveBlendExtension$1);function AdditiveBlendExtension$1(args){var _this3;(0,_classCallCheck2["default"])(this,AdditiveBlendExtension$1);_this3=_super9.call(this,args);_this3.opts.rendering=RENDERING_MODES_BLEND[RENDERING_MODES.ADDITIVE];return _this3;}return(0,_createClass2["default"])(AdditiveBlendExtension$1);}(BaseExtension$1);AdditiveBlendExtension$1.extensionName='AdditiveBlendExtension';/**
 * This deck.gl extension allows for a color palette to be used for rendering in 3D with Maximum Intensity Projection.
 * */var MaximumIntensityProjectionExtension$1=/*#__PURE__*/function(_BaseExtension$2){(0,_inherits2["default"])(MaximumIntensityProjectionExtension$1,_BaseExtension$2);var _super10=_createSuper(MaximumIntensityProjectionExtension$1);function MaximumIntensityProjectionExtension$1(args){var _this4;(0,_classCallCheck2["default"])(this,MaximumIntensityProjectionExtension$1);_this4=_super10.call(this,args);_this4.opts.rendering=RENDERING_MODES_BLEND[RENDERING_MODES.MAX_INTENSITY_PROJECTION];return _this4;}return(0,_createClass2["default"])(MaximumIntensityProjectionExtension$1);}(BaseExtension$1);MaximumIntensityProjectionExtension$1.extensionName='MaximumIntensityProjectionExtension';/**
 * This deck.gl extension allows for a color palette to be used for rendering in 3D with Minimum Intensity Projection.
 * */var MinimumIntensityProjectionExtension$1=/*#__PURE__*/function(_BaseExtension$3){(0,_inherits2["default"])(MinimumIntensityProjectionExtension$1,_BaseExtension$3);var _super11=_createSuper(MinimumIntensityProjectionExtension$1);function MinimumIntensityProjectionExtension$1(args){var _this5;(0,_classCallCheck2["default"])(this,MinimumIntensityProjectionExtension$1);_this5=_super11.call(this,args);_this5.opts.rendering=RENDERING_MODES_BLEND[RENDERING_MODES.MIN_INTENSITY_PROJECTION];return _this5;}return(0,_createClass2["default"])(MinimumIntensityProjectionExtension$1);}(BaseExtension$1);MinimumIntensityProjectionExtension$1.extensionName='MinimumIntensityProjectionExtension';/**
 * This object contains the BaseExtension, which can be extended for other color palette-style rendering, as well
 * implementations of three ray casting algorithms as extensions.
 * @typedef Extension3D
 * @type {object}
 * @property {object} BaseExtension
 * @property {object} AdditiveBlendExtension
 * @property {object} MaximumIntensityProjectionExtension
 * @property {object} MinimumIntensityProjectionExtension
 */var ColorPalette3DExtensions={BaseExtension:BaseExtension$1,AdditiveBlendExtension:AdditiveBlendExtension$1,MaximumIntensityProjectionExtension:MaximumIntensityProjectionExtension$1,MinimumIntensityProjectionExtension:MinimumIntensityProjectionExtension$1};exports.ColorPalette3DExtensions=ColorPalette3DExtensions;var fs$2="#define GLSLIFY 1\nvec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}vec4 apply_transparent_color_452471729(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}vec4 colormap(float intensity,float opacity){return vec4(COLORMAP_FUNCTION(min(1.,intensity)).xyz,opacity);}";// eslint-disable-line
var additiveColormap={name:'additive-colormap',fs:fs$2};var defaultProps$6={colormap:{type:'string',value:'viridis',compare:true}};function removeExtraColormapFunctionsFromShader(colormap){// Always include viridis so shaders compile,
// but otherwise we discard all other colormaps via a regex.
// With all the colormaps, the shaders were too large
// and crashed our computers when we loaded volumes too large.
var discardColormaps=COLORMAPS.filter(function(i){return i!==(colormap||'viridis');}).map(function(i){return i.replace(/-/g,'_');});var discardRegex=new RegExp("vec4 (".concat(discardColormaps.join('(_([0-9]*))?|'),")\\(float x_[0-9]+\\){([^}]+)}"),'g');var channelsModules=_objectSpread(_objectSpread({},additiveColormap),{},{fs:additiveColormap.fs.replace(discardRegex,''),defines:{COLORMAP_FUNCTION:colormap||defaultProps$6.colormap.value}});return channelsModules;}/**
 * This deck.gl extension allows for an additive colormap like viridis or jet to be used for pseudo-coloring channels in 3D.
 * @typedef LayerProps
 * @type {object}
 * @property {string=} colormap String indicating a colormap (default: 'viridis').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap
 * */var BaseExtension=/*#__PURE__*/function(_LayerExtension5){(0,_inherits2["default"])(BaseExtension,_LayerExtension5);var _super12=_createSuper(BaseExtension);function BaseExtension(){(0,_classCallCheck2["default"])(this,BaseExtension);return _super12.apply(this,arguments);}(0,_createClass2["default"])(BaseExtension,[{key:"getShaders",value:function getShaders(){var _this$props10;return _objectSpread(_objectSpread({},(0,_get2["default"])((0,_getPrototypeOf2["default"])(BaseExtension.prototype),"getShaders",this).call(this)),{},{modules:[removeExtraColormapFunctionsFromShader((this===null||this===void 0?void 0:(_this$props10=this.props)===null||_this$props10===void 0?void 0:_this$props10.colormap)||defaultProps$6.colormap.value)]});}},{key:"updateState",value:function updateState(_ref7){var props=_ref7.props,oldProps=_ref7.oldProps,changeFlags=_ref7.changeFlags,rest=(0,_objectWithoutProperties2["default"])(_ref7,_excluded3);(0,_get2["default"])((0,_getPrototypeOf2["default"])(BaseExtension.prototype),"updateState",this).call(this,_objectSpread({props:props,oldProps:oldProps,changeFlags:changeFlags},rest));if(props.colormap!==oldProps.colormap){var gl=this.context.gl;if(this.state.model){this.state.model["delete"]();this.setState({model:this._getModel(gl)});}}}}]);return BaseExtension;}(_core.LayerExtension);BaseExtension.extensionName='BaseExtension';BaseExtension.defaultProps=defaultProps$6;var RENDERING_MODES_COLORMAP=(_RENDERING_MODES_COLO={},(0,_defineProperty2["default"])(_RENDERING_MODES_COLO,RENDERING_MODES.MAX_INTENSITY_PROJECTION,{_BEFORE_RENDER:"      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);\n    ",_RENDER:"    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] > maxVals[i]) {\n          maxVals[i] = intensityArray[i];\n        }\n      }\n    ",_AFTER_RENDER:"      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        total += maxVals[i];\n      }\n      // Do not go past 1 in opacity/colormap value.\n      total = min(total, 1.0);\n      color = colormap(total, total);\n    "}),(0,_defineProperty2["default"])(_RENDERING_MODES_COLO,RENDERING_MODES.MIN_INTENSITY_PROJECTION,{_BEFORE_RENDER:"      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);\n    ",_RENDER:"    \n      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\n      for(int i = 0; i < 6; i++) {\n        if(intensityArray[i] < minVals[i]) {\n          minVals[i] = intensityArray[i];\n        }\n      }\n    ",_AFTER_RENDER:"      float total = 0.0;\n      for(int i = 0; i < 6; i++) {\n        total += minVals[i];\n      }\n      // Do not go past 1 in opacity/colormap value.\n      total = min(total, 1.0);\n      color = colormap(total, total);\n    "}),(0,_defineProperty2["default"])(_RENDERING_MODES_COLO,RENDERING_MODES.ADDITIVE,{_BEFORE_RENDER:"",_RENDER:"    float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);\n\t\tfloat total = 0.0;\n\n\t\tfor(int i = 0; i < 6; i++) {\n\t\t\ttotal += intensityArray[i];\n\t\t}\n\t\t// Do not go past 1 in opacity/colormap value.\n\t\ttotal = min(total, 1.0);\n\n\t\tvec4 val_color = colormap(total, total);\n\n\t\t// Opacity correction\n\t\tval_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);\n\t\tcolor.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n\t\tcolor.a += (1.0 - color.a) * val_color.a;\n\t\tif (color.a >= 0.95) {\n\t\t\tbreak;\n\t\t}\n    p += ray_dir * dt;\n    ",_AFTER_RENDER:""}),_RENDERING_MODES_COLO);/**
 * This deck.gl extension allows for an additive colormap like viridis or jet to be used for pseudo-coloring channels with Additive Blending in 3D.
 * */var AdditiveBlendExtension=/*#__PURE__*/function(_BaseExtension){(0,_inherits2["default"])(AdditiveBlendExtension,_BaseExtension);var _super13=_createSuper(AdditiveBlendExtension);function AdditiveBlendExtension(args){var _this6;(0,_classCallCheck2["default"])(this,AdditiveBlendExtension);_this6=_super13.call(this,args);_this6.opts.rendering=RENDERING_MODES_COLORMAP[RENDERING_MODES.ADDITIVE];return _this6;}return(0,_createClass2["default"])(AdditiveBlendExtension);}(BaseExtension);AdditiveBlendExtension.extensionName='AdditiveBlendExtension';/**
 * This deck.gl extension allows for an additive colormap like viridis or jet to be used for pseudo-coloring channels with Maximum Intensity Projection in 3D.
 * */var MaximumIntensityProjectionExtension=/*#__PURE__*/function(_BaseExtension2){(0,_inherits2["default"])(MaximumIntensityProjectionExtension,_BaseExtension2);var _super14=_createSuper(MaximumIntensityProjectionExtension);function MaximumIntensityProjectionExtension(args){var _this7;(0,_classCallCheck2["default"])(this,MaximumIntensityProjectionExtension);_this7=_super14.call(this,args);_this7.opts.rendering=RENDERING_MODES_COLORMAP[RENDERING_MODES.MAX_INTENSITY_PROJECTION];return _this7;}return(0,_createClass2["default"])(MaximumIntensityProjectionExtension);}(BaseExtension);MaximumIntensityProjectionExtension.extensionName='MaximumIntensityProjectionExtension';/**
 * This deck.gl extension allows for an additive colormap like viridis or jet to be used for pseudo-coloring channels with Minimum Intensity Projection in 3D.
 */var MinimumIntensityProjectionExtension=/*#__PURE__*/function(_BaseExtension3){(0,_inherits2["default"])(MinimumIntensityProjectionExtension,_BaseExtension3);var _super15=_createSuper(MinimumIntensityProjectionExtension);function MinimumIntensityProjectionExtension(args){var _this8;(0,_classCallCheck2["default"])(this,MinimumIntensityProjectionExtension);_this8=_super15.call(this,args);_this8.opts.rendering=RENDERING_MODES_COLORMAP[RENDERING_MODES.MIN_INTENSITY_PROJECTION];return _this8;}return(0,_createClass2["default"])(MinimumIntensityProjectionExtension);}(BaseExtension);MinimumIntensityProjectionExtension.extensionName='MinimumIntensityProjectionExtension';/**
 * This object contains the BaseExtension, which can be extended for other additive colormap-style (i.e viridis, jet etc.) rendering, as well
 * implementations of three ray casting algorithms as extensions.
 * @typedef Extension3D
 * @type {object}
 * @property {object} BaseExtension
 * @property {object} AdditiveBlendExtension
 * @property {object} MaximumIntensityProjectionExtension
 * @property {object} MinimumIntensityProjectionExtension
 */var AdditiveColormap3DExtensions={BaseExtension:BaseExtension,AdditiveBlendExtension:AdditiveBlendExtension,MaximumIntensityProjectionExtension:MaximumIntensityProjectionExtension,MinimumIntensityProjectionExtension:MinimumIntensityProjectionExtension};exports.AdditiveColormap3DExtensions=AdditiveColormap3DExtensions;var defaultProps$5={pickable:{type:'boolean',value:true,compare:true},coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,contrastLimits:{type:'array',value:[],compare:true},channelsVisible:{type:'array',value:[],compare:true},selections:{type:'array',value:[],compare:true},domain:{type:'array',value:[],compare:true},viewportId:{type:'string',value:'',compare:true},loader:{type:'object',value:{getRaster:function(){var _getRaster=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee(){return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return _context.stop();}}},_callee);}));function getRaster(){return _getRaster.apply(this,arguments);}return getRaster;}(),dtype:'Uint16'},compare:true},onClick:{type:'function',value:null,compare:true},onViewportLoad:{type:'function',value:null,compare:true},interpolation:{type:'number',value:_constants["default"].NEAREST,compare:true},extensions:{type:'array',value:[new ColorPaletteExtension()],compare:true}};/**
 * @typedef LayerProps
 * @type {Object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {Object} loader PixelSource. Represents an N-dimensional image.
 * @property {Array} selections Selection to be used for fetching data.
 * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {string=} viewportId Id for the current view.  This needs to match the viewState id in deck.gl and is necessary for the lens.
 * @property {function=} onHover Hook function from deck.gl to handle hover objects.
 * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.
 * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.
 * @property {function=} onViewportLoad Function that gets called when the data in the viewport loads.
 * @property {String=} id Unique identifier for this layer.
 * @property {Array=} extensions [deck.gl extensions](https://deck.gl/docs/developer-guide/custom-layers/layer-extensions) to add to the layers.
 */ /**
 * @type {{ new <S extends string[]>(...props: import('../types').Viv<LayerProps, S>[]) }}
 * @ignore
 */var ImageLayer=/*#__PURE__*/function(_CompositeLayer2){(0,_inherits2["default"])(ImageLayer,_CompositeLayer2);var _super16=_createSuper(ImageLayer);function ImageLayer(){(0,_classCallCheck2["default"])(this,ImageLayer);return _super16.apply(this,arguments);}(0,_createClass2["default"])(ImageLayer,[{key:"finalizeState",value:function finalizeState(){this.state.abortController.abort();}},{key:"updateState",value:function updateState(_ref8){var _this9=this;var props=_ref8.props,oldProps=_ref8.oldProps;var loaderChanged=props.loader!==oldProps.loader;var selectionsChanged=props.selections!==oldProps.selections;if(loaderChanged||selectionsChanged){// Only fetch new data to render if loader has changed
var _this$props11=this.props,loader=_this$props11.loader,_this$props11$selecti=_this$props11.selections,selections=_this$props11$selecti===void 0?[]:_this$props11$selecti,onViewportLoad=_this$props11.onViewportLoad;var abortController=new AbortController();this.setState({abortController:abortController});var signal=abortController.signal;var getRaster=function getRaster(selection){return loader.getRaster({selection:selection,signal:signal});};var dataPromises=selections.map(getRaster);Promise.all(dataPromises).then(function(rasters){var raster={data:rasters.map(function(d){return d.data;}),width:rasters[0].width,height:rasters[0].height};if(isInterleaved(loader.shape)){// data is for BitmapLayer and needs to be of form { data: Uint8Array, width, height };
// eslint-disable-next-line prefer-destructuring
raster.data=raster.data[0];if(raster.data.length===raster.width*raster.height*3){// data is RGB (not RGBA) and need to update texture formats
raster.format=_constants["default"].RGB;raster.dataFormat=_constants["default"].RGB;}}if(onViewportLoad){onViewportLoad(raster);}_this9.setState(_objectSpread({},raster));})["catch"](function(e){if(e!==SIGNAL_ABORTED){throw e;// re-throws error if not our signal
}});}}// eslint-disable-next-line class-methods-use-this
},{key:"getPickingInfo",value:function getPickingInfo(_ref9){var info=_ref9.info,sourceLayer=_ref9.sourceLayer;// eslint-disable-next-line no-param-reassign
info.sourceLayer=sourceLayer;// eslint-disable-next-line no-param-reassign
info.tile=sourceLayer.props.tile;return info;}},{key:"renderLayers",value:function renderLayers(){var _this$props12=this.props,loader=_this$props12.loader,id=_this$props12.id;var dtype=loader.dtype;var _this$state5=this.state,width=_this$state5.width,height=_this$state5.height,data=_this$state5.data;if(!(width&&height))return null;var bounds=[0,height,width,0];if(isInterleaved(loader.shape)){var _loader$meta$photomet=loader.meta.photometricInterpretation,photometricInterpretation=_loader$meta$photomet===void 0?2:_loader$meta$photomet;return new BitmapLayer(this.props,{image:this.state,photometricInterpretation:photometricInterpretation,// Shared props with XRLayer:
bounds:bounds,id:"image-sub-layer-".concat(bounds,"-").concat(id),extensions:[]});}return new XRLayer(this.props,{channelData:{data:data,height:height,width:width},// Shared props with BitmapLayer:
bounds:bounds,id:"image-sub-layer-".concat(bounds,"-").concat(id),dtype:dtype});}}]);return ImageLayer;}(_core.CompositeLayer);exports.ImageLayer=ImageLayer;ImageLayer.layerName='ImageLayer';ImageLayer.defaultProps=defaultProps$5;var defaultProps$4={pickable:{type:'boolean',value:true,compare:true},onHover:{type:'function',value:null,compare:false},contrastLimits:{type:'array',value:[],compare:true},channelsVisible:{type:'array',value:[],compare:true},domain:{type:'array',value:[],compare:true},viewportId:{type:'string',value:'',compare:true},maxRequests:{type:'number',value:10,compare:true},onClick:{type:'function',value:null,compare:true},refinementStrategy:{type:'string',value:null,compare:true},excludeBackground:{type:'boolean',value:false,compare:true},extensions:{type:'array',value:[new ColorPaletteExtension()],compare:true}};/**
 * @typedef LayerProps
 * @type {object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {Array} loader Image pyramid. PixelSource[], where each PixelSource is decreasing in shape.
 * @property {Array} selections Selection to be used for fetching data.
 * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {string=} viewportId Id for the current view.  This needs to match the viewState id in deck.gl and is necessary for the lens.
 * @property {String=} id Unique identifier for this layer.
 * @property {function=} onTileError Custom override for handle tile fetching errors.
 * @property {function=} onHover Hook function from deck.gl to handle hover objects.
 * @property {number=} maxRequests Maximum parallel ongoing requests allowed before aborting.
 * @property {function=} onClick Hook function from deck.gl to handle clicked-on objects.
 * @property {Object=} modelMatrix Math.gl Matrix4 object containing an affine transformation to be applied to the image.
 * @property {string=} refinementStrategy 'best-available' | 'no-overlap' | 'never' will be passed to TileLayer. A default will be chosen based on opacity.
 * @property {boolean=} excludeBackground Whether to exclude the background image. The background image is also excluded for opacity!=1.
 * @property {Array=} extensions [deck.gl extensions](https://deck.gl/docs/developer-guide/custom-layers/layer-extensions) to add to the layers.
 */ /**
 * @type {{ new <S extends string[]>(...props: import('../../types').Viv<LayerProps, S>[]) }}
 * @ignore
 */var MultiscaleImageLayer=/*#__PURE__*/function(_CompositeLayer3){(0,_inherits2["default"])(MultiscaleImageLayer,_CompositeLayer3);var _super17=_createSuper(MultiscaleImageLayer);function MultiscaleImageLayer(){(0,_classCallCheck2["default"])(this,MultiscaleImageLayer);return _super17.apply(this,arguments);}(0,_createClass2["default"])(MultiscaleImageLayer,[{key:"renderLayers",value:function renderLayers(){var _this$props13=this.props,loader=_this$props13.loader,selections=_this$props13.selections,opacity=_this$props13.opacity,viewportId=_this$props13.viewportId,onTileError=_this$props13.onTileError,onHover=_this$props13.onHover,id=_this$props13.id,onClick=_this$props13.onClick,modelMatrix=_this$props13.modelMatrix,excludeBackground=_this$props13.excludeBackground,refinementStrategy=_this$props13.refinementStrategy;// Get properties from highest resolution
var _loader$=loader[0],tileSize=_loader$.tileSize,dtype=_loader$.dtype;// This is basically to invert:
// https://github.com/visgl/deck.gl/pull/4616/files#diff-4d6a2e500c0e79e12e562c4f1217dc80R128
// The z level can be wrong for showing the correct scales because of the calculation deck.gl does
// so we need to invert it for fetching tiles and minZoom/maxZoom.
var getTileData=/*#__PURE__*/function(){var _ref11=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee2(_ref10){var x,y,z,signal,resolution,getTile,tiles,tile;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:x=_ref10.x,y=_ref10.y,z=_ref10.z,signal=_ref10.signal;if(!(!selections||selections.length===0)){_context2.next=3;break;}return _context2.abrupt("return",null);case 3:// I don't fully undertstand why this works, but I have a sense.
// It's basically to cancel out:
// https://github.com/visgl/deck.gl/pull/4616/files#diff-4d6a2e500c0e79e12e562c4f1217dc80R128,
// which felt odd to me to beign with.
// The image-tile example works without, this but I have a feeling there is something
// going on with our pyramids and/or rendering that is different.
resolution=Math.round(-z);getTile=function getTile(selection){var config={x:x,y:y,selection:selection,signal:signal};return loader[resolution].getTile(config);};_context2.prev=5;_context2.next=8;return Promise.all(selections.map(getTile));case 8:tiles=_context2.sent;tile={data:tiles.map(function(d){return d.data;}),width:tiles[0].width,height:tiles[0].height};if(!isInterleaved(loader[resolution].shape)){_context2.next=14;break;}// eslint-disable-next-line prefer-destructuring
tile.data=tile.data[0];if(tile.data.length===tile.width*tile.height*3){tile.format=_constants["default"].RGB;tile.dataFormat=_constants["default"].RGB;// is this not properly inferred?
}// can just return early, no need  to check for webgl2
return _context2.abrupt("return",tile);case 14:return _context2.abrupt("return",tile);case 17:_context2.prev=17;_context2.t0=_context2["catch"](5);if(!(_context2.t0===SIGNAL_ABORTED)){_context2.next=21;break;}return _context2.abrupt("return",null);case 21:throw _context2.t0;case 22:case"end":return _context2.stop();}}},_callee2,null,[[5,17]]);}));return function getTileData(_x){return _ref11.apply(this,arguments);};}();var _getImageSize2=getImageSize(loader[0]),height=_getImageSize2.height,width=_getImageSize2.width;var tiledLayer=new MultiscaleImageLayerBase(this.props,{id:"Tiled-Image-".concat(id),getTileData:getTileData,dtype:dtype,tileSize:tileSize,// If you scale a matrix up or down, that is like zooming in or out.  zoomOffset controls
// how the zoom level you fetch tiles at is offset, allowing us to fetch higher resolution tiles
// while at a lower "absolute" zoom level.  If you didn't use this prop, an image that is scaled
// up would always look "low resolution" no matter the level of the image pyramid you are looking at.
zoomOffset:Math.round(Math.log2(modelMatrix?modelMatrix.getScale()[0]:1)),extent:[0,0,width,height],// See the above note within for why the use of zoomOffset and the rounding necessary.
minZoom:Math.round(-(loader.length-1)),maxZoom:0,// We want a no-overlap caching strategy with an opacity < 1 to prevent
// multiple rendered sublayers (some of which have been cached) from overlapping
refinementStrategy:refinementStrategy||(opacity===1?'best-available':'no-overlap'),// TileLayer checks `changeFlags.updateTriggersChanged.getTileData` to see if tile cache
// needs to be re-created. We want to trigger this behavior if the loader changes.
// https://github.com/uber/deck.gl/blob/3f67ea6dfd09a4d74122f93903cb6b819dd88d52/modules/geo-layers/src/tile-layer/tile-layer.js#L50
updateTriggers:{getTileData:[loader,selections]},onTileError:onTileError||loader[0].onTileError});// This gives us a background image and also solves the current
// minZoom funny business.  We don't use it for the background if we have an opacity
// paramteter set to anything but 1, but we always use it for situations where
// we are zoomed out too far.
var lowestResolution=loader[loader.length-1];var implementsGetRaster=typeof lowestResolution.getRaster==='function';var layerModelMatrix=modelMatrix?modelMatrix.clone():new _math.Matrix4();var baseLayer=implementsGetRaster&&!excludeBackground&&new ImageLayer(this.props,{id:"Background-Image-".concat(id),loader:lowestResolution,modelMatrix:layerModelMatrix.scale(Math.pow(2,loader.length-1)),visible:!viewportId||this.context.viewport.id===viewportId,onHover:onHover,onClick:onClick,// Background image is nicest when LINEAR in my opinion.
interpolation:_constants["default"].LINEAR,onViewportLoad:null});var layers=[baseLayer,tiledLayer];return layers;}}]);return MultiscaleImageLayer;}(_core.CompositeLayer);exports.MultiscaleImageLayer=MultiscaleImageLayer;MultiscaleImageLayer.layerName='MultiscaleImageLayer';MultiscaleImageLayer.defaultProps=defaultProps$4;var defaultProps$3={pickable:{type:'boolean',value:true,compare:true},loader:{type:'object',value:{getRaster:function(){var _getRaster2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee3(){return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return _context3.stop();}}},_callee3);}));function getRaster(){return _getRaster2.apply(this,arguments);}return getRaster;}(),getRasterSize:function getRasterSize(){return{height:0,width:0};},dtype:'<u2'},compare:true},id:{type:'string',value:'',compare:true},boundingBox:{type:'array',value:[[0,0],[0,1],[1,1],[1,0]],compare:true},boundingBoxColor:{type:'array',value:[255,0,0],compare:true},boundingBoxOutlineWidth:{type:'number',value:1,compare:true},viewportOutlineColor:{type:'array',value:[255,190,0],compare:true},viewportOutlineWidth:{type:'number',value:2,compare:true},overviewScale:{type:'number',value:1,compare:true},zoom:{type:'number',value:1,compare:true}};/**
 * @typedef LayerProps
 * @type {Object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<Array.<number>>} colors List of [r, g, b] values for each channel.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {Array} loader PixelSource[]. Assumes multiscale if loader.length > 1.
 * @property {Array} selections Selection to be used for fetching data.
 * @property {number=} opacity Opacity of the layer.
 * @property {string=} colormap String indicating a colormap (default: '').  The full list of options is here: https://github.com/glslify/glsl-colormap#glsl-colormap
 * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {Array.<number>=} boundingBoxColor [r, g, b] color of the bounding box (default: [255, 0, 0]).
 * @property {number=} boundingBoxOutlineWidth Width of the bounding box in px (default: 1).
 * @property {Array.<number>=} viewportOutlineColor [r, g, b] color of the outline (default: [255, 190, 0]).
 * @property {number=} viewportOutlineWidth Viewport outline width in px (default: 2).
 * @property {String=} id Unique identifier for this layer.
 */ /**
 * @type {{ new <S extends string[]>(...props: import('../types').Viv<LayerProps, S>[]) }}
 * @ignore
 */var OverviewLayer=/*#__PURE__*/function(_CompositeLayer4){(0,_inherits2["default"])(OverviewLayer,_CompositeLayer4);var _super18=_createSuper(OverviewLayer);function OverviewLayer(){(0,_classCallCheck2["default"])(this,OverviewLayer);return _super18.apply(this,arguments);}(0,_createClass2["default"])(OverviewLayer,[{key:"renderLayers",value:function renderLayers(){var _this$props14=this.props,loader=_this$props14.loader,id=_this$props14.id,zoom=_this$props14.zoom,boundingBox=_this$props14.boundingBox,boundingBoxColor=_this$props14.boundingBoxColor,boundingBoxOutlineWidth=_this$props14.boundingBoxOutlineWidth,viewportOutlineColor=_this$props14.viewportOutlineColor,viewportOutlineWidth=_this$props14.viewportOutlineWidth,overviewScale=_this$props14.overviewScale;var _getImageSize3=getImageSize(loader[0]),width=_getImageSize3.width,height=_getImageSize3.height;var z=loader.length-1;var lowestResolution=loader[z];var overview=new ImageLayer(this.props,{id:"viewport-".concat(id),modelMatrix:new _math.Matrix4().scale(Math.pow(2,z)*overviewScale),loader:lowestResolution});var boundingBoxOutline=new _layers.PolygonLayer({id:"bounding-box-overview-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[boundingBox],getPolygon:function getPolygon(f){return f;},filled:false,stroked:true,getLineColor:boundingBoxColor,getLineWidth:boundingBoxOutlineWidth*Math.pow(2,zoom)});var viewportOutline=new _layers.PolygonLayer({id:"viewport-outline-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[[[0,0],[width*overviewScale,0],[width*overviewScale,height*overviewScale],[0,height*overviewScale]]],getPolygon:function getPolygon(f){return f;},filled:false,stroked:true,getLineColor:viewportOutlineColor,getLineWidth:viewportOutlineWidth*Math.pow(2,zoom)});var layers=[overview,boundingBoxOutline,viewportOutline];return layers;}}]);return OverviewLayer;}(_core.CompositeLayer);exports.OverviewLayer=OverviewLayer;OverviewLayer.layerName='OverviewLayer';OverviewLayer.defaultProps=defaultProps$3;function getVivId(id){return"-#".concat(id,"#");}/**
 * Create a boudning box from a viewport based on passed-in viewState.
 * @param {viewState} Object The viewState for a certain viewport.
 * @returns {View} The DeckGL View for this viewport.
 */function makeBoundingBox(viewState){var viewport=new _core.OrthographicView().makeViewport({// From the current `detail` viewState, we need its projection matrix (actually the inverse).
viewState:viewState,height:viewState.height,width:viewState.width});// Use the inverse of the projection matrix to map screen to the view space.
return[viewport.unproject([0,0]),viewport.unproject([viewport.width,0]),viewport.unproject([viewport.width,viewport.height]),viewport.unproject([0,viewport.height])];}/**
 * Create an initial view state that centers the image in the viewport at the zoom level that fills the dimensions in `viewSize`.
 * @param {Object} loader (PixelSource[] | PixelSource)
 * @param {Object} viewSize { height, width } object giving dimensions of the viewport for deducing the right zoom level to center the image.
 * @param {Object=} zoomBackOff A positive number which controls how far zoomed out the view state is from filling the entire viewport (default is 0 so the image fully fills the view).
 * SideBySideViewer and PictureInPictureViewer use .5 when setting viewState automatically in their default behavior, so the viewport is slightly zoomed out from the image
 * filling the whole screen.  1 unit of zoomBackOff (so a passed-in value of 1) corresponds to a 2x zooming out.
 * @param {Boolean=} use3d Whether or not to return a view state that can be used with the 3d viewer
 * @param {Boolean=} modelMatrix If using a transformation matrix, passing it in here will allow this function to properly center the volume.
 * @returns {Object} A default initial view state that centers the image within the view: { target: [x, y, 0], zoom: -zoom }.
 */function getDefaultInitialViewState(loader,viewSize){var zoomBackOff=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var use3d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var modelMatrix=arguments.length>4?arguments[4]:undefined;var source=Array.isArray(loader)?loader[0]:loader;var _getImageSize4=getImageSize(source),width=_getImageSize4.width,height=_getImageSize4.height;var depth=source.shape[source.labels.indexOf('z')];var zoom=Math.log2(Math.min(viewSize.width/width,viewSize.height/height))-zoomBackOff;var physicalSizeScalingMatrix=getPhysicalSizeScalingMatrix(source);var loaderInitialViewState={target:(modelMatrix||new _math.Matrix4()).transformPoint((use3d?physicalSizeScalingMatrix:new _math.Matrix4()).transformPoint([width/2,height/2,use3d?depth/2:0])),zoom:zoom};return loaderInitialViewState;}/**
 * Creates the layers for viewing an image in detail.
 * @param {String} id The identifier of the view.
 * @param {Object} props The layer properties.
 * @returns {Array} An array of layers.
 */function getImageLayer(id,props){var _loader$2,_loader$2$constructor;var loader=props.loader;// Grab name of PixelSource if a class instance (works for Tiff & Zarr).
var sourceName=(_loader$2=loader[0])===null||_loader$2===void 0?void 0:(_loader$2$constructor=_loader$2.constructor)===null||_loader$2$constructor===void 0?void 0:_loader$2$constructor.name;// Create at least one layer even without selections so that the tests pass.
var Layer=loader.length>1?MultiscaleImageLayer:ImageLayer;var layerLoader=loader.length>1?loader:loader[0];return new Layer(_objectSpread(_objectSpread({},props),{},{id:"".concat(sourceName).concat(getVivId(id)),viewportId:id,loader:layerLoader}));}function getPosition(boundingBox,position,length){var viewLength=boundingBox[2][0]-boundingBox[0][0];switch(position){case'bottom-right':{var yCoord=boundingBox[2][1]-(boundingBox[2][1]-boundingBox[0][1])*length;var xLeftCoord=boundingBox[2][0]-viewLength*length;return[yCoord,xLeftCoord];}case'top-right':{var _yCoord=(boundingBox[2][1]-boundingBox[0][1])*length;var _xLeftCoord=boundingBox[2][0]-viewLength*length;return[_yCoord,_xLeftCoord];}case'top-left':{var _yCoord2=(boundingBox[2][1]-boundingBox[0][1])*length;var _xLeftCoord2=viewLength*length;return[_yCoord2,_xLeftCoord2];}case'bottom-left':{var _yCoord3=boundingBox[2][1]-(boundingBox[2][1]-boundingBox[0][1])*length;var _xLeftCoord3=viewLength*length;return[_yCoord3,_xLeftCoord3];}default:{throw new Error("Position ".concat(position," not found"));}}}var defaultProps$2={pickable:{type:'boolean',value:true,compare:true},viewState:{type:'object',value:{zoom:0,target:[0,0,0]},compare:true},unit:{type:'string',value:'',compare:true},size:{type:'number',value:1,compare:true},position:{type:'string',value:'bottom-right',compare:true},length:{type:'number',value:0.085,compare:true}};/**
 * @typedef LayerProps
 * @type {Object}
 * @property {String} unit Physical unit size per pixel at full resolution.
 * @property {Number} size Physical size of a pixel.
 * @property {Object} viewState The current viewState for the desired view.  We cannot internally use this.context.viewport because it is one frame behind:
 * https://github.com/visgl/deck.gl/issues/4504
 * @property {Array=} boundingBox Boudning box of the view in which this should render.
 * @property {string=} id Id from the parent layer.
 * @property {number=} length Value from 0 to 1 representing the portion of the view to be used for the length part of the scale bar.
 */ /**
 * @type {{ new(...props: LayerProps[]) }}
 * @ignore
 */var ScaleBarLayer=/*#__PURE__*/function(_CompositeLayer5){(0,_inherits2["default"])(ScaleBarLayer,_CompositeLayer5);var _super19=_createSuper(ScaleBarLayer);function ScaleBarLayer(){(0,_classCallCheck2["default"])(this,ScaleBarLayer);return _super19.apply(this,arguments);}(0,_createClass2["default"])(ScaleBarLayer,[{key:"renderLayers",value:function renderLayers(){var _this$props15=this.props,id=_this$props15.id,unit=_this$props15.unit,size=_this$props15.size,position=_this$props15.position,viewState=_this$props15.viewState,length=_this$props15.length;var boundingBox=makeBoundingBox(viewState);var zoom=viewState.zoom;var viewLength=boundingBox[2][0]-boundingBox[0][0];var barLength=viewLength*0.05;// This is a good heuristic for stopping the bar tick marks from getting too small
// and/or the text squishing up into the bar.
var barHeight=Math.max(Math.pow(2,-zoom+1.5),(boundingBox[2][1]-boundingBox[0][1])*0.007);var numUnits=barLength*size;var _getPosition=getPosition(boundingBox,position,length),_getPosition2=(0,_slicedToArray2["default"])(_getPosition,2),yCoord=_getPosition2[0],xLeftCoord=_getPosition2[1];var lengthBar=new _layers.LineLayer({id:"scale-bar-length-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[[[xLeftCoord,yCoord],[xLeftCoord+barLength,yCoord]]],getSourcePosition:function getSourcePosition(d){return d[0];},getTargetPosition:function getTargetPosition(d){return d[1];},getWidth:2,getColor:[220,220,220]});var tickBoundsLeft=new _layers.LineLayer({id:"scale-bar-height-left-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[[[xLeftCoord,yCoord-barHeight],[xLeftCoord,yCoord+barHeight]]],getSourcePosition:function getSourcePosition(d){return d[0];},getTargetPosition:function getTargetPosition(d){return d[1];},getWidth:2,getColor:[220,220,220]});var tickBoundsRight=new _layers.LineLayer({id:"scale-bar-height-right-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[[[xLeftCoord+barLength,yCoord-barHeight],[xLeftCoord+barLength,yCoord+barHeight]]],getSourcePosition:function getSourcePosition(d){return d[0];},getTargetPosition:function getTargetPosition(d){return d[1];},getWidth:2,getColor:[220,220,220]});var textLayer=new _layers.TextLayer({id:"units-label-layer-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[{text:numUnits.toPrecision(5)+unit,position:[xLeftCoord+barLength*0.5,yCoord+barHeight*4]}],getColor:[220,220,220,255],getSize:12,fontFamily:DEFAULT_FONT_FAMILY,sizeUnits:'meters',sizeScale:Math.pow(2,-zoom),characterSet:[].concat((0,_toConsumableArray2["default"])(unit.split('')),(0,_toConsumableArray2["default"])(range(10).map(function(i){return String(i);})),['.','e','+'])});return[lengthBar,tickBoundsLeft,tickBoundsRight,textLayer];}}]);return ScaleBarLayer;}(_core.CompositeLayer);exports.ScaleBarLayer=ScaleBarLayer;ScaleBarLayer.layerName='ScaleBarLayer';ScaleBarLayer.defaultProps=defaultProps$2;var vs="#version 300 es\n#define GLSLIFY 1\n#define SHADER_NAME xr-layer-vertex-shader\nin vec3 positions;uniform vec3 eye_pos;uniform mat4 proj;uniform mat4 model;uniform mat4 view;uniform mat4 scale;uniform mat4 resolution;out vec3 vray_dir;flat out vec3 transformed_eye;void main(){gl_Position=proj*view*model*scale*resolution*vec4(positions,1.);/*This first diagram is a skewed volume(i.e a \"shear\" model matrix applied)top down with the eye marked as #,all in world space^___|__\\|\\\\|\\|____|||\n#\nThis next diagram shows the volume after the inverse model matrix has placed it back in model coordinates,but the eye still in world space.^___|___|||||||__|__||||\n#\nFinally,we apply the inverse model matrix transformation to the eye as well to bring it too into world space.Notice that the ray here matches the \"voxels\" through which the first ray also passes,as desired.^____/__|/||/||/____|///\n#\n*/transformed_eye=(inverse(resolution)*inverse(scale)*inverse(model)*(vec4(eye_pos,1.))).xyz;vray_dir=positions-transformed_eye;}";// eslint-disable-line
var fs$1="#version 300 es\nprecision highp int;precision highp float;precision highp SAMPLER_TYPE;\n#define GLSLIFY 1\nuniform highp SAMPLER_TYPE volume0;uniform highp SAMPLER_TYPE volume1;uniform highp SAMPLER_TYPE volume2;uniform highp SAMPLER_TYPE volume3;uniform highp SAMPLER_TYPE volume4;uniform highp SAMPLER_TYPE volume5;uniform vec3 scaledDimensions;uniform mat4 scale;uniform vec3 normals[NUM_PLANES];uniform float distances[NUM_PLANES];uniform vec3 colors[6];uniform vec2 xSlice;uniform vec2 ySlice;uniform vec2 zSlice;uniform vec2 contrastLimits[6];in vec3 vray_dir;flat in vec3 transformed_eye;out vec4 color;vec2 intersect_box(vec3 orig,vec3 dir){vec3 box_min=vec3(xSlice[0],ySlice[0],zSlice[0]);vec3 box_max=vec3(xSlice[1],ySlice[1],zSlice[1]);vec3 inv_dir=1./dir;vec3 tmin_tmp=(box_min-orig)*inv_dir;vec3 tmax_tmp=(box_max-orig)*inv_dir;vec3 tmin=min(tmin_tmp,tmax_tmp);vec3 tmax=max(tmin_tmp,tmax_tmp);float t0=max(tmin.x,max(tmin.y,tmin.z));float t1=min(tmax.x,min(tmax.y,tmax.z));vec2 val=vec2(t0,t1);return val;}float linear_to_srgb(float x){if(x<=0.0031308f){return 12.92f*x;}return 1.055f*pow(x,1.f/2.4f)-0.055f;}float wang_hash(int seed){seed=(seed ^ 61)^(seed>>16);seed*=9;seed=seed ^(seed>>4);seed*=0x27d4eb2d;seed=seed ^(seed>>15);return float(seed % 2147483647)/float(2147483647);}void main(void){vec3 ray_dir=normalize(vray_dir);vec2 t_hit=intersect_box(transformed_eye,ray_dir);if(t_hit.x>t_hit.y){discard;}t_hit.x=max(t_hit.x,0.);vec3 dt_vec=1./(scale*vec4(abs(ray_dir),1.)).xyz;float dt=1.*min(dt_vec.x,min(dt_vec.y,dt_vec.z));float offset=wang_hash(int(gl_FragCoord.x+640.*gl_FragCoord.y));vec3 p=transformed_eye+(t_hit.x+offset*dt)*ray_dir;_BEFORE_RENDERfor(float t=t_hit.x;t<t_hit.y;t+=dt){float canShow=1.;for(int i=0;i<NUM_PLANES;i+=1){canShow*=max(0.,sign(dot(normals[i],p)+distances[i]));}float canShowXCoordinate=max(p.x-0.,0.)*max(1.-p.x,0.);float canShowYCoordinate=max(p.y-0.,0.)*max(1.-p.y,0.);float canShowZCoordinate=max(p.z-0.,0.)*max(1.-p.z,0.);float canShowCoordinate=float(ceil(canShowXCoordinate*canShowYCoordinate*canShowZCoordinate));canShow=canShowCoordinate*canShow;float intensityValue0=float(texture(volume0,p).r);DECKGL_PROCESS_INTENSITY(intensityValue0,contrastLimits[0],0);intensityValue0=canShow*intensityValue0;float intensityValue1=float(texture(volume1,p).r);DECKGL_PROCESS_INTENSITY(intensityValue1,contrastLimits[1],1);intensityValue1=canShow*intensityValue1;float intensityValue2=float(texture(volume2,p).r);DECKGL_PROCESS_INTENSITY(intensityValue2,contrastLimits[2],2);intensityValue2=canShow*intensityValue2;float intensityValue3=float(texture(volume3,p).r);DECKGL_PROCESS_INTENSITY(intensityValue3,contrastLimits[3],3);intensityValue3=canShow*intensityValue3;float intensityValue4=float(texture(volume4,p).r);DECKGL_PROCESS_INTENSITY(intensityValue4,contrastLimits[4],4);intensityValue4=canShow*intensityValue4;float intensityValue5=float(texture(volume5,p).r);DECKGL_PROCESS_INTENSITY(intensityValue5,contrastLimits[5],5);intensityValue5=canShow*intensityValue5;_RENDERp+=ray_dir*dt;}_AFTER_RENDERcolor.r=linear_to_srgb(color.r);color.g=linear_to_srgb(color.g);color.b=linear_to_srgb(color.b);}";// eslint-disable-line
var fs="#define GLSLIFY 1\nfloat apply_contrast_limits(float intensity,vec2 contrastLimits){float contrastLimitsAppliedToIntensity=(intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0]));return max(0.,contrastLimitsAppliedToIntensity);}";// eslint-disable-line
var channels={name:'channel-intensity-module',fs:fs};/* This is largely an adaptation of Will Usher's excellent blog post/code:
https://github.com/Twinklebear/webgl-volume-raycaster
Without his app, this would have been exponentially more difficult to do, so we thank him dearly.

The major changes are:

- Code has been adapted to the luma.gl/deck.gl framework instead of more-or-less pure WebGL.

- We use a coordinate system that will allow overlays/other figures on our vertex shader/javascript via the `uniform mat4 scale` that matches raw pixel size multiplied by
the ratio of physical sizes (if present) to the world space, just like our 2D layers.  Will implements everything in a unit cube (I think?) centered at the origin.

- We use an OrbitView which is a similar camera to what Will has, but stops gimbal lock from happening
by stopping full rotations whereas Will implements a camera that allows for full rotations without gimbal lock via quaternions.
We have an open issue for implementing this deck.gl: https://github.com/visgl/deck.gl/issues/5364

- We have a multi-channel use case and have a few tweaks in the fragment shader to handle that.

- We convert all of our data to Float32Array so we can use LINEAR sampling while also maintaing the dynamic range and integrity of the data.

- Will uses a colormap via a sampled texture, which is a very good idea, but not something we are geared up for in 2D, so not something we will do in 3D either: 
https://github.com/visgl/luma.gl/issues/1415

- We allow for multiple rendering settings (Max/Min Int. Proj., Additive, etc.)

- We allow for arbtirary affine transformations via deck.gl's modelMatrix prop and have updated the vertex shader accordingly.
More information about that is detailed in the comments there.
*/ // prettier-ignore
var CUBE_STRIP=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0];var NUM_PLANES_DEFAULT=1;var defaultProps$1={pickable:false,coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,channelData:{type:'object',value:{},compare:true},contrastLimits:{type:'array',value:[],compare:true},dtype:{type:'string',value:'Uint8',compare:true},xSlice:{type:'array',value:null,compare:true},ySlice:{type:'array',value:null,compare:true},zSlice:{type:'array',value:null,compare:true},clippingPlanes:{type:'array',value:[],compare:true},resolutionMatrix:{type:'object',value:new _math.Matrix4(),compare:true},channelsVisible:{type:'array',value:[],compare:true},extensions:{type:'array',value:[new ColorPalette3DExtensions.AdditiveBlendExtension()],compare:true}};function getRenderingAttrs(){var values=getDtypeValues('Float32');return _objectSpread(_objectSpread({},values),{},{sampler:values.sampler.replace('2D','3D'),cast:function cast(data){return new Float32Array(data);}});}function getRenderingFromExtensions(extensions){var rendering={};extensions.forEach(function(extension){rendering=extension.opts.rendering;});if(!rendering._RENDER){throw new Error('XR3DLayer requires at least one extension to define opts.rendering as an object with _RENDER as a property at the minimum.');}return rendering;}/**
 * @typedef LayerProps
 * @type {Object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {string} dtype Dtype for the layer.
 * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {Object=} modelMatrix A column major affine transformation to be applied to the volume.
 * @property {Array.<number>=} xSlice 0-width (physical coordinates) interval on which to slice the volume.
 * @property {Array.<number>=} ySlice 0-height (physical coordinates) interval on which to slice the volume.
 * @property {Array.<number>=} zSlice 0-depth (physical coordinates) interval on which to slice the volume.
 * @property {Array.<Object>=} clippingPlanes List of math.gl [Plane](https://math.gl/modules/culling/docs/api-reference/plane) objects.
 * @property {Object=} resolutionMatrix Matrix for scaling the volume based on the (downsampled) resolution being displayed.
 * @property {Array=} extensions [deck.gl extensions](https://deck.gl/docs/developer-guide/custom-layers/layer-extensions) to add to the layers - default is AdditiveBlendExtension from ColorPalette3DExtensions.
 */ /**
 * @type {{ new <S extends string[]>(...props: import('../../../types').Viv<LayerProps>[]) }}
 * @ignore
 */var XR3DLayer=/*#__PURE__*/function(_Layer2){(0,_inherits2["default"])(XR3DLayer,_Layer2);var _super20=_createSuper(XR3DLayer);function XR3DLayer(){(0,_classCallCheck2["default"])(this,XR3DLayer);return _super20.apply(this,arguments);}(0,_createClass2["default"])(XR3DLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;// This tells WebGL how to read row data from the texture.  For example, the default here is 4 (i.e for RGBA, one byte per channel) so
// each row of data is expected to be a multiple of 4.  This setting (i.e 1) allows us to have non-multiple-of-4 row sizes.  For example, for 2 byte (16 bit data),
// we could use 2 as the value and it would still work, but 1 also works fine (and is more flexible for 8 bit - 1 byte - textures as well).
// https://stackoverflow.com/questions/42789896/webgl-error-arraybuffer-not-big-enough-for-request-in-case-of-gl-luminance
gl.pixelStorei(_constants["default"].UNPACK_ALIGNMENT,1);gl.pixelStorei(_constants["default"].PACK_ALIGNMENT,1);var programManager=_engine.ProgramManager.getDefaultProgramManager(gl);var processStr="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";if(!programManager._hookFunctions.includes(processStr)){programManager.addShaderHook(processStr);}}},{key:"_isHookDefinedByExtensions",value:function _isHookDefinedByExtensions(hookName){var extensions=this.props.extensions;return extensions===null||extensions===void 0?void 0:extensions.some(function(e){var shaders=e.getShaders();if(shaders){var _shaders$inject2=shaders.inject,inject=_shaders$inject2===void 0?{}:_shaders$inject2,_shaders$modules2=shaders.modules,modules=_shaders$modules2===void 0?[]:_shaders$modules2;var definesInjection=inject[hookName];var moduleDefinesInjection=modules.some(function(m){return m.inject&&(m===null||m===void 0?void 0:m.inject[hookName]);});return definesInjection||moduleDefinesInjection;}return false;});}/**
   * This function compiles the shaders and the projection module.
   */},{key:"getShaders",value:function getShaders(){var _this$props16=this.props,clippingPlanes=_this$props16.clippingPlanes,extensions=_this$props16.extensions;var _getRenderingAttrs=getRenderingAttrs(),sampler=_getRenderingAttrs.sampler;var _getRenderingFromExte=getRenderingFromExtensions(extensions),_BEFORE_RENDER=_getRenderingFromExte._BEFORE_RENDER,_RENDER=_getRenderingFromExte._RENDER,_AFTER_RENDER=_getRenderingFromExte._AFTER_RENDER;var extensionDefinesDeckglProcessIntensity=this._isHookDefinedByExtensions('fs:DECKGL_PROCESS_INTENSITY');var newChannelsModule=_objectSpread({inject:{}},channels);if(!extensionDefinesDeckglProcessIntensity){newChannelsModule.inject['fs:DECKGL_PROCESS_INTENSITY']="\n        intensity = apply_contrast_limits(intensity, contrastLimits);\n      ";}return(0,_get2["default"])((0,_getPrototypeOf2["default"])(XR3DLayer.prototype),"getShaders",this).call(this,{vs:vs,fs:fs$1.replace('_BEFORE_RENDER',_BEFORE_RENDER).replace('_RENDER',_RENDER).replace('_AFTER_RENDER',_AFTER_RENDER),defines:{SAMPLER_TYPE:sampler,NUM_PLANES:String(clippingPlanes.length||NUM_PLANES_DEFAULT)},modules:[newChannelsModule]});}/**
   * This function finalizes state by clearing all textures from the WebGL context
   */},{key:"finalizeState",value:function finalizeState(){(0,_get2["default"])((0,_getPrototypeOf2["default"])(XR3DLayer.prototype),"finalizeState",this).call(this);if(this.state.textures){Object.values(this.state.textures).forEach(function(tex){return tex&&tex["delete"]();});}}/**
   * This function updates state by retriggering model creation (shader compilation and attribute binding)
   * and loading any textures that need be loading.
   */},{key:"updateState",value:function updateState(_ref12){var _props$channelData2,_oldProps$channelData2;var props=_ref12.props,oldProps=_ref12.oldProps,changeFlags=_ref12.changeFlags;// setup model first
if(changeFlags.extensionsChanged||props.colormap!==oldProps.colormap||props.renderingMode!==oldProps.renderingMode||props.clippingPlanes.length!==oldProps.clippingPlanes.length){var gl=this.context.gl;if(this.state.model){this.state.model["delete"]();}this.setState({model:this._getModel(gl)});}if(props.channelData&&(props===null||props===void 0?void 0:(_props$channelData2=props.channelData)===null||_props$channelData2===void 0?void 0:_props$channelData2.data)!==(oldProps===null||oldProps===void 0?void 0:(_oldProps$channelData2=oldProps.channelData)===null||_oldProps$channelData2===void 0?void 0:_oldProps$channelData2.data)){this.loadTexture(props.channelData);}}/**
   * This function creates the luma.gl model.
   */},{key:"_getModel",value:function _getModel(gl){if(!gl){return null;}return new _core2.Model(gl,_objectSpread(_objectSpread({},this.getShaders()),{},{geometry:new _core2.Geometry({drawMode:gl.TRIANGLE_STRIP,attributes:{positions:new Float32Array(CUBE_STRIP)}})}));}/**
   * This function runs the shaders and draws to the canvas
   */},{key:"draw",value:function draw(_ref13){var uniforms=_ref13.uniforms;var _this$state6=this.state,textures=_this$state6.textures,model=_this$state6.model,scaleMatrix=_this$state6.scaleMatrix;var _this$props17=this.props,contrastLimits=_this$props17.contrastLimits,xSlice=_this$props17.xSlice,ySlice=_this$props17.ySlice,zSlice=_this$props17.zSlice,modelMatrix=_this$props17.modelMatrix,channelsVisible=_this$props17.channelsVisible,domain=_this$props17.domain,dtype=_this$props17.dtype,clippingPlanes=_this$props17.clippingPlanes,resolutionMatrix=_this$props17.resolutionMatrix;var _this$context$viewpor=this.context.viewport,viewMatrix=_this$context$viewpor.viewMatrix,viewMatrixInverse=_this$context$viewpor.viewMatrixInverse,projectionMatrix=_this$context$viewpor.projectionMatrix;if(textures&&model&&scaleMatrix){var paddedContrastLimits=padContrastLimits({contrastLimits:contrastLimits,channelsVisible:channelsVisible,domain:domain,dtype:dtype});var invertedScaleMatrix=scaleMatrix.clone().invert();var invertedResolutionMatrix=resolutionMatrix.clone().invert();var paddedClippingPlanes=padWithDefault(clippingPlanes.map(function(p){return p.clone().transform(invertedScaleMatrix).transform(invertedResolutionMatrix);}),new _culling.Plane([1,0,0]),clippingPlanes.length||NUM_PLANES_DEFAULT);// Need to flatten for shaders.
var normals=paddedClippingPlanes.map(function(plane){return plane.normal;}).flat();var distances=paddedClippingPlanes.map(function(plane){return plane.distance;});model.setUniforms(_objectSpread(_objectSpread(_objectSpread({},uniforms),textures),{},{contrastLimits:paddedContrastLimits,xSlice:new Float32Array(xSlice?xSlice.map(function(i){return i/scaleMatrix[0]/resolutionMatrix[0];}):[0,1]),ySlice:new Float32Array(ySlice?ySlice.map(function(i){return i/scaleMatrix[5]/resolutionMatrix[5];}):[0,1]),zSlice:new Float32Array(zSlice?zSlice.map(function(i){return i/scaleMatrix[10]/resolutionMatrix[10];}):[0,1]),eye_pos:new Float32Array([viewMatrixInverse[12],viewMatrixInverse[13],viewMatrixInverse[14]]),view:viewMatrix,proj:projectionMatrix,scale:scaleMatrix,resolution:resolutionMatrix,model:modelMatrix||new _math.Matrix4(),normals:normals,distances:distances})).draw();}}/**
   * This function loads all textures from incoming resolved promises/data from the loaders by calling `dataToTexture`
   */},{key:"loadTexture",value:function loadTexture(channelData){var _this10=this;var textures={volume0:null,volume1:null,volume2:null,volume3:null,volume4:null,volume5:null};if(this.state.textures){Object.values(this.state.textures).forEach(function(tex){return tex&&tex["delete"]();});}if(channelData&&Object.keys(channelData).length>0&&channelData.data){var height=channelData.height,width=channelData.width,depth=channelData.depth;channelData.data.forEach(function(d,i){textures["volume".concat(i)]=_this10.dataToTexture(d,width,height,depth);},this);this.setState({textures:textures,scaleMatrix:new _math.Matrix4().scale(this.props.physicalSizeScalingMatrix.transformPoint([width,height,depth]))});}}/**
   * This function creates textures from the data
   */},{key:"dataToTexture",value:function dataToTexture(data,width,height,depth){var _attrs$cast3,_attrs$cast4,_parameters2;var attrs=getRenderingAttrs();var texture=new _core2.Texture3D(this.context.gl,{width:width,height:height,depth:depth,data:(_attrs$cast3=(_attrs$cast4=attrs.cast)===null||_attrs$cast4===void 0?void 0:_attrs$cast4.call(attrs,data))!==null&&_attrs$cast3!==void 0?_attrs$cast3:data,// ? Seems to be a luma.gl bug.  Looks like Texture2D is wrong or this is but these are flipped somewhere.
format:attrs.dataFormat,dataFormat:attrs.format,type:attrs.type,mipmaps:false,parameters:(_parameters2={},(0,_defineProperty2["default"])(_parameters2,_constants["default"].TEXTURE_MIN_FILTER,_constants["default"].LINEAR),(0,_defineProperty2["default"])(_parameters2,_constants["default"].TEXTURE_MAG_FILTER,_constants["default"].LINEAR),(0,_defineProperty2["default"])(_parameters2,_constants["default"].TEXTURE_WRAP_S,_constants["default"].CLAMP_TO_EDGE),(0,_defineProperty2["default"])(_parameters2,_constants["default"].TEXTURE_WRAP_T,_constants["default"].CLAMP_TO_EDGE),(0,_defineProperty2["default"])(_parameters2,_constants["default"].TEXTURE_WRAP_R,_constants["default"].CLAMP_TO_EDGE),_parameters2)});return texture;}}]);return XR3DLayer;}(_core.Layer);exports.XR3DLayer=XR3DLayer;XR3DLayer.layerName='XR3DLayer';XR3DLayer.defaultProps=defaultProps$1;/* global globalThis */ /**
 * Creates a single continguous TypedArray that can visualized as a volume in 3D space where the y-axis going up is positive,
 * the x-axis going right is positive, and the z-axis coming out of the screen is positive.
 * To do this, and keep the orientation, we must anti-diagonally transpose each slice of raster data so that the (0, 0) data point is transformed
 * to the top right.  If you start the camera looking at the 0th slice (or rotate from looking at the final slice) in 3D, this becomes more apparent.
 * Of note here is that in 2D rendering, the y-axis is positive in the downward direction.
 *
 * @param {object} props
 * @param {object} props.source PixelSource
 * @param {object} props.selection A single selection for the PixelSource
 * @param {object} props.onUpdate A callback for progress that is called twice during the loading of each plane, once when the promsie resolves and once when it is loaded into the final contiguous buffer.
 * @param {object} props.downsampleDepth This is the number by which to downsample on the z direction, usually `2 ** resolution` where `resolution` is that of the `PixelSource` in the image pyramid.
 * The idea here is to get every `downsampleDepth` raster slice so that proper scaling is maintained (just liek a 2D image pyramid).
 * @return {TypedArray}
 * @ignore
 */function getVolume(_x2){return _getVolume.apply(this,arguments);}function _getVolume(){_getVolume=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee18(_ref14){var source,selection,_ref14$onUpdate,onUpdate,_ref14$downsampleDept,downsampleDepth,signal,shape,labels,dtype,_getImageSize8,height,width,depth,depthDownsampled,rasterSize,name,TypedArray,volumeData;return _regenerator["default"].wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:source=_ref14.source,selection=_ref14.selection,_ref14$onUpdate=_ref14.onUpdate,onUpdate=_ref14$onUpdate===void 0?function(){}:_ref14$onUpdate,_ref14$downsampleDept=_ref14.downsampleDepth,downsampleDepth=_ref14$downsampleDept===void 0?1:_ref14$downsampleDept,signal=_ref14.signal;shape=source.shape,labels=source.labels,dtype=source.dtype;_getImageSize8=getImageSize(source),height=_getImageSize8.height,width=_getImageSize8.width;depth=shape[labels.indexOf('z')];depthDownsampled=Math.max(1,Math.floor(depth/downsampleDepth));rasterSize=height*width;name="".concat(dtype,"Array");TypedArray=globalThis[name];volumeData=new TypedArray(rasterSize*depthDownsampled);_context18.next=11;return Promise.all(new Array(depthDownsampled).fill(0).map(/*#__PURE__*/function(){var _ref49=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee17(_,z){var depthSelection,_yield$source$getRast,rasterData,r,volIndex,rasterIndex;return _regenerator["default"].wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:depthSelection=_objectSpread(_objectSpread({},selection),{},{z:z*downsampleDepth});_context17.next=3;return source.getRaster({selection:depthSelection,signal:signal});case 3:_yield$source$getRast=_context17.sent;rasterData=_yield$source$getRast.data;r=0;onUpdate();// For now this process fills in each raster plane anti-diagonally transposed.
// This is to ensure that the image looks right in three dimensional space.
while(r<rasterSize){volIndex=z*rasterSize+(rasterSize-r-1);rasterIndex=(width-r-1)%width+width*Math.floor(r/width);volumeData[volIndex]=rasterData[rasterIndex];r+=1;}onUpdate();case 9:case"end":return _context17.stop();}}},_callee17);}));return function(_x23,_x24){return _ref49.apply(this,arguments);};}()));case 11:return _context18.abrupt("return",{data:volumeData,height:height,width:width,depth:depthDownsampled});case 12:case"end":return _context18.stop();}}},_callee18);}));return _getVolume.apply(this,arguments);}var getTextLayer=function getTextLayer(text,viewport,id){return new _layers.TextLayer({id:"text-".concat(id),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[{text:text,position:viewport.position}],getColor:[220,220,220,255],getSize:25,sizeUnits:'meters',sizeScale:Math.pow(2,-viewport.zoom),fontFamily:'Helvetica'});};var defaultProps={pickable:false,coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,contrastLimits:{type:'array',value:[],compare:true},channelsVisible:{type:'array',value:[],compare:true},selections:{type:'array',value:[],compare:true},resolution:{type:'number',value:0,compare:true},domain:{type:'array',value:[],compare:true},loader:{type:'object',value:[{getRaster:function(){var _getRaster3=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee4(){return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return _context4.stop();}}},_callee4);}));function getRaster(){return _getRaster3.apply(this,arguments);}return getRaster;}(),dtype:'Uint16',shape:[1],labels:['z']}],compare:true},xSlice:{type:'array',value:null,compare:true},ySlice:{type:'array',value:null,compare:true},zSlice:{type:'array',value:null,compare:true},clippingPlanes:{type:'array',value:[],compare:true},onUpdate:{type:'function',value:function value(){},compare:true},useProgressIndicator:{type:'boolean',value:true,compare:true},useWebGL1Warning:{type:'boolean',value:true,compare:true},extensions:{type:'array',value:[new ColorPalette3DExtensions.AdditiveBlendExtension()],compare:true}};/**
 * @typedef LayerProps
 * @type {Object}
 * @property {Array.<Array.<number>>} contrastLimits List of [begin, end] values to control each channel's ramp function.
 * @property {Array.<boolean>} channelsVisible List of boolean values for each channel for whether or not it is visible.
 * @property {Array} loader PixelSource[]. Represents an N-dimensional image.
 * @property {Array} selections Selection to be used for fetching data.
 * @property {Array.<Array.<number>>=} domain Override for the possible max/min values (i.e something different than 65535 for uint16/'<u2').
 * @property {number=} resolution Resolution at which you would like to see the volume and load it into memory (0 highest, loader.length -1 the lowest default 0)
 * @property {Object=} modelMatrix A column major affine transformation to be applied to the volume.
 * @property {Array.<number>=} xSlice 0-width (physical coordinates) interval on which to slice the volume.
 * @property {Array.<number>=} ySlice 0-height (physical coordinates) interval on which to slice the volume.
 * @property {Array.<number>=} zSlice 0-depth (physical coordinates) interval on which to slice the volume.
 * @property {function=} onViewportLoad Function that gets called when the data in the viewport loads.
 * @property {Array.<Object>=} clippingPlanes List of math.gl [Plane](https://math.gl/modules/culling/docs/api-reference/plane) objects.
 * @property {boolean=} useProgressIndicator Whether or not to use the default progress text + indicator (default is true)
 * @property {boolean=} useWebGL1Warning Whether or not to use the default WebGL1 warning (default is true)
 * @property {function=} onUpdate A callback to be used for getting updates of the progress, ({ progress }) => {}
 * @property {Array=} extensions [deck.gl extensions](https://deck.gl/docs/developer-guide/custom-layers/layer-extensions) to add to the layers - default is AdditiveBlendExtension from ColorPalette3DExtensions.
 */ /**
 * @type {{ new <S extends string[]>(...props: import('../../types').Viv<LayerProps, S>[]) }}
 * @ignore
 */var VolumeLayer=/*#__PURE__*/function(_CompositeLayer6){(0,_inherits2["default"])(VolumeLayer,_CompositeLayer6);var _super21=_createSuper(VolumeLayer);function VolumeLayer(){(0,_classCallCheck2["default"])(this,VolumeLayer);return _super21.apply(this,arguments);}(0,_createClass2["default"])(VolumeLayer,[{key:"clearState",value:function clearState(){this.setState({height:null,width:null,depth:null,data:null,physicalSizeScalingMatrix:null,resolutionMatrix:null,progress:0,abortController:null});}},{key:"finalizeState",value:function finalizeState(){this.state.abortController.abort();}},{key:"updateState",value:function updateState(_ref15){var _this11=this;var oldProps=_ref15.oldProps,props=_ref15.props;var loaderChanged=props.loader!==oldProps.loader;var resolutionChanged=props.resolution!==oldProps.resolution;var selectionsChanged=props.selections!==oldProps.selections;// Only fetch new data to render if loader has changed
if(resolutionChanged){// Clear last volume.
this.clearState();}if(loaderChanged||selectionsChanged||resolutionChanged){var _this$props18=this.props,loader=_this$props18.loader,_this$props18$selecti=_this$props18.selections,selections=_this$props18$selecti===void 0?[]:_this$props18$selecti,_resolution=_this$props18.resolution,onViewportLoad=_this$props18.onViewportLoad;var source=loader[_resolution];var progress=0;var totalRequests=// eslint-disable-next-line no-bitwise
(source.shape[source.labels.indexOf('z')]>>_resolution)*selections.length;var onUpdate=function onUpdate(){progress+=0.5/totalRequests;if(_this11.props.onUpdate){_this11.props.onUpdate({progress:progress});}_this11.setState({progress:progress});};var abortController=new AbortController();this.setState({abortController:abortController});var _signal=abortController.signal;var volumePromises=selections.map(function(selection){return getVolume({selection:selection,source:source,onUpdate:onUpdate,downsampleDepth:Math.pow(2,_resolution),signal:_signal});});var physicalSizeScalingMatrix=getPhysicalSizeScalingMatrix(loader[_resolution]);Promise.all(volumePromises).then(function(volumes){if(onViewportLoad){onViewportLoad(volumes);}var volume={data:volumes.map(function(d){return d.data;}),width:volumes[0].width,height:volumes[0].height,depth:volumes[0].depth};_this11.setState(_objectSpread(_objectSpread({},volume),{},{physicalSizeScalingMatrix:physicalSizeScalingMatrix,resolutionMatrix:new _math.Matrix4().scale(Math.pow(2,_resolution))}));});}}},{key:"renderLayers",value:function renderLayers(){var _parameters3;var _this$props19=this.props,loader=_this$props19.loader,id=_this$props19.id,resolution=_this$props19.resolution,useProgressIndicator=_this$props19.useProgressIndicator,useWebGL1Warning=_this$props19.useWebGL1Warning;var dtype=loader[resolution].dtype;var _this$state7=this.state,data=_this$state7.data,width=_this$state7.width,height=_this$state7.height,depth=_this$state7.depth,progress=_this$state7.progress,physicalSizeScalingMatrix=_this$state7.physicalSizeScalingMatrix,resolutionMatrix=_this$state7.resolutionMatrix;var gl=this.context.gl;if(!(0,_core2.isWebGL2)(gl)&&useWebGL1Warning){var viewport=this.context.viewport;return getTextLayer(['Volume rendering is only available on browsers that support WebGL2. If you','are using Safari, you can turn on WebGL2 by navigating in the top menubar','to check Develop > Experimental Features > WebGL 2.0 and then refreshing','the page.'].join('\n'),viewport,id);}if(!(width&&height)&&useProgressIndicator){var _viewport=this.context.viewport;return getTextLayer("Loading Volume ".concat(String((progress||0)*100).slice(0,5),"%..."),_viewport,id);}return new XR3DLayer(this.props,{channelData:{data:data,width:width,height:height,depth:depth},id:"XR3DLayer-".concat(0,"-",height,"-").concat(width,"-",0,"-").concat(resolution,"-").concat(id),physicalSizeScalingMatrix:physicalSizeScalingMatrix,parameters:(_parameters3={},(0,_defineProperty2["default"])(_parameters3,_constants["default"].CULL_FACE,true),(0,_defineProperty2["default"])(_parameters3,_constants["default"].CULL_FACE_MODE,_constants["default"].FRONT),(0,_defineProperty2["default"])(_parameters3,_constants["default"].DEPTH_TEST,false),(0,_defineProperty2["default"])(_parameters3,"blendFunc",[_constants["default"].SRC_ALPHA,_constants["default"].ONE]),(0,_defineProperty2["default"])(_parameters3,"blend",true),_parameters3),resolutionMatrix:resolutionMatrix,dtype:dtype});}}]);return VolumeLayer;}(_core.CompositeLayer);exports.VolumeLayer=VolumeLayer;VolumeLayer.layerName='VolumeLayer';VolumeLayer.defaultProps=defaultProps;var areViewStatesEqual=function areViewStatesEqual(viewState,otherViewState){return otherViewState===viewState||(viewState===null||viewState===void 0?void 0:viewState.zoom)===(otherViewState===null||otherViewState===void 0?void 0:otherViewState.zoom)&&(viewState===null||viewState===void 0?void 0:viewState.rotationX)===(otherViewState===null||otherViewState===void 0?void 0:otherViewState.rotationX)&&(viewState===null||viewState===void 0?void 0:viewState.rotationOrbit)===(otherViewState===null||otherViewState===void 0?void 0:otherViewState.rotationOrbit)&&(0,_fastDeepEqual["default"])(viewState===null||viewState===void 0?void 0:viewState.target,otherViewState===null||otherViewState===void 0?void 0:otherViewState.target);};var VivViewerWrapper=/*#__PURE__*/function(_PureComponent){(0,_inherits2["default"])(VivViewerWrapper,_PureComponent);var _super22=_createSuper(VivViewerWrapper);function VivViewerWrapper(props){var _this12;(0,_classCallCheck2["default"])(this,VivViewerWrapper);_this12=_super22.call(this,props);_this12.state={viewStates:{}};var viewStates=_this12.state.viewStates;var _this12$props=_this12.props,views=_this12$props.views,initialViewStates=_this12$props.viewStates;views.forEach(function(view){viewStates[view.id]=view.filterViewState({viewState:initialViewStates.find(function(v){return v.id===view.id;})});});_this12._onViewStateChange=_this12._onViewStateChange.bind((0,_assertThisInitialized2["default"])(_this12));_this12.layerFilter=_this12.layerFilter.bind((0,_assertThisInitialized2["default"])(_this12));_this12.onHover=_this12.onHover.bind((0,_assertThisInitialized2["default"])(_this12));return _this12;}(0,_createClass2["default"])(VivViewerWrapper,[{key:"layerFilter",value:function layerFilter(_ref16){var layer=_ref16.layer,viewport=_ref16.viewport;return layer.id.includes(getVivId(viewport.id));}},{key:"_onViewStateChange",value:function _onViewStateChange(_ref17){var viewId=_ref17.viewId,viewState=_ref17.viewState,interactionState=_ref17.interactionState,oldViewState=_ref17.oldViewState;var _this$props20=this.props,views=_this$props20.views,onViewStateChange=_this$props20.onViewStateChange;viewState=onViewStateChange&&onViewStateChange({viewId:viewId,viewState:viewState,interactionState:interactionState,oldViewState:oldViewState})||viewState;this.setState(function(prevState){var viewStates={};views.forEach(function(view){var currentViewState=prevState.viewStates[view.id];viewStates[view.id]=view.filterViewState({viewState:_objectSpread(_objectSpread({},viewState),{},{id:viewId}),oldViewState:oldViewState,currentViewState:currentViewState});});return{viewStates:viewStates};});return viewState;}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var props=this.props;var views=props.views;var viewStates=_objectSpread({},this.state.viewStates);var anyChanged=false;views.forEach(function(view){var _props$viewStates,_prevProps$viewStates;var currViewState=(_props$viewStates=props.viewStates)===null||_props$viewStates===void 0?void 0:_props$viewStates.find(function(viewState){return viewState.id===view.id;});if(!currViewState){return;}var prevViewState=(_prevProps$viewStates=prevProps.viewStates)===null||_prevProps$viewStates===void 0?void 0:_prevProps$viewStates.find(function(viewState){return viewState.id===view.id;});if(areViewStatesEqual(currViewState,prevViewState)){return;}anyChanged=true;var height=view.height,width=view.width;viewStates[view.id]=view.filterViewState({viewState:_objectSpread(_objectSpread({},currViewState),{},{height:height,width:width,id:view.id})});});if(anyChanged){this.setState({viewStates:viewStates});}}},{key:"onHover",value:function onHover(info,event){var tile=info.tile,coordinate=info.coordinate,layer=info.sourceLayer;var _this$props21=this.props,onHover=_this$props21.onHover,hoverHooks=_this$props21.hoverHooks;if(onHover){onHover(info,event);}if(!hoverHooks||!coordinate||!layer){return null;}var _hoverHooks$handleVal=hoverHooks.handleValue,handleValue=_hoverHooks$handleVal===void 0?function(){}:_hoverHooks$handleVal,_hoverHooks$handleCoo=hoverHooks.handleCoordnate,handleCoordnate=_hoverHooks$handleCoo===void 0?function(){}:_hoverHooks$handleCoo;var hoverData;if(layer.id.includes("Tiled")){if(!(tile!==null&&tile!==void 0&&tile.content)){return null;}var content=tile.content,bbox=tile.bbox,z=tile.z;if(!content.data||!bbox){return null;}var data=content.data,width=content.width,height=content.height;var left=bbox.left,right=bbox.right,top=bbox.top,bottom=bbox.bottom;var bounds=[left,data.height<layer.tileSize?height:bottom,data.width<layer.tileSize?width:right,top];if(!data){return null;}var layerZoomScale=Math.max(1,Math.pow(2,Math.round(-z)));var dataCoords=[Math.floor((coordinate[0]-bounds[0])/layerZoomScale),Math.floor((coordinate[1]-bounds[3])/layerZoomScale)];var coords=dataCoords[1]*width+dataCoords[0];hoverData=data.map(function(d){return d[coords];});}else{var channelData=layer.props.channelData;if(!channelData){return null;}var _data=channelData.data,_width=channelData.width,_height=channelData.height;if(!_data||!_width||!_height){return null;}var _bounds2=[0,_height,_width,0];var zoom=layer.context.viewport.zoom;var _layerZoomScale=Math.max(1,Math.pow(2,Math.floor(-zoom)));var _dataCoords=[Math.floor((coordinate[0]-_bounds2[0])/_layerZoomScale),Math.floor((coordinate[1]-_bounds2[3])/_layerZoomScale)];var _coords=_dataCoords[1]*_width+_dataCoords[0];hoverData=_data.map(function(d){return d[_coords];});}handleValue(hoverData);handleCoordnate(coordinate);}},{key:"_renderLayers",value:function _renderLayers(){var onHover=this.onHover;var viewStates=this.state.viewStates;var _this$props22=this.props,views=_this$props22.views,layerProps=_this$props22.layerProps;return views.map(function(view,i){return view.getLayers({viewStates:viewStates,props:_objectSpread(_objectSpread({},layerProps[i]),{},{onHover:onHover})});});}},{key:"render",value:function render(){var _this$props23=this.props,views=_this$props23.views,randomize=_this$props23.randomize,_this$props23$useDevi=_this$props23.useDevicePixels,useDevicePixels=_this$props23$useDevi===void 0?true:_this$props23$useDevi,deckProps=_this$props23.deckProps;var viewStates=this.state.viewStates;var deckGLViews=views.map(function(view){return view.getDeckGlView();});if(randomize){var random=Math.random();var holdFirstElement=deckGLViews[0];var randomWieghted=random*1.49;var randomizedIndex=Math.round(randomWieghted*(views.length-1));deckGLViews[0]=deckGLViews[randomizedIndex];deckGLViews[randomizedIndex]=holdFirstElement;}return/* @__PURE__ */_react["default"].createElement(_react2["default"],_objectSpread(_objectSpread({},deckProps!==null&&deckProps!==void 0?deckProps:{}),{},{layerFilter:this.layerFilter,layers:(deckProps===null||deckProps===void 0?void 0:deckProps.layers)===void 0?(0,_toConsumableArray2["default"])(this._renderLayers()):[].concat((0,_toConsumableArray2["default"])(this._renderLayers()),(0,_toConsumableArray2["default"])(deckProps.layers)),onViewStateChange:this._onViewStateChange,views:deckGLViews,viewState:viewStates,useDevicePixels:useDevicePixels,getCursor:function getCursor(_ref18){var isDragging=_ref18.isDragging;return isDragging?"grabbing":"crosshair";}}));}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,prevState){var views=props.views,viewStatesProps=props.viewStates;if(views.some(function(view){return!prevState.viewStates[view.id]||view.height!==prevState.viewStates[view.id].height||view.width!==prevState.viewStates[view.id].width;})){var viewStates={};views.forEach(function(view){var height=view.height,width=view.width;var currentViewState=prevState.viewStates[view.id];viewStates[view.id]=view.filterViewState({viewState:_objectSpread(_objectSpread({},currentViewState||viewStatesProps.find(function(v){return v.id===view.id;})),{},{height:height,width:width,id:view.id})});});return{viewStates:viewStates};}return prevState;}}]);return VivViewerWrapper;}(_react.PureComponent);var VivViewer=function VivViewer(props){return/* @__PURE__ */_react["default"].createElement(VivViewerWrapper,_objectSpread({},props));};/**
 * This class generates a layer and a view for use in the VivViewer
 * @param {Object} args
 * @param {string} args.id id for this VivView.
 * @param {Object} args.height Width of the view.
 * @param {Object} args.width Height of the view.
 * @param {string} args.id Id for the current view
 * @param {number=} args.x X (top-left) location on the screen for the current view
 * @param {number=} args.y Y (top-left) location on the screen for the current view
 */exports.VivViewer=VivViewer;var VivView=/*#__PURE__*/function(){function VivView(_ref19){var id=_ref19.id,_ref19$x=_ref19.x,x=_ref19$x===void 0?0:_ref19$x,_ref19$y=_ref19.y,y=_ref19$y===void 0?0:_ref19$y,height=_ref19.height,width=_ref19.width;(0,_classCallCheck2["default"])(this,VivView);this.width=width;this.height=height;this.id=id;this.x=x;this.y=y;}/**
   * Create a DeckGL view based on this class.
   * @returns {View} The DeckGL View for this class.
   */(0,_createClass2["default"])(VivView,[{key:"getDeckGlView",value:function getDeckGlView(){return new _core.OrthographicView({controller:true,id:this.id,height:this.height,width:this.width,x:this.x,y:this.y});}/**
   * Create a viewState for this class, checking the id to make sure this class and veiwState match.
   * @param {Object} args
   * @param {object} [args.viewState] incoming ViewState object from deck.gl update.
   * @param {object} [args.oldViewState] old ViewState object from deck.gl.
   * @param {object} [args.currentViewState] current ViewState object in react state.
   * @returns {?object} ViewState for this class (or null by default if the ids do not match).
   */},{key:"filterViewState",value:function filterViewState(_ref20){var viewState=_ref20.viewState;var id=this.id,height=this.height,width=this.width;return viewState.id===id?_objectSpread({height:height,width:width},viewState):null;}/**
   * Create a layer for this instance.
   * @param {Object} args
   * @param {Object<string,Object>} args.viewStates ViewStates for all current views.
   * @param {Object} args.props Props for this instance.
   * @returns {Layer} Instance of a layer.
   */ // eslint-disable-next-line class-methods-use-this,no-unused-vars
},{key:"getLayers",value:function getLayers(_ref21){var viewStates=_ref21.viewStates,props=_ref21.props;}}]);return VivView;}();/* eslint-disable max-classes-per-file */exports.VivView=VivView;var OVERVIEW_VIEW_ID='overview';exports.OVERVIEW_VIEW_ID=OVERVIEW_VIEW_ID;var OverviewState=/*#__PURE__*/(0,_createClass2["default"])(function OverviewState(){(0,_classCallCheck2["default"])(this,OverviewState);});var OverviewController=/*#__PURE__*/function(_Controller){(0,_inherits2["default"])(OverviewController,_Controller);var _super23=_createSuper(OverviewController);function OverviewController(props){var _this13;(0,_classCallCheck2["default"])(this,OverviewController);_this13=_super23.call(this,OverviewState,props);_this13.events=['click'];return _this13;}(0,_createClass2["default"])(OverviewController,[{key:"handleEvent",value:function handleEvent(event){if(event.type!=='click'){return;}var _this$getCenter=this.getCenter(event),_this$getCenter2=(0,_slicedToArray2["default"])(_this$getCenter,2),x=_this$getCenter2[0],y=_this$getCenter2[1];var _this$controllerState=this.controllerStateProps,width=_this$controllerState.width,height=_this$controllerState.height,zoom=_this$controllerState.zoom,scale=_this$controllerState.scale;if(x<0||y<0||x>width||y>height){return;}var scaleFactor=1/(Math.pow(2,zoom)*scale);x*=scaleFactor;y*=scaleFactor;if(this.onViewStateChange){this.onViewStateChange({viewState:{target:[x,y,0]}});}}}]);return OverviewController;}(_core.Controller);/**
 * This class generates a OverviewLayer and a view for use in the VivViewer as an overview to a Detailview (they must be used in conjection).
 * From the base class VivView, only the initialViewState argument is used.  This class uses private methods to position its x and y from the
 * additional arguments:
 * @param {Object} args
 * @param {Object} args.id for thie VivView
 * @param {Object} args.loader PixelSource[], where each PixelSource is decreasing in shape. If length == 1, not multiscale.
 * @param {number} args.detailHeight Height of the detail view.
 * @param {number} args.detailWidth Width of the detail view.
 * @param {number} [args.scale] Scale of this viewport relative to the detail. Default is .2.
 * @param {number} [args.margin] Margin to be offset from the the corner of the other viewport. Default is 25.
 * @param {string} [args.position] Location of the viewport - one of "bottom-right", "top-right", "top-left", "bottom-left."  Default is 'bottom-right'.
 * @param {number} [args.minimumWidth] Absolute lower bound for how small the viewport should scale. Default is 150.
 * @param {number} [args.maximumWidth] Absolute upper bound for how large the viewport should scale. Default is 350.
 * @param {number} [args.minimumHeight] Absolute lower bound for how small the viewport should scale. Default is 150.
 * @param {number} [args.maximumHeight] Absolute upper bound for how large the viewport should scale. Default is 350.
 * @param {Boolean} [args.clickCenter] Click to center the default view. Default is true.
 * */var OverviewView=/*#__PURE__*/function(_VivView){(0,_inherits2["default"])(OverviewView,_VivView);var _super24=_createSuper(OverviewView);function OverviewView(_ref22){var _this14;var id=_ref22.id,loader=_ref22.loader,detailHeight=_ref22.detailHeight,detailWidth=_ref22.detailWidth,_ref22$scale=_ref22.scale,scale=_ref22$scale===void 0?0.2:_ref22$scale,_ref22$margin=_ref22.margin,margin=_ref22$margin===void 0?25:_ref22$margin,_ref22$position=_ref22.position,position=_ref22$position===void 0?'bottom-right':_ref22$position,_ref22$minimumWidth=_ref22.minimumWidth,minimumWidth=_ref22$minimumWidth===void 0?150:_ref22$minimumWidth,_ref22$maximumWidth=_ref22.maximumWidth,maximumWidth=_ref22$maximumWidth===void 0?350:_ref22$maximumWidth,_ref22$minimumHeight=_ref22.minimumHeight,minimumHeight=_ref22$minimumHeight===void 0?150:_ref22$minimumHeight,_ref22$maximumHeight=_ref22.maximumHeight,maximumHeight=_ref22$maximumHeight===void 0?350:_ref22$maximumHeight,_ref22$clickCenter=_ref22.clickCenter,clickCenter=_ref22$clickCenter===void 0?true:_ref22$clickCenter;(0,_classCallCheck2["default"])(this,OverviewView);_this14=_super24.call(this,{id:id});_this14.margin=margin;_this14.loader=loader;_this14.position=position;_this14.detailHeight=detailHeight;_this14.detailWidth=detailWidth;_this14._setHeightWidthScale({detailWidth:detailWidth,detailHeight:detailHeight,scale:scale,minimumWidth:minimumWidth,maximumWidth:maximumWidth,minimumHeight:minimumHeight,maximumHeight:maximumHeight});_this14._setXY();_this14.clickCenter=clickCenter;return _this14;}/**
   * Set the image-pixel scale and height and width based on detail view.
   */(0,_createClass2["default"])(OverviewView,[{key:"_setHeightWidthScale",value:function _setHeightWidthScale(_ref23){var detailWidth=_ref23.detailWidth,detailHeight=_ref23.detailHeight,scale=_ref23.scale,minimumWidth=_ref23.minimumWidth,maximumWidth=_ref23.maximumWidth,minimumHeight=_ref23.minimumHeight,maximumHeight=_ref23.maximumHeight;var numLevels=this.loader.length;var _getImageSize5=getImageSize(this.loader[0]),rasterWidth=_getImageSize5.width,rasterHeight=_getImageSize5.height;this._imageWidth=rasterWidth;this._imageHeight=rasterHeight;if(rasterWidth>rasterHeight){var heightWidthRatio=rasterHeight/rasterWidth;this.width=Math.min(maximumWidth,Math.max(detailWidth*scale,minimumWidth));this.height=this.width*heightWidthRatio;this.scale=Math.pow(2,numLevels-1)/rasterWidth*this.width;}else{var widthHeightRatio=rasterWidth/rasterHeight;this.height=Math.min(maximumHeight,Math.max(detailHeight*scale,minimumHeight));this.width=this.height*widthHeightRatio;this.scale=Math.pow(2,numLevels-1)/rasterHeight*this.height;}}/**
   * Set the x and y (top left corner) of this overview relative to the detail.
   */},{key:"_setXY",value:function _setXY(){var height=this.height,width=this.width,margin=this.margin,position=this.position,detailWidth=this.detailWidth,detailHeight=this.detailHeight;switch(position){case'bottom-right':{this.x=detailWidth-width-margin;this.y=detailHeight-height-margin;break;}case'top-right':{this.x=detailWidth-width-margin;this.y=margin;break;}case'top-left':{this.x=margin;this.y=margin;break;}case'bottom-left':{this.x=margin;this.y=detailHeight-height-margin;break;}default:{throw new Error("overviewLocation prop needs to be one of ['bottom-right', 'top-right', 'top-left', 'bottom-left']");}}}},{key:"getDeckGlView",value:function getDeckGlView(){var scale=this.scale,clickCenter=this.clickCenter;var controller=clickCenter&&{type:OverviewController,scale:scale};return new _core.OrthographicView({controller:controller,id:this.id,height:this.height,width:this.width,x:this.x,y:this.y,clear:true});}},{key:"filterViewState",value:function filterViewState(_ref24){var viewState=_ref24.viewState;// Scale the view as the overviewScale changes with screen resizing - basically, do not react to any view state changes.
var _imageWidth=this._imageWidth,_imageHeight=this._imageHeight,scale=this.scale;return _objectSpread(_objectSpread({},viewState),{},{height:this.height,width:this.width,id:this.id,target:[_imageWidth*scale/2,_imageHeight*scale/2,0],zoom:-(this.loader.length-1)});}},{key:"getLayers",value:function getLayers(_ref25){var _this15=this;var viewStates=_ref25.viewStates,props=_ref25.props;var detail=viewStates.detail,overview=viewStates.overview;if(!detail){throw new Error('Overview requires a viewState with id detail');}// Scale the bounding box.
var boundingBox=makeBoundingBox(detail).map(function(coords){return coords.map(function(e){return e*_this15.scale;});});var overviewLayer=new OverviewLayer(props,{id:getVivId(this.id),boundingBox:boundingBox,overviewScale:this.scale,zoom:-overview.zoom});return[overviewLayer];}}]);return OverviewView;}(VivView);exports.OverviewView=OverviewView;var DETAIL_VIEW_ID='detail';/**
 * This class generates a MultiscaleImageLayer and a view for use in the VivViewer as a detailed view.
 * It takes the same arguments for its constructor as its base class VivView.
 * */exports.DETAIL_VIEW_ID=DETAIL_VIEW_ID;var DetailView=/*#__PURE__*/function(_VivView2){(0,_inherits2["default"])(DetailView,_VivView2);var _super25=_createSuper(DetailView);function DetailView(){(0,_classCallCheck2["default"])(this,DetailView);return _super25.apply(this,arguments);}(0,_createClass2["default"])(DetailView,[{key:"getLayers",value:function getLayers(_ref26){var _loader$3,_loader$3$meta,_loader$3$meta$physic;var props=_ref26.props,viewStates=_ref26.viewStates;var loader=props.loader;var id=this.id,height=this.height,width=this.width;var layerViewState=viewStates[id];var layers=[getImageLayer(id,props)];// Inspect the first pixel source for physical sizes
if((_loader$3=loader[0])!==null&&_loader$3!==void 0&&(_loader$3$meta=_loader$3.meta)!==null&&_loader$3$meta!==void 0&&(_loader$3$meta$physic=_loader$3$meta.physicalSizes)!==null&&_loader$3$meta$physic!==void 0&&_loader$3$meta$physic.x){var _loader$0$meta$physic=loader[0].meta.physicalSizes.x,size=_loader$0$meta$physic.size,unit=_loader$0$meta$physic.unit;layers.push(new ScaleBarLayer({id:getVivId(id),loader:loader,unit:unit,size:size,viewState:_objectSpread(_objectSpread({},layerViewState),{},{height:height,width:width})}));}return layers;}},{key:"filterViewState",value:function filterViewState(_ref27){var viewState=_ref27.viewState,currentViewState=_ref27.currentViewState;if(viewState.id===OVERVIEW_VIEW_ID){var target=viewState.target;if(target){return _objectSpread(_objectSpread({},currentViewState),{},{target:target});}}return(0,_get2["default"])((0,_getPrototypeOf2["default"])(DetailView.prototype),"filterViewState",this).call(this,{viewState:viewState});}}]);return DetailView;}(VivView);/**
 * This class generates a MultiscaleImageLayer and a view for use in the SideBySideViewer.
 * It is linked with its other views as controlled by `linkedIds`, `zoomLock`, and `panLock` parameters.
 * It takes the same arguments for its constructor as its base class VivView plus the following:
 * @param {Object} args
 * @param {Array<String>} args.linkedIds Ids of the other views to which this could be locked via zoom/pan.
 * @param {Boolean} args.panLock Whether or not we lock pan.
 * @param {Boolean} args.zoomLock Whether or not we lock zoom.
 * @param {Array=} args.viewportOutlineColor Outline color of the border (default [255, 255, 255])
 * @param {number=} args.viewportOutlineWidth Default outline width (default 10)
 * @param {number=} args.x X (top-left) location on the screen for the current view
 * @param {number=} args.y Y (top-left) location on the screen for the current view
 * @param {number} args.height Width of the view.
 * @param {number} args.width Height of the view.
 * @param {string} args.id id of the View
 * */exports.DetailView=DetailView;var SideBySideView=/*#__PURE__*/function(_VivView3){(0,_inherits2["default"])(SideBySideView,_VivView3);var _super26=_createSuper(SideBySideView);function SideBySideView(_ref28){var _this16;var id=_ref28.id,_ref28$x=_ref28.x,x=_ref28$x===void 0?0:_ref28$x,_ref28$y=_ref28.y,y=_ref28$y===void 0?0:_ref28$y,height=_ref28.height,width=_ref28.width,_ref28$linkedIds=_ref28.linkedIds,linkedIds=_ref28$linkedIds===void 0?[]:_ref28$linkedIds,_ref28$panLock=_ref28.panLock,panLock=_ref28$panLock===void 0?true:_ref28$panLock,_ref28$zoomLock=_ref28.zoomLock,zoomLock=_ref28$zoomLock===void 0?true:_ref28$zoomLock,_ref28$viewportOutlin=_ref28.viewportOutlineColor,viewportOutlineColor=_ref28$viewportOutlin===void 0?[255,255,255]:_ref28$viewportOutlin,_ref28$viewportOutlin2=_ref28.viewportOutlineWidth,viewportOutlineWidth=_ref28$viewportOutlin2===void 0?10:_ref28$viewportOutlin2;(0,_classCallCheck2["default"])(this,SideBySideView);_this16=_super26.call(this,{id:id,x:x,y:y,height:height,width:width});_this16.linkedIds=linkedIds;_this16.panLock=panLock;_this16.zoomLock=zoomLock;_this16.viewportOutlineColor=viewportOutlineColor;_this16.viewportOutlineWidth=viewportOutlineWidth;return _this16;}(0,_createClass2["default"])(SideBySideView,[{key:"filterViewState",value:function filterViewState(_ref29){var viewState=_ref29.viewState,oldViewState=_ref29.oldViewState,currentViewState=_ref29.currentViewState;var viewStateId=viewState.id;var id=this.id,linkedIds=this.linkedIds,panLock=this.panLock,zoomLock=this.zoomLock;if(oldViewState&&linkedIds.indexOf(viewStateId)!==-1&&(zoomLock||panLock)){var thisViewState={height:currentViewState.height,width:currentViewState.width,target:[],zoom:null};var _currentViewState$tar=(0,_slicedToArray2["default"])(currentViewState.target,2),currentX=_currentViewState$tar[0],currentY=_currentViewState$tar[1];if(zoomLock){var dZoom=viewState.zoom-oldViewState.zoom;thisViewState.zoom=currentViewState.zoom+dZoom;}else{thisViewState.zoom=currentViewState.zoom;}if(panLock){var _oldViewState$target=(0,_slicedToArray2["default"])(oldViewState.target,2),oldX=_oldViewState$target[0],oldY=_oldViewState$target[1];var _viewState$target=(0,_slicedToArray2["default"])(viewState.target,2),newX=_viewState$target[0],newY=_viewState$target[1];var dx=newX-oldX;var dy=newY-oldY;thisViewState.target.push(currentX+dx);thisViewState.target.push(currentY+dy);}else{thisViewState.target.push(currentX);thisViewState.target.push(currentY);}return{id:id,target:thisViewState.target,zoom:thisViewState.zoom,height:thisViewState.height,width:thisViewState.width};}return viewState.id===id?{id:id,target:viewState.target,zoom:viewState.zoom,height:viewState.height,width:viewState.width}:{id:id,target:currentViewState.target,zoom:currentViewState.zoom,height:currentViewState.height,width:currentViewState.width};}},{key:"getLayers",value:function getLayers(_ref30){var _loader$4,_loader$4$meta,_loader$4$meta$physic;var props=_ref30.props,viewStates=_ref30.viewStates;var loader=props.loader;var id=this.id,viewportOutlineColor=this.viewportOutlineColor,viewportOutlineWidth=this.viewportOutlineWidth,height=this.height,width=this.width;var layerViewState=viewStates[id];var boundingBox=makeBoundingBox(_objectSpread(_objectSpread({},layerViewState),{},{height:height,width:width}));var layers=[getImageLayer(id,props)];var border=new _layers.PolygonLayer({id:"viewport-outline-".concat(getVivId(id)),coordinateSystem:_core.COORDINATE_SYSTEM.CARTESIAN,data:[boundingBox],getPolygon:function getPolygon(f){return f;},filled:false,stroked:true,getLineColor:viewportOutlineColor,getLineWidth:viewportOutlineWidth*Math.pow(2,-layerViewState.zoom)});layers.push(border);if((_loader$4=loader[0])!==null&&_loader$4!==void 0&&(_loader$4$meta=_loader$4.meta)!==null&&_loader$4$meta!==void 0&&(_loader$4$meta$physic=_loader$4$meta.physicalSizes)!==null&&_loader$4$meta$physic!==void 0&&_loader$4$meta$physic.x){var _loader$0$meta$physic2=loader[0].meta.physicalSizes.x,size=_loader$0$meta$physic2.size,unit=_loader$0$meta$physic2.unit;layers.push(new ScaleBarLayer({id:getVivId(id),loader:loader,unit:unit,size:size,viewState:_objectSpread(_objectSpread({},layerViewState),{},{height:height,width:width})}));}return layers;}}]);return SideBySideView;}(VivView);/**
 * This class generates a VolumeLayer and a view for use in the VivViewer as volumetric rendering.
 * @param {Object} args
 * @param {Array<number>} args.target Centered target for the camera (used if useFixedAxis is true)
 * @param {Boolean} args.useFixedAxis Whether or not to fix the axis of the camera.
 * */exports.SideBySideView=SideBySideView;var VolumeView=/*#__PURE__*/function(_VivView4){(0,_inherits2["default"])(VolumeView,_VivView4);var _super27=_createSuper(VolumeView);function VolumeView(_ref31){var _this17;var target=_ref31.target,useFixedAxis=_ref31.useFixedAxis,args=(0,_objectWithoutProperties2["default"])(_ref31,_excluded4);(0,_classCallCheck2["default"])(this,VolumeView);_this17=_super27.call(this,args);_this17.target=target;_this17.useFixedAxis=useFixedAxis;return _this17;}(0,_createClass2["default"])(VolumeView,[{key:"getDeckGlView",value:function getDeckGlView(){var height=this.height,width=this.width,id=this.id,x=this.x,y=this.y;return new _core.OrbitView({id:id,controller:true,height:height,width:width,x:x,y:y,orbitAxis:'Y'});}},{key:"filterViewState",value:function filterViewState(_ref32){var viewState=_ref32.viewState;var id=this.id,target=this.target,useFixedAxis=this.useFixedAxis;return viewState.id===id?_objectSpread(_objectSpread({},viewState),{},{// fix the center of the camera if desired
target:useFixedAxis?target:viewState.target}):null;}},{key:"getLayers",value:function getLayers(_ref33){var props=_ref33.props;var loader=props.loader;var id=this.id;var layers=[new VolumeLayer(props,{id:"".concat(loader.type).concat(getVivId(id))})];return layers;}}]);return VolumeView;}(VivView);exports.VolumeView=VolumeView;var PictureInPictureViewer=function PictureInPictureViewer(props){var loader=props.loader,contrastLimits=props.contrastLimits,colors=props.colors,channelsVisible=props.channelsVisible,viewStatesProp=props.viewStates,colormap=props.colormap,overview=props.overview,overviewOn=props.overviewOn,selections=props.selections,_props$hoverHooks=props.hoverHooks,hoverHooks=_props$hoverHooks===void 0?{handleValue:function handleValue(){},handleCoordinate:function handleCoordinate(){}}:_props$hoverHooks,height=props.height,width=props.width,_props$lensEnabled=props.lensEnabled,lensEnabled=_props$lensEnabled===void 0?false:_props$lensEnabled,_props$lensSelection=props.lensSelection,lensSelection=_props$lensSelection===void 0?0:_props$lensSelection,_props$lensRadius=props.lensRadius,lensRadius=_props$lensRadius===void 0?100:_props$lensRadius,_props$lensBorderColo=props.lensBorderColor,lensBorderColor=_props$lensBorderColo===void 0?[255,255,255]:_props$lensBorderColo,_props$lensBorderRadi=props.lensBorderRadius,lensBorderRadius=_props$lensBorderRadi===void 0?0.02:_props$lensBorderRadi,_props$clickCenter=props.clickCenter,clickCenter=_props$clickCenter===void 0?true:_props$clickCenter,transparentColor=props.transparentColor,onViewStateChange=props.onViewStateChange,onHover=props.onHover,onViewportLoad=props.onViewportLoad,_props$extensions=props.extensions,extensions=_props$extensions===void 0?[new ColorPaletteExtension()]:_props$extensions,deckProps=props.deckProps;var detailViewState=viewStatesProp===null||viewStatesProp===void 0?void 0:viewStatesProp.find(function(v){return v.id===DETAIL_VIEW_ID;});var baseViewState=(0,_react.useMemo)(function(){return detailViewState||getDefaultInitialViewState(loader,{height:height,width:width},0.5);},[loader,detailViewState]);var detailView=new DetailView({id:DETAIL_VIEW_ID,height:height,width:width});var layerConfig={loader:loader,contrastLimits:contrastLimits,colors:colors,channelsVisible:channelsVisible,selections:selections,onViewportLoad:onViewportLoad,colormap:colormap,lensEnabled:lensEnabled,lensSelection:lensSelection,lensRadius:lensRadius,lensBorderColor:lensBorderColor,lensBorderRadius:lensBorderRadius,extensions:extensions,transparentColor:transparentColor};var views=[detailView];var layerProps=[layerConfig];var viewStates=[_objectSpread(_objectSpread({},baseViewState),{},{id:DETAIL_VIEW_ID})];if(overviewOn&&loader){var overviewViewState=(viewStatesProp===null||viewStatesProp===void 0?void 0:viewStatesProp.find(function(v){return v.id===OVERVIEW_VIEW_ID;}))||_objectSpread(_objectSpread({},baseViewState),{},{id:OVERVIEW_VIEW_ID});var overviewView=new OverviewView(_objectSpread({id:OVERVIEW_VIEW_ID,loader:loader,detailHeight:height,detailWidth:width,clickCenter:clickCenter},overview));views.push(overviewView);layerProps.push(_objectSpread(_objectSpread({},layerConfig),{},{lensEnabled:false}));viewStates.push(overviewViewState);}if(!loader)return null;return/* @__PURE__ */_react["default"].createElement(VivViewer,{layerProps:layerProps,views:views,viewStates:viewStates,hoverHooks:hoverHooks,onViewStateChange:onViewStateChange,onHover:onHover,deckProps:deckProps});};exports.PictureInPictureViewer=PictureInPictureViewer;var SideBySideViewer=function SideBySideViewer(props){var loader=props.loader,contrastLimits=props.contrastLimits,colors=props.colors,channelsVisible=props.channelsVisible,viewStatesProp=props.viewStates,colormap=props.colormap,panLock=props.panLock,selections=props.selections,zoomLock=props.zoomLock,height=props.height,width=props.width,_props$lensEnabled2=props.lensEnabled,lensEnabled=_props$lensEnabled2===void 0?false:_props$lensEnabled2,_props$lensSelection2=props.lensSelection,lensSelection=_props$lensSelection2===void 0?0:_props$lensSelection2,_props$lensRadius2=props.lensRadius,lensRadius=_props$lensRadius2===void 0?100:_props$lensRadius2,_props$lensBorderColo2=props.lensBorderColor,lensBorderColor=_props$lensBorderColo2===void 0?[255,255,255]:_props$lensBorderColo2,_props$lensBorderRadi2=props.lensBorderRadius,lensBorderRadius=_props$lensBorderRadi2===void 0?0.02:_props$lensBorderRadi2,transparentColor=props.transparentColor,onViewStateChange=props.onViewStateChange,onHover=props.onHover,onViewportLoad=props.onViewportLoad,_props$extensions2=props.extensions,extensions=_props$extensions2===void 0?[new ColorPaletteExtension()]:_props$extensions2,deckProps=props.deckProps;var leftViewState=viewStatesProp===null||viewStatesProp===void 0?void 0:viewStatesProp.find(function(v){return v.id==="left";});var rightViewState=viewStatesProp===null||viewStatesProp===void 0?void 0:viewStatesProp.find(function(v){return v.id==="right";});var viewStates=(0,_react.useMemo)(function(){if(leftViewState&&rightViewState){return viewStatesProp;}var defaultViewState=getDefaultInitialViewState(loader,{height:height,width:width/2},0.5);return[leftViewState||_objectSpread(_objectSpread({},defaultViewState),{},{id:"left"}),rightViewState||_objectSpread(_objectSpread({},defaultViewState),{},{id:"right"})];},[loader,leftViewState,rightViewState]);var detailViewLeft=new SideBySideView({id:"left",linkedIds:["right"],panLock:panLock,zoomLock:zoomLock,height:height,width:width/2});var detailViewRight=new SideBySideView({id:"right",x:width/2,linkedIds:["left"],panLock:panLock,zoomLock:zoomLock,height:height,width:width/2});var layerConfig={loader:loader,contrastLimits:contrastLimits,colors:colors,channelsVisible:channelsVisible,selections:selections,onViewportLoad:onViewportLoad,colormap:colormap,lensEnabled:lensEnabled,lensSelection:lensSelection,lensRadius:lensRadius,lensBorderColor:lensBorderColor,lensBorderRadius:lensBorderRadius,extensions:extensions,transparentColor:transparentColor};var views=[detailViewRight,detailViewLeft];var layerProps=[layerConfig,layerConfig];return loader?/* @__PURE__ */_react["default"].createElement(VivViewer,{layerProps:layerProps,views:views,randomize:true,onViewStateChange:onViewStateChange,onHover:onHover,viewStates:viewStates,deckProps:deckProps}):null;};exports.SideBySideViewer=SideBySideViewer;var VolumeViewer=function VolumeViewer(props){var loader=props.loader,contrastLimits=props.contrastLimits,colors=props.colors,channelsVisible=props.channelsVisible,selections=props.selections,colormap=props.colormap,_props$resolution=props.resolution,resolution=_props$resolution===void 0?Math.max(0,loader.length-1):_props$resolution,modelMatrix=props.modelMatrix,onViewStateChange=props.onViewStateChange,_props$xSlice=props.xSlice,xSlice=_props$xSlice===void 0?null:_props$xSlice,_props$ySlice=props.ySlice,ySlice=_props$ySlice===void 0?null:_props$ySlice,_props$zSlice=props.zSlice,zSlice=_props$zSlice===void 0?null:_props$zSlice,_onViewportLoad=props.onViewportLoad,screenHeight=props.height,screenWidth=props.width,viewStatesProp=props.viewStates,_props$clippingPlanes=props.clippingPlanes,clippingPlanes=_props$clippingPlanes===void 0?[]:_props$clippingPlanes,_props$useFixedAxis=props.useFixedAxis,useFixedAxis=_props$useFixedAxis===void 0?true:_props$useFixedAxis,_props$extensions3=props.extensions,extensions=_props$extensions3===void 0?[new ColorPalette3DExtensions.AdditiveBlendExtension()]:_props$extensions3;var volumeViewState=viewStatesProp===null||viewStatesProp===void 0?void 0:viewStatesProp.find(function(state){return(state===null||state===void 0?void 0:state.id)==="3d";});var initialViewState=(0,_react.useMemo)(function(){if(volumeViewState){return volumeViewState;}var viewState=getDefaultInitialViewState(loader,{height:screenHeight,width:screenWidth},1,true,modelMatrix);return _objectSpread(_objectSpread({},viewState),{},{rotationX:0,rotationOrbit:0});},[loader,resolution,modelMatrix]);var viewStates=[volumeViewState||_objectSpread(_objectSpread({},initialViewState),{},{id:"3d"})];var volumeView=new VolumeView({id:"3d",target:viewStates[0].target,useFixedAxis:useFixedAxis});var layerConfig={loader:loader,contrastLimits:contrastLimits,colors:colors,channelsVisible:channelsVisible,selections:selections,colormap:colormap,xSlice:xSlice,ySlice:ySlice,zSlice:zSlice,resolution:resolution,extensions:extensions,modelMatrix:modelMatrix,onViewportLoad:function onViewportLoad(){return setTimeout(_onViewportLoad,0);},clippingPlanes:clippingPlanes};var views=[volumeView];var layerProps=[layerConfig];return loader?/* @__PURE__ */_react["default"].createElement(VivViewer,{layerProps:layerProps,views:views,viewStates:viewStates,onViewStateChange:onViewStateChange,useDevicePixels:false}):null;};exports.VolumeViewer=VolumeViewer;var VIV_PROXY_KEY="__viv";var OFFSETS_PROXY_KEY="".concat(VIV_PROXY_KEY,"-offsets");function checkProxies(tiff){if(!isProxy(tiff,OFFSETS_PROXY_KEY)){console.warn("GeoTIFF source is missing offsets proxy.");}}function isProxy(tiff,proxyFlag){return tiff[proxyFlag];}function createOffsetsProxy(tiff,offsets){var get=function get(target,key){if(key==="getImage"){return function(index){if(!(index in target.ifdRequests)&&index in offsets){var offset=offsets[index];target.ifdRequests[index]=target.parseFileDirectoryAt(offset);}return target.getImage(index);};}if(key===OFFSETS_PROXY_KEY){return true;}return Reflect.get(target,key);};return new Proxy(tiff,{get:get});}var LZWDecoder=/*#__PURE__*/function(_BaseDecoder){(0,_inherits2["default"])(LZWDecoder,_BaseDecoder);var _super28=_createSuper(LZWDecoder);function LZWDecoder(fileDirectory){var _this18;(0,_classCallCheck2["default"])(this,LZWDecoder);_this18=_super28.call(this);var width=fileDirectory.TileWidth||fileDirectory.ImageWidth;var height=fileDirectory.TileLength||fileDirectory.ImageLength;var nbytes=fileDirectory.BitsPerSample[0]/8;_this18.maxUncompressedSize=width*height*nbytes;return _this18;}(0,_createClass2["default"])(LZWDecoder,[{key:"decodeBlock",value:function(){var _decodeBlock=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee5(buffer){var bytes,decoded;return _regenerator["default"].wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:bytes=new Uint8Array(buffer);_context5.next=3;return(0,_lzwTiffDecoder.decompress)(bytes,this.maxUncompressedSize);case 3:decoded=_context5.sent;return _context5.abrupt("return",decoded.buffer);case 5:case"end":return _context5.stop();}}},_callee5,this);}));function decodeBlock(_x3){return _decodeBlock.apply(this,arguments);}return decodeBlock;}()}]);return LZWDecoder;}(_geotiff.BaseDecoder);var encodedJs="Y29uc3QgZmllbGRUYWdOYW1lcyA9IHsKICAvLyBUSUZGIEJhc2VsaW5lCiAgMHgwMTNCOiAnQXJ0aXN0JywKICAweDAxMDI6ICdCaXRzUGVyU2FtcGxlJywKICAweDAxMDk6ICdDZWxsTGVuZ3RoJywKICAweDAxMDg6ICdDZWxsV2lkdGgnLAogIDB4MDE0MDogJ0NvbG9yTWFwJywKICAweDAxMDM6ICdDb21wcmVzc2lvbicsCiAgMHg4Mjk4OiAnQ29weXJpZ2h0JywKICAweDAxMzI6ICdEYXRlVGltZScsCiAgMHgwMTUyOiAnRXh0cmFTYW1wbGVzJywKICAweDAxMEE6ICdGaWxsT3JkZXInLAogIDB4MDEyMTogJ0ZyZWVCeXRlQ291bnRzJywKICAweDAxMjA6ICdGcmVlT2Zmc2V0cycsCiAgMHgwMTIzOiAnR3JheVJlc3BvbnNlQ3VydmUnLAogIDB4MDEyMjogJ0dyYXlSZXNwb25zZVVuaXQnLAogIDB4MDEzQzogJ0hvc3RDb21wdXRlcicsCiAgMHgwMTBFOiAnSW1hZ2VEZXNjcmlwdGlvbicsCiAgMHgwMTAxOiAnSW1hZ2VMZW5ndGgnLAogIDB4MDEwMDogJ0ltYWdlV2lkdGgnLAogIDB4MDEwRjogJ01ha2UnLAogIDB4MDExOTogJ01heFNhbXBsZVZhbHVlJywKICAweDAxMTg6ICdNaW5TYW1wbGVWYWx1ZScsCiAgMHgwMTEwOiAnTW9kZWwnLAogIDB4MDBGRTogJ05ld1N1YmZpbGVUeXBlJywKICAweDAxMTI6ICdPcmllbnRhdGlvbicsCiAgMHgwMTA2OiAnUGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbicsCiAgMHgwMTFDOiAnUGxhbmFyQ29uZmlndXJhdGlvbicsCiAgMHgwMTI4OiAnUmVzb2x1dGlvblVuaXQnLAogIDB4MDExNjogJ1Jvd3NQZXJTdHJpcCcsCiAgMHgwMTE1OiAnU2FtcGxlc1BlclBpeGVsJywKICAweDAxMzE6ICdTb2Z0d2FyZScsCiAgMHgwMTE3OiAnU3RyaXBCeXRlQ291bnRzJywKICAweDAxMTE6ICdTdHJpcE9mZnNldHMnLAogIDB4MDBGRjogJ1N1YmZpbGVUeXBlJywKICAweDAxMDc6ICdUaHJlc2hob2xkaW5nJywKICAweDAxMUE6ICdYUmVzb2x1dGlvbicsCiAgMHgwMTFCOiAnWVJlc29sdXRpb24nLAoKICAvLyBUSUZGIEV4dGVuZGVkCiAgMHgwMTQ2OiAnQmFkRmF4TGluZXMnLAogIDB4MDE0NzogJ0NsZWFuRmF4RGF0YScsCiAgMHgwMTU3OiAnQ2xpcFBhdGgnLAogIDB4MDE0ODogJ0NvbnNlY3V0aXZlQmFkRmF4TGluZXMnLAogIDB4MDFCMTogJ0RlY29kZScsCiAgMHgwMUIyOiAnRGVmYXVsdEltYWdlQ29sb3InLAogIDB4MDEwRDogJ0RvY3VtZW50TmFtZScsCiAgMHgwMTUwOiAnRG90UmFuZ2UnLAogIDB4MDE0MTogJ0hhbGZ0b25lSGludHMnLAogIDB4MDE1QTogJ0luZGV4ZWQnLAogIDB4MDE1QjogJ0pQRUdUYWJsZXMnLAogIDB4MDExRDogJ1BhZ2VOYW1lJywKICAweDAxMjk6ICdQYWdlTnVtYmVyJywKICAweDAxM0Q6ICdQcmVkaWN0b3InLAogIDB4MDEzRjogJ1ByaW1hcnlDaHJvbWF0aWNpdGllcycsCiAgMHgwMjE0OiAnUmVmZXJlbmNlQmxhY2tXaGl0ZScsCiAgMHgwMTUzOiAnU2FtcGxlRm9ybWF0JywKICAweDAxNTQ6ICdTTWluU2FtcGxlVmFsdWUnLAogIDB4MDE1NTogJ1NNYXhTYW1wbGVWYWx1ZScsCiAgMHgwMjJGOiAnU3RyaXBSb3dDb3VudHMnLAogIDB4MDE0QTogJ1N1YklGRHMnLAogIDB4MDEyNDogJ1Q0T3B0aW9ucycsCiAgMHgwMTI1OiAnVDZPcHRpb25zJywKICAweDAxNDU6ICdUaWxlQnl0ZUNvdW50cycsCiAgMHgwMTQzOiAnVGlsZUxlbmd0aCcsCiAgMHgwMTQ0OiAnVGlsZU9mZnNldHMnLAogIDB4MDE0MjogJ1RpbGVXaWR0aCcsCiAgMHgwMTJEOiAnVHJhbnNmZXJGdW5jdGlvbicsCiAgMHgwMTNFOiAnV2hpdGVQb2ludCcsCiAgMHgwMTU4OiAnWENsaXBQYXRoVW5pdHMnLAogIDB4MDExRTogJ1hQb3NpdGlvbicsCiAgMHgwMjExOiAnWUNiQ3JDb2VmZmljaWVudHMnLAogIDB4MDIxMzogJ1lDYkNyUG9zaXRpb25pbmcnLAogIDB4MDIxMjogJ1lDYkNyU3ViU2FtcGxpbmcnLAogIDB4MDE1OTogJ1lDbGlwUGF0aFVuaXRzJywKICAweDAxMUY6ICdZUG9zaXRpb24nLAoKICAvLyBFWElGCiAgMHg5MjAyOiAnQXBlcnR1cmVWYWx1ZScsCiAgMHhBMDAxOiAnQ29sb3JTcGFjZScsCiAgMHg5MDA0OiAnRGF0ZVRpbWVEaWdpdGl6ZWQnLAogIDB4OTAwMzogJ0RhdGVUaW1lT3JpZ2luYWwnLAogIDB4ODc2OTogJ0V4aWYgSUZEJywKICAweDkwMDA6ICdFeGlmVmVyc2lvbicsCiAgMHg4MjlBOiAnRXhwb3N1cmVUaW1lJywKICAweEEzMDA6ICdGaWxlU291cmNlJywKICAweDkyMDk6ICdGbGFzaCcsCiAgMHhBMDAwOiAnRmxhc2hwaXhWZXJzaW9uJywKICAweDgyOUQ6ICdGTnVtYmVyJywKICAweEE0MjA6ICdJbWFnZVVuaXF1ZUlEJywKICAweDkyMDg6ICdMaWdodFNvdXJjZScsCiAgMHg5MjdDOiAnTWFrZXJOb3RlJywKICAweDkyMDE6ICdTaHV0dGVyU3BlZWRWYWx1ZScsCiAgMHg5Mjg2OiAnVXNlckNvbW1lbnQnLAoKICAvLyBJUFRDCiAgMHg4M0JCOiAnSVBUQycsCgogIC8vIElDQwogIDB4ODc3MzogJ0lDQyBQcm9maWxlJywKCiAgLy8gWE1QCiAgMHgwMkJDOiAnWE1QJywKCiAgLy8gR0RBTAogIDB4QTQ4MDogJ0dEQUxfTUVUQURBVEEnLAogIDB4QTQ4MTogJ0dEQUxfTk9EQVRBJywKCiAgLy8gUGhvdG9zaG9wCiAgMHg4NjQ5OiAnUGhvdG9zaG9wJywKCiAgLy8gR2VvVGlmZgogIDB4ODMwRTogJ01vZGVsUGl4ZWxTY2FsZScsCiAgMHg4NDgyOiAnTW9kZWxUaWVwb2ludCcsCiAgMHg4NUQ4OiAnTW9kZWxUcmFuc2Zvcm1hdGlvbicsCiAgMHg4N0FGOiAnR2VvS2V5RGlyZWN0b3J5JywKICAweDg3QjA6ICdHZW9Eb3VibGVQYXJhbXMnLAogIDB4ODdCMTogJ0dlb0FzY2lpUGFyYW1zJywKCiAgLy8gTEVSQwogIDB4QzVGMjogJ0xlcmNQYXJhbWV0ZXJzJywKfTsKCmNvbnN0IGZpZWxkVGFncyA9IHt9Owpmb3IgKGNvbnN0IGtleSBpbiBmaWVsZFRhZ05hbWVzKSB7CiAgaWYgKGZpZWxkVGFnTmFtZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgZmllbGRUYWdzW2ZpZWxkVGFnTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICB9Cn0KClsKICBmaWVsZFRhZ3MuQml0c1BlclNhbXBsZSwKICBmaWVsZFRhZ3MuRXh0cmFTYW1wbGVzLAogIGZpZWxkVGFncy5TYW1wbGVGb3JtYXQsCiAgZmllbGRUYWdzLlN0cmlwQnl0ZUNvdW50cywKICBmaWVsZFRhZ3MuU3RyaXBPZmZzZXRzLAogIGZpZWxkVGFncy5TdHJpcFJvd0NvdW50cywKICBmaWVsZFRhZ3MuVGlsZUJ5dGVDb3VudHMsCiAgZmllbGRUYWdzLlRpbGVPZmZzZXRzLAogIGZpZWxkVGFncy5TdWJJRkRzLApdOwoKY29uc3QgZmllbGRUeXBlTmFtZXMgPSB7CiAgMHgwMDAxOiAnQllURScsCiAgMHgwMDAyOiAnQVNDSUknLAogIDB4MDAwMzogJ1NIT1JUJywKICAweDAwMDQ6ICdMT05HJywKICAweDAwMDU6ICdSQVRJT05BTCcsCiAgMHgwMDA2OiAnU0JZVEUnLAogIDB4MDAwNzogJ1VOREVGSU5FRCcsCiAgMHgwMDA4OiAnU1NIT1JUJywKICAweDAwMDk6ICdTTE9ORycsCiAgMHgwMDBBOiAnU1JBVElPTkFMJywKICAweDAwMEI6ICdGTE9BVCcsCiAgMHgwMDBDOiAnRE9VQkxFJywKICAvLyBJRkQgb2Zmc2V0LCBzdWdnZXN0ZWQgYnkgaHR0cHM6Ly9vd2wucGh5LnF1ZWVuc3UuY2EvfnBoaWwvZXhpZnRvb2wvc3RhbmRhcmRzLmh0bWwKICAweDAwMEQ6ICdJRkQnLAogIC8vIGludHJvZHVjZWQgYnkgQmlnVElGRgogIDB4MDAxMDogJ0xPTkc4JywKICAweDAwMTE6ICdTTE9ORzgnLAogIDB4MDAxMjogJ0lGRDgnLAp9OwoKY29uc3QgZmllbGRUeXBlcyA9IHt9Owpmb3IgKGNvbnN0IGtleSBpbiBmaWVsZFR5cGVOYW1lcykgewogIGlmIChmaWVsZFR5cGVOYW1lcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICBmaWVsZFR5cGVzW2ZpZWxkVHlwZU5hbWVzW2tleV1dID0gcGFyc2VJbnQoa2V5LCAxMCk7CiAgfQp9Cgpjb25zdCBMZXJjUGFyYW1ldGVycyA9IHsKICBWZXJzaW9uOiAwLAogIEFkZENvbXByZXNzaW9uOiAxLAp9OwoKY29uc3QgTGVyY0FkZENvbXByZXNzaW9uID0gewogIE5vbmU6IDAsCiAgRGVmbGF0ZTogMSwKfTsKCmNvbnN0IGdlb0tleU5hbWVzID0gewogIDEwMjQ6ICdHVE1vZGVsVHlwZUdlb0tleScsCiAgMTAyNTogJ0dUUmFzdGVyVHlwZUdlb0tleScsCiAgMTAyNjogJ0dUQ2l0YXRpb25HZW9LZXknLAogIDIwNDg6ICdHZW9ncmFwaGljVHlwZUdlb0tleScsCiAgMjA0OTogJ0dlb2dDaXRhdGlvbkdlb0tleScsCiAgMjA1MDogJ0dlb2dHZW9kZXRpY0RhdHVtR2VvS2V5JywKICAyMDUxOiAnR2VvZ1ByaW1lTWVyaWRpYW5HZW9LZXknLAogIDIwNTI6ICdHZW9nTGluZWFyVW5pdHNHZW9LZXknLAogIDIwNTM6ICdHZW9nTGluZWFyVW5pdFNpemVHZW9LZXknLAogIDIwNTQ6ICdHZW9nQW5ndWxhclVuaXRzR2VvS2V5JywKICAyMDU1OiAnR2VvZ0FuZ3VsYXJVbml0U2l6ZUdlb0tleScsCiAgMjA1NjogJ0dlb2dFbGxpcHNvaWRHZW9LZXknLAogIDIwNTc6ICdHZW9nU2VtaU1ham9yQXhpc0dlb0tleScsCiAgMjA1ODogJ0dlb2dTZW1pTWlub3JBeGlzR2VvS2V5JywKICAyMDU5OiAnR2VvZ0ludkZsYXR0ZW5pbmdHZW9LZXknLAogIDIwNjA6ICdHZW9nQXppbXV0aFVuaXRzR2VvS2V5JywKICAyMDYxOiAnR2VvZ1ByaW1lTWVyaWRpYW5Mb25nR2VvS2V5JywKICAyMDYyOiAnR2VvZ1RPV0dTODRHZW9LZXknLAogIDMwNzI6ICdQcm9qZWN0ZWRDU1R5cGVHZW9LZXknLAogIDMwNzM6ICdQQ1NDaXRhdGlvbkdlb0tleScsCiAgMzA3NDogJ1Byb2plY3Rpb25HZW9LZXknLAogIDMwNzU6ICdQcm9qQ29vcmRUcmFuc0dlb0tleScsCiAgMzA3NjogJ1Byb2pMaW5lYXJVbml0c0dlb0tleScsCiAgMzA3NzogJ1Byb2pMaW5lYXJVbml0U2l6ZUdlb0tleScsCiAgMzA3ODogJ1Byb2pTdGRQYXJhbGxlbDFHZW9LZXknLAogIDMwNzk6ICdQcm9qU3RkUGFyYWxsZWwyR2VvS2V5JywKICAzMDgwOiAnUHJvak5hdE9yaWdpbkxvbmdHZW9LZXknLAogIDMwODE6ICdQcm9qTmF0T3JpZ2luTGF0R2VvS2V5JywKICAzMDgyOiAnUHJvakZhbHNlRWFzdGluZ0dlb0tleScsCiAgMzA4MzogJ1Byb2pGYWxzZU5vcnRoaW5nR2VvS2V5JywKICAzMDg0OiAnUHJvakZhbHNlT3JpZ2luTG9uZ0dlb0tleScsCiAgMzA4NTogJ1Byb2pGYWxzZU9yaWdpbkxhdEdlb0tleScsCiAgMzA4NjogJ1Byb2pGYWxzZU9yaWdpbkVhc3RpbmdHZW9LZXknLAogIDMwODc6ICdQcm9qRmFsc2VPcmlnaW5Ob3J0aGluZ0dlb0tleScsCiAgMzA4ODogJ1Byb2pDZW50ZXJMb25nR2VvS2V5JywKICAzMDg5OiAnUHJvakNlbnRlckxhdEdlb0tleScsCiAgMzA5MDogJ1Byb2pDZW50ZXJFYXN0aW5nR2VvS2V5JywKICAzMDkxOiAnUHJvakNlbnRlck5vcnRoaW5nR2VvS2V5JywKICAzMDkyOiAnUHJvalNjYWxlQXROYXRPcmlnaW5HZW9LZXknLAogIDMwOTM6ICdQcm9qU2NhbGVBdENlbnRlckdlb0tleScsCiAgMzA5NDogJ1Byb2pBemltdXRoQW5nbGVHZW9LZXknLAogIDMwOTU6ICdQcm9qU3RyYWlnaHRWZXJ0UG9sZUxvbmdHZW9LZXknLAogIDMwOTY6ICdQcm9qUmVjdGlmaWVkR3JpZEFuZ2xlR2VvS2V5JywKICA0MDk2OiAnVmVydGljYWxDU1R5cGVHZW9LZXknLAogIDQwOTc6ICdWZXJ0aWNhbENpdGF0aW9uR2VvS2V5JywKICA0MDk4OiAnVmVydGljYWxEYXR1bUdlb0tleScsCiAgNDA5OTogJ1ZlcnRpY2FsVW5pdHNHZW9LZXknLAp9OwoKY29uc3QgZ2VvS2V5cyA9IHt9Owpmb3IgKGNvbnN0IGtleSBpbiBnZW9LZXlOYW1lcykgewogIGlmIChnZW9LZXlOYW1lcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICBnZW9LZXlzW2dlb0tleU5hbWVzW2tleV1dID0gcGFyc2VJbnQoa2V5LCAxMCk7CiAgfQp9Cgpjb25zdCByZWdpc3RyeSA9IG5ldyBNYXAoKTsKCmZ1bmN0aW9uIGFkZERlY29kZXIoY2FzZXMsIGltcG9ydEZuKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGNhc2VzKSkgewogICAgY2FzZXMgPSBbY2FzZXNdOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXBhcmFtLXJlYXNzaWduCiAgfQogIGNhc2VzLmZvckVhY2goKGMpID0+IHJlZ2lzdHJ5LnNldChjLCBpbXBvcnRGbikpOwp9Cgphc3luYyBmdW5jdGlvbiBnZXREZWNvZGVyKGZpbGVEaXJlY3RvcnkpIHsKICBjb25zdCBpbXBvcnRGbiA9IHJlZ2lzdHJ5LmdldChmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9uKTsKICBpZiAoIWltcG9ydEZuKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIGlkZW50aWZpZXI6ICR7ZmlsZURpcmVjdG9yeS5Db21wcmVzc2lvbn1gKTsKICB9CiAgY29uc3QgRGVjb2RlciA9IGF3YWl0IGltcG9ydEZuKCk7CiAgcmV0dXJuIG5ldyBEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwp9CgovLyBBZGQgZGVmYXVsdCBkZWNvZGVycyB0byByZWdpc3RyeSAoZW5kLXVzZXIgbWF5IG92ZXJyaWRlIHdpdGggb3RoZXIgaW1wbGVtZW50YXRpb25zKQphZGREZWNvZGVyKFt1bmRlZmluZWQsIDFdLCAoKSA9PiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJhdzsgfSkudGhlbigobSkgPT4gbS5kZWZhdWx0KSk7CmFkZERlY29kZXIoNSwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBsenc7IH0pLnRoZW4oKG0pID0+IG0uZGVmYXVsdCkpOwphZGREZWNvZGVyKDYsICgpID0+IHsKICB0aHJvdyBuZXcgRXJyb3IoJ29sZCBzdHlsZSBKUEVHIGNvbXByZXNzaW9uIGlzIG5vdCBzdXBwb3J0ZWQuJyk7Cn0pOwphZGREZWNvZGVyKDcsICgpID0+IFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4ganBlZzsgfSkudGhlbigobSkgPT4gbS5kZWZhdWx0KSk7CmFkZERlY29kZXIoWzgsIDMyOTQ2XSwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBkZWZsYXRlOyB9KS50aGVuKChtKSA9PiBtLmRlZmF1bHQpKTsKYWRkRGVjb2RlcigzMjc3MywgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBwYWNrYml0czsgfSkudGhlbigobSkgPT4gbS5kZWZhdWx0KSk7CmFkZERlY29kZXIoMzQ4ODcsICgpID0+IFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gbGVyYzsgfSkudGhlbigobSkgPT4gbS5kZWZhdWx0KSk7CmFkZERlY29kZXIoNTAwMDEsICgpID0+IFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gd2ViaW1hZ2U7IH0pLnRoZW4oKG0pID0+IG0uZGVmYXVsdCkpOwoKZnVuY3Rpb24gZGVjb2RlUm93QWNjKHJvdywgc3RyaWRlKSB7CiAgbGV0IGxlbmd0aCA9IHJvdy5sZW5ndGggLSBzdHJpZGU7CiAgbGV0IG9mZnNldCA9IDA7CiAgZG8gewogICAgZm9yIChsZXQgaSA9IHN0cmlkZTsgaSA+IDA7IGktLSkgewogICAgICByb3dbb2Zmc2V0ICsgc3RyaWRlXSArPSByb3dbb2Zmc2V0XTsKICAgICAgb2Zmc2V0Kys7CiAgICB9CgogICAgbGVuZ3RoIC09IHN0cmlkZTsKICB9IHdoaWxlIChsZW5ndGggPiAwKTsKfQoKZnVuY3Rpb24gZGVjb2RlUm93RmxvYXRpbmdQb2ludChyb3csIHN0cmlkZSwgYnl0ZXNQZXJTYW1wbGUpIHsKICBsZXQgaW5kZXggPSAwOwogIGxldCBjb3VudCA9IHJvdy5sZW5ndGg7CiAgY29uc3Qgd2MgPSBjb3VudCAvIGJ5dGVzUGVyU2FtcGxlOwoKICB3aGlsZSAoY291bnQgPiBzdHJpZGUpIHsKICAgIGZvciAobGV0IGkgPSBzdHJpZGU7IGkgPiAwOyAtLWkpIHsKICAgICAgcm93W2luZGV4ICsgc3RyaWRlXSArPSByb3dbaW5kZXhdOwogICAgICArK2luZGV4OwogICAgfQogICAgY291bnQgLT0gc3RyaWRlOwogIH0KCiAgY29uc3QgY29weSA9IHJvdy5zbGljZSgpOwogIGZvciAobGV0IGkgPSAwOyBpIDwgd2M7ICsraSkgewogICAgZm9yIChsZXQgYiA9IDA7IGIgPCBieXRlc1BlclNhbXBsZTsgKytiKSB7CiAgICAgIHJvd1soYnl0ZXNQZXJTYW1wbGUgKiBpKSArIGJdID0gY29weVsoKGJ5dGVzUGVyU2FtcGxlIC0gYiAtIDEpICogd2MpICsgaV07CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBhcHBseVByZWRpY3RvcihibG9jaywgcHJlZGljdG9yLCB3aWR0aCwgaGVpZ2h0LCBiaXRzUGVyU2FtcGxlLAogIHBsYW5hckNvbmZpZ3VyYXRpb24pIHsKICBpZiAoIXByZWRpY3RvciB8fCBwcmVkaWN0b3IgPT09IDEpIHsKICAgIHJldHVybiBibG9jazsKICB9CgogIGZvciAobGV0IGkgPSAwOyBpIDwgYml0c1BlclNhbXBsZS5sZW5ndGg7ICsraSkgewogICAgaWYgKGJpdHNQZXJTYW1wbGVbaV0gJSA4ICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignV2hlbiBkZWNvZGluZyB3aXRoIHByZWRpY3Rvciwgb25seSBtdWx0aXBsZSBvZiA4IGJpdHMgYXJlIHN1cHBvcnRlZC4nKTsKICAgIH0KICAgIGlmIChiaXRzUGVyU2FtcGxlW2ldICE9PSBiaXRzUGVyU2FtcGxlWzBdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignV2hlbiBkZWNvZGluZyB3aXRoIHByZWRpY3RvciwgYWxsIHNhbXBsZXMgbXVzdCBoYXZlIHRoZSBzYW1lIHNpemUuJyk7CiAgICB9CiAgfQoKICBjb25zdCBieXRlc1BlclNhbXBsZSA9IGJpdHNQZXJTYW1wbGVbMF0gLyA4OwogIGNvbnN0IHN0cmlkZSA9IHBsYW5hckNvbmZpZ3VyYXRpb24gPT09IDIgPyAxIDogYml0c1BlclNhbXBsZS5sZW5ndGg7CgogIGZvciAobGV0IGkgPSAwOyBpIDwgaGVpZ2h0OyArK2kpIHsKICAgIC8vIExhc3Qgc3RyaXAgd2lsbCBiZSB0cnVuY2F0ZWQgaWYgaGVpZ2h0ICUgc3RyaXBIZWlnaHQgIT0gMAogICAgaWYgKGkgKiBzdHJpZGUgKiB3aWR0aCAqIGJ5dGVzUGVyU2FtcGxlID49IGJsb2NrLmJ5dGVMZW5ndGgpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBsZXQgcm93OwogICAgaWYgKHByZWRpY3RvciA9PT0gMikgeyAvLyBob3Jpem9udGFsIHByZWRpY3Rpb24KICAgICAgc3dpdGNoIChiaXRzUGVyU2FtcGxlWzBdKSB7CiAgICAgICAgY2FzZSA4OgogICAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkoCiAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwKICAgICAgICAgICk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE2OgogICAgICAgICAgcm93ID0gbmV3IFVpbnQxNkFycmF5KAogICAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUgLyAyLAogICAgICAgICAgKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzI6CiAgICAgICAgICByb3cgPSBuZXcgVWludDMyQXJyYXkoCiAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDQsCiAgICAgICAgICApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUHJlZGljdG9yIDIgbm90IGFsbG93ZWQgd2l0aCAke2JpdHNQZXJTYW1wbGVbMF19IGJpdHMgcGVyIHNhbXBsZS5gKTsKICAgICAgfQogICAgICBkZWNvZGVSb3dBY2Mocm93LCBzdHJpZGUpOwogICAgfSBlbHNlIGlmIChwcmVkaWN0b3IgPT09IDMpIHsgLy8gaG9yaXpvbnRhbCBmbG9hdGluZyBwb2ludAogICAgICByb3cgPSBuZXcgVWludDhBcnJheSgKICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICk7CiAgICAgIGRlY29kZVJvd0Zsb2F0aW5nUG9pbnQocm93LCBzdHJpZGUsIGJ5dGVzUGVyU2FtcGxlKTsKICAgIH0KICB9CiAgcmV0dXJuIGJsb2NrOwp9CgpjbGFzcyBCYXNlRGVjb2RlciB7CiAgYXN5bmMgZGVjb2RlKGZpbGVEaXJlY3RvcnksIGJ1ZmZlcikgewogICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuZGVjb2RlQmxvY2soYnVmZmVyKTsKICAgIGNvbnN0IHByZWRpY3RvciA9IGZpbGVEaXJlY3RvcnkuUHJlZGljdG9yIHx8IDE7CiAgICBpZiAocHJlZGljdG9yICE9PSAxKSB7CiAgICAgIGNvbnN0IGlzVGlsZWQgPSAhZmlsZURpcmVjdG9yeS5TdHJpcE9mZnNldHM7CiAgICAgIGNvbnN0IHRpbGVXaWR0aCA9IGlzVGlsZWQgPyBmaWxlRGlyZWN0b3J5LlRpbGVXaWR0aCA6IGZpbGVEaXJlY3RvcnkuSW1hZ2VXaWR0aDsKICAgICAgY29uc3QgdGlsZUhlaWdodCA9IGlzVGlsZWQgPyBmaWxlRGlyZWN0b3J5LlRpbGVMZW5ndGggOiAoCiAgICAgICAgZmlsZURpcmVjdG9yeS5Sb3dzUGVyU3RyaXAgfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aAogICAgICApOwogICAgICByZXR1cm4gYXBwbHlQcmVkaWN0b3IoCiAgICAgICAgZGVjb2RlZCwgcHJlZGljdG9yLCB0aWxlV2lkdGgsIHRpbGVIZWlnaHQsIGZpbGVEaXJlY3RvcnkuQml0c1BlclNhbXBsZSwKICAgICAgICBmaWxlRGlyZWN0b3J5LlBsYW5hckNvbmZpZ3VyYXRpb24sCiAgICAgICk7CiAgICB9CiAgICByZXR1cm4gZGVjb2RlZDsKICB9Cn0KCmxldCBBLEk9bnVsbDtmdW5jdGlvbiBnKCl7cmV0dXJuIG51bGwhPT1JJiZJLmJ1ZmZlcj09PUEubWVtb3J5LmJ1ZmZlcnx8KEk9bmV3IFVpbnQ4QXJyYXkoQS5tZW1vcnkuYnVmZmVyKSksSX1sZXQgQj0wO2xldCBRPW51bGw7ZnVuY3Rpb24gQygpe3JldHVybiBudWxsIT09USYmUS5idWZmZXI9PT1BLm1lbW9yeS5idWZmZXJ8fChRPW5ldyBJbnQzMkFycmF5KEEubWVtb3J5LmJ1ZmZlcikpLFF9YXN5bmMgZnVuY3Rpb24gRShJKXt2b2lkIDA9PT1JJiYoST0iIi5yZXBsYWNlKC9cLmpzJC8sIl9iZy53YXNtIikpOygic3RyaW5nIj09dHlwZW9mIEl8fCJmdW5jdGlvbiI9PXR5cGVvZiBSZXF1ZXN0JiZJIGluc3RhbmNlb2YgUmVxdWVzdHx8ImZ1bmN0aW9uIj09dHlwZW9mIFVSTCYmSSBpbnN0YW5jZW9mIFVSTCkmJihJPWZldGNoKEkpKTtjb25zdHtpbnN0YW5jZTpnLG1vZHVsZTpCfT1hd2FpdCBhc3luYyBmdW5jdGlvbihBLEkpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBSZXNwb25zZSYmQSBpbnN0YW5jZW9mIFJlc3BvbnNlKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcpdHJ5e3JldHVybiBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhBLEkpfWNhdGNoKEkpe2lmKCJhcHBsaWNhdGlvbi93YXNtIj09QS5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIikpdGhyb3cgSTtjb25zb2xlLndhcm4oImBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZ2AgZmFpbGVkIGJlY2F1c2UgeW91ciBzZXJ2ZXIgZG9lcyBub3Qgc2VydmUgd2FzbSB3aXRoIGBhcHBsaWNhdGlvbi93YXNtYCBNSU1FIHR5cGUuIEZhbGxpbmcgYmFjayB0byBgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVgIHdoaWNoIGlzIHNsb3dlci4gT3JpZ2luYWwgZXJyb3I6XG4iLEkpO31jb25zdCBnPWF3YWl0IEEuYXJyYXlCdWZmZXIoKTtyZXR1cm4gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoZyxJKX17Y29uc3QgZz1hd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShBLEkpO3JldHVybiBnIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuSW5zdGFuY2U/e2luc3RhbmNlOmcsbW9kdWxlOkF9Omd9fShhd2FpdCBJLHt9KTtyZXR1cm4gQT1nLmV4cG9ydHMsRS5fX3diaW5kZ2VuX3dhc21fbW9kdWxlPUIsQX12YXIgRD1PYmplY3QuZnJlZXplKHtfX3Byb3RvX186bnVsbCxkZWNvbXByZXNzOmZ1bmN0aW9uKEksUSl7dHJ5e2NvbnN0IEY9QS5fX3diaW5kZ2VuX2FkZF90b19zdGFja19wb2ludGVyKC0xNik7dmFyIEU9ZnVuY3Rpb24oQSxJKXtjb25zdCBRPUkoMSpBLmxlbmd0aCk7cmV0dXJuIGcoKS5zZXQoQSxRLzEpLEI9QS5sZW5ndGgsUX0oSSxBLl9fd2JpbmRnZW5fbWFsbG9jKSxEPUI7QS5kZWNvbXByZXNzKEYsRSxELFEpO3ZhciBpPUMoKVtGLzQrMF0sdz1DKClbRi80KzFdLEc9KG89aSxOPXcsZygpLnN1YmFycmF5KG8vMSxvLzErTikpLnNsaWNlKCk7cmV0dXJuIEEuX193YmluZGdlbl9mcmVlKGksMSp3KSxHfWZpbmFsbHl7QS5fX3diaW5kZ2VuX2FkZF90b19zdGFja19wb2ludGVyKDE2KTt9dmFyIG8sTjt9LGRlZmF1bHQ6RX0pO2NvbnN0IGk9WzYyLDAsMCwwLDYzLDUyLDUzLDU0LDU1LDU2LDU3LDU4LDU5LDYwLDYxLDAsMCwwLDAsMCwwLDAsMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOSwyMCwyMSwyMiwyMywyNCwyNSwwLDAsMCwwLDAsMCwyNiwyNywyOCwyOSwzMCwzMSwzMiwzMywzNCwzNSwzNiwzNywzOCwzOSw0MCw0MSw0Miw0Myw0NCw0NSw0Niw0Nyw0OCw0OSw1MCw1MV07ZnVuY3Rpb24gdyhBKXtyZXR1cm4gaVtBLTQzXX1jb25zdCBHPWZ1bmN0aW9uKEEpe2xldCBJLGc9QS5lbmRzV2l0aCgiPT0iKT8yOkEuZW5kc1dpdGgoIj0iKT8xOjAsQj1BLmxlbmd0aCxRPW5ldyBVaW50OEFycmF5KEIvNCozKTtmb3IobGV0IGc9MCxDPTA7ZzxCO2crPTQsQys9MylJPXcoQS5jaGFyQ29kZUF0KGcpKTw8MTh8dyhBLmNoYXJDb2RlQXQoZysxKSk8PDEyfHcoQS5jaGFyQ29kZUF0KGcrMikpPDw2fHcoQS5jaGFyQ29kZUF0KGcrMykpLFFbQ109ST4+MTYsUVtDKzFdPUk+PjgmMjU1LFFbQysyXT0yNTUmSTtyZXR1cm4gUS5zdWJhcnJheSgwLFEubGVuZ3RoLWcpfSgiQUdGemJRRUFBQUFCV1E1Z0FuOS9BWDlnQTM5L2Z3Ri9ZQUovZndCZ0FYOEFZQU4vZjM4QVlBRi9BWDlnQkg5L2YzOEFZQVIvZjM5L0FYOWdCbjkvZjM5L2Z3QmdBWDhCZm1BQUFHQUZmMzkvZjM4QVlBVi9mMzkvZndGL1lBSitmd0YvQTIxc0JRZ0lDd01CQWdVTUFRQUJBQUlBQlFBQ0FnWUdEUVlEQWdBQ0FBQUVCQVFDQWdZR0FBWUJCZ0lIQXdRREJBUURBd0FEQlFNREJBUUVCQVFDQWdBSEFBUUFBZ01CQWdjRkJBSURBUVVDQWdJREFnSURBd2NDQVFBQUJBSUFDZ0FBQVFBRkFnQURCUWtKQ1FNQ0JBVUJjQUVyS3dVREFRQVJCZ2tCZndGQmdJREFBQXNIWHdVR2JXVnRiM0o1QWdBS1pHVmpiMjF3Y21WemN3QW5IMTlmZDJKcGJtUm5aVzVmWVdSa1gzUnZYM04wWVdOclgzQnZhVzUwWlhJQVloRmZYM2RpYVc1a1oyVnVYMjFoYkd4dll3Qk1EMTlmZDJKcGJtUm5aVzVmWm5KbFpRQldDVEFCQUVFQkN5cHFKRFVDWm1WRE5RRm1aVU5oYTJwWEREMXBWQm9oU1Z0VGFHZGZYREVPWGxocWFRc2NRV0FiUDJRS3N1Z0JiTk1xQWdoL0FYNENRQUpBQWtBQ1FDQUFRZlVCVHdSQUlBQkJ6Zjk3VHcwQ0lBQkJDMm9pQUVGNGNTRUdRWkNud0FBb0FnQWlDRVVOQVVFQUlBWnJJUVFDUUFKQUFuOUJBQ0FBUVFoMklnQkZEUUFhUVI4Z0JrSC8vLzhIU3cwQUdpQUdRUVlnQUdjaUFHdEJIM0YyUVFGeElBQkJBWFJyUVQ1cUN5SUhRUUowUVp5cHdBQnFLQUlBSWdBRVFDQUdRUUJCR1NBSFFRRjJhMEVmY1NBSFFSOUdHM1FoQWdOQUFrQWdBRUVFYWlnQ0FFRjRjU0lGSUFaSkRRQWdCU0FHYXlJRklBUlBEUUFnQUNFRElBVWlCQTBBUVFBaEJBd0RDeUFBUVJScUtBSUFJZ1VnQVNBRklBQWdBa0VkZGtFRWNXcEJFR29vQWdBaUFFY2JJQUVnQlJzaEFTQUNRUUYwSVFJZ0FBMEFDeUFCQkVBZ0FTRUFEQUlMSUFNTkFndEJBQ0VEUVFJZ0IwRWZjWFFpQUVFQUlBQnJjaUFJY1NJQVJRMERJQUJCQUNBQWEzRm9RUUowUVp5cHdBQnFLQUlBSWdCRkRRTUxBMEFnQUNBRElBQkJCR29vQWdCQmVIRWlBaUFHVHlBQ0lBWnJJZ0lnQkVseElnRWJJUU1nQWlBRUlBRWJJUVFnQUNnQ0VDSUNCSDhnQWdVZ0FFRVVhaWdDQUFzaUFBMEFDeUFEUlEwQ0MwR2Nxc0FBS0FJQUlnQWdCazlCQUNBRUlBQWdCbXRQR3cwQklBTW9BaGdoQndKQUFrQWdBeUFES0FJTUlnRkdCRUFnQTBFVVFSQWdBMEVVYWlJQ0tBSUFJZ0ViYWlnQ0FDSUFEUUZCQUNFQkRBSUxJQU1vQWdnaUFDQUJOZ0lNSUFFZ0FEWUNDQXdCQ3lBQ0lBTkJFR29nQVJzaEFnTkFJQUloQlNBQUlnRkJGR29pQWlnQ0FDSUFSUVJBSUFGQkVHb2hBaUFCS0FJUUlRQUxJQUFOQUFzZ0JVRUFOZ0lBQ3dKQUlBZEZEUUFDUUNBRElBTW9BaHhCQW5SQm5LbkFBR29pQUNnQ0FFY0VRQ0FIUVJCQkZDQUhLQUlRSUFOR0cyb2dBVFlDQUNBQlJRMENEQUVMSUFBZ0FUWUNBQ0FCRFFCQmtLZkFBRUdRcDhBQUtBSUFRWDRnQXlnQ0hIZHhOZ0lBREFFTElBRWdCellDR0NBREtBSVFJZ0FFUUNBQklBQTJBaEFnQUNBQk5nSVlDeUFEUVJScUtBSUFJZ0JGRFFBZ0FVRVVhaUFBTmdJQUlBQWdBVFlDR0FzQ1FDQUVRUkJQQkVBZ0F5QUdRUU55TmdJRUlBTWdCbW9pQlNBRVFRRnlOZ0lFSUFRZ0JXb2dCRFlDQUNBRVFZQUNUd1JBSUFWQ0FEY0NFQ0FGQW45QkFDQUVRUWgySWdCRkRRQWFRUjhnQkVILy8vOEhTdzBBR2lBRVFRWWdBR2NpQUd0QkgzRjJRUUZ4SUFCQkFYUnJRVDVxQ3lJQU5nSWNJQUJCQW5SQm5LbkFBR29oQWdKQUFrQUNRQUpBUVpDbndBQW9BZ0FpQVVFQklBQkJIM0YwSWdaeEJFQWdBaWdDQUNJQ1FRUnFLQUlBUVhoeElBUkhEUUVnQWlFQURBSUxRWkNud0FBZ0FTQUdjallDQUNBQ0lBVTJBZ0FNQXdzZ0JFRUFRUmtnQUVFQmRtdEJIM0VnQUVFZlJodDBJUUVEUUNBQ0lBRkJIWFpCQkhGcVFSQnFJZ1lvQWdBaUFFVU5BaUFCUVFGMElRRWdBQ0VDSUFCQkJHb29BZ0JCZUhFZ0JFY05BQXNMSUFBb0FnZ2lBaUFGTmdJTUlBQWdCVFlDQ0NBRlFRQTJBaGdnQlNBQU5nSU1JQVVnQWpZQ0NBd0VDeUFHSUFVMkFnQUxJQVVnQWpZQ0dDQUZJQVUyQWd3Z0JTQUZOZ0lJREFJTElBUkJBM1lpQWtFRGRFR1VwOEFBYWlFQUFuOUJqS2ZBQUNnQ0FDSUJRUUVnQW5RaUFuRUVRQ0FBS0FJSURBRUxRWXlud0FBZ0FTQUNjallDQUNBQUN5RUNJQUFnQlRZQ0NDQUNJQVUyQWd3Z0JTQUFOZ0lNSUFVZ0FqWUNDQXdCQ3lBRElBUWdCbW9pQUVFRGNqWUNCQ0FBSUFOcUlnQWdBQ2dDQkVFQmNqWUNCQXNnQTBFSWFnOExBa0FDUUVHTXA4QUFLQUlBSWdGQkVDQUFRUXRxUVhoeElBQkJDMGtiSWdaQkEzWWlBSFlpQWtFRGNVVUVRQ0FHUVp5cXdBQW9BZ0JORFFNZ0FnMEJRWkNud0FBb0FnQWlBRVVOQXlBQVFRQWdBR3R4YUVFQ2RFR2NxY0FBYWlnQ0FDSUJRUVJxS0FJQVFYaHhJQVpySVFRZ0FTRUNBMEFnQVNnQ0VDSUFSUVJBSUFGQkZHb29BZ0FpQUVVTkJBc2dBRUVFYWlnQ0FFRjRjU0FHYXlJQklBUWdBU0FFU1NJQkd5RUVJQUFnQWlBQkd5RUNJQUFoQVF3QUN3QUxBa0FnQWtGL2MwRUJjU0FBYWlJQVFRTjBRWXlud0FCcUlnTkJFR29vQWdBaUFrRUlhaUlGS0FJQUlnUWdBMEVJYWlJRFJ3UkFJQVFnQXpZQ0RDQURJQVEyQWdnTUFRdEJqS2ZBQUNBQlFYNGdBSGR4TmdJQUN5QUNJQUJCQTNRaUFFRURjallDQkNBQUlBSnFJZ0FnQUNnQ0JFRUJjallDQkNBRkR3c0NRRUVDSUFCMElnUkJBQ0FFYTNJZ0FpQUFkSEVpQUVFQUlBQnJjV2dpQWtFRGRFR01wOEFBYWlJRFFSQnFLQUlBSWdCQkNHb2lCU2dDQUNJRUlBTkJDR29pQTBjRVFDQUVJQU0yQWd3Z0F5QUVOZ0lJREFFTFFZeW53QUFnQVVGK0lBSjNjVFlDQUFzZ0FDQUdRUU55TmdJRUlBQWdCbW9pQXlBQ1FRTjBJZ0lnQm1zaUFVRUJjallDQkNBQUlBSnFJQUUyQWdCQm5LckFBQ2dDQUNJQUJFQWdBRUVEZGlJRVFRTjBRWlNud0FCcUlRQkJwS3JBQUNnQ0FDRUNBbjlCaktmQUFDZ0NBQ0lHUVFFZ0JFRWZjWFFpQkhFRVFDQUFLQUlJREFFTFFZeW53QUFnQkNBR2NqWUNBQ0FBQ3lFRUlBQWdBallDQ0NBRUlBSTJBZ3dnQWlBQU5nSU1JQUlnQkRZQ0NBdEJwS3JBQUNBRE5nSUFRWnlxd0FBZ0FUWUNBQ0FGRHdzZ0FpZ0NHQ0VIQWtBQ1FDQUNJQUlvQWd3aUFVWUVRQ0FDUVJSQkVDQUNRUlJxSWdFb0FnQWlBeHRxS0FJQUlnQU5BVUVBSVFFTUFnc2dBaWdDQ0NJQUlBRTJBZ3dnQVNBQU5nSUlEQUVMSUFFZ0FrRVFhaUFER3lFREEwQWdBeUVGSUFBaUFVRVVhaUlES0FJQUlnQkZCRUFnQVVFUWFpRURJQUVvQWhBaEFBc2dBQTBBQ3lBRlFRQTJBZ0FMSUFkRkRRTWdBaUFDS0FJY1FRSjBRWnlwd0FCcUlnQW9BZ0JIQkVBZ0IwRVFRUlFnQnlnQ0VDQUNSaHRxSUFFMkFnQWdBVVVOQkF3REN5QUFJQUUyQWdBZ0FRMENRWkNud0FCQmtLZkFBQ2dDQUVGK0lBSW9BaHgzY1RZQ0FBd0RDd0pBQWtBQ1FBSkFBa0JCbktyQUFDZ0NBQ0lBSUFaSkJFQkJvS3JBQUNnQ0FDSUFJQVpMRFFOQkFDRUNJQVpCcjRBRWFpSUFRUkIyUUFBaUFVRi9SZzBHSUFGQkVIUWlCVVVOQmtHc3FzQUFJQUJCZ0lCOGNTSUVRYXlxd0FBb0FnQnFJZ0EyQWdCQnNLckFBRUd3cXNBQUtBSUFJZ0VnQUNBQklBQkxHellDQUVHb3FzQUFLQUlBSWdORkRRRkJ0S3JBQUNFQUEwQWdBQ2dDQUNJQklBQW9BZ1FpQjJvZ0JVWU5BeUFBS0FJSUlnQU5BQXNNQkF0QnBLckFBQ2dDQUNFQ0FuOGdBQ0FHYXlJQlFROU5CRUJCcEtyQUFFRUFOZ0lBUVp5cXdBQkJBRFlDQUNBQ0lBQkJBM0kyQWdRZ0FDQUNhaUlCUVFScUlRQWdBU2dDQkVFQmNnd0JDMEdjcXNBQUlBRTJBZ0JCcEtyQUFDQUNJQVpxSWdRMkFnQWdCQ0FCUVFGeU5nSUVJQUFnQW1vZ0FUWUNBQ0FDUVFScUlRQWdCa0VEY2dzaEFTQUFJQUUyQWdBZ0FrRUlhZzhMUWNpcXdBQW9BZ0FpQUVFQUlBQWdCVTBiUlFSQVFjaXF3QUFnQlRZQ0FBdEJ6S3JBQUVIL0h6WUNBRUcwcXNBQUlBVTJBZ0JCd0tyQUFFRUFOZ0lBUWJpcXdBQWdCRFlDQUVHZ3A4QUFRWlNud0FBMkFnQkJxS2ZBQUVHY3A4QUFOZ0lBUVp5bndBQkJsS2ZBQURZQ0FFR3dwOEFBUWFTbndBQTJBZ0JCcEtmQUFFR2NwOEFBTmdJQVFiaW53QUJCcktmQUFEWUNBRUdzcDhBQVFhU253QUEyQWdCQndLZkFBRUcwcDhBQU5nSUFRYlNud0FCQnJLZkFBRFlDQUVISXA4QUFRYnlud0FBMkFnQkJ2S2ZBQUVHMHA4QUFOZ0lBUWRDbndBQkJ4S2ZBQURZQ0FFSEVwOEFBUWJ5bndBQTJBZ0JCMktmQUFFSE1wOEFBTmdJQVFjeW53QUJCeEtmQUFEWUNBRUhncDhBQVFkU253QUEyQWdCQjFLZkFBRUhNcDhBQU5nSUFRZHlud0FCQjFLZkFBRFlDQUVIb3A4QUFRZHlud0FBMkFnQkI1S2ZBQUVIY3A4QUFOZ0lBUWZDbndBQkI1S2ZBQURZQ0FFSHNwOEFBUWVTbndBQTJBZ0JCK0tmQUFFSHNwOEFBTmdJQVFmU253QUJCN0tmQUFEWUNBRUdBcU1BQVFmU253QUEyQWdCQi9LZkFBRUgwcDhBQU5nSUFRWWlvd0FCQi9LZkFBRFlDQUVHRXFNQUFRZnlud0FBMkFnQkJrS2pBQUVHRXFNQUFOZ0lBUVl5b3dBQkJoS2pBQURZQ0FFR1lxTUFBUVl5b3dBQTJBZ0JCbEtqQUFFR01xTUFBTmdJQVFhQ293QUJCbEtqQUFEWUNBRUdvcU1BQVFaeW93QUEyQWdCQm5LakFBRUdVcU1BQU5nSUFRYkNvd0FCQnBLakFBRFlDQUVHa3FNQUFRWnlvd0FBMkFnQkJ1S2pBQUVHc3FNQUFOZ0lBUWF5b3dBQkJwS2pBQURZQ0FFSEFxTUFBUWJTb3dBQTJBZ0JCdEtqQUFFR3NxTUFBTmdJQVFjaW93QUJCdktqQUFEWUNBRUc4cU1BQVFiU293QUEyQWdCQjBLakFBRUhFcU1BQU5nSUFRY1Nvd0FCQnZLakFBRFlDQUVIWXFNQUFRY3lvd0FBMkFnQkJ6S2pBQUVIRXFNQUFOZ0lBUWVDb3dBQkIxS2pBQURZQ0FFSFVxTUFBUWN5b3dBQTJBZ0JCNktqQUFFSGNxTUFBTmdJQVFkeW93QUJCMUtqQUFEWUNBRUh3cU1BQVFlU293QUEyQWdCQjVLakFBRUhjcU1BQU5nSUFRZmlvd0FCQjdLakFBRFlDQUVIc3FNQUFRZVNvd0FBMkFnQkJnS25BQUVIMHFNQUFOZ0lBUWZTb3dBQkI3S2pBQURZQ0FFR0lxY0FBUWZ5b3dBQTJBZ0JCL0tqQUFFSDBxTUFBTmdJQVFaQ3B3QUJCaEtuQUFEWUNBRUdFcWNBQVFmeW93QUEyQWdCQm1LbkFBRUdNcWNBQU5nSUFRWXlwd0FCQmhLbkFBRFlDQUVHb3FzQUFJQVUyQWdCQmxLbkFBRUdNcWNBQU5nSUFRYUNxd0FBZ0JFRllhaUlBTmdJQUlBVWdBRUVCY2pZQ0JDQUFJQVZxUVNnMkFnUkJ4S3JBQUVHQWdJQUJOZ0lBREFNTElBQkJER29vQWdBZ0JTQURUWElnQVNBRFMzSU5BU0FBSUFRZ0IybzJBZ1JCcUtyQUFFR29xc0FBS0FJQUlnQkJEMnBCZUhFaUFVRjRhallDQUVHZ3FzQUFRYUNxd0FBb0FnQWdCR29pQkNBQUlBRnJha0VJYWlJRE5nSUFJQUZCZkdvZ0EwRUJjallDQUNBQUlBUnFRU2cyQWdSQnhLckFBRUdBZ0lBQk5nSUFEQUlMUWFDcXdBQWdBQ0FHYXlJQ05nSUFRYWlxd0FCQnFLckFBQ2dDQUNJQUlBWnFJZ0UyQWdBZ0FTQUNRUUZ5TmdJRUlBQWdCa0VEY2pZQ0JDQUFRUWhxSVFJTUFndEJ5S3JBQUVISXFzQUFLQUlBSWdBZ0JTQUFJQVZKR3pZQ0FDQUVJQVZxSVFGQnRLckFBQ0VBQWtBRFFDQUJJQUFvQWdCSEJFQWdBQ2dDQ0NJQURRRU1BZ3NMSUFCQkRHb29BZ0FOQUNBQUlBVTJBZ0FnQUNBQUtBSUVJQVJxTmdJRUlBVWdCa0VEY2pZQ0JDQUZJQVpxSVFBZ0FTQUZheUFHYXlFR0FrQUNRQ0FCUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQlJnMEJJQUZCQkdvb0FnQWlBa0VEY1VFQlJnUkFJQUVnQWtGNGNTSUNFQkVnQWlBR2FpRUdJQUVnQW1vaEFRc2dBU0FCS0FJRVFYNXhOZ0lFSUFBZ0JrRUJjallDQkNBQUlBWnFJQVkyQWdBZ0JrR0FBazhFUUNBQVFnQTNBaEFnQUFKL1FRQWdCa0VJZGlJQ1JRMEFHa0VmSUFaQi8vLy9CMHNOQUJvZ0JrRUdJQUpuSWdKclFSOXhka0VCY1NBQ1FRRjBhMEUrYWdzaUFUWUNIQ0FCUVFKMFFaeXB3QUJxSVFJQ1FBSkFBa0FDUUVHUXA4QUFLQUlBSWdSQkFTQUJRUjl4ZENJRGNRUkFJQUlvQWdBaUFrRUVhaWdDQUVGNGNTQUdSdzBCSUFJaEJBd0NDMEdRcDhBQUlBTWdCSEkyQWdBZ0FpQUFOZ0lBREFNTElBWkJBRUVaSUFGQkFYWnJRUjl4SUFGQkgwWWJkQ0VCQTBBZ0FpQUJRUjEyUVFSeGFrRVFhaUlES0FJQUlnUkZEUUlnQVVFQmRDRUJJQVFpQWtFRWFpZ0NBRUY0Y1NBR1J3MEFDd3NnQkNnQ0NDSUNJQUEyQWd3Z0JDQUFOZ0lJSUFCQkFEWUNHQ0FBSUFRMkFnd2dBQ0FDTmdJSURBVUxJQU1nQURZQ0FBc2dBQ0FDTmdJWUlBQWdBRFlDRENBQUlBQTJBZ2dNQXdzZ0JrRURkaUlCUVFOMFFaU253QUJxSVFJQ2YwR01wOEFBS0FJQUlnUkJBU0FCZENJQmNRUkFJQUlvQWdnTUFRdEJqS2ZBQUNBQklBUnlOZ0lBSUFJTElRRWdBaUFBTmdJSUlBRWdBRFlDRENBQUlBSTJBZ3dnQUNBQk5nSUlEQUlMUWFpcXdBQWdBRFlDQUVHZ3FzQUFRYUNxd0FBb0FnQWdCbW9pQWpZQ0FDQUFJQUpCQVhJMkFnUU1BUXRCcEtyQUFDQUFOZ0lBUVp5cXdBQkJuS3JBQUNnQ0FDQUdhaUlDTmdJQUlBQWdBa0VCY2pZQ0JDQUFJQUpxSUFJMkFnQUxJQVZCQ0dvUEMwRzBxc0FBSVFBRFFBSkFJQUFvQWdBaUFTQURUUVJBSUFFZ0FDZ0NCR29pQnlBRFN3MEJDeUFBS0FJSUlRQU1BUXNMUWFpcXdBQWdCVFlDQUVHZ3FzQUFJQVJCV0dvaUFEWUNBQ0FGSUFCQkFYSTJBZ1FnQUNBRmFrRW9OZ0lFUWNTcXdBQkJnSUNBQVRZQ0FDQURJQWRCWUdwQmVIRkJlR29pQUNBQUlBTkJFR3BKR3lJQlFSczJBZ1JCdEtyQUFDa0NBQ0VKSUFGQkVHcEJ2S3JBQUNrQ0FEY0NBQ0FCSUFrM0FnaEJ3S3JBQUVFQU5nSUFRYmlxd0FBZ0JEWUNBRUcwcXNBQUlBVTJBZ0JCdktyQUFDQUJRUWhxTmdJQUlBRkJIR29oQUFOQUlBQkJCellDQUNBSElBQkJCR29pQUVzTkFBc2dBU0FEUmcwQUlBRWdBU2dDQkVGK2NUWUNCQ0FESUFFZ0Eyc2lCVUVCY2pZQ0JDQUJJQVUyQWdBZ0JVR0FBazhFUUNBRFFnQTNBaEFnQTBFY2FnSi9RUUFnQlVFSWRpSUFSUTBBR2tFZklBVkIvLy8vQjBzTkFCb2dCVUVHSUFCbklnQnJRUjl4ZGtFQmNTQUFRUUYwYTBFK2Fnc2lBRFlDQUNBQVFRSjBRWnlwd0FCcUlRRUNRQUpBQWtBQ1FFR1FwOEFBS0FJQUlnUkJBU0FBUVI5eGRDSUhjUVJBSUFFb0FnQWlCRUVFYWlnQ0FFRjRjU0FGUncwQklBUWhBQXdDQzBHUXA4QUFJQVFnQjNJMkFnQWdBU0FETmdJQUlBTkJHR29nQVRZQ0FBd0RDeUFGUVFCQkdTQUFRUUYyYTBFZmNTQUFRUjlHRzNRaEFRTkFJQVFnQVVFZGRrRUVjV3BCRUdvaUJ5Z0NBQ0lBUlEwQ0lBRkJBWFFoQVNBQUlRUWdBRUVFYWlnQ0FFRjRjU0FGUncwQUN3c2dBQ2dDQ0NJQklBTTJBZ3dnQUNBRE5nSUlJQU5CR0dwQkFEWUNBQ0FESUFBMkFnd2dBeUFCTmdJSURBTUxJQWNnQXpZQ0FDQURRUmhxSUFRMkFnQUxJQU1nQXpZQ0RDQURJQU0yQWdnTUFRc2dCVUVEZGlJQlFRTjBRWlNud0FCcUlRQUNmMEdNcDhBQUtBSUFJZ1JCQVNBQmRDSUJjUVJBSUFBb0FnZ01BUXRCaktmQUFDQUJJQVJ5TmdJQUlBQUxJUUVnQUNBRE5nSUlJQUVnQXpZQ0RDQURJQUEyQWd3Z0F5QUJOZ0lJQzBHZ3FzQUFLQUlBSWdBZ0JrME5BRUdncXNBQUlBQWdCbXNpQWpZQ0FFR29xc0FBUWFpcXdBQW9BZ0FpQUNBR2FpSUJOZ0lBSUFFZ0FrRUJjallDQkNBQUlBWkJBM0kyQWdRZ0FFRUlhZzhMSUFJUEN5QUJJQWMyQWhnZ0FpZ0NFQ0lBQkVBZ0FTQUFOZ0lRSUFBZ0FUWUNHQXNnQWtFVWFpZ0NBQ0lBUlEwQUlBRkJGR29nQURZQ0FDQUFJQUUyQWhnTEFrQWdCRUVRVHdSQUlBSWdCa0VEY2pZQ0JDQUNJQVpxSWdNZ0JFRUJjallDQkNBRElBUnFJQVEyQWdCQm5LckFBQ2dDQUNJQUJFQWdBRUVEZGlJRlFRTjBRWlNud0FCcUlRQkJwS3JBQUNnQ0FDRUJBbjlCaktmQUFDZ0NBQ0lHUVFFZ0JVRWZjWFFpQlhFRVFDQUFLQUlJREFFTFFZeW53QUFnQlNBR2NqWUNBQ0FBQ3lFRklBQWdBVFlDQ0NBRklBRTJBZ3dnQVNBQU5nSU1JQUVnQlRZQ0NBdEJwS3JBQUNBRE5nSUFRWnlxd0FBZ0JEWUNBQXdCQ3lBQ0lBUWdCbW9pQUVFRGNqWUNCQ0FBSUFKcUlnQWdBQ2dDQkVFQmNqWUNCQXNnQWtFSWFndmhFQUlTZndKK0l3QkJnQUZySWdZa0FDQUdJQU0yQWl3Z0JpQUNOZ0lvQWtBQ2Z3SkFBa0FDUUFKQUlBRXRBRWRGQkVBZ0FTa0RPQ0VZSUFGQ0FEY0RPQUovSUJoQy8vOERnMUJGQkVBZ0dFSXdpS2NoRVNBWVFoQ0lweUVNSUJoQ0lJaW5EQUVMSUFaQklHb2dBU0FHUVNocUVDc2dCaThCSUVVRVFFRUJJUTBNQmd0QkF5RU5JQVl2QVNJaURDSUNJQUV2QVVCUERRVWdBaUFCTHdGQ1JnMENJQUV2QVVRZ0RFSC8vd054UmcwRElBRkJHR29vQWdCRkRRVWdBVUVvYWlBQlFSQnFJZ2NnREJBbUdpQUJLQUlZSWdJZ0RFSC8vd054SWdwTkRRUWdCeWdDQUNBS1FRSjBhaUlDTFFBQ0lSRWdBaThCQUFzaEV5QUdRUmhxSUFGQktHb1FRaUFHS0FJWUlRSUNRQ0FHS0FJY0lnY2dCVTBFUUNBSERRRkJBU0VTUVFFaERTQUZJUWRCQVF3SEN5QUZSUVJBUVFFaERVRUFJUWRCQVF3SEN5QUVJQUlnQlJCTEdpQUJRVEJxSWdJZ0FpZ0NBQ0FGYWpZQ0FFR0lnOEFBSVFSQkFDRU5RUUFoQjBFQkRBWUxJQVFnQWlBSEVFc2dBVUV3YWlJQ0lBSW9BZ0FnQjJvMkFnQWdCMm9oQkNBRklBZHJJUWRCQUNFTlFRRU1CUXNnQUVFQ09nQUlJQUJDQURjQ0FBd0ZDeUFCSUFFdEFFWWlCMEVCYWlJQ09nQUtJQUZCQVNBSFFROXhkRUVDYWpzQlFDQUJRWDhnQWtFUGNYUkJmM003QVFnZ0FVRVFhaUFIRUExQkFDRU1RUUFoRFNBRklRZEJBQXdEQ3lBQlFRRTZBRWRCQWlFTkRBRUxJQW9nQWtIb2hzQUFFRFlBQzBFQUlRd2dCU0VIUVFBTElRSWdCa0U0YWtFQU5nSUFJQVpDQURjRE1DQUdRY2dBYWtFQU5nSUFJQVpDQURjRFFDQUdRZndBYWtFQU5nSUFJQVpCOUFCcVFRQTJBZ0FnQmtIc0FHcEJBRFlDQUNBR1FlUUFha0VBTmdJQUlBWkIzQUJxUVFBMkFnQWdCa0hZaWNBQU5nSjRJQVpCMkluQUFEWUNjQ0FHUWRpSndBQTJBbWdnQmtIWWljQUFOZ0pnSUFaQjJJbkFBRFlDV0NBR1FRQTJBbFFnQmtIWWljQUFOZ0pRQWtBQ2Z3SkFJQUpGRFFBZ0FVRVFhaUVVSUFGQktHb2hGU0FHUWNnQWFpRVhJQVpCUG1vaEZnSkFBa0FDUUFKQUFrQUNRQUpBQWtBRFFBSkFBa0FnQncwQUlBWkJFR29nRlJCQ0lBWW9BaFJGRFFCQkFDRUhEQUVMSUFFZ0JrRW9haEFZUVFBaEN5QVhJUkJCQUNFT0FrQUNRQUpBQWtBQ1FBSkFBa0FDUUFKQUEwQWdBUzBBQ3lJQ0lBRXRBQW9pQ0VrTkFTQUJJQUlnQ0dzNkFBc2dCa0V3YWlBTGFpSUtJQUV2QVFnaUFpQUJLUU1BSUFpdGlTSVlwM0U3QVFBZ0FTQVlJQUt0UW4rRlFvQ0FmSVNETndNQUlBNEVRQ0FPUVg5cVFRVkxEUVVnQnlBTElCWnFMd0VBSWdKSkRRWWdFQ0FFTmdJQUlCQkJCR29nQWpZQ0FDQUhJQUpySVFjZ0FpQUVhaUVFQ3lBQkx3RkFJZ0lnRG1wQi8vOERjU0FCTHdFSUlBRXRBRWhyUWYvL0EzRkdEUUlnQ2k4QkFDSUtJQUV2QVVKR0lBb2dBazl5RFFJZ0NpQUJMd0ZFUmcwQ0lBRW9BaVFpQWlBS1RRMEdJQWNnQVNnQ0hDQUtRUUYwYWk4QkFDSUNTUTBDSUE1QkFXb2hEaUFMSUJacVFRSnFJQUk3QVFBZ0VFRUlhaUVRSUF0QkFtb2lDMEVNUncwQUMwRUdJUTVCQlNFUUlBWXZBVG9oQ0F3SEN5QU9EUUZCQVNBTklCSWJJUTBNQ0FzZ0RrRUJhaUVPQ3lBT1FRZFBEUU1nQmtFd2FpQU9RWDlxSWhCQkFYUnFMd0VBSVFnZ0VBMEVJQXdoQ2d3RkN5QU9RWDlxUVFaQm1JVEFBQkEyQUF0QjZJSEFBRUVqUWZpQ3dBQVFTQUFMSUFvZ0FrR29oTUFBRURZQUN5QU9RUVpCdUlUQUFCQTNBQXNnQmtIUUFHb2hBaUFHUVRCcUlRc0RRQ0FHUVFocUlCUWdGQ0FMTHdFQUlnb2dBaWdDQUNBQ1FRUnFLQUlBRUNrZ0RCQWpJQVl0QUFvaEVTQUdMd0VJSVJNZ0FTQUJMd0ZBUVFGcU93RkFJQXRCQW1vaEN5QUNRUWhxSVFJZ0NpRU1JQkJCZjJvaUVBMEFDeUFPUVFOMElBWnFRVUJySWdJb0FnUWhDU0FDUVFBMkFnUWdBaWdDQUNFUElBSkJpSVBBQURZQ0FBc2dDQ0lNSUFFdkFVSkdEUU1DUUNBQkx3RkVJQWhIQkVBZ0NDQUJMd0ZBSWdKTkRRRkJBeUVOUVFBTURRc2dBVUVCT2dCSFFRSWhEVUVBREF3TEFuOGdCd0ovQWtBQ1FDQUNJQWhIQkVBZ0FTZ0NKQ0lDSUFoTERRRWdDQ0FDUWRpRXdBQVFOZ0FMSUFFb0FpUWlBaUFLUWYvL0EzRWlDRTBOQ0NBSElBRW9BaHdnQ0VFQmRHb3ZBUUJCQVdwQi8vOERjU0lDVHcwQklBOEVRQ0FCS0FJc0lnSWdDVWtOQ2lBQktBSW9JQThnQ1JCTEdpQUJJQWsyQWpBZ0FTQUpOZ0kwQzBFQUlROGdGUkF6SVF0QkFRd0RDeUFISUFFb0Fod2dDRUVCZEdvdkFRQWlBa2tFUUVFQUlROGdGU0FVSUF3UUppRUxRUUVNQXdzZ0ZDQU1JQVFnQWhBcElRc2dBZ3dCQ3lBUFJRUkFJQUVvQWl3aUNDQUJLQUkwSWdsSkRRa2dGU2dDQUNFUEN5QUpSUTBFSUFrZ0Frc05DU0FQTFFBQUlRc2dCQ0FQSUFrUVN5QUNJQWxHRFFvZ0NXb2dDem9BQUNBQ0N5SUpheUVISUFrZ0JDSVBhaUVFUVFBTElBRW9BaGhCL3g5TkJFQWdCaUFVSUFzZ0NoQWpJQUV2QVVBaEVDQUdMUUFDSVJFZ0JpOEJBQ0VUQWtBZ0FTMEFDaUlJUVF0TERRQWdFQ0FCTHdFSUlnb2dBUzBBU0d0Qi8vOERjVWNOQUNBQklBaEJBV282QUFvZ0FTQUtRUUYwUVFGeU93RUlDeUFCSUJCQkFXbzdBVUFMUVFBaEVrVU5BUXNMUWdFaEdTQVBSUTBLSUFFb0Fpd2lBaUFKU1EwSElBRW9BaWdnRHlBSkVFc2FJQUVnQ1RZQ01DQUJJQWsyQWpRTUNndEJBRUVBUVlpRndBQVFOZ0FMSUFFUU5Bd0dDeUFJSUFKQnlJVEFBQkEyQUFzZ0NTQUNRZWlFd0FBUU53QUxJQWtnQ0VINGhNQUFFRGNBQ3lBSklBSkJtSVhBQUJBM0FBdEJBRUVBUWFpRndBQVFOZ0FMSUFrZ0FrRzRoY0FBRURjQUMwRUFDeUVNUVFBaEUwRUFJUkVMSUFBZ0JTQUhhellDQkNBQUlBTWdCaWdDTENJQ2F6WUNBQ0FBUVFBZ0RTQURJQUpMR3lBTklBMUJBVVliT2dBSUlBRWdESzFDLy84RGcwSVFoaUFaaENBVHJVTC8vd09EUWlDR2hDQVJyVUwvQVlOQ01JYUVOd000Q3lBR1FZQUJhaVFBQzlZUUFoRi9BbjRqQUVHQUFXc2lCaVFBSUFZZ0F6WUNMQ0FHSUFJMkFpZ0NRQUovQWtBQ1FBSkFBa0FnQVMwQVIwVUVRQ0FCS1FNNElSY2dBVUlBTndNNEFuOGdGMEwvL3dPRFVFVUVRQ0FYUWpDSXB5RVJJQmRDRUlpbklRd2dGMElnaUtjTUFRc2dCa0VnYWlBQklBWkJLR29RTGlBR0x3RWdSUVJBUVFFaERRd0dDMEVESVEwZ0JpOEJJaUlNSWdJZ0FTOEJRRThOQlNBQ0lBRXZBVUpHRFFJZ0FTOEJSQ0FNUWYvL0EzRkdEUU1nQVVFWWFpZ0NBRVVOQlNBQlFTaHFJQUZCRUdvaUJ5QU1FQ1lhSUFFb0FoZ2lBaUFNUWYvL0EzRWlDVTBOQkNBSEtBSUFJQWxCQW5ScUlnSXRBQUloRVNBQ0x3RUFDeUVTSUFaQkdHb2dBVUVvYWhCQ0lBWW9BaGdoQWdKQUlBWW9BaHdpQnlBRlRRUkFJQWNOQVVFQklRaEJBU0VOSUFVaEIwRUJEQWNMSUFWRkJFQkJBU0VOUVFBaEIwRUJEQWNMSUFRZ0FpQUZFRXNhSUFGQk1Hb2lBaUFDS0FJQUlBVnFOZ0lBUVlpRHdBQWhCRUVBSVExQkFDRUhRUUVNQmdzZ0JDQUNJQWNRU3lBQlFUQnFJZ0lnQWlnQ0FDQUhhallDQUNBSGFpRUVJQVVnQjJzaEIwRUFJUTFCQVF3RkN5QUFRUUk2QUFnZ0FFSUFOd0lBREFVTElBRWdBUzBBUmlJSFFRRnFJZ0k2QUFvZ0FVRUJJQWRCRDNGMFFRSnFPd0ZBSUFGQmZ5QUNRUTl4ZEVGL2N6c0JDQ0FCUVJCcUlBY1FEVUVBSVF4QkFDRU5JQVVoQjBFQURBTUxJQUZCQVRvQVIwRUNJUTBNQVFzZ0NTQUNRZWlHd0FBUU5nQUxRUUFoRENBRklRZEJBQXNoQWlBR1FUaHFRUUEyQWdBZ0JrSUFOd013SUFaQnlBQnFRUUEyQWdBZ0JrSUFOd05BSUFaQi9BQnFRUUEyQWdBZ0JrSDBBR3BCQURZQ0FDQUdRZXdBYWtFQU5nSUFJQVpCNUFCcVFRQTJBZ0FnQmtIY0FHcEJBRFlDQUNBR1FkaUp3QUEyQW5nZ0JrSFlpY0FBTmdKd0lBWkIySW5BQURZQ2FDQUdRZGlKd0FBMkFtQWdCa0hZaWNBQU5nSllJQVpCQURZQ1ZDQUdRZGlKd0FBMkFsQUNRQUovQWtBZ0FrVU5BQ0FCUVJCcUlSTWdBVUVvYWlFVUlBWkJ5QUJxSVJZZ0JrRSthaUVWQWtBQ1FBSkFBa0FDUUFKQUFrQUNRQU5BQWtBQ1FDQUhEUUFnQmtFUWFpQVVFRUlnQmlnQ0ZFVU5BRUVBSVFjTUFRc2dBU0FHUVNocUVDQkJBQ0VMSUJZaEVFRUFJUTRDUUFKQUFrQUNRQUpBQWtBQ1FBSkFBa0FEUUNBQkxRQUxJZ0lnQVMwQUNpSUpTUTBCSUFFZ0FpQUphem9BQ3lBQklBRXBBd0FpRnlBSnJVSS9nNGczQXdBZ0JrRXdhaUFMYWlJSklBRXZBUWdnRjZkeE93RUFJQTRFUUNBT1FYOXFRUVZMRFFVZ0J5QUxJQlZxTHdFQUlnSkpEUVlnRUNBRU5nSUFJQkJCQkdvZ0FqWUNBQ0FISUFKcklRY2dBaUFFYWlFRUN5QUJMd0ZBSWdJZ0RtcEIvLzhEY1NBQkx3RUlJQUV0QUVoclFmLy9BM0ZHRFFJZ0NTOEJBQ0lKSUFFdkFVSkdJQWtnQWs5eURRSWdDU0FCTHdGRVJnMENJQUVvQWlRaUFpQUpUUTBHSUFjZ0FTZ0NIQ0FKUVFGMGFpOEJBQ0lDU1EwQ0lBNUJBV29oRGlBTElCVnFRUUpxSUFJN0FRQWdFRUVJYWlFUUlBdEJBbW9pQzBFTVJ3MEFDMEVHSVE1QkJTRVFJQVl2QVRvaENBd0hDeUFPRFFGQkFTQU5JQWdiSVEwTUNBc2dEa0VCYWlFT0N5QU9RUWRQRFFNZ0JrRXdhaUFPUVg5cUloQkJBWFJxTHdFQUlRZ2dFQTBFSUF3aENRd0ZDeUFPUVg5cVFRWkJtSVRBQUJBMkFBdEI2SUhBQUVFalFmaUN3QUFRU0FBTElBa2dBa0dvaE1BQUVEWUFDeUFPUVFaQnVJVEFBQkEzQUFzZ0JrSFFBR29oQWlBR1FUQnFJUXNEUUNBR1FRaHFJQk1nRXlBTEx3RUFJZ2tnQWlnQ0FDQUNRUVJxS0FJQUVDa2dEQkFqSUFZdEFBb2hFU0FHTHdFSUlSSWdBU0FCTHdGQVFRRnFPd0ZBSUF0QkFtb2hDeUFDUVFocUlRSWdDU0VNSUJCQmYyb2lFQTBBQ3lBT1FRTjBJQVpxUVVCcklnSW9BZ1FoQ2lBQ1FRQTJBZ1FnQWlnQ0FDRVBJQUpCaUlQQUFEWUNBQXNnQ0NJTUlBRXZBVUpHRFFNQ1FDQUJMd0ZFSUFoSEJFQWdDQ0FCTHdGQUlnSk5EUUZCQXlFTlFRQU1EUXNnQVVFQk9nQkhRUUloRFVFQURBd0xBbjhnQndKL0FrQUNRQ0FDSUFoSEJFQWdBU2dDSkNJQ0lBaExEUUVnQ0NBQ1FkaUV3QUFRTmdBTElBRW9BaVFpQWlBSlFmLy9BM0VpQ0UwTkNDQUhJQUVvQWh3Z0NFRUJkR292QVFCQkFXcEIvLzhEY1NJQ1R3MEJJQThFUUNBQktBSXNJZ0lnQ2trTkNpQUJLQUlvSUE4Z0NoQkxHaUFCSUFvMkFqQWdBU0FLTmdJMEMwRUFJUThnRkJBeklRdEJBUXdEQ3lBSElBRW9BaHdnQ0VFQmRHb3ZBUUFpQWtrRVFFRUFJUThnRkNBVElBd1FKaUVMUVFFTUF3c2dFeUFNSUFRZ0FoQXBJUXNnQWd3QkN5QVBSUVJBSUFFb0Fpd2lDQ0FCS0FJMElncEpEUWtnRkNnQ0FDRVBDeUFLUlEwRUlBb2dBa3NOQ1NBUExRQUFJUXNnQkNBUElBb1FTeUFDSUFwR0RRb2dDbW9nQ3pvQUFDQUNDeUlLYXlFSElBb2dCQ0lQYWlFRVFRQUxJQUVvQWhoQi94OU5CRUFnQmlBVElBc2dDUkFqSUFFdkFVQWhFQ0FHTFFBQ0lSRWdCaThCQUNFU0FrQWdBUzBBQ2lJSVFRdExEUUFnRUNBQkx3RUlJZ2tnQVMwQVNHdEIvLzhEY1VjTkFDQUJJQWhCQVdvNkFBb2dBU0FKUVFGMFFRRnlPd0VJQ3lBQklCQkJBV283QVVBTFFRQWhDRVVOQVFzTFFnRWhHQ0FQUlEwS0lBRW9BaXdpQWlBS1NRMEhJQUVvQWlnZ0R5QUtFRXNhSUFFZ0NqWUNNQ0FCSUFvMkFqUU1DZ3RCQUVFQVFZaUZ3QUFRTmdBTElBRVFOQXdHQ3lBSUlBSkJ5SVRBQUJBMkFBc2dDaUFDUWVpRXdBQVFOd0FMSUFvZ0NFSDRoTUFBRURjQUN5QUtJQUpCbUlYQUFCQTNBQXRCQUVFQVFhaUZ3QUFRTmdBTElBb2dBa0c0aGNBQUVEY0FDMEVBQ3lFTVFRQWhFa0VBSVJFTElBQWdCU0FIYXpZQ0JDQUFJQU1nQmlnQ0xDSUNhellDQUNBQVFRQWdEU0FESUFKTEd5QU5JQTFCQVVZYk9nQUlJQUVnREsxQy8vOERnMElRaGlBWWhDQVNyVUwvL3dPRFFpQ0doQ0FSclVML0FZTkNNSWFFTndNNEN5QUdRWUFCYWlRQUM2b0lBUVovSXdCQjhBQnJJZ1VrQUNBRklBTTJBZ3dnQlNBQ05nSUlRUUVoQnlBQklRWUNRQ0FCUVlFQ1NRMEFRUUFnQVdzaENVR0FBaUVJQTBBQ1FDQUlJQUZQRFFCQkFDRUhJQUFnQ0dvc0FBQkJ2MzlNRFFBZ0NDRUdEQUlMSUFoQmYyb2hCa0VBSVFjZ0NFRUJSZzBCSUFnZ0NXb2dCaUVJUVFGSERRQUxDeUFGSUFZMkFoUWdCU0FBTmdJUUlBVkJBRUVGSUFjYk5nSWNJQVZCOEl2QUFFSEFrc0FBSUFjYk5nSVlBa0FDZndKQUFrQWdBaUFCU3lJSElBTWdBVXR5UlFSQUlBSWdBMHNOQVFKQUlBSkZJQUVnQWtaeVJRUkFJQUVnQWswTkFTQUFJQUpxTEFBQVFVQklEUUVMSUFNaEFnc2dCU0FDTmdJZ0lBSkJBQ0FCSUFKSEcwVUVRQ0FDSVFjTUF3c2dBVUVCYWlFREEwQUNRQ0FDSUFGUERRQWdBQ0FDYWl3QUFFRkFTQTBBSUFJaEJ5QUZRU1JxREFVTElBSkJmMm9oQnlBQ1FRRkdEUU1nQWlBRFJpQUhJUUpGRFFBTERBSUxJQVVnQWlBRElBY2JOZ0lvSUFWQnhBQnFRUU0yQWdBZ0JVSGNBR3BCSFRZQ0FDQUZRZFFBYWtFZE5nSUFJQVZDQXpjQ05DQUZRZWlTd0FBMkFqQWdCVUVjTmdKTUlBVWdCVUhJQUdvMkFrQWdCU0FGUVJocU5nSllJQVVnQlVFUWFqWUNVQ0FGSUFWQktHbzJBa2dNQXdzZ0JVSGtBR3BCSFRZQ0FDQUZRZHdBYWtFZE5nSUFJQVZCMUFCcVFSdzJBZ0FnQlVIRUFHcEJCRFlDQUNBRlFnUTNBalFnQlVHa2s4QUFOZ0l3SUFWQkhEWUNUQ0FGSUFWQnlBQnFOZ0pBSUFVZ0JVRVlhallDWUNBRklBVkJFR28yQWxnZ0JTQUZRUXhxTmdKUUlBVWdCVUVJYWpZQ1NBd0NDeUFGUVNScUN5RUlBa0FnQVNBSFJnMEFRUUVoQXdKQUFrQUNRQ0FBSUFkcUlnWXNBQUFpQWtGL1RBUkFRUUFoQXlBQUlBRnFJZ0VoQUNBQklBWkJBV3BIQkVBZ0JpMEFBVUUvY1NFRElBWkJBbW9oQUFzZ0FrRWZjU0VKSUFKQi93RnhRZDhCU3cwQklBTWdDVUVHZEhJaEFnd0NDeUFGSUFKQi93RnhOZ0lrSUFWQktHb2hBUXdDQzBFQUlRb2dBU0VHSUFBZ0FVY0VRQ0FBTFFBQVFUOXhJUW9nQUVFQmFpRUdDeUFLSUFOQkJuUnlJUUFnQWtIL0FYRkI4QUZKQkVBZ0FDQUpRUXgwY2lFQ0RBRUxRUUFoQWlBQklBWkhCSDhnQmkwQUFFRS9jUVZCQUFzZ0NVRVNkRUdBZ1BBQWNTQUFRUVowY25JaUFrR0FnTVFBUmcwQ0N5QUZJQUkyQWlSQkFTRURJQVZCS0dvaEFTQUNRWUFCU1EwQVFRSWhBeUFDUVlBUVNRMEFRUU5CQkNBQ1FZQ0FCRWtiSVFNTElBVWdCellDS0NBRklBTWdCMm8yQWl3Z0JVSEVBR3BCQlRZQ0FDQUZRZXdBYWtFZE5nSUFJQVZCNUFCcVFSMDJBZ0FnQlVIY0FHcEJIallDQUNBRlFkUUFha0VmTmdJQUlBVkNCVGNDTkNBRlFmaVR3QUEyQWpBZ0JTQUJOZ0pZSUFVZ0NEWUNVQ0FGUVJ3MkFrd2dCU0FGUWNnQWFqWUNRQ0FGSUFWQkdHbzJBbWdnQlNBRlFSQnFOZ0pnSUFVZ0JVRWdhallDU0F3QkMwSDhpOEFBUVNzZ0JCQklBQXNnQlVFd2FpQUVFRkVBQzlJSUFRVi9JQUJCZUdvaUFTQUFRWHhxS0FJQUlnTkJlSEVpQUdvaEFnSkFBa0FnQTBFQmNRMEFJQU5CQTNGRkRRRWdBU2dDQUNJRElBQnFJUUFnQVNBRGF5SUJRYVNxd0FBb0FnQkdCRUFnQWlnQ0JFRURjVUVEUncwQlFaeXF3QUFnQURZQ0FDQUNJQUlvQWdSQmZuRTJBZ1FnQVNBQVFRRnlOZ0lFSUFBZ0FXb2dBRFlDQUE4TElBRWdBeEFSQ3dKQUlBSkJCR29pQkNnQ0FDSURRUUp4QkVBZ0JDQURRWDV4TmdJQUlBRWdBRUVCY2pZQ0JDQUFJQUZxSUFBMkFnQU1BUXNDUUNBQ1FhaXF3QUFvQWdCSEJFQkJwS3JBQUNnQ0FDQUNSZzBCSUFJZ0EwRjRjU0lDRUJFZ0FTQUFJQUpxSWdCQkFYSTJBZ1FnQUNBQmFpQUFOZ0lBSUFGQnBLckFBQ2dDQUVjTkFrR2Nxc0FBSUFBMkFnQVBDMEdvcXNBQUlBRTJBZ0JCb0tyQUFFR2dxc0FBS0FJQUlBQnFJZ0EyQWdBZ0FTQUFRUUZ5TmdJRVFhU3F3QUFvQWdBZ0FVWUVRRUdjcXNBQVFRQTJBZ0JCcEtyQUFFRUFOZ0lBQzBIRXFzQUFLQUlBSWdJZ0FFOE5Ba0dvcXNBQUtBSUFJZ0JGRFFJQ1FFR2dxc0FBS0FJQUlnTkJLVWtOQUVHMHFzQUFJUUVEUUNBQktBSUFJZ1FnQUUwRVFDQUVJQUVvQWdScUlBQkxEUUlMSUFFb0FnZ2lBUTBBQ3d0QnpLckFBQUovUWY4ZlFieXF3QUFvQWdBaUFFVU5BQnBCQUNFQkEwQWdBVUVCYWlFQklBQW9BZ2dpQUEwQUN5QUJRZjhmSUFGQi94OUxHd3MyQWdBZ0F5QUNUUTBDUWNTcXdBQkJmellDQUE4TFFhU3F3QUFnQVRZQ0FFR2Nxc0FBUVp5cXdBQW9BZ0FnQUdvaUFEWUNBQ0FCSUFCQkFYSTJBZ1FnQUNBQmFpQUFOZ0lBRHd0QnpLckFBQUovQWtBZ0FFR0FBazhFUUNBQlFnQTNBaEFnQVVFY2FnSi9RUUFnQUVFSWRpSUNSUTBBR2tFZklBQkIvLy8vQjBzTkFCb2dBRUVHSUFKbklnSnJRUjl4ZGtFQmNTQUNRUUYwYTBFK2Fnc2lBellDQUNBRFFRSjBRWnlwd0FCcUlRSUNRQUpBQWtBQ1FBSkFRWkNud0FBb0FnQWlCRUVCSUFOQkgzRjBJZ1Z4QkVBZ0FpZ0NBQ0lDUVFScUtBSUFRWGh4SUFCSERRRWdBaUVEREFJTFFaQ253QUFnQkNBRmNqWUNBQ0FDSUFFMkFnQU1Bd3NnQUVFQVFSa2dBMEVCZG10QkgzRWdBMEVmUmh0MElRUURRQ0FDSUFSQkhYWkJCSEZxUVJCcUlnVW9BZ0FpQTBVTkFpQUVRUUYwSVFRZ0F5SUNRUVJxS0FJQVFYaHhJQUJIRFFBTEN5QURLQUlJSWdBZ0FUWUNEQ0FESUFFMkFnZ2dBVUVZYWtFQU5nSUFJQUVnQXpZQ0RDQUJJQUEyQWdnTUFnc2dCU0FCTmdJQUN5QUJRUmhxSUFJMkFnQWdBU0FCTmdJTUlBRWdBVFlDQ0F0QnpLckFBRUhNcXNBQUtBSUFRWDlxSWdBMkFnQWdBQTBEUWJ5cXdBQW9BZ0FpQUEwQlFmOGZEQUlMSUFCQkEzWWlBa0VEZEVHVXA4QUFhaUVBQW45QmpLZkFBQ2dDQUNJRFFRRWdBblFpQW5FRVFDQUFLQUlJREFFTFFZeW53QUFnQWlBRGNqWUNBQ0FBQ3lFQ0lBQWdBVFlDQ0NBQ0lBRTJBZ3dnQVNBQU5nSU1JQUVnQWpZQ0NBOExRUUFoQVFOQUlBRkJBV29oQVNBQUtBSUlJZ0FOQUFzZ0FVSC9IeUFCUWY4ZlN4c0xOZ0lBQ3d1V0J3RUtmeUFBS0FJUUlRTUNRQUpBQWtBZ0FDZ0NDQ0lNUVFGSEJFQWdBMEVCUmcwQkRBTUxJQU5CQVVjTkFRc2dBU0FDYWlFREFrQUNRQ0FBUVJScUtBSUFJZ2hGQkVBZ0FTRUVEQUVMSUFFaEJBTkFJQU1nQkNJSFJnMENJQWRCQVdvaEJBSkFJQWNzQUFBaUJrRi9TZzBBSUFaQi93RnhJUWtDZnlBRElBUkdCRUJCQUNFS0lBTU1BUXNnQnkwQUFVRS9jU0VLSUFkQkFtb2lCQXNoQmlBSlFlQUJTUTBBQW44Z0F5QUdSZ1JBUVFBaEN5QUREQUVMSUFZdEFBQkJQM0VoQ3lBR1FRRnFJZ1FMSVFZZ0NVSHdBVWtOQUNBRElBWkdCSDlCQUFVZ0JrRUJhaUVFSUFZdEFBQkJQM0VMSUFsQkVuUkJnSUR3QUhFZ0NrRU1kSElnQzBFR2RISnlRWUNBeEFCR0RRTUxJQVFnQjJzZ0JXb2hCU0FJUVg5cUlnZ05BQXNMSUFNZ0JFWU5BQUpBSUFRc0FBQWlCMEYvU2cwQUFuOGdBeUFFUVFGcVJnUkFJQU1oQ0VFQURBRUxJQVJCQW1vaENDQUVMUUFCUVQ5eFFRWjBDeUFIUWY4QmNVSGdBVWtOQUFKL0lBTWdDRVlFUUNBRElRWkJBQXdCQ3lBSVFRRnFJUVlnQ0MwQUFFRS9jUXNnQjBIL0FYRkI4QUZKRFFBZ0IwSC9BWEVoQjNJaEJDQURJQVpHQkg5QkFBVWdCaTBBQUVFL2NRc2dCMEVTZEVHQWdQQUFjU0FFUVFaMGNuSkJnSURFQUVZTkFRc0NRQ0FGUlNBQ0lBVkdja1VFUUVFQUlRTWdCU0FDVHcwQklBRWdCV29zQUFCQlFFZ05BUXNnQVNFREN5QUZJQUlnQXhzaEFpQURJQUVnQXhzaEFRc2dERUVCUmcwQURBRUxBa0FnQWdSQVFRQWhCQ0FDSVFVZ0FTRURBMEFnQkNBRExRQUFRY0FCY1VHQUFVWnFJUVFnQTBFQmFpRURJQVZCZjJvaUJRMEFDeUFDSUFScklBQW9BZ3dpQms4TkFrRUFJUVFnQWlFRklBRWhBd05BSUFRZ0F5MEFBRUhBQVhGQmdBRkdhaUVFSUFOQkFXb2hBeUFGUVg5cUlnVU5BQXNNQVF0QkFDRUVJQUFvQWd3aUJnMEFEQUVMUVFBaEF5QUVJQUpySUFacUlnUWhCUUpBQWtBQ1FFRUFJQUF0QUNBaUJpQUdRUU5HRzBFRGNVRUJhdzREQVFBQkFnc2dCRUVCZGlFRElBUkJBV3BCQVhZaEJRd0JDMEVBSVFVZ0JDRURDeUFEUVFGcUlRTUNRQU5BSUFOQmYyb2lBd1JBSUFBb0FoZ2dBQ2dDQkNBQUtBSWNLQUlRRVFBQVJRMEJEQUlMQ3lBQUtBSUVJUVFnQUNnQ0dDQUJJQUlnQUNnQ0hDZ0NEQkVCQUEwQUlBVkJBV29oQXlBQUtBSWNJUUVnQUNnQ0dDRUFBMEFnQTBGL2FpSURSUVJBUVFBUEN5QUFJQVFnQVNnQ0VCRUFBRVVOQUFzTFFRRVBDeUFBS0FJWUlBRWdBaUFBUVJ4cUtBSUFLQUlNRVFFQUM3c0dBUVIvSUFBZ0FXb2hBZ0pBQWtBZ0FFRUVhaWdDQUNJRFFRRnhEUUFnQTBFRGNVVU5BU0FBS0FJQUlnTWdBV29oQVNBQUlBTnJJZ0JCcEtyQUFDZ0NBRVlFUUNBQ0tBSUVRUU54UVFOSERRRkJuS3JBQUNBQk5nSUFJQUlnQWlnQ0JFRitjVFlDQkNBQUlBRkJBWEkyQWdRZ0FpQUJOZ0lBRHdzZ0FDQURFQkVMQWtBZ0FrRUVhaWdDQUNJRFFRSnhCRUFnQWtFRWFpQURRWDV4TmdJQUlBQWdBVUVCY2pZQ0JDQUFJQUZxSUFFMkFnQU1BUXNDUUNBQ1FhaXF3QUFvQWdCSEJFQkJwS3JBQUNnQ0FDQUNSZzBCSUFJZ0EwRjRjU0lDRUJFZ0FDQUJJQUpxSWdGQkFYSTJBZ1FnQUNBQmFpQUJOZ0lBSUFCQnBLckFBQ2dDQUVjTkFrR2Nxc0FBSUFFMkFnQVBDMEdvcXNBQUlBQTJBZ0JCb0tyQUFFR2dxc0FBS0FJQUlBRnFJZ0UyQWdBZ0FDQUJRUUZ5TmdJRUlBQkJwS3JBQUNnQ0FFY05Ba0djcXNBQVFRQTJBZ0JCcEtyQUFFRUFOZ0lBRHd0QnBLckFBQ0FBTmdJQVFaeXF3QUJCbktyQUFDZ0NBQ0FCYWlJQk5nSUFJQUFnQVVFQmNqWUNCQ0FBSUFGcUlBRTJBZ0FQQ3lBQlFZQUNUd1JBSUFCQ0FEY0NFQ0FBUVJ4cUFuOUJBQ0FCUVFoMklnSkZEUUFhUVI4Z0FVSC8vLzhIU3cwQUdpQUJRUVlnQW1jaUFtdEJIM0YyUVFGeElBSkJBWFJyUVQ1cUN5SUROZ0lBSUFOQkFuUkJuS25BQUdvaEFnSkFBa0FDUUFKQVFaQ253QUFvQWdBaUJFRUJJQU5CSDNGMElnVnhCRUFnQWlnQ0FDSUNRUVJxS0FJQVFYaHhJQUZIRFFFZ0FpRUREQUlMUVpDbndBQWdCQ0FGY2pZQ0FDQUNJQUEyQWdBTUF3c2dBVUVBUVJrZ0EwRUJkbXRCSDNFZ0EwRWZSaHQwSVFRRFFDQUNJQVJCSFhaQkJIRnFRUkJxSWdVb0FnQWlBMFVOQWlBRVFRRjBJUVFnQXlJQ1FRUnFLQUlBUVhoeElBRkhEUUFMQ3lBREtBSUlJZ0VnQURZQ0RDQURJQUEyQWdnZ0FFRVlha0VBTmdJQUlBQWdBellDRENBQUlBRTJBZ2dQQ3lBRklBQTJBZ0FMSUFCQkdHb2dBallDQUNBQUlBQTJBZ3dnQUNBQU5nSUlEd3NnQVVFRGRpSUNRUU4wUVpTbndBQnFJUUVDZjBHTXA4QUFLQUlBSWdOQkFTQUNkQ0lDY1FSQUlBRW9BZ2dNQVF0QmpLZkFBQ0FDSUFOeU5nSUFJQUVMSVFJZ0FTQUFOZ0lJSUFJZ0FEWUNEQ0FBSUFFMkFnd2dBQ0FDTmdJSUN3dXFCZ0VIZndKQUFrQUNRQUpBQWtBQ1FBSkFBa0FnQUVHQWdBUlBCRUFnQUVHQWdBaEpEUUVnQUVHMTJYTnFRYlhiSzBrZ0FFSGlpM1JxUWVJTFNYSWdBRUdmcUhScVFaOFlTU0FBUWQ3aWRHcEJEa2x5Y2lBQVFmNy8vd0J4UVo3d0NrWWdBRUdpc25WcVFTSkpjaUFBUWN1UmRXcEJDMGx5Y2cwQ0lBQkI4SU00U1E4TElBQkJnUDREY1VFSWRpRUdRZWlVd0FBaEFTQUFRZjhCY1NFSEEwQUNRQ0FCUVFKcUlRVWdBaUFCTFFBQklnUnFJUU1nQmlBQkxRQUFJZ0ZIQkVBZ0FTQUdTdzBCSUFNaEFpQUZJZ0ZCdXBYQUFFY05BZ3dCQ3lBRElBSkpEUVFnQTBHaUFrc05CU0FDUWJxVndBQnFJUUVDUUFOQUlBUkZEUUVnQkVGL2FpRUVJQUV0QUFBZ0FVRUJhaUVCSUFkSERRQUxRUUFoQkF3RUN5QURJUUlnQlNJQlFicVZ3QUJIRFFFTEN5QUFRZi8vQTNFaEEwSGNsOEFBSVFGQkFTRUVBMEFnQVVFQmFpRUFBbjhnQUNBQkxRQUFJZ0pCR0hSQkdIVWlCVUVBVGcwQUdpQUFRWkdhd0FCR0RRWWdBUzBBQVNBRlFmOEFjVUVJZEhJaEFpQUJRUUpxQ3lFQklBTWdBbXNpQTBFQVNBMENJQVJCQVhNaEJDQUJRWkdhd0FCSERRQUxEQUVMSUFCQmdQNERjVUVJZGlFR1FaR2F3QUFoQVNBQVFmOEJjU0VIQTBBQ1FDQUJRUUpxSVFVZ0FpQUJMUUFCSWdScUlRTWdCaUFCTFFBQUlnRkhCRUFnQVNBR1N3MEJJQU1oQWlBRklnRkIzWnJBQUVjTkFnd0JDeUFESUFKSkRRWWdBMEd2QVVzTkJ5QUNRZDJhd0FCcUlRRUNRQU5BSUFSRkRRRWdCRUYvYWlFRUlBRXRBQUFnQVVFQmFpRUJJQWRIRFFBTFFRQWhCQXdEQ3lBRElRSWdCU0lCUWQyYXdBQkhEUUVMQ3lBQVFmLy9BM0VoQTBHTW5NQUFJUUZCQVNFRUEwQWdBVUVCYWlFQUFuOGdBQ0FCTFFBQUlnSkJHSFJCR0hVaUJVRUFUZzBBR2lBQVFhK2Z3QUJHRFFnZ0FTMEFBU0FGUWY4QWNVRUlkSEloQWlBQlFRSnFDeUVCSUFNZ0Ftc2lBMEVBU0EwQklBUkJBWE1oQkNBQlFhK2Z3QUJIRFFBTEN5QUVRUUZ4RHdzZ0FpQURRY2lVd0FBUU9BQUxJQU5Cb2dKQnlKVEFBQkEzQUF0Qi9JdkFBRUVyUWRpVXdBQVFTQUFMSUFJZ0EwSElsTUFBRURnQUN5QURRYThCUWNpVXdBQVFOd0FMUWZ5THdBQkJLMEhZbE1BQUVFZ0FDN0VGQVFkL1FTdEJnSURFQUNBQUtBSUFJZ2xCQVhFaUJSc2hDaUFFSUFWcUlRZ0NRQ0FKUVFSeFJRUkFRUUFoQVF3QkN5QUNCRUFnQWlFR0lBRWhCUU5BSUFjZ0JTMEFBRUhBQVhGQmdBRkdhaUVISUFWQkFXb2hCU0FHUVg5cUlnWU5BQXNMSUFJZ0NHb2dCMnNoQ0FzQ1FBSkFJQUFvQWdoQkFVY0VRQ0FBSUFvZ0FTQUNFRVlOQVF3Q0N5QUFRUXhxS0FJQUlnWWdDRTBFUUNBQUlBb2dBU0FDRUVZTkFRd0NDd0pBQWtBQ1FBSkFJQWxCQ0hFRVFDQUFLQUlFSVFrZ0FFRXdOZ0lFSUFBdEFDQWhDeUFBUVFFNkFDQWdBQ0FLSUFFZ0FoQkdEUVZCQUNFRklBWWdDR3NpQVNFQ1FRRWdBQzBBSUNJR0lBWkJBMFliUVFOeFFRRnJEZ01DQVFJREMwRUFJUVVnQmlBSWF5SUdJUWdDUUFKQUFrQkJBU0FBTFFBZ0lnY2dCMEVEUmh0QkEzRkJBV3NPQXdFQUFRSUxJQVpCQVhZaEJTQUdRUUZxUVFGMklRZ01BUXRCQUNFSUlBWWhCUXNnQlVFQmFpRUZBMEFnQlVGL2FpSUZSUTBFSUFBb0FoZ2dBQ2dDQkNBQUtBSWNLQUlRRVFBQVJRMEFDMEVCRHdzZ0FVRUJkaUVGSUFGQkFXcEJBWFloQWd3QkMwRUFJUUlnQVNFRkN5QUZRUUZxSVFVQ1FBTkFJQVZCZjJvaUJVVU5BU0FBS0FJWUlBQW9BZ1FnQUNnQ0hDZ0NFQkVBQUVVTkFBdEJBUThMSUFBb0FnUWhBU0FBS0FJWUlBTWdCQ0FBS0FJY0tBSU1FUUVBRFFFZ0FrRUJhaUVISUFBb0Fod2hBaUFBS0FJWUlRTURRQ0FIUVg5cUlnY0VRQ0FESUFFZ0FpZ0NFQkVBQUVVTkFRd0RDd3NnQUNBTE9nQWdJQUFnQ1RZQ0JFRUFEd3NnQUNnQ0JDRUZJQUFnQ2lBQklBSVFSZzBBSUFBb0FoZ2dBeUFFSUFBb0Fod29BZ3dSQVFBTkFDQUlRUUZxSVFjZ0FDZ0NIQ0VCSUFBb0FoZ2hBQU5BSUFkQmYyb2lCMFVFUUVFQUR3c2dBQ0FGSUFFb0FoQVJBQUJGRFFBTEMwRUJEd3NnQUNnQ0dDQURJQVFnQUVFY2FpZ0NBQ2dDREJFQkFBdjBCUUVLZnlNQVFUQnJJZ01rQUNBRFFTUnFJQUUyQWdBZ0EwRURPZ0FvSUFOQ2dJQ0FnSUFFTndNSUlBTWdBRFlDSUNBRFFRQTJBaGdnQTBFQU5nSVFBbjhDUUFKQUFrQWdBaWdDQ0NJRUJFQWdBaWdDQUNFR0lBSW9BZ1FpQ0NBQ1FReHFLQUlBSWdVZ0JTQUlTeHNpQlVVTkFTQUFJQVlvQWdBZ0JpZ0NCQ0FCS0FJTUVRRUFEUU1nQmtFTWFpRUFJQUlvQWhRaEJ5QUNLQUlRSVFvZ0JTRUpBMEFnQXlBRVFSeHFMUUFBT2dBb0lBTWdCRUVFYWlrQ0FFSWdpVGNEQ0NBRVFSaHFLQUlBSVFKQkFDRUxRUUFoQVFKQUFrQUNRQ0FFUVJScUtBSUFRUUZyRGdJQUFnRUxJQUlnQjA4RVFDQUNJQWRCdEpEQUFCQTJBQXNnQWtFRGRDQUthaUlNS0FJRVFTQkhEUUVnRENnQ0FDZ0NBQ0VDQzBFQklRRUxJQU1nQWpZQ0ZDQURJQUUyQWhBZ0JFRVFhaWdDQUNFQ0FrQUNRQUpBSUFSQkRHb29BZ0JCQVdzT0FnQUNBUXNnQWlBSFR3UkFJQUlnQjBHMGtNQUFFRFlBQ3lBQ1FRTjBJQXBxSWdFb0FnUkJJRWNOQVNBQktBSUFLQUlBSVFJTFFRRWhDd3NnQXlBQ05nSWNJQU1nQ3pZQ0dDQUVLQUlBSWdFZ0Iwa0VRQ0FLSUFGQkEzUnFJZ0VvQWdBZ0EwRUlhaUFCS0FJRUVRQUFEUVVnQ1VGL2FpSUpSUTBFSUFSQklHb2hCQ0FBUVh4cUlRRWdBQ2dDQUNFQ0lBQkJDR29oQUNBREtBSWdJQUVvQWdBZ0FpQURLQUlrS0FJTUVRRUFSUTBCREFVTEN5QUJJQWRCcEpEQUFCQTJBQXNnQWlnQ0FDRUdJQUlvQWdRaUNDQUNRUlJxS0FJQUlnVWdCU0FJU3hzaUJVVU5BQ0FDS0FJUUlRUWdBQ0FHS0FJQUlBWW9BZ1FnQVNnQ0RCRUJBQTBDSUFaQkRHb2hBQ0FGSVFJRFFDQUVLQUlBSUFOQkNHb2dCRUVFYWlnQ0FCRUFBQTBESUFKQmYyb2lBa1VOQWlBRVFRaHFJUVFnQUVGOGFpRUJJQUFvQWdBaENTQUFRUWhxSVFBZ0F5Z0NJQ0FCS0FJQUlBa2dBeWdDSkNnQ0RCRUJBRVVOQUFzTUFndEJBQ0VGQ3lBSUlBVkxCRUFnQXlnQ0lDQUdJQVZCQTNScUlnQW9BZ0FnQUNnQ0JDQURLQUlrS0FJTUVRRUFEUUVMUVFBTUFRdEJBUXNnQTBFd2FpUUFDNDBGQVFkL0FrQWdBVUhNLzN0TERRQkJFQ0FCUVF0cVFYaHhJQUZCQzBrYklRSWdBRUY4YWlJRktBSUFJZ1pCZUhFaEF3SkFBa0FDUUFKQUFrQUNRQ0FHUVFOeEJFQWdBRUY0YWlJSElBTnFJUWdnQXlBQ1R3MEJRYWlxd0FBb0FnQWdDRVlOQWtHa3FzQUFLQUlBSUFoR0RRTWdDRUVFYWlnQ0FDSUdRUUp4RFFZZ0JrRjRjU0lHSUFOcUlnTWdBazhOQkF3R0N5QUNRWUFDU1NBRElBSkJCSEpKY2lBRElBSnJRWUdBQ0U5eURRVU1CQXNnQXlBQ2F5SUJRUkJKRFFNZ0JTQUNJQVpCQVhGeVFRSnlOZ0lBSUFJZ0Iyb2lCQ0FCUVFOeU5nSUVJQWdnQ0NnQ0JFRUJjallDQkNBRUlBRVFCZ3dEQzBHZ3FzQUFLQUlBSUFOcUlnTWdBazBOQXlBRklBSWdCa0VCY1hKQkFuSTJBZ0FnQWlBSGFpSUJJQU1nQW1zaUJFRUJjallDQkVHZ3FzQUFJQVEyQWdCQnFLckFBQ0FCTmdJQURBSUxRWnlxd0FBb0FnQWdBMm9pQXlBQ1NRMENBa0FnQXlBQ2F5SUJRUTlOQkVBZ0JTQUdRUUZ4SUFOeVFRSnlOZ0lBSUFNZ0Iyb2lBU0FCS0FJRVFRRnlOZ0lFUVFBaEFRd0JDeUFGSUFJZ0JrRUJjWEpCQW5JMkFnQWdBaUFIYWlJRUlBRkJBWEkyQWdRZ0F5QUhhaUlDSUFFMkFnQWdBaUFDS0FJRVFYNXhOZ0lFQzBHa3FzQUFJQVEyQWdCQm5LckFBQ0FCTmdJQURBRUxJQWdnQmhBUklBTWdBbXNpQVVFUVR3UkFJQVVnQWlBRktBSUFRUUZ4Y2tFQ2NqWUNBQ0FDSUFkcUlnUWdBVUVEY2pZQ0JDQURJQWRxSWdJZ0FpZ0NCRUVCY2pZQ0JDQUVJQUVRQmd3QkN5QUZJQU1nQlNnQ0FFRUJjWEpCQW5JMkFnQWdBeUFIYWlJQklBRW9BZ1JCQVhJMkFnUUxJQUFoQkF3QkN5QUJFQUFpQWtVTkFDQUNJQUFnQVVGOFFYZ2dCU2dDQUNJRVFRTnhHeUFFUVhoeGFpSUVJQVFnQVVzYkVFc2dBQkFFRHdzZ0JBdjBCQUVKZnlNQVFUQnJJZ1FrQUFKQUFuOGdBZ1JBSUFSQktHb2hDUU5BQWtBZ0FDZ0NDQzBBQUVVTkFDQUFLQUlBUWNpTndBQkJCQ0FBS0FJRUtBSU1FUUVBUlEwQVFRRU1Bd3NnQkVFS05nSW9JQVJDaW9DQWdCQTNBeUFnQkNBQ05nSWNRUUFoQlNBRVFRQTJBaGdnQkNBQ05nSVVJQVFnQVRZQ0VFRUJJUWNnQVNFR0lBSWlBeUVJQW44Q1FBSkFBMEFnQlNBR2FpRUdJQVFnQjJwQkoyb3RBQUFoQ2dKQUFrQUNRQ0FEUVFkTkJFQWdBMFVOQVNBSUlBVnJJUXRCQUNFREEwQWdBeUFHYWkwQUFDQUtSZzBFSUFzZ0EwRUJhaUlEUncwQUN3d0JDeUFFUVFocUlBb2dCaUFERUJRZ0JDZ0NDRUVCUmcwQklBUW9BaHdoQ0FzZ0JDQUlOZ0lZREFRTElBUW9BZ3doQXlBRUtBSWtJUWNnQkNnQ0dDRUZDeUFFSUFNZ0JXcEJBV29pQlRZQ0dBSkFBa0FnQlNBSFNRUkFJQVFvQWhRaEF3d0JDeUFFS0FJVUlnTWdCVWtOQUNBSFFRVlBEUU1nQlNBSGF5SUdJQVFvQWhCcUlnZ2dDVVlOQVNBSUlBa2dCeEJFUlEwQkN5QUVLQUljSWdnZ0JVa2dBeUFJU1hJTkF5QUlJQVZySVFNZ0JDZ0NFQ0VHREFFTEN5QUFLQUlJUVFFNkFBQWdCa0VCYWd3Q0N5QUhRUVJCc0pMQUFCQTNBQXNnQUNnQ0NFRUFPZ0FBSUFJTElRTWdBQ2dDQkNFR0lBQW9BZ0FoQlFKQUFrQWdBMFVnQWlBRFJuSkZCRUFnQWlBRFN3UkFJQUVnQTJvaUJ5d0FBRUcvZjBvTkFnc2dBU0FDUVFBZ0EwSE1qY0FBRUFNQUN5QUZJQUVnQXlBR0tBSU1FUUVBUlEwQlFRRU1CQXRCQVNBRklBRWdBeUFHS0FJTUVRRUFEUU1hSUFjc0FBQkJ2MzlNRFFRTElBRWdBMm9oQVNBQ0lBTnJJZ0lOQUFzTFFRQUxJQVJCTUdva0FBOExJQUVnQWlBRElBSkIzSTNBQUJBREFBdTZBd0VFZnlNQVFSQnJJZ0lrQUNBQUtBSUFJUVFDUUFKQUFrQUNmd0pBQWtBZ0FVR0FBVThFUUNBQ1FRQTJBZ3dnQVVHQUVFa05BU0FDUVF4cUlRQWdBVUdBZ0FSSkJFQWdBaUFCUVQ5eFFZQUJjam9BRGlBQ0lBRkJESFpCNEFGeU9nQU1JQUlnQVVFR2RrRS9jVUdBQVhJNkFBMUJBeUVCREFZTElBSWdBVUUvY1VHQUFYSTZBQThnQWlBQlFSSjJRZkFCY2pvQURDQUNJQUZCQm5aQlAzRkJnQUZ5T2dBT0lBSWdBVUVNZGtFL2NVR0FBWEk2QUExQkJDRUJEQVVMSUFRb0FnZ2lBQ0FFUVFScUtBSUFSd1JBSUFRb0FnQWhCUXdFQ3dKQUlBQkJBV29pQXlBQVNRMEFJQUJCQVhRaUJTQURJQVVnQTBzYklnTkJDQ0FEUVFoTEd5RURJQUFFUUNBRFFRQklEUUVnQkNnQ0FDSUZSUTBESUFVZ0FFRUJJQU1RVlF3RUN5QURRUUJPRFFJTEVGMEFDeUFDSUFGQlAzRkJnQUZ5T2dBTklBSWdBVUVHZGtIQUFYSTZBQXdnQWtFTWFpRUFRUUloQVF3REN5QURRUUVRV1FzaUJRUkFJQVFnQlRZQ0FDQUVRUVJxSUFNMkFnQWdCQ2dDQ0NFQURBRUxJQU5CQVJCakFBc2dBQ0FGYWlBQk9nQUFJQVFnQkNnQ0NFRUJhallDQ0F3QkN5QUVJQUFnQUNBQmFoQWZDeUFDUVJCcUpBQkJBQXUwQXdFRWZ5QUFRUUEyQWdnZ0FFRVVha0VBTmdJQUlBRkJEM0VoQkNBQVFReHFJUUpCQUNFQkEwQWdBQ2dDQkNBQlJnUkFJQUFnQVJBOElBQW9BZ2doQVFzZ0FDZ0NBQ0FCUVFKMGFpSUJJQU02QUFJZ0FVRUFPd0VBSUFBZ0FDZ0NDRUVCYWpZQ0NDQUFLQUlVSWdFZ0FDZ0NFRVlFUUNBQ0lBRVFPeUFBS0FJVUlRRUxJQUFvQWd3Z0FVRUJkR3BCQVRzQkFDQUFJQUFvQWhSQkFXbzJBaFFnQUNnQ0NDRUJJQU5CQVdvaUJTRURJQVZCLy84RGNTQUVka1VOQUFzZ0FDZ0NCQ0FCUmdSQUlBQWdBUkE4SUFBb0FnZ2hBUXNnQUNnQ0FDQUJRUUowYWlJQlFRQTZBQUlnQVVFQU93RUFJQUFnQUNnQ0NFRUJhallDQ0NBQUtBSVVJZ0VnQUNnQ0VFWUVRQ0FDSUFFUU95QUFLQUlVSVFFTElBQW9BZ3dnQVVFQmRHcEJBRHNCQUNBQUlBQW9BaFJCQVdvMkFoUWdBQ2dDQ0NJQklBQW9BZ1JHQkVBZ0FDQUJFRHdnQUNnQ0NDRUJDeUFBS0FJQUlBRkJBblJxSWdGQkFEb0FBaUFCUVFBN0FRQWdBQ0FBS0FJSVFRRnFOZ0lJSUFBb0FoUWlBU0FBS0FJUVJnUkFJQUlnQVJBN0lBQW9BaFFoQVFzZ0FDZ0NEQ0FCUVFGMGFrRUFPd0VBSUFBZ0FDZ0NGRUVCYWpZQ0ZBditBd0lEZndGK0lBRW9BaGhCSnlBQlFSeHFLQUlBS0FJUUVRQUFSUVJBUWZRQUlRTkJBaUVDQWtBQ1FBSkFBa0FDUUFKQUlBQW9BZ0FpQUVGM2FnNGZCUUVEQXdBREF3TURBd01EQXdNREF3TURBd01EQXdNREF3UURBd01EQkFJTFFmSUFJUU1NQkF0QjdnQWhBd3dEQ3lBQVFkd0FSZzBCQ3dKL0FuNENRQ0FBRUE5RkJFQWdBQkFIUlEwQlFRRU1Bd3NnQUVFQmNtZEJBblpCQjNPdFFvQ0FnSURRQUlRTUFRc2dBRUVCY21kQkFuWkJCM090UW9DQWdJRFFBSVFMSVFWQkF3c2hBaUFBSVFNTUFRc2dBQ0VEQ3dOQUlBSWhCRUhjQUNFQVFRRWhBZ0pBQW40Q1FBSkFBa0FDUUNBRVFRRnJEZ01CQlFBQ0N3SkFBa0FDUUFKQUlBVkNJSWluUWY4QmNVRUJhdzRGQXdJQkFBWUZDMEgxQUNFQUlBVkMvLy8vLzQ5Z2cwS0FnSUNBTUlRTUJndEIrd0FoQUNBRlF2Ly8vLytQWUlOQ2dJQ0FnQ0NFREFVTFFUQkIxd0FnQXlBRnB5SUVRUUowUVJ4eGRrRVBjU0lBUVFwSkd5QUFhaUVBSUFWQ2YzeEMvLy8vL3crRElBVkNnSUNBZ0hDRGhDQUVEUVFhSUFWQy8vLy8vNDlnZzBLQWdJQ0FFSVFNQkF0Qi9RQWhBQ0FGUXYvLy8vK1BZSU1NQXd0QkFDRUNJQU1oQUF3REN5QUJLQUlZUVNjZ0FTZ0NIQ2dDRUJFQUFBOExJQVZDLy8vLy80OWdnMEtBZ0lDQXdBQ0VDeUVGUVFNaEFnc2dBU2dDR0NBQUlBRW9BaHdvQWhBUkFBQkZEUUFMQzBFQkM2QURBUVYvQWtBQ1FFRUFRUThnQUVHa21nUkpHeUlCSUFGQkNHb2lBU0FCUVFKMFFaaWd3QUJxS0FJQVFRdDBJQUJCQzNRaUFrc2JJZ0VnQVVFRWFpSUJJQUZCQW5SQm1LREFBR29vQWdCQkMzUWdBa3NiSWdFZ0FVRUNhaUlCSUFGQkFuUkJtS0RBQUdvb0FnQkJDM1FnQWtzYklnRWdBVUVCYWlJQklBRkJBblJCbUtEQUFHb29BZ0JCQzNRZ0Frc2JJZ05CQW5SQm1LREFBR29vQWdCQkMzUWlBU0FDUmlBQklBSkphaUFEYWlJQ1FSNU5CRUJCc1FVaEJDQUNRUjVIQkVBZ0FrRUNkRUdjb01BQWFpZ0NBRUVWZGlFRUMwRUFJUUVnQWtGL2FpSURJQUpOQkVBZ0EwRWZUdzBESUFOQkFuUkJtS0RBQUdvb0FnQkIvLy8vQUhFaEFRc0NRQ0FFSUFKQkFuUkJtS0RBQUdvb0FnQkJGWFlpQTBFQmFrWU5BQ0FBSUFGcklRSWdBMEd4QlNBRFFiRUZTeHNoQlNBRVFYOXFJUUZCQUNFQUEwQWdBeUFGUmcwRElBQWdBMEdVb2NBQWFpMEFBR29pQUNBQ1N3MEJJQUVnQTBFQmFpSURSdzBBQ3lBQklRTUxJQU5CQVhFUEN5QUNRUjlCMkovQUFCQTJBQXNnQlVHeEJVSG9uOEFBRURZQUN5QURRUjlCK0ovQUFCQTJBQXZvQWdFRmZ3SkFRYzMvZXlBQVFSQWdBRUVRU3hzaUFHc2dBVTBOQUNBQVFSQWdBVUVMYWtGNGNTQUJRUXRKR3lJRWFrRU1haEFBSWdKRkRRQWdBa0Y0YWlFQkFrQWdBRUYvYWlJRElBSnhSUVJBSUFFaEFBd0JDeUFDUVh4cUlnVW9BZ0FpQmtGNGNTQUNJQU5xUVFBZ0FHdHhRWGhxSWdJZ0FDQUNhaUFDSUFGclFSQkxHeUlBSUFGcklnSnJJUU1nQmtFRGNRUkFJQUFnQXlBQUtBSUVRUUZ4Y2tFQ2NqWUNCQ0FBSUFOcUlnTWdBeWdDQkVFQmNqWUNCQ0FGSUFJZ0JTZ0NBRUVCY1hKQkFuSTJBZ0FnQUNBQUtBSUVRUUZ5TmdJRUlBRWdBaEFHREFFTElBRW9BZ0FoQVNBQUlBTTJBZ1FnQUNBQklBSnFOZ0lBQ3dKQUlBQkJCR29vQWdBaUFVRURjVVVOQUNBQlFYaHhJZ0lnQkVFUWFrME5BQ0FBUVFScUlBUWdBVUVCY1hKQkFuSTJBZ0FnQUNBRWFpSUJJQUlnQkdzaUJFRURjallDQkNBQUlBSnFJZ0lnQWlnQ0JFRUJjallDQkNBQklBUVFCZ3NnQUVFSWFpRURDeUFEQzRVREFRUi9Ba0FDUUNBQlFZQUNUd1JBSUFCQkdHb29BZ0FoQkFKQUFrQWdBQ0FBS0FJTUlnSkdCRUFnQUVFVVFSQWdBRUVVYWlJQ0tBSUFJZ01iYWlnQ0FDSUJEUUZCQUNFQ0RBSUxJQUFvQWdnaUFTQUNOZ0lNSUFJZ0FUWUNDQXdCQ3lBQ0lBQkJFR29nQXhzaEF3TkFJQU1oQlNBQklnSkJGR29pQXlnQ0FDSUJSUVJBSUFKQkVHb2hBeUFDS0FJUUlRRUxJQUVOQUFzZ0JVRUFOZ0lBQ3lBRVJRMENJQUFnQUVFY2FpZ0NBRUVDZEVHY3FjQUFhaUlCS0FJQVJ3UkFJQVJCRUVFVUlBUW9BaEFnQUVZYmFpQUNOZ0lBSUFKRkRRTU1BZ3NnQVNBQ05nSUFJQUlOQVVHUXA4QUFRWkNud0FBb0FnQkJmaUFBS0FJY2QzRTJBZ0FQQ3lBQVFReHFLQUlBSWdJZ0FFRUlhaWdDQUNJQVJ3UkFJQUFnQWpZQ0RDQUNJQUEyQWdnUEMwR01wOEFBUVl5bndBQW9BZ0JCZmlBQlFRTjJkM0UyQWdBTUFRc2dBaUFFTmdJWUlBQW9BaEFpQVFSQUlBSWdBVFlDRUNBQklBSTJBaGdMSUFCQkZHb29BZ0FpQUVVTkFDQUNRUlJxSUFBMkFnQWdBQ0FDTmdJWUN3dWpBd0lFZndKK0l3QkJRR29pQWlRQVFRRWhCQUpBSUFBdEFBUU5BQ0FBTFFBRklRVWdBQ2dDQUNJRExRQUFRUVJ4UlFSQUlBTW9BaGhCOFkzQUFFSHpqY0FBSUFVYlFRSkJBeUFGR3lBRFFSeHFLQUlBS0FJTUVRRUFEUUVnQUNnQ0FDSURLQUlZUWM2bXdBQkJCeUFEUVJ4cUtBSUFLQUlNRVFFQURRRWdBQ2dDQUNJREtBSVlRYWVNd0FCQkFpQURRUnhxS0FJQUtBSU1FUUVBRFFFZ0FTQUFLQUlBUVpTZ3dBQW9BZ0FSQUFBaEJBd0JDeUFGUlFSQUlBTW9BaGhCN0kzQUFFRURJQU5CSEdvb0FnQW9BZ3dSQVFBTkFTQUFLQUlBSVFNTElBSkJBVG9BRnlBQ1FUUnFRYkNOd0FBMkFnQWdBaUFES1FJWU53TUlJQUlnQWtFWGFqWUNFQ0FES1FJSUlRWWdBeWtDRUNFSElBSWdBeTBBSURvQU9DQUNJQWMzQXlnZ0FpQUdOd01nSUFJZ0F5a0NBRGNER0NBQ0lBSkJDR28yQWpBZ0FrRUlha0hPcHNBQVFRY1FDdzBBSUFKQkNHcEJwNHpBQUVFQ0VBc05BQ0FCSUFKQkdHcEJsS0RBQUNnQ0FCRUFBQTBBSUFJb0FqQkI3NDNBQUVFQ0lBSW9BalFvQWd3UkFRQWhCQXNnQUVFQk9nQUZJQUFnQkRvQUJDQUNRVUJySkFBTDVnSUNCbjhCZmlNQVFUQnJJZ1FrQUNBRVFSQnFFQ29nQkNBRUtBSVVJZ1UyQWh3Z0JDQUVLQUlRSWdZMkFoZ2dCRUVJYWlBRFFRQVFRQ0FFS1FNSUlRb2dBRUVBTmdJSUlBQWdDamNDQUFKQUFrQWdBd1JBUVFBaEJrRUFJUVVEUUNBQUlBVkJnQ0FRT2lBQUlBTWdBQ2dDQkNJSElBY2dBMHNiRUU4Z0JpQUNTdzBDSUFBb0FnQWhDQ0FBS0FJSUlnY2dCVWtOQXlBRVFTQnFJQVJCR0dvaUNTZ0NBQ0FCSUFacUlBSWdCbXNnQlNBSWFpQUhJQVZySUFrb0FnUW9BZ3dSQ0FBZ0JDZ0NKQ0FGYWlFSElBUW9BaUFoQ0NBQUtBSUlJZ1VnQjA4RVFDQUFLQUlBR2lBQUlBYzJBZ2dnQnlFRkN5QUVMUUFvUVFKSEJFQWdCaUFJYWlFR0lBVWdBMGtOQVFzTElBUW9BaGdoQmlBRUtBSWNJUVVMSUFZZ0JTZ0NBQkVEQUNBRUtBSWNJZ0FvQWdnYUlBUW9BaGdoQVNBQUtBSUVCRUFnQVJBRUN5QUVRVEJxSkFBUEN5QUdJQUpCeUlIQUFCQTVBQXNnQlNBSFFkaUJ3QUFRT1FBTDJBSUJCWDhDUUFKQUFrQUNRQUpBSUFKQkEycEJmSEVnQW1zaUJFVU5BQ0FESUFRZ0JDQURTeHNpQlVVTkFFRUFJUVFnQVVIL0FYRWhCZ0pBQTBBZ0FpQUVhaTBBQUNBR1JnMEJJQVVnQkVFQmFpSUVSdzBBQ3lBRklBTkJlR29pQkUwTkFnd0RDMEVCSVFjTUF3c2dBMEY0YWlFRVFRQWhCUXNnQVVIL0FYRkJnWUtFQ0d3aEJnTkFJQUlnQldvaUIwRUVhaWdDQUNBR2N5SUlRWDl6SUFoQi8vMzdkMnB4SUFjb0FnQWdCbk1pQjBGL2N5QUhRZi85KzNkcWNYSkJnSUdDaEhoeFJRUkFJQVZCQ0dvaUJTQUVUUTBCQ3dzZ0JTQURTdzBDQzBFQUlRWUNmMEVBSUFNZ0JVWU5BQm9nQWlBRmFpRUNJQU1nQldzaEJrRUFJUVFnQVVIL0FYRWhBUUpBQTBBZ0FpQUVhaTBBQUNBQlJnMEJJQVlnQkVFQmFpSUVSdzBBQzBFQURBRUxJQVFoQmtFQkN5RUhJQVVnQm1vaEJBc2dBQ0FFTmdJRUlBQWdCellDQUE4TElBVWdBMEhva01BQUVEa0FDNzRDQWdWL0FYNGpBRUV3YXlJRUpBQkJKeUVDQWtBZ0FFS1F6Z0JVQkVBZ0FDRUhEQUVMQTBBZ0JFRUphaUFDYWlJRFFYeHFJQUFnQUVLUXpnQ0FJZ2RDa000QWZuMm5JZ1ZCLy84RGNVSGtBRzRpQmtFQmRFR21qc0FBYWk4QUFEc0FBQ0FEUVg1cUlBVWdCa0hrQUd4clFmLy9BM0ZCQVhSQnBvN0FBR292QUFBN0FBQWdBa0Y4YWlFQ0lBQkMvOEhYTDFZZ0J5RUFEUUFMQ3lBSHB5SURRZU1BU2dSQUlBSkJmbW9pQWlBRVFRbHFhaUFIcHlJRElBTkIvLzhEY1VIa0FHNGlBMEhrQUd4clFmLy9BM0ZCQVhSQnBvN0FBR292QUFBN0FBQUxBa0FnQTBFS1RnUkFJQUpCZm1vaUFpQUVRUWxxYWlBRFFRRjBRYWFPd0FCcUx3QUFPd0FBREFFTElBSkJmMm9pQWlBRVFRbHFhaUFEUVRCcU9nQUFDeUFCUWZDTHdBQkJBQ0FFUVFscUlBSnFRU2NnQW1zUUNDQUVRVEJxSkFBTG93SUNCSDhCZmlNQVFVQnFJZ1FrQUFKQUFrQUNRQ0FDSUFOcUlnTWdBazhFUUNBQktBSUVJUVVnQkVFWWFrS0JnSUNBRURjREFDQUVLQUljSWdKQmYyb2lCaUFFS0FJWWFrRUFJQUpySWdkeHJTQUZRUUYwSWdVZ0F5QUZJQU5MR3lJRFFRZ2dBMEVJU3h1dGZpSUlRaUNJcHlBQ1JYSU5BU0FDYVVFQlJnUkFJQWluSUFacUlBZHhJUU1NQXdzZ0JFRXdhaEF3QUFzZ0JFRUlhaUFEUVFBUVdpQUFJQVFwQXdnM0FnUkJBU0VDREFJTFFRQWhBZ3NnQkVFd2FpQUJFRTBnQkVFZ2FpQURJQUlnQkVFd2FoQWxRUUVoQWlBRVFTaHFLQUlBSVFNZ0JDZ0NKQ0VGSUFRb0FpQkJBVWNFUUNBQklBVWdBeEJhUVFBaEFnd0JDeUFFUVJCcUlBVWdBeEJhSUFBZ0JDa0RFRGNDQkFzZ0FDQUNOZ0lBSUFSQlFHc2tBQXV1QWdFSWZ5TUFRVEJySWdFa0FFR0FJQ0VDSUFGQkdHb1FMeUFCS0FJY0lRUWdBU2dDR0NFRklBRkJFR29RTWlBQktBSVVJUVlnQVNnQ0VDRUhJQUZCQ0dwQmdDQkJBUkJBSUFGQmdDQTJBaWdnQVNBQktBSU1JZ2cyQWlRZ0FTQUJLQUlJSWdNMkFpQWdDRUdCSUU4RVFDQUJRU0JxUVlBZ0VFVWdBU2dDSUNFRElBRW9BaWdoQWdzZ0FFRUFPd0JISUFCQkFEc0JPQ0FBSUFNMkFpZ2dBQ0FGTmdJUUlBQkJDRG9BUmlBQVFRQTZBQXNnQUVJQU53TUFJQUJCTUdwQ0FEY0RBQ0FBUVN4cUlBSTJBZ0FnQUVFa2FrRUFOZ0lBSUFCQklHb2dCallDQUNBQVFSeHFJQWMyQWdBZ0FFRVlha0VBTmdJQUlBQkJGR29nQkRZQ0FDQUFRUWs2QUFvZ0FFR0FBanNCUWlBQVFZRUNPd0ZFSUFCQmdnSTdBVUFnQUVIL0F6c0JDQ0FCUVRCcUpBQUx4d0lDQlg4QmZpTUFRUkJySWdNa0FDQUFMUUFMSVFJZ0EwSUFOd01JSUFFb0FnQWhCUUpBQWtBZ0FBSi9JQUVvQWdRaUJFSEFBQ0FDYXlJR1FmZ0JjVUVEZGlJQ1NRUkFJQVJCQ1U4TkFpQURRUWhxSUFVZ0JCQkxHaUFCUVFBMkFnUWdBVUdJZzhBQU5nSUFJQVJCQTNRTUFRc2dCa0gvQVhGQnlBQlBEUUlnQTBFSWFpQUZJQUlRU3hvZ0FTQUVJQUpyTmdJRUlBRWdBaUFGYWpZQ0FDQUdRZmdCY1FzZ0FDMEFDeUlCYWpvQUN5QUFJQUFwQXdBZ0F5a0RDQ0lIUWppR0lBZENLSVpDZ0lDQWdJQ0F3UDhBZzRRZ0IwSVloa0tBZ0lDQWdPQS9neUFIUWdpR1FvQ0FnSUR3SDRPRWhDQUhRZ2lJUW9DQWdQZ1BneUFIUWhpSVFvQ0EvQWVEaENBSFFpaUlRb0QrQTRNZ0IwSTRpSVNFaENBQlFUOXhyWWlFTndNQUlBTkJFR29rQUE4TElBUkJDRUhZaGNBQUVEY0FDeUFDUVFoQnlJWEFBQkEzQUF1cUFnRURmeU1BUVlBQmF5SUVKQUFDUUFKQUFuOENRQ0FCS0FJQUlnTkJFSEZGQkVBZ0FDZ0NBQ0VDSUFOQklIRU5BU0FDclNBQkVCVU1BZ3NnQUNnQ0FDRUNRUUFoQUFOQUlBQWdCR3BCL3dCcUlBSkJEM0VpQTBFd2NpQURRZGNBYWlBRFFRcEpHem9BQUNBQVFYOXFJUUFnQWtFRWRpSUNEUUFMSUFCQmdBRnFJZ0pCZ1FGUERRSWdBVUdranNBQVFRSWdBQ0FFYWtHQUFXcEJBQ0FBYXhBSURBRUxRUUFoQUFOQUlBQWdCR3BCL3dCcUlBSkJEM0VpQTBFd2NpQURRVGRxSUFOQkNra2JPZ0FBSUFCQmYyb2hBQ0FDUVFSMklnSU5BQXNnQUVHQUFXb2lBa0dCQVU4TkFpQUJRYVNPd0FCQkFpQUFJQVJxUVlBQmFrRUFJQUJyRUFnTElBUkJnQUZxSkFBUEN5QUNRWUFCUVpTT3dBQVFPUUFMSUFKQmdBRkJsSTdBQUJBNUFBdXhBZ0VFZnlNQVFVQnFJZ0lrQUNBQktBSUVJZ05GQkVBZ0FVRUVhaUVESUFFb0FnQWhCQ0FDUVFBMkFpQWdBa0lCTndNWUlBSWdBa0VZYWpZQ0pDQUNRVGhxSUFSQkVHb3BBZ0EzQXdBZ0FrRXdhaUFFUVFocUtRSUFOd01BSUFJZ0JDa0NBRGNES0NBQ1FTUnFRZGlKd0FBZ0FrRW9haEFKR2lBQ1FSQnFJZ1FnQWlnQ0lEWUNBQ0FDSUFJcEF4ZzNBd2dDUUNBQktBSUVJZ1ZGRFFBZ0FVRUlhaWdDQUVVTkFDQUZFQVFMSUFNZ0Fpa0RDRGNDQUNBRFFRaHFJQVFvQWdBMkFnQWdBeWdDQUNFREN5QUJRUUUyQWdRZ0FVRU1haWdDQUNFRUlBRkJDR29pQVNnQ0FDRUZJQUZDQURjQ0FFRU1RUVFRV1NJQlJRUkFRUXhCQkJCakFBc2dBU0FFTmdJSUlBRWdCVFlDQkNBQklBTTJBZ0FnQUVHUWk4QUFOZ0lFSUFBZ0FUWUNBQ0FDUVVCckpBQUwvQUVCQW44akFFRVFheUlDSkFBZ0FDZ0NBQ0FDUVFBMkFnd0Nmd0pBQWtBZ0FVR0FBVThFUUNBQlFZQVFTUTBCSUFKQkRHb2hBQ0FCUVlDQUJFOE5BaUFDSUFGQlAzRkJnQUZ5T2dBT0lBSWdBVUVNZGtIZ0FYSTZBQXdnQWlBQlFRWjJRVDl4UVlBQmNqb0FEVUVEREFNTElBSWdBVG9BRENBQ1FReHFJUUJCQVF3Q0N5QUNJQUZCUDNGQmdBRnlPZ0FOSUFJZ0FVRUdka0hBQVhJNkFBd2dBa0VNYWlFQVFRSU1BUXNnQWlBQlFUOXhRWUFCY2pvQUR5QUNJQUZCRW5aQjhBRnlPZ0FNSUFJZ0FVRUdka0UvY1VHQUFYSTZBQTRnQWlBQlFReDJRVDl4UVlBQmNqb0FEVUVFQ3lFQklBQWdBUkFMSUFKQkVHb2tBQXY1QVFFQ2Z5TUFRUkJySWdJa0FDQUNRUUEyQWd3Q2Z3SkFBa0FnQVVHQUFVOEVRQ0FCUVlBUVNRMEJJQUpCREdvaEF5QUJRWUNBQkU4TkFpQUNJQUZCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0hnQVhJNkFBd2dBaUFCUVFaMlFUOXhRWUFCY2pvQURVRUREQU1MSUFJZ0FUb0FEQ0FDUVF4cUlRTkJBUXdDQ3lBQ0lBRkJQM0ZCZ0FGeU9nQU5JQUlnQVVFR2RrSEFBWEk2QUF3Z0FrRU1haUVEUVFJTUFRc2dBaUFCUVQ5eFFZQUJjam9BRHlBQ0lBRkJFblpCOEFGeU9nQU1JQUlnQVVFR2RrRS9jVUdBQVhJNkFBNGdBaUFCUVF4MlFUOXhRWUFCY2pvQURVRUVDeUVCSUFBZ0F5QUJFQXNnQWtFUWFpUUFDL3dCQVFOL0l3QkJJR3NpQkNRQUFrQWdBa0VCYWlJRElBSlBCRUFnQVNnQ0JDSUNRUUYwSWdVZ0F5QUZJQU5MR3lJRFFRUWdBMEVFU3hzaUEwSC8vLy8vQTNFZ0EwWkJBWFFoQlNBRFFRSjBJUU1DUUNBQ0JFQWdCRUVZYWtFQ05nSUFJQVFnQWtFQ2REWUNGQ0FFSUFFb0FnQTJBaEFNQVFzZ0JFRUFOZ0lRQ3lBRUlBTWdCU0FFUVJCcUVDVkJBU0VDSUFSQkNHb29BZ0FoQXlBRUtBSUVJUVVnQkNnQ0FFRUJSd1JBSUFFZ0JUWUNBQ0FCSUFOQkFuWTJBZ1JCQUNFQ0RBSUxJQUFnQlRZQ0JDQUFRUWhxSUFNMkFnQU1BUXNnQUNBRE5nSUVJQUJCQ0dwQkFEWUNBRUVCSVFJTElBQWdBallDQUNBRVFTQnFKQUFMOEFFQkJIOGpBRUVnYXlJRUpBQUNRQ0FDUVFGcUlnTWdBazhFUUNBQktBSUVJZ1ZCQVhRaUFpQURJQUlnQTBzYklnTkJCQ0FEUVFSTEd5SURJQU5xSWdZZ0EwOUJBWFFoQXdKQUlBVUVRQ0FFUVJocVFRSTJBZ0FnQkNBQ05nSVVJQVFnQVNnQ0FEWUNFQXdCQ3lBRVFRQTJBaEFMSUFRZ0JpQURJQVJCRUdvUUpVRUJJUUlnQkVFSWFpZ0NBQ0VESUFRb0FnUWhCU0FFS0FJQVFRRkhCRUFnQVNBRk5nSUFJQUVnQTBFQmRqWUNCRUVBSVFJTUFnc2dBQ0FGTmdJRUlBQkJDR29nQXpZQ0FBd0JDeUFBSUFNMkFnUWdBRUVJYWtFQU5nSUFRUUVoQWdzZ0FDQUNOZ0lBSUFSQklHb2tBQXZaQVFFRGZ3SkFJQUJCQkdvb0FnQWlCQ0FBUVFocUtBSUFJZ05ySUFJZ0FXc2lCVThFUUNBQUtBSUFJUVFNQVFzQ2Z3SkFBa0FnQXlBRmFpSUNJQU5KRFFBZ0JFRUJkQ0lESUFJZ0F5QUNTeHNpQWtFSUlBSkJDRXNiSVFJZ0JBUkFJQUpCQUVnTkFTQUFLQUlBSWdORkRRSWdBeUFFUVFFZ0FoQlZEQU1MSUFKQkFFNE5BUXNRWFFBTElBSkJBUkJaQ3lJRUJFQWdBQ0FFTmdJQUlBQkJCR29nQWpZQ0FDQUFRUWhxS0FJQUlRTU1BUXNnQWtFQkVHTUFDeUFESUFScUlBRWdCUkJMR2lBQVFRaHFJZ0FnQUNnQ0FDQUZhallDQUF2b0FRRUZmeU1BUVJCcklnTWtBQ0FBTFFBTElRSWdBMElBTndNSUlBRW9BZ0FoQlFKQUFrQWdBQUovSUFFb0FnUWlCRUhBQUNBQ2F5SUdRZmdCY1VFRGRpSUNTUVJBSUFSQkNVOE5BaUFEUVFocUlBVWdCQkJMR2lBQlFRQTJBZ1FnQVVHSWc4QUFOZ0lBSUFSQkEzUU1BUXNnQmtIL0FYRkJ5QUJQRFFJZ0EwRUlhaUFGSUFJUVN4b2dBU0FFSUFKck5nSUVJQUVnQWlBRmFqWUNBQ0FHUWZnQmNRc2dBQzBBQ3lJQmFqb0FDeUFBSUFBcEF3QWdBeWtEQ0NBQlFUOXhyWWFFTndNQUlBTkJFR29rQUE4TElBUkJDRUg0aGNBQUVEY0FDeUFDUVFoQjZJWEFBQkEzQUF2Y0FRRUVmeU1BUVVCcUlnSWtBQ0FCUVFScUlRUWdBU2dDQkVVRVFDQUJLQUlBSVFNZ0FrRUFOZ0lnSUFKQ0FUY0RHQ0FDSUFKQkdHbzJBaVFnQWtFNGFpQURRUkJxS1FJQU53TUFJQUpCTUdvZ0EwRUlhaWtDQURjREFDQUNJQU1wQWdBM0F5Z2dBa0VrYWtIWWljQUFJQUpCS0dvUUNSb2dBa0VRYWlJRElBSW9BaUEyQWdBZ0FpQUNLUU1ZTndNSUFrQWdBU2dDQkNJRlJRMEFJQUZCQ0dvb0FnQkZEUUFnQlJBRUN5QUVJQUlwQXdnM0FnQWdCRUVJYWlBREtBSUFOZ0lBQ3lBQVFaQ0x3QUEyQWdRZ0FDQUVOZ0lBSUFKQlFHc2tBQXVZQWdFQ2Z5TUFRU0JySWdRa0FFRUJJUVZCaUtmQUFFR0lwOEFBS0FJQVFRRnFOZ0lBQWtBQ1FBSkFRZENxd0FBb0FnQkJBVWNFUUVIUXFzQUFRb0dBZ0lBUU53TUFEQUVMUWRTcXdBQkIxS3JBQUNnQ0FFRUJhaUlGTmdJQUlBVkJBa3NOQVFzZ0JDQUROZ0ljSUFRZ0FqWUNHQ0FFUWZDSndBQTJBaFFnQkVId2ljQUFOZ0lRUWZ5bXdBQW9BZ0FpQWtGL1RBMEFRZnltd0FBZ0FrRUJhaUlDTmdJQVFmeW13QUJCaEtmQUFDZ0NBQ0lEQkg5QmdLZkFBQ2dDQUNBRVFRaHFJQUFnQVNnQ0VCRUNBQ0FFSUFRcEF3ZzNBeEFnQkVFUWFpQURLQUlNRVFJQVFmeW13QUFvQWdBRklBSUxRWDlxTmdJQUlBVkJBVTBOQVFzQUN5TUFRUkJySWdJa0FDQUNJQUUyQWd3Z0FpQUFOZ0lJQUF2TUFRRUNmeUFCUVJScUtBSUFJZ1VnQTBILy93TnhJZ1JMQkVBZ0FTZ0NEQ0FFUVFGMGFpOEJBQ0VGSUFFb0FnZ2lCQ0FCS0FJRVJnUkFJQUVnQkJBOElBRW9BZ2doQkFzZ0FTZ0NBQ0FFUVFKMGFpSUVJQUk2QUFJZ0JDQURPd0VBSUFFZ0FTZ0NDRUVCYWpZQ0NDQUJLQUlVSWdRZ0FVRVFhaWdDQUVZRVFDQUJRUXhxSUFRUU95QUJLQUlVSVFRTElBRW9BZ3dnQkVFQmRHb2dCVUVCYWpzQkFDQUJJQUVvQWhSQkFXbzJBaFFnQUNBQ09nQUNJQUFnQXpzQkFBOExJQVFnQlVINGhzQUFFRFlBQzhRQkFRSi9Jd0JCRUdzaUFpUUFJQUlnQWExQ2dJQ0FnQkJDQUNBQktBSVlRY1dtd0FCQkNTQUJRUnhxS0FJQUtBSU1FUUVBRzRRM0F3QWdBaUFBTmdJTUlBSWdBa0VNYWhBU0lBSXRBQVFoQVNBQ0xRQUZCRUFnQVVIL0FYRWhBQ0FDQW45QkFTQUFEUUFhSUFJb0FnQWlBRUVjYWlnQ0FDZ0NEQ0VCSUFBb0FoZ2hBeUFBTFFBQVFRUnhSUVJBSUFOQjk0M0FBRUVDSUFFUkFRQU1BUXNnQTBIMmpjQUFRUUVnQVJFQkFBc2lBVG9BQkFzZ0FrRVFhaVFBSUFGQi93RnhRUUJIQzZvQkFRSi9Ba0FDUUFKQUlBSUVRRUVCSVFRZ0FVRUFUZzBCREFJTElBQWdBVFlDQkVFQklRUU1BUXNDUUFKQUFrQUNRQUpBSUFNb0FnQWlCVVVFUUNBQlJRMEJEQU1MSUFNb0FnUWlBdzBCSUFFTkFnc2dBaUVEREFNTElBVWdBeUFDSUFFUVZTSURSUTBCREFJTElBRWdBaEJaSWdNTkFRc2dBQ0FCTmdJRUlBSWhBUXdDQ3lBQUlBTTJBZ1JCQUNFRURBRUxRUUFoQVFzZ0FDQUVOZ0lBSUFCQkNHb2dBVFlDQUF1ZkFRRURmeUFBUWdBM0FnZ0NRQ0FCUVJScUtBSUFJZ1FnQWtILy93TnhJZ05MQkVBZ0FTZ0NEQ0FEUVFGMGFpOEJBQ0VESUFBb0FnUWhCQ0FBUVFBMkFnUWdBQ2dDQUNFRklBQkJBVFlDQUNBRUlBTkpEUUVnQVNBQ0lBVWdBeEFwSUFBb0FnUUVRQ0FBS0FJQUVBUUxJQUFnQXpZQ0RDQUFJQVEyQWdRZ0FDQUZOZ0lBRHdzZ0F5QUVRYmlHd0FBUU5nQUxJQU1nQkVISWhzQUFFRGNBQzRjQkFRSi9Jd0JCTUdzaUJDUUFJQVJCSUdvaUJTQUNOZ0lJSUFVZ0FqWUNCQ0FGSUFFMkFnQWdCRUVJYWlBRVFTQnFFRTRnQkVFUWFpQUVLQUlJSWdFZ0JDZ0NEQ0lDSUFNUUV5QUNCRUFnQVJBRUN5QUVRU2hxSUFSQkdHb29BZ0EyQWdBZ0JDQUVLUU1RTndNZ0lBUWdCRUVnYWhCT0lBQWdCQ2tEQURjREFDQUVRVEJxSkFBTGdnRUJCbjhqQUVFUWF5SURKQUFnQUNBQUtBSUlJQUVRT2lBQUtBSUFJUVVnQUNnQ0NDRUNJQU5CQ0dwQkFTQUJFRm9nQWlBRmFpRUVJQU1vQWd3aUJpQURLQUlJSWdkTEJFQWdCQ0FHSUFkckVGSWdCU0FDSUFacUlBZHJJZ0pxSVFRTElBQWdBUVIvSUFSQkFEb0FBQ0FDUVFGcUJTQUNDellDQ0NBRFFSQnFKQUFMamdFQkEzOGdBQ2dDQ0NJRUlBRkIvLzhEY1NJRlN3UkFJQU1FUUNBQUtBSUFJUVFnQWtGL2FpRUZJQUVoQUFOQUlBUWdBRUgvL3dOeFFRSjBhaUlHTHdFQUlRQWdBeUFGYWlBR0xRQUNPZ0FBSUFBZ0FTQUFJQUZCLy84RGNVa2JJUUFnQTBGL2FpSUREUUFMSUFJdEFBQVBDMEVBUVFCQm1JZkFBQkEyQUFzZ0JVRUJhaUFFUVlpSHdBQVFOd0FMYUFFQ2Z5TUFRZEFBYXlJQ0pBQWpBRUV3YXlJQkpBQWdBVUVJT2dBUElBRkJNR29rQUNBQ0VCZEIwQUJCQ0JCWklnRUVRQ0FCSUFKQjBBQVFTeG9nQVVFQk9nQklJQUJCcElQQUFEWUNCQ0FBSUFFMkFnQWdBa0hRQUdva0FBOExRZEFBUVFnUVl3QUxnQUVDQW44QmZpQUJMUUFMSWdRZ0FTMEFDaUlEU1FSQUlBRWdBaEFZSUFFdEFBc2hCQ0FCTFFBS0lRTUxJQVFnQTBIL0FYRkpCSDlCQUFVZ0FTQUVJQU5yT2dBTElBRWdBU2tEQUNBRHJZa2lCU0FCTHdFSUlnR3RRbitGUW9DQWZJU0ROd01BSUFFZ0JhZHhJUU5CQVFzaEFTQUFJQU03QVFJZ0FDQUJPd0VBQzZJQkFRTi9Jd0JCRUdzaUFTUUFJQUFvQWdBaUFrRVVhaWdDQUNFREFrQUNmd0pBQWtBZ0FpZ0NCQTRDQUFFREN5QUREUUpCQUNFQ1FmQ0p3QUFNQVFzZ0F3MEJJQUlvQWdBaUF5Z0NCQ0VDSUFNb0FnQUxJUU1nQVNBQ05nSUVJQUVnQXpZQ0FDQUJRZnlLd0FBZ0FDZ0NCQ2dDQ0NBQUtBSUlFQ0lBQ3lBQlFRQTJBZ1FnQVNBQ05nSUFJQUZCNklyQUFDQUFLQUlFS0FJSUlBQW9BZ2dRSWdBTGdRRUJBMzhnQVNnQ0JDSURJQUpQQkVBQ1FDQURSUTBBSUFFb0FnQWhCQUpBQWtBZ0FrVUVRRUVCSVFNZ0JCQUVEQUVMSUFRZ0EwRUJJQUlRVlNJRFJRMEJDeUFCSUFJMkFnUWdBU0FETmdJQURBRUxJQUFnQWpZQ0JDQUFRUWhxUVFFMkFnQkJBU0VGQ3lBQUlBVTJBZ0FQQzBHVWlNQUFRU1JCdUlqQUFCQklBQXQxQWdKL0FYNGdBUzBBQ3lJRUlBRXRBQW9pQTBrRVFDQUJJQUlRSUNBQkxRQUxJUVFnQVMwQUNpRURDeUFFSUFOQi93RnhTUVIvUVFBRklBRWdCQ0FEYXpvQUN5QUJJQUVwQXdBaUJTQURyVUkvZzRnM0F3QWdBUzhCQ0NBRnAzRWhBMEVCQ3lFQklBQWdBenNCQWlBQUlBRTdBUUFMTUFFQmZ3SkFBa0JCZ0lBQlFRSVFXU0lCRFFFTUFBdEJnSUFCUVFJUVl3QUxJQUFnQVRZQ0FDQUFRWUFnTmdJRUM0WUJBUUYvSXdCQlFHb2lBU1FBSUFGQkt6WUNEQ0FCUVlDQndBQTJBZ2dnQVVHc2djQUFOZ0lVSUFFZ0FEWUNFQ0FCUVN4cVFRSTJBZ0FnQVVFOGFrRWhOZ0lBSUFGQ0FqY0NIQ0FCUWF5TXdBQTJBaGdnQVVFZE5nSTBJQUVnQVVFd2FqWUNLQ0FCSUFGQkVHbzJBamdnQVNBQlFRaHFOZ0l3SUFGQkdHcEI4SURBQUJCUkFBdHhBUU4vSXdCQklHc2lBaVFBQWtBZ0FDQUJFQmtOQUNBQlFSeHFLQUlBSVFNZ0FTZ0NHQ0FDUVJ4cVFRQTJBZ0FnQWtId2k4QUFOZ0lZSUFKQ0FUY0NEQ0FDUWZTTHdBQTJBZ2dnQXlBQ1FRaHFFQWtOQUNBQVFRUnFJQUVRR1NBQ1FTQnFKQUFQQ3lBQ1FTQnFKQUJCQVFzd0FRRi9Ba0FDUUVHQXdBQkJBaEJaSWdFTkFRd0FDMEdBd0FCQkFoQmpBQXNnQUNBQk5nSUFJQUJCZ0NBMkFnUUxld0VDZndKQUFrQWdBQ2dDQkNJQkJFQWdBQ2dDRENJQ0lBRlBEUUVnQUNnQ0FDSUJJQUpxSUFFdEFBQTZBQUFnQUVFQU5nSUlJQUFnQUNnQ0RFRUJhallDRENBQUtBSUVSUTBDSUFBb0FnQXRBQUFQQzBFQVFRQkJpSWJBQUJBMkFBc2dBaUFCUVppR3dBQVFOZ0FMUVFCQkFFR29oc0FBRURZQUMyZ0JBbjhnQUNBQUxRQkdJZ0ZCQVdvaUFqb0FDaUFBUVFFZ0FVRVBjWFJCQW1vaUFUc0JRQ0FBUVg4Z0FrRVBjWFJCZjNNN0FRZ2dBRUVZYWlnQ0FDQUJRZi8vQTNFaUFVOEVRQ0FBSUFFMkFoZ0xJQUJCSkdvb0FnQWdBVThFUUNBQUlBRTJBaVFMQzFBQkFYOGdBRUVVYWlnQ0FDSUJSU0FCUVFKMFJYSkZCRUFnQUNnQ0VCQUVDeUFBUVNCcUtBSUFJZ0ZGSUFGQkFYUkZja1VFUUNBQUtBSWNFQVFMSUFCQkxHb29BZ0FFUUNBQUtBSW9FQVFMQzJ3QkFYOGpBRUV3YXlJREpBQWdBeUFCTmdJRUlBTWdBRFlDQUNBRFFSeHFRUUkyQWdBZ0EwRXNha0VjTmdJQUlBTkNBamNDRENBRFFZQ053QUEyQWdnZ0EwRWNOZ0lrSUFNZ0EwRWdhallDR0NBRElBTTJBaWdnQXlBRFFRUnFOZ0lnSUFOQkNHb2dBaEJSQUF0c0FRRi9Jd0JCTUdzaUF5UUFJQU1nQVRZQ0JDQURJQUEyQWdBZ0EwRWNha0VDTmdJQUlBTkJMR3BCSERZQ0FDQURRZ0kzQWd3Z0EwSE1rY0FBTmdJSUlBTkJIRFlDSkNBRElBTkJJR28yQWhnZ0F5QURRUVJxTmdJb0lBTWdBellDSUNBRFFRaHFJQUlRVVFBTGJBRUJmeU1BUVRCcklnTWtBQ0FESUFFMkFnUWdBeUFBTmdJQUlBTkJIR3BCQWpZQ0FDQURRU3hxUVJ3MkFnQWdBMElDTndJTUlBTkJnSkxBQURZQ0NDQURRUncyQWlRZ0F5QURRU0JxTmdJWUlBTWdBMEVFYWpZQ0tDQURJQU0yQWlBZ0EwRUlhaUFDRUZFQUMyd0JBWDhqQUVFd2F5SURKQUFnQXlBQk5nSUVJQU1nQURZQ0FDQURRUnhxUVFJMkFnQWdBMEVzYWtFY05nSUFJQU5DQWpjQ0RDQURRYXlSd0FBMkFnZ2dBMEVjTmdJa0lBTWdBMEVnYWpZQ0dDQURJQU5CQkdvMkFpZ2dBeUFETmdJZ0lBTkJDR29nQWhCUkFBdGNBUUYvSXdCQkVHc2lBeVFBQWtBZ0FDZ0NCQ0FCYXlBQ1R3UkFJQU5CQURZQ0FBd0JDeUFESUFBZ0FTQUNFQllnQXlnQ0FFRUJSdzBBSUFOQkNHb29BZ0FpQUFSQUlBTW9BZ1FnQUJCakFBc1FYUUFMSUFOQkVHb2tBQXRhQVFGL0l3QkJFR3NpQWlRQUFrQWdBQ2dDQkNBQmEwRUJUd1JBSUFKQkFEWUNBQXdCQ3lBQ0lBQWdBUkFlSUFJb0FnQkJBVWNOQUNBQ1FRaHFLQUlBSWdBRVFDQUNLQUlFSUFBUVl3QUxFRjBBQ3lBQ1FSQnFKQUFMV2dFQmZ5TUFRUkJySWdJa0FBSkFJQUFvQWdRZ0FXdEJBVThFUUNBQ1FRQTJBZ0FNQVFzZ0FpQUFJQUVRSFNBQ0tBSUFRUUZIRFFBZ0FrRUlhaWdDQUNJQUJFQWdBaWdDQkNBQUVHTUFDeEJkQUFzZ0FrRVFhaVFBQzFrQkFYOGpBRUVnYXlJQ0pBQWdBaUFBS0FJQU5nSUVJQUpCR0dvZ0FVRVFhaWtDQURjREFDQUNRUkJxSUFGQkNHb3BBZ0EzQXdBZ0FpQUJLUUlBTndNSUlBSkJCR3BCMkluQUFDQUNRUWhxRUFrZ0FrRWdhaVFBQzBZQUFrQkJDQ0FDU1FSQUFuOUJDQ0FDU1FSQUlBSWdBeEFRREFFTElBTVFBQXNpQWcwQlFRQVBDeUFBSUFNUUNnOExJQUlnQUNBRElBRWdBU0FEU3hzUVN5QUFFQVFMV1FFQmZ5TUFRU0JySWdJa0FDQUNJQUFvQWdBMkFnUWdBa0VZYWlBQlFSQnFLUUlBTndNQUlBSkJFR29nQVVFSWFpa0NBRGNEQUNBQ0lBRXBBZ0EzQXdnZ0FrRUVha0h3ajhBQUlBSkJDR29RQ1NBQ1FTQnFKQUFMV1FBQ1FBSkFBa0FnQVVGL1NnUkFBa0FnQWdSQUlBRU5BUXdFQ3lBQlJRMERJQUZCQVJCWklnSU5CQXdDQ3lBQkVFY2lBa1VOQVF3REN4QmRBQXNnQVVFQkVHTUFDMEVCSVFJTElBQWdBVFlDQkNBQUlBSTJBZ0FMVmdFQmZ5TUFRU0JySWdJa0FDQUNJQUEyQWdRZ0FrRVlhaUFCUVJCcUtRSUFOd01BSUFKQkVHb2dBVUVJYWlrQ0FEY0RBQ0FDSUFFcEFnQTNBd2dnQWtFRWFrSHdqOEFBSUFKQkNHb1FDU0FDUVNCcUpBQUxXUUVEZndKQUlBRW9BZ3dpQWlBQktBSUlJZ05QQkVBZ0FTZ0NCQ0lFSUFKSkRRRWdBU2dDQUNFQklBQWdBaUFEYXpZQ0JDQUFJQUVnQTJvMkFnQVBDeUFESUFKQjJJYkFBQkE0QUFzZ0FpQUVRZGlHd0FBUU53QUxWUUVCZnlBQVFSQnFJQUF0QUVZUURTQUFRUUE2QUVjZ0FFRUFPd0U0SUFCQk1HcENBRGNEQUNBQVFRQTZBQXNnQUVJQU53TUFJQUFnQUMwQVJrRUJhaUlCT2dBS0lBQkJmeUFCUVE5eGRFRi9jenNCQ0F0REFRTi9Ba0FnQWtVTkFBTkFJQUF0QUFBaUJDQUJMUUFBSWdWR0JFQWdBRUVCYWlFQUlBRkJBV29oQVNBQ1FYOXFJZ0lOQVF3Q0N3c2dCQ0FGYXlFREN5QURDMFVCQVg4akFFRVFheUlDSkFBZ0FpQUFJQUVRTFFKQUlBSW9BZ0JCQVVZRVFDQUNRUWhxS0FJQUlnQkZEUUVnQWlnQ0JDQUFFR01BQ3lBQ1FSQnFKQUFQQ3hCZEFBdEtBQUovSUFGQmdJREVBRWNFUUVFQklBQW9BaGdnQVNBQVFSeHFLQUlBS0FJUUVRQUFEUUVhQ3lBQ1JRUkFRUUFQQ3lBQUtBSVlJQUlnQXlBQVFSeHFLQUlBS0FJTUVRRUFDd3NtQVFGL0FrQWdBQkFBSWdGRkRRQWdBVUY4YWkwQUFFRURjVVVOQUNBQklBQVFVZ3NnQVF0SEFRRi9Jd0JCSUdzaUF5UUFJQU5CRkdwQkFEWUNBQ0FEUWZDTHdBQTJBaEFnQTBJQk53SUVJQU1nQVRZQ0hDQURJQUEyQWhnZ0F5QURRUmhxTmdJQUlBTWdBaEJSQUF0RUFRSi9JQUVvQWdRaEFpQUJLQUlBSVFOQkNFRUVFRmtpQVVVRVFFRUlRUVFRWXdBTElBRWdBallDQkNBQklBTTJBZ0FnQUVHZ2k4QUFOZ0lFSUFBZ0FUWUNBQXRiQVFOL0l3QkJFR3NpQVNRQUlBQW9BZ3dpQWtVRVFFR0Fpc0FBUVN0QnlJckFBQkJJQUFzZ0FDZ0NDQ0lEUlFSQVFZQ0t3QUJCSzBIWWlzQUFFRWdBQ3lBQklBSTJBZ2dnQVNBQU5nSUVJQUVnQXpZQ0FDQUJFRkFBQ3pNQkFYOGdBZ1JBSUFBaEF3TkFJQU1nQVMwQUFEb0FBQ0FCUVFGcUlRRWdBMEVCYWlFRElBSkJmMm9pQWcwQUN3c2dBQXNzQUFKQUlBQkJmRTBFUUNBQVJRUkFRUVFoQUF3Q0N5QUFJQUJCZlVsQkFuUVFXU0lBRFFFTEFBc2dBQXN4QVFGL0lBRW9BZ1FpQWdSQUlBQWdBallDQkNBQVFRaHFRUUUyQWdBZ0FDQUJLQUlBTmdJQUR3c2dBRUVBTmdJQUN6RUJBWDhnQUNBQktBSUVJQUVvQWdnaUFrc0VmeUFCSUFJUVJTQUJLQUlJQlNBQ0N6WUNCQ0FBSUFFb0FnQTJBZ0FMS0FFQmZ5QUFLQUlJSWdJZ0FVOEVRQ0FBS0FJQUdpQUFJQUUyQWdnUEN5QUFJQUVnQW1zUUtBc3NBUUYvSXdCQkVHc2lBU1FBSUFGQkNHb2dBRUVJYWlnQ0FEWUNBQ0FCSUFBcEFnQTNBd0FnQVJBc0FBczBBUUYvSXdCQkVHc2lBaVFBSUFJZ0FUWUNEQ0FDSUFBMkFnZ2dBa0c4ak1BQU5nSUVJQUpCOEl2QUFEWUNBQ0FDRUVvQUN5RUFJQUVFUUFOQUlBQkJBRG9BQUNBQVFRRnFJUUFnQVVGL2FpSUJEUUFMQ3dzZ0FRRi9Ba0FnQUNnQ0FDSUJSUTBBSUFCQkJHb29BZ0JGRFFBZ0FSQUVDd3NnQVFGL0FrQWdBQ2dDQkNJQlJRMEFJQUJCQ0dvb0FnQkZEUUFnQVJBRUN3c01BQ0FBSUFFZ0FpQURFRDRMQ3dBZ0FRUkFJQUFRQkFzTEVnQWdBQ2dDQUNBQklBRWdBbW9RSDBFQUN4UUFJQUFvQWdBZ0FTQUFLQUlFS0FJTUVRQUFDeGtBQW45QkNDQUJTUVJBSUFFZ0FCQVFEQUVMSUFBUUFBc0xFQUFnQUNBQ05nSUVJQUFnQVRZQ0FBc1RBQ0FBUWFDTHdBQTJBZ1FnQUNBQk5nSUFDeEFBSUFFZ0FDZ0NBQ0FBS0FJRUVBVUxFUUJCekl2QUFFRVJRZUNMd0FBUVNBQUxEZ0FnQUNnQ0FCb0RRQXdBQ3dBTEN3QWdBRFVDQUNBQkVCVUxEUUFnQUNnQ0FDQUJJQUlRQ3dzTEFDQUFNUUFBSUFFUUZRc0xBQ0FBSXdCcUpBQWpBQXNaQUNBQUlBRkIrS2JBQUNnQ0FDSUFRUTRnQUJzUkFnQUFDdzBBSUFGQnhKREFBRUVDRUFVTENRQWdBRUVBT2dCSEN3Y0FJQUF0QUVjTERRQkM5UG1lNXU2anF2bitBQXNOQUVMM3VPNzZxc3pWN3VVQUN3d0FRdW5Rb3R2TW91cTdSZ3NEQUFFTEF3QUJDd3ZmSmdFQVFZQ0F3QUFMMVNZdlZYTmxjbk12Wm0wNE1UTXZMbkoxYzNSMWNDOTBiMjlzWTJoaGFXNXpMM04wWVdKc1pTMTRPRFpmTmpRdFlYQndiR1V0WkdGeWQybHVMMnhwWWk5eWRYTjBiR2xpTDNOeVl5OXlkWE4wTDJ4cFluSmhjbmt2WTI5eVpTOXpjbU12WVd4c2IyTXZiR0Y1YjNWMExuSnpBQUFRQUhBQUFBQUxBUUFBT1FBQUFHTmhiR3hsWkNCZ1VtVnpkV3gwT2pwMWJuZHlZWEFvS1dBZ2IyNGdZVzRnWUVWeWNtQWdkbUZzZFdVQUFRQUFBQUFBQUFBQkFBQUFBZ0FBQUhOeVl5OXNhV0l1Y25NQUFMd0FFQUFLQUFBQUd3QUFBQTRBQUFDOEFCQUFDZ0FBQUJ3QUFBQVNBQUFBWVhOelpYSjBhVzl1SUdaaGFXeGxaRG9nYldsa0lEdzlJSE5sYkdZdWJHVnVLQ2t2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZMjl5WlM5emNtTXZjMnhwWTJVdmJXOWtMbkp6Q3dFUUFHMEFBQUQ5QkFBQUNRQUFBQU1BQUFCUUFBQUFDQUFBQUFRQUFBQUZBQUFBQmdBQUFBY0FBQUFJQUFBQVVBQUFBQWdBQUFBSkFBQUFDZ0FBQUFzQUFBQU1BQUFBTDFWelpYSnpMMlp0T0RFekx5NWpZWEpuYnk5eVpXZHBjM1J5ZVM5emNtTXZaMmwwYUhWaUxtTnZiUzB4WldOak5qSTVPV1JpT1dWak9ESXpMM2RsWlhwc0xUQXVNUzQwTDNOeVl5OWtaV052WkdVdWNuTUFBTUFCRUFCV0FBQUFXZ0lBQUI4QUFBREFBUkFBVmdBQUFHMENBQUFiQUFBQXdBRVFBRllBQUFDQ0FnQUFKZ0FBQU1BQkVBQldBQUFBcXdJQUFCRUFBQURBQVJBQVZnQUFBSzBDQUFBUkFBQUF3QUVRQUZZQUFBQzVBZ0FBR1FBQUFNQUJFQUJXQUFBQXpRSUFBQ0lBQUFEQUFSQUFWZ0FBQU04Q0FBQWJBQUFBd0FFUUFGWUFBQURRQWdBQUZRQUFBTUFCRUFCV0FBQUEwUUlBQUJVQUFBREFBUkFBVmdBQUFQb0NBQUFOQUFBQXdBRVFBRllBQUFCRkF3QUFFUUFBQU1BQkVBQldBQUFBU3dNQUFCRUFBQURBQVJBQVZnQUFBSW9EQUFBUkFBQUF3QUVRQUZZQUFBQ1FBd0FBRVFBQUFNQUJFQUJXQUFBQXZBTUFBQ2NBQUFEQUFSQUFWZ0FBQUx3REFBQUpBQUFBd0FFUUFGWUFBQUMvQXdBQUNRQUFBTUFCRUFCV0FBQUF4Z01BQUJVQUFBREFBUkFBVmdBQUFNa0RBQUFZQUFBQXdBRVFBRllBQUFEU0F3QUFDZ0FBQU1BQkVBQldBQUFBK0FNQUFBb0FBQURBQVJBQVZnQUFBQVVFQUFBVkFBQUF3QUVRQUZZQUFBQU5CQUFBRmdBQUFNQUJFQUJXQUFBQUdBUUFBQWtBQUFBdlZYTmxjbk12Wm0wNE1UTXZMbkoxYzNSMWNDOTBiMjlzWTJoaGFXNXpMM04wWVdKc1pTMTRPRFpmTmpRdFlYQndiR1V0WkdGeWQybHVMMnhwWWk5eWRYTjBiR2xpTDNOeVl5OXlkWE4wTDJ4cFluSmhjbmt2WVd4c2IyTXZjM0pqTDNKaGQxOTJaV011Y25OVWNtbGxaQ0IwYnlCemFISnBibXNnZEc4Z1lTQnNZWEpuWlhJZ1kyRndZV05wZEhtb0F4QUFiQUFBQU1VQkFBQUpBQUFBVFdGNGFXMTFiU0JqYjJSbElITnBlbVVnTVRJZ2NtVnhkV2x5WldRc0lHZHZkQ0FBU0FRUUFDTUFBQUF2VlhObGNuTXZabTA0TVRNdkxtTmhjbWR2TDNKbFoybHpkSEo1TDNOeVl5OW5hWFJvZFdJdVkyOXRMVEZsWTJNMk1qazVaR0k1WldNNE1qTXZkMlZsZW13dE1DNHhMalF2YzNKakwyeHBZaTV5Y3dCMEJCQUFVd0FBQUUwQUFBQUZBQUFBRHdBQUFBUUFBQUFFQUFBQUVBQUFBQkVBQUFBU0FBQUFEd0FBQUFBQUFBQUJBQUFBRXdBQUFHTmhiR3hsWkNCZ1QzQjBhVzl1T2pwMWJuZHlZWEFvS1dBZ2IyNGdZU0JnVG05dVpXQWdkbUZzZFdWc2FXSnlZWEo1TDNOMFpDOXpjbU12Y0dGdWFXTnJhVzVuTG5KekFDc0ZFQUFjQUFBQTdRRUFBQjhBQUFBckJSQUFIQUFBQU80QkFBQWVBQUFBRkFBQUFCQUFBQUFFQUFBQUZRQUFBQllBQUFBUEFBQUFDQUFBQUFRQUFBQVhBQUFBR0FBQUFCa0FBQUFNQUFBQUJBQUFBQm9BQUFBUEFBQUFDQUFBQUFRQUFBQWJBQUFBYkdsaWNtRnllUzloYkd4dll5OXpjbU12Y21GM1gzWmxZeTV5YzJOaGNHRmphWFI1SUc5MlpYSm1iRzkzQUFBQXNBVVFBQndBQUFBZUFnQUFCUUFBQUdBdUxnRHhCUkFBQWdBQUFHTmhiR3hsWkNCZ1QzQjBhVzl1T2pwMWJuZHlZWEFvS1dBZ2IyNGdZU0JnVG05dVpXQWdkbUZzZFdVNklBQUFBUEFGRUFBQUFBQUFKd1lRQUFJQUFBQWlBQUFBQUFBQUFBRUFBQUFqQUFBQWFXNWtaWGdnYjNWMElHOW1JR0p2ZFc1a2N6b2dkR2hsSUd4bGJpQnBjeUFnWW5WMElIUm9aU0JwYm1SbGVDQnBjeUFBQUV3R0VBQWdBQUFBYkFZUUFCSUFBQUJzYVdKeVlYSjVMMk52Y21VdmMzSmpMMlp0ZEM5aWRXbHNaR1Z5Y3k1eWN5SUFBQUFNQUFBQUJBQUFBQ1FBQUFBbEFBQUFKZ0FBQUNBZ0lDQ1FCaEFBSUFBQUFESUFBQUFoQUFBQWtBWVFBQ0FBQUFBekFBQUFFZ0FBQUNCN0Npd0tMQ0FnZXlCOUlIMXNhV0p5WVhKNUwyTnZjbVV2YzNKakwyWnRkQzl1ZFcwdWNuUDVCaEFBR3dBQUFHVUFBQUFVQUFBQU1IZ3dNREF4TURJd016QTBNRFV3TmpBM01EZ3dPVEV3TVRFeE1qRXpNVFF4TlRFMk1UY3hPREU1TWpBeU1USXlNak15TkRJMU1qWXlOekk0TWprek1ETXhNekl6TXpNME16VXpOak0zTXpnek9UUXdOREUwTWpRek5EUTBOVFEyTkRjME9EUTVOVEExTVRVeU5UTTFORFUxTlRZMU56VTROVGsyTURZeE5qSTJNelkwTmpVMk5qWTNOamcyT1Rjd056RTNNamN6TnpRM05UYzJOemMzT0RjNU9EQTRNVGd5T0RNNE5EZzFPRFk0TnpnNE9EazVNRGt4T1RJNU16azBPVFU1TmprM09UZzVPUUFBSWdBQUFBUUFBQUFFQUFBQUp3QUFBQ2dBQUFBcEFBQUFiR2xpY21GeWVTOWpiM0psTDNOeVl5OW1iWFF2Ylc5a0xuSnpBQWdJRUFBYkFBQUFWUVFBQUJFQUFBQUlDQkFBR3dBQUFGOEVBQUFrQUFBQUtDbHNhV0p5WVhKNUwyTnZjbVV2YzNKakwzTnNhV05sTDIxbGJXTm9jaTV5Y3dBQVJnZ1FBQ0FBQUFCYUFBQUFCUUFBQUhKaGJtZGxJSE4wWVhKMElHbHVaR1Y0SUNCdmRYUWdiMllnY21GdVoyVWdabTl5SUhOc2FXTmxJRzltSUd4bGJtZDBhQ0I0Q0JBQUVnQUFBSW9JRUFBaUFBQUFjbUZ1WjJVZ1pXNWtJR2x1WkdWNElMd0lFQUFRQUFBQWlnZ1FBQ0lBQUFCemJHbGpaU0JwYm1SbGVDQnpkR0Z5ZEhNZ1lYUWdJR0oxZENCbGJtUnpJR0YwSUFEY0NCQUFGZ0FBQVBJSUVBQU5BQUFBYkdsaWNtRnllUzlqYjNKbEwzTnlZeTl6ZEhJdmNHRjBkR1Z5Ymk1eWN3QVFDUkFBSHdBQUFMQUJBQUFtQUFBQVd5NHVMbDFpZVhSbElHbHVaR1Y0SUNCcGN5QnZkWFFnYjJZZ1ltOTFibVJ6SUc5bUlHQUFBRVVKRUFBTEFBQUFVQWtRQUJZQUFBRHdCUkFBQVFBQUFHSmxaMmx1SUR3OUlHVnVaQ0FvSUR3OUlDa2dkMmhsYmlCemJHbGphVzVuSUdBQUFJQUpFQUFPQUFBQWpna1FBQVFBQUFDU0NSQUFFQUFBQVBBRkVBQUJBQUFBSUdseklHNXZkQ0JoSUdOb1lYSWdZbTkxYm1SaGNuazdJR2wwSUdseklHbHVjMmxrWlNBZ0tHSjVkR1Z6SUNrZ2IyWWdZRVVKRUFBTEFBQUF4QWtRQUNZQUFBRHFDUkFBQ0FBQUFQSUpFQUFHQUFBQThBVVFBQUVBQUFCc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDNWdWFXTnZaR1V2Y0hKcGJuUmhZbXhsTG5KekFBQUFJQW9RQUNVQUFBQUtBQUFBSEFBQUFDQUtFQUFsQUFBQUdnQUFBRFlBQUFBQUFRTUZCUVlHQXdjR0NBZ0pFUW9jQ3hrTUZBMFFEZzBQQkJBREVoSVRDUllCRndVWUFoa0RHZ2NjQWgwQkh4WWdBeXNETEFJdEN5NEJNQU14QWpJQnB3S3BBcW9FcXdqNkF2c0YvUVQrQS84SnJYaDVpNDJpTUZkWWk0eVFIQjNkRGc5TFRQdjhMaTgvWEYxZnRlS0VqWTZSa3FteHVydkZ4c25LM3VUbC93QUVFUklwTVRRM09qczlTVXBkaEk2U3FiRzB1cnZHeXM3UDVPVUFCQTBPRVJJcE1UUTZPMFZHU1VwZVpHV0VrWnVkeWM3UERSRXBSVWxYWkdXTmthbTB1cnZGeWQvazVmQU5FVVZKWkdXQWhMSzh2ci9WMS9EeGc0V0xwS2ErdjhYSHpzL2EyMGlZdmMzR3pzOUpUazlYV1Y1ZmlZNlBzYmEzdjhIR3g5Y1JGaGRiWFBiMy92K0FEVzF4M3Q4T0R4OXVieHdkWDMxK3JxKzd2UG9XRng0ZlJrZE9UMWhhWEY1K2Y3WEYxTlhjOFBIMWNuT1BkSFdXTDE4bUxpK25yN2UveDgvWDM1cEFsNWd3angvQXdjNy9UazlhV3djSUR4QW5MKzd2Ym04M1BUOUNSWkNSL3Y5VFozWEl5ZERSMk5ubi92OEFJRjhpZ3Q4RWdrUUlHd1FHRVlHc0RvQ3JOU2dMZ09BREdRZ0JCQzhFTkFRSEF3RUhCZ2NSQ2xBUEVnZFZCd01FSEFvSkF3Z0RCd01DQXdNRERBUUZBd3NHQVE0VkJUb0RFUWNHQlJBSFZ3Y0NCeFVOVUFSREF5MERBUVFSQmc4TU9nUWRKVjhnYlFScUpZRElCWUt3QXhvR2d2MERXUWNWQ3hjSkZBd1VER29HQ2dZYUJsa0hLd1ZHQ2l3RURBUUJBekVMTEFRYUJnc0RnS3dHQ2dZaFAwd0VMUU4wQ0R3RER3TThCemdJS3dXQy94RVlDQzhSTFFNZ0VDRVBnSXdFZ3BjWkN4V0lsQVV2QlRzSEFnNFlDWUN6TFhRTWdOWWFEQVdBL3dXQTN3enVEUU9FalFNM0NZRmNGSUM0Q0lETEtqZ0RDZ1k0Q0VZSURBWjBDeDREV2dSWkNZQ0RHQndLRmdsTUJJQ0tCcXVrREJjRU1hRUVnZG9tQnd3RkJZQ2xFWUZ0RUhnb0tnWk1CSUNOQklDK0F4c0REdzBBQmdFQkF3RUVBZ2dJQ1FJS0JRc0NEZ1FRQVJFQ0VnVVRFUlFCRlFJWEFoa05IQVVkQ0NRQmFnTnJBcndDMFFMVUROVUoxZ0xYQXRvQjRBWGhBdWdDN2lEd0JQZ0MrUUw2QXZzQkRDYzdQazVQajU2ZW53WUhDVFk5UGxiejBORUVGQmcyTjFaWGY2cXVyNzAxNEJLSGlZNmVCQTBPRVJJcE1UUTZSVVpKU2s1UFpHVmN0cmNiSEFjSUNnc1VGelk1T3FpcDJOa0pONUNScUFjS096NW1hWStTYjEvdTcxcGltcHNuS0ZXZG9LR2pwS2VvcmJxOHhBWUxEQlVkT2o5RlVhYW56TTJnQnhrYUlpVStQOFhHQkNBakpTWW9Nemc2U0VwTVVGTlZWbGhhWEY1Z1kyVm1hM040ZlgrS3BLcXZzTURRcnE5NXpHNXZrMTRpZXdVREJDMERaZ01CTHk2QWdoMERNUThjQkNRSkhnVXJCVVFFRGlxQXFnWWtCQ1FFS0FnMEN3R0FrSUUzQ1JZS0NJQ1lPUU5qQ0Frd0ZnVWhBeHNGQVVBNEJFc0ZMd1FLQndrSFFDQW5CQXdKTmdNNkJSb0hCQXdIVUVrM013MHpCeTRJQ29FbVVrNG9DQ3BXSEJRWENVNEVIZzlERGhrSENnWklDQ2NKZFFzL1FTb0dPd1VLQmxFR0FRVVFBd1dBaTJJZVNBZ0tnS1plSWtVTENnWU5FemtIQ2pZc0JCQ0F3RHhrVXd4SUNRcEdSUnRJQ0ZNZE9ZRUhSZ29kQTBkSk53TU9DQW9HT1FjS2dUWVpnTGNCRHpJTmc1dG1kUXVBeElxOGhDK1AwWUpIb2JtQ09RY3FCQUpnSmdwR0NpZ0ZFNEt3VzJWTEJEa0hFVUFGQ3dJT2wvZ0loTllxQ2FMM2dSOHhBeEVFQ0lHTWlRUnJCUTBEQ1FjUWsyQ0E5Z3B6Q0c0WFJvQ2FGQXhYQ1JtQWg0RkhBNFZDRHhXRlVDdUExUzBER2dRQ2dYQTZCUUdGQUlEWEtVd0VDZ1FDZ3hGRVREMkF3andHQVFSVkJSczBBb0VPTEFSa0RGWUtnSzQ0SFEwc0JBa0hBZzRHZ0pxRDJBZ05BdzBEZEF4WkJ3d1VEQVE0Q0FvR0tBZ2lUb0ZVREJVREF3VUhDUmtIQndrRERRY3BnTXNsQ29RR2JHbGljbUZ5ZVM5amIzSmxMM055WXk5MWJtbGpiMlJsTDNWdWFXTnZaR1ZmWkdGMFlTNXljd0N2RHhBQUtBQUFBRXNBQUFBb0FBQUFydzhRQUNnQUFBQlhBQUFBRmdBQUFLOFBFQUFvQUFBQVVnQUFBRDRBQUFBaUFBQUFCQUFBQUFRQUFBQXFBQUFBQUFNQUFJTUVJQUNSQldBQVhST2dBQklYb0I0TUlPQWU3eXdnS3lvd29DdHZwbUFzQXFqZ0xCNzc0QzBBL3FBMW52L2dOZjBCWVRZQkNxRTJKQTFoTjZzTzRUZ3ZHQ0U1TUJ4aFJ2TWVvVXJ3YW1GT1QyK2hUcDI4SVU5bDBlRlBBTm9oVUFEZzRWRXc0V0ZUN09LaFZORG80VlFnQUM1VjhBRy9WUUJ3QUFjQUxRRUJBUUlCQWdFQlNBc3dGUkFCWlFjQ0JnSUNBUVFqQVI0Yld3czZDUWtCR0FRQkNRRURBUVVyQTNjUEFTQTNBUUVCQkFnRUFRTUhDZ0lkQVRvQkFRRUNCQWdCQ1FFS0Fob0JBZ0k1QVFRQ0JBSUNBd01CSGdJREFRc0NPUUVFQlFFQ0JBRVVBaFlHQVFFNkFRRUNBUVFJQVFjRENnSWVBVHNCQVFFTUFRa0JLQUVEQVRrREJRTUJCQWNDQ3dJZEFUb0JBZ0VDQVFNQkJRSUhBZ3NDSEFJNUFnRUJBZ1FJQVFrQkNnSWRBVWdCQkFFQ0F3RUJDQUZSQVFJSERBaGlBUUlKQ3daS0Foc0JBUUVCQVRjT0FRVUJBZ1VMQVNRSkFXWUVBUVlCQWdJQ0dRSUVBeEFFRFFFQ0FnWUJEd0VBQXdBREhRTWRBaDRDUUFJQkJ3Z0JBZ3NKQVMwRGR3SWlBWFlEQkFJSkFRWUQyd0lDQVRvQkFRY0JBUUVCQWdnR0NnSUJNQkUvQkRBSEFRRUZBU2dKREFJZ0JBSUNBUU00QVFFQ0F3RUJBem9JQWdLWUF3RU5BUWNFQVFZQkF3TEdPZ0VGQUFIRElRQURqUUZnSUFBR2FRSUFCQUVLSUFKUUFnQUJBd0VFQVJrQ0JRR1hBaG9TRFFFbUNCa0xMZ013QVFJRUFnSW5BVU1HQWdJQ0Fnd0JDQUV2QVRNQkFRTUNBZ1VDQVFFcUFnZ0I3Z0VDQVFRQkFBRUFFQkFRQUFJQUFlSUJsUVVBQXdFQ0JRUW9Bd1FCcFFJQUJBQUNtUXV3QVRZUE9BTXhCQUlDUlFNa0JRRUlQZ0VNQWpRSkNnUUNBVjhEQWdFQkFnWUJvQUVEQ0JVQ09RSUJBUUVCRmdFT0J3TUZ3d2dDQXdFQkZ3RlJBUUlHQVFFQ0FRRUNBUUxyQVFJRUJnSUJBaHNDVlFnQ0FRRUNhZ0VCQVFJR0FRRmxBd0lFQVFVQUNRRUM5UUVLQWdFQkJBR1FCQUlDQkFFZ0NpZ0dBZ1FJQVFrR0FnTXVEUUVDQUFjQkJnRUJVaFlDQndFQ0FRSjZCZ01CQVFJQkJ3RUJTQUlEQVFFQkFBSUFCVHNIQUFFL0JGRUJBQUlBQVFFREJBVUlDQUlISGdTVUF3QTNCRElJQVE0QkZnVUJEd0FIQVJFQ0J3RUNBUVVBQndBRUFBZHRCd0JnZ1BBQVRHRjViM1YwUlhKeWNISnBkbUYwWlFCN0NYQnliMlIxWTJWeWN3SUliR0Z1WjNWaFoyVUJCRkoxYzNRQURIQnliMk5sYzNObFpDMWllUU1GY25WemRHTWRNUzQwT1M0d0lDaGxNVGc0TkdFNFpUTWdNakF5TUMweE1pMHlPU2tHZDJGc2NuVnpCakF1TVRndU1BeDNZWE50TFdKcGJtUm5aVzRTTUM0eUxqY3dJQ2hpTmpNMU5XTXlOekFwIik7bGV0IG87YXN5bmMgZnVuY3Rpb24gTihBLEkpe298fChvPWF3YWl0KGFzeW5jKCk9Pihhd2FpdCBFKEcpLEQpKSgpKTtjb25zdCBnPW8uZGVjb21wcmVzcyhBLEkpO2lmKDA9PT1nLmxlbmd0aCl0aHJvdyBFcnJvcigiRmFpbGVkIHRvIGRlY29kZSB3aXRoIExaVyBkZWNvZGVyLiIpO3JldHVybiBnfQoKY2xhc3MgTFpXRGVjb2RlciQxIGV4dGVuZHMgQmFzZURlY29kZXIgewogIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgIHN1cGVyKCk7CiAgICBjb25zdCB3aWR0aCA9IGZpbGVEaXJlY3RvcnkuVGlsZVdpZHRoIHx8IGZpbGVEaXJlY3RvcnkuSW1hZ2VXaWR0aDsKICAgIGNvbnN0IGhlaWdodCA9IGZpbGVEaXJlY3RvcnkuVGlsZUxlbmd0aCB8fCBmaWxlRGlyZWN0b3J5LkltYWdlTGVuZ3RoOwogICAgY29uc3QgbmJ5dGVzID0gZmlsZURpcmVjdG9yeS5CaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgIHRoaXMubWF4VW5jb21wcmVzc2VkU2l6ZSA9IHdpZHRoICogaGVpZ2h0ICogbmJ5dGVzOwogIH0KCiAgYXN5bmMgZGVjb2RlQmxvY2soYnVmZmVyKSB7CiAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgTihieXRlcywgdGhpcy5tYXhVbmNvbXByZXNzZWRTaXplKTsKICAgIHJldHVybiBkZWNvZGVkLmJ1ZmZlcjsKICB9Cn0KCmFkZERlY29kZXIoNSwgKCkgPT4gTFpXRGVjb2RlciQxKTsKY29uc3Qgd29ya2VyID0gc2VsZjsKd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBhc3luYyAoZSkgPT4gewogIGNvbnN0IHsgaWQsIGZpbGVEaXJlY3RvcnksIGJ1ZmZlciB9ID0gZS5kYXRhOwogIGNvbnN0IGRlY29kZXIgPSBhd2FpdCBnZXREZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogIGNvbnN0IGRlY29kZWQgPSBhd2FpdCBkZWNvZGVyLmRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpOwogIHdvcmtlci5wb3N0TWVzc2FnZSh7IGRlY29kZWQsIGlkIH0sIFtkZWNvZGVkXSk7Cn0pOwoKY2xhc3MgUmF3RGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgIHJldHVybiBidWZmZXI7CiAgfQp9Cgp2YXIgcmF3ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogIF9fcHJvdG9fXzogbnVsbCwKICAnZGVmYXVsdCc6IFJhd0RlY29kZXIKfSk7Cgpjb25zdCBNSU5fQklUUyA9IDk7CmNvbnN0IENMRUFSX0NPREUgPSAyNTY7IC8vIGNsZWFyIGNvZGUKY29uc3QgRU9JX0NPREUgPSAyNTc7IC8vIGVuZCBvZiBpbmZvcm1hdGlvbgpjb25zdCBNQVhfQllURUxFTkdUSCA9IDEyOwoKZnVuY3Rpb24gZ2V0Qnl0ZShhcnJheSwgcG9zaXRpb24sIGxlbmd0aCkgewogIGNvbnN0IGQgPSBwb3NpdGlvbiAlIDg7CiAgY29uc3QgYSA9IE1hdGguZmxvb3IocG9zaXRpb24gLyA4KTsKICBjb25zdCBkZSA9IDggLSBkOwogIGNvbnN0IGVmID0gKHBvc2l0aW9uICsgbGVuZ3RoKSAtICgoYSArIDEpICogOCk7CiAgbGV0IGZnID0gKDggKiAoYSArIDIpKSAtIChwb3NpdGlvbiArIGxlbmd0aCk7CiAgY29uc3QgZGcgPSAoKGEgKyAyKSAqIDgpIC0gcG9zaXRpb247CiAgZmcgPSBNYXRoLm1heCgwLCBmZyk7CiAgaWYgKGEgPj0gYXJyYXkubGVuZ3RoKSB7CiAgICBjb25zb2xlLndhcm4oJ3JhbiBvZmYgdGhlIGVuZCBvZiB0aGUgYnVmZmVyIGJlZm9yZSBmaW5kaW5nIEVPSV9DT0RFIChlbmQgb24gaW5wdXQgY29kZSknKTsKICAgIHJldHVybiBFT0lfQ09ERTsKICB9CiAgbGV0IGNodW5rMSA9IGFycmF5W2FdICYgKCgyICoqICg4IC0gZCkpIC0gMSk7CiAgY2h1bmsxIDw8PSAobGVuZ3RoIC0gZGUpOwogIGxldCBjaHVua3MgPSBjaHVuazE7CiAgaWYgKGEgKyAxIDwgYXJyYXkubGVuZ3RoKSB7CiAgICBsZXQgY2h1bmsyID0gYXJyYXlbYSArIDFdID4+PiBmZzsKICAgIGNodW5rMiA8PD0gTWF0aC5tYXgoMCwgKGxlbmd0aCAtIGRnKSk7CiAgICBjaHVua3MgKz0gY2h1bmsyOwogIH0KICBpZiAoZWYgPiA4ICYmIGEgKyAyIDwgYXJyYXkubGVuZ3RoKSB7CiAgICBjb25zdCBoaSA9ICgoYSArIDMpICogOCkgLSAocG9zaXRpb24gKyBsZW5ndGgpOwogICAgY29uc3QgY2h1bmszID0gYXJyYXlbYSArIDJdID4+PiBoaTsKICAgIGNodW5rcyArPSBjaHVuazM7CiAgfQogIHJldHVybiBjaHVua3M7Cn0KCmZ1bmN0aW9uIGFwcGVuZFJldmVyc2VkKGRlc3QsIHNvdXJjZSkgewogIGZvciAobGV0IGkgPSBzb3VyY2UubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIGRlc3QucHVzaChzb3VyY2VbaV0pOwogIH0KICByZXR1cm4gZGVzdDsKfQoKZnVuY3Rpb24gZGVjb21wcmVzcyhpbnB1dCkgewogIGNvbnN0IGRpY3Rpb25hcnlJbmRleCA9IG5ldyBVaW50MTZBcnJheSg0MDkzKTsKICBjb25zdCBkaWN0aW9uYXJ5Q2hhciA9IG5ldyBVaW50OEFycmF5KDQwOTMpOwogIGZvciAobGV0IGkgPSAwOyBpIDw9IDI1NzsgaSsrKSB7CiAgICBkaWN0aW9uYXJ5SW5kZXhbaV0gPSA0MDk2OwogICAgZGljdGlvbmFyeUNoYXJbaV0gPSBpOwogIH0KICBsZXQgZGljdGlvbmFyeUxlbmd0aCA9IDI1ODsKICBsZXQgYnl0ZUxlbmd0aCA9IE1JTl9CSVRTOwogIGxldCBwb3NpdGlvbiA9IDA7CgogIGZ1bmN0aW9uIGluaXREaWN0aW9uYXJ5KCkgewogICAgZGljdGlvbmFyeUxlbmd0aCA9IDI1ODsKICAgIGJ5dGVMZW5ndGggPSBNSU5fQklUUzsKICB9CiAgZnVuY3Rpb24gZ2V0TmV4dChhcnJheSkgewogICAgY29uc3QgYnl0ZSA9IGdldEJ5dGUoYXJyYXksIHBvc2l0aW9uLCBieXRlTGVuZ3RoKTsKICAgIHBvc2l0aW9uICs9IGJ5dGVMZW5ndGg7CiAgICByZXR1cm4gYnl0ZTsKICB9CiAgZnVuY3Rpb24gYWRkVG9EaWN0aW9uYXJ5KGksIGMpIHsKICAgIGRpY3Rpb25hcnlDaGFyW2RpY3Rpb25hcnlMZW5ndGhdID0gYzsKICAgIGRpY3Rpb25hcnlJbmRleFtkaWN0aW9uYXJ5TGVuZ3RoXSA9IGk7CiAgICBkaWN0aW9uYXJ5TGVuZ3RoKys7CiAgICByZXR1cm4gZGljdGlvbmFyeUxlbmd0aCAtIDE7CiAgfQogIGZ1bmN0aW9uIGdldERpY3Rpb25hcnlSZXZlcnNlZChuKSB7CiAgICBjb25zdCByZXYgPSBbXTsKICAgIGZvciAobGV0IGkgPSBuOyBpICE9PSA0MDk2OyBpID0gZGljdGlvbmFyeUluZGV4W2ldKSB7CiAgICAgIHJldi5wdXNoKGRpY3Rpb25hcnlDaGFyW2ldKTsKICAgIH0KICAgIHJldHVybiByZXY7CiAgfQoKICBjb25zdCByZXN1bHQgPSBbXTsKICBpbml0RGljdGlvbmFyeSgpOwogIGNvbnN0IGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQpOwogIGxldCBjb2RlID0gZ2V0TmV4dChhcnJheSk7CiAgbGV0IG9sZENvZGU7CiAgd2hpbGUgKGNvZGUgIT09IEVPSV9DT0RFKSB7CiAgICBpZiAoY29kZSA9PT0gQ0xFQVJfQ09ERSkgewogICAgICBpbml0RGljdGlvbmFyeSgpOwogICAgICBjb2RlID0gZ2V0TmV4dChhcnJheSk7CiAgICAgIHdoaWxlIChjb2RlID09PSBDTEVBUl9DT0RFKSB7CiAgICAgICAgY29kZSA9IGdldE5leHQoYXJyYXkpOwogICAgICB9CgogICAgICBpZiAoY29kZSA9PT0gRU9JX0NPREUpIHsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChjb2RlID4gQ0xFQVJfQ09ERSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgY29ycnVwdGVkIGNvZGUgYXQgc2NhbmxpbmUgJHtjb2RlfWApOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHZhbCA9IGdldERpY3Rpb25hcnlSZXZlcnNlZChjb2RlKTsKICAgICAgICBhcHBlbmRSZXZlcnNlZChyZXN1bHQsIHZhbCk7CiAgICAgICAgb2xkQ29kZSA9IGNvZGU7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY29kZSA8IGRpY3Rpb25hcnlMZW5ndGgpIHsKICAgICAgY29uc3QgdmFsID0gZ2V0RGljdGlvbmFyeVJldmVyc2VkKGNvZGUpOwogICAgICBhcHBlbmRSZXZlcnNlZChyZXN1bHQsIHZhbCk7CiAgICAgIGFkZFRvRGljdGlvbmFyeShvbGRDb2RlLCB2YWxbdmFsLmxlbmd0aCAtIDFdKTsKICAgICAgb2xkQ29kZSA9IGNvZGU7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBvbGRWYWwgPSBnZXREaWN0aW9uYXJ5UmV2ZXJzZWQob2xkQ29kZSk7CiAgICAgIGlmICghb2xkVmFsKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCb2d1cyBlbnRyeS4gTm90IGluIGRpY3Rpb25hcnksICR7b2xkQ29kZX0gLyAke2RpY3Rpb25hcnlMZW5ndGh9LCBwb3NpdGlvbjogJHtwb3NpdGlvbn1gKTsKICAgICAgfQogICAgICBhcHBlbmRSZXZlcnNlZChyZXN1bHQsIG9sZFZhbCk7CiAgICAgIHJlc3VsdC5wdXNoKG9sZFZhbFtvbGRWYWwubGVuZ3RoIC0gMV0pOwogICAgICBhZGRUb0RpY3Rpb25hcnkob2xkQ29kZSwgb2xkVmFsW29sZFZhbC5sZW5ndGggLSAxXSk7CiAgICAgIG9sZENvZGUgPSBjb2RlOwogICAgfQoKICAgIGlmIChkaWN0aW9uYXJ5TGVuZ3RoICsgMSA+PSAoMiAqKiBieXRlTGVuZ3RoKSkgewogICAgICBpZiAoYnl0ZUxlbmd0aCA9PT0gTUFYX0JZVEVMRU5HVEgpIHsKICAgICAgICBvbGRDb2RlID0gdW5kZWZpbmVkOwogICAgICB9IGVsc2UgewogICAgICAgIGJ5dGVMZW5ndGgrKzsKICAgICAgfQogICAgfQogICAgY29kZSA9IGdldE5leHQoYXJyYXkpOwogIH0KICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkocmVzdWx0KTsKfQoKY2xhc3MgTFpXRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgIHJldHVybiBkZWNvbXByZXNzKGJ1ZmZlcikuYnVmZmVyOwogIH0KfQoKdmFyIGx6dyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICBfX3Byb3RvX186IG51bGwsCiAgJ2RlZmF1bHQnOiBMWldEZWNvZGVyCn0pOwoKLyogLSotIHRhYi13aWR0aDogMjsgaW5kZW50LXRhYnMtbW9kZTogbmlsOyBjLWJhc2ljLW9mZnNldDogMiAtKi0gLwovKiB2aW06IHNldCBzaGlmdHdpZHRoPTIgdGFic3RvcD0yIGF1dG9pbmRlbnQgY2luZGVudCBleHBhbmR0YWI6ICovCi8qCiAgIENvcHlyaWdodCAyMDExIG5vdG1hc3RlcnlldAogICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwoKLy8gLSBUaGUgSlBFRyBzcGVjaWZpY2F0aW9uIGNhbiBiZSBmb3VuZCBpbiB0aGUgSVRVIENDSVRUIFJlY29tbWVuZGF0aW9uIFQuODEKLy8gICAod3d3LnczLm9yZy9HcmFwaGljcy9KUEVHL2l0dS10ODEucGRmKQovLyAtIFRoZSBKRklGIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBKUEVHIEZpbGUgSW50ZXJjaGFuZ2UgRm9ybWF0Ci8vICAgKHd3dy53My5vcmcvR3JhcGhpY3MvSlBFRy9qZmlmMy5wZGYpCi8vIC0gVGhlIEFkb2JlIEFwcGxpY2F0aW9uLVNwZWNpZmljIEpQRUcgbWFya2VycyBpbiB0aGUgU3VwcG9ydGluZyB0aGUgRENUIEZpbHRlcnMKLy8gICBpbiBQb3N0U2NyaXB0IExldmVsIDIsIFRlY2huaWNhbCBOb3RlICM1MTE2Ci8vICAgKHBhcnRuZXJzLmFkb2JlLmNvbS9wdWJsaWMvZGV2ZWxvcGVyL2VuL3BzL3Nkay81MTE2LkRDVF9GaWx0ZXIucGRmKQoKY29uc3QgZGN0WmlnWmFnID0gbmV3IEludDMyQXJyYXkoWwogIDAsCiAgMSwgOCwKICAxNiwgOSwgMiwKICAzLCAxMCwgMTcsIDI0LAogIDMyLCAyNSwgMTgsIDExLCA0LAogIDUsIDEyLCAxOSwgMjYsIDMzLCA0MCwKICA0OCwgNDEsIDM0LCAyNywgMjAsIDEzLCA2LAogIDcsIDE0LCAyMSwgMjgsIDM1LCA0MiwgNDksIDU2LAogIDU3LCA1MCwgNDMsIDM2LCAyOSwgMjIsIDE1LAogIDIzLCAzMCwgMzcsIDQ0LCA1MSwgNTgsCiAgNTksIDUyLCA0NSwgMzgsIDMxLAogIDM5LCA0NiwgNTMsIDYwLAogIDYxLCA1NCwgNDcsCiAgNTUsIDYyLAogIDYzLApdKTsKCmNvbnN0IGRjdENvczEgPSA0MDE3OyAvLyBjb3MocGkvMTYpCmNvbnN0IGRjdFNpbjEgPSA3OTk7IC8vIHNpbihwaS8xNikKY29uc3QgZGN0Q29zMyA9IDM0MDY7IC8vIGNvcygzKnBpLzE2KQpjb25zdCBkY3RTaW4zID0gMjI3NjsgLy8gc2luKDMqcGkvMTYpCmNvbnN0IGRjdENvczYgPSAxNTY3OyAvLyBjb3MoNipwaS8xNikKY29uc3QgZGN0U2luNiA9IDM3ODQ7IC8vIHNpbig2KnBpLzE2KQpjb25zdCBkY3RTcXJ0MiA9IDU3OTM7IC8vIHNxcnQoMikKY29uc3QgZGN0U3FydDFkMiA9IDI4OTY7Ly8gc3FydCgyKSAvIDIKCmZ1bmN0aW9uIGJ1aWxkSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLCB2YWx1ZXMpIHsKICBsZXQgayA9IDA7CiAgY29uc3QgY29kZSA9IFtdOwogIGxldCBsZW5ndGggPSAxNjsKICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgIC0tbGVuZ3RoOwogIH0KICBjb2RlLnB1c2goeyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwoKICBsZXQgcCA9IGNvZGVbMF07CiAgbGV0IHE7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2RlTGVuZ3Roc1tpXTsgaisrKSB7CiAgICAgIHAgPSBjb2RlLnBvcCgpOwogICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICB3aGlsZSAocC5pbmRleCA+IDApIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgfQogICAgICBwLmluZGV4Kys7CiAgICAgIGNvZGUucHVzaChwKTsKICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICBjb2RlLnB1c2gocSA9IHsgY2hpbGRyZW46IFtdLCBpbmRleDogMCB9KTsKICAgICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gcS5jaGlsZHJlbjsKICAgICAgICBwID0gcTsKICAgICAgfQogICAgICBrKys7CiAgICB9CiAgICBpZiAoaSArIDEgPCBsZW5ndGgpIHsKICAgICAgLy8gcCBoZXJlIHBvaW50cyB0byBsYXN0IGNvZGUKICAgICAgY29kZS5wdXNoKHEgPSB7IGNoaWxkcmVuOiBbXSwgaW5kZXg6IDAgfSk7CiAgICAgIHAuY2hpbGRyZW5bcC5pbmRleF0gPSBxLmNoaWxkcmVuOwogICAgICBwID0gcTsKICAgIH0KICB9CiAgcmV0dXJuIGNvZGVbMF0uY2hpbGRyZW47Cn0KCmZ1bmN0aW9uIGRlY29kZVNjYW4oZGF0YSwgaW5pdGlhbE9mZnNldCwKICBmcmFtZSwgY29tcG9uZW50cywgcmVzZXRJbnRlcnZhbCwKICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICBzdWNjZXNzaXZlUHJldiwgc3VjY2Vzc2l2ZSkgewogIGNvbnN0IHsgbWN1c1BlckxpbmUsIHByb2dyZXNzaXZlIH0gPSBmcmFtZTsKCiAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpbml0aWFsT2Zmc2V0OwogIGxldCBvZmZzZXQgPSBpbml0aWFsT2Zmc2V0OwogIGxldCBiaXRzRGF0YSA9IDA7CiAgbGV0IGJpdHNDb3VudCA9IDA7CiAgZnVuY3Rpb24gcmVhZEJpdCgpIHsKICAgIGlmIChiaXRzQ291bnQgPiAwKSB7CiAgICAgIGJpdHNDb3VudC0tOwogICAgICByZXR1cm4gKGJpdHNEYXRhID4+IGJpdHNDb3VudCkgJiAxOwogICAgfQogICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgIGlmIChiaXRzRGF0YSA9PT0gMHhGRikgewogICAgICBjb25zdCBuZXh0Qnl0ZSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHVuZXhwZWN0ZWQgbWFya2VyOiAkeygoYml0c0RhdGEgPDwgOCkgfCBuZXh0Qnl0ZSkudG9TdHJpbmcoMTYpfWApOwogICAgICB9CiAgICAgIC8vIHVuc3R1ZmYgMAogICAgfQogICAgYml0c0NvdW50ID0gNzsKICAgIHJldHVybiBiaXRzRGF0YSA+Pj4gNzsKICB9CiAgZnVuY3Rpb24gZGVjb2RlSHVmZm1hbih0cmVlKSB7CiAgICBsZXQgbm9kZSA9IHRyZWU7CiAgICBsZXQgYml0OwogICAgd2hpbGUgKChiaXQgPSByZWFkQml0KCkpICE9PSBudWxsKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uZC1hc3NpZ24KICAgICAgbm9kZSA9IG5vZGVbYml0XTsKICAgICAgaWYgKHR5cGVvZiBub2RlID09PSAnbnVtYmVyJykgewogICAgICAgIHJldHVybiBub2RlOwogICAgICB9CiAgICAgIGlmICh0eXBlb2Ygbm9kZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgaHVmZm1hbiBzZXF1ZW5jZScpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZnVuY3Rpb24gcmVjZWl2ZShpbml0aWFsTGVuZ3RoKSB7CiAgICBsZXQgbGVuZ3RoID0gaW5pdGlhbExlbmd0aDsKICAgIGxldCBuID0gMDsKICAgIHdoaWxlIChsZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGJpdCA9IHJlYWRCaXQoKTsKICAgICAgaWYgKGJpdCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgbiA9IChuIDw8IDEpIHwgYml0OwogICAgICAtLWxlbmd0aDsKICAgIH0KICAgIHJldHVybiBuOwogIH0KICBmdW5jdGlvbiByZWNlaXZlQW5kRXh0ZW5kKGxlbmd0aCkgewogICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgIGlmIChuID49IDEgPDwgKGxlbmd0aCAtIDEpKSB7CiAgICAgIHJldHVybiBuOwogICAgfQogICAgcmV0dXJuIG4gKyAoLTEgPDwgbGVuZ3RoKSArIDE7CiAgfQogIGZ1bmN0aW9uIGRlY29kZUJhc2VsaW5lKGNvbXBvbmVudCwgenopIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiByZWNlaXZlQW5kRXh0ZW5kKHQpOwogICAgY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgIHp6WzBdID0gY29tcG9uZW50LnByZWQ7CiAgICBsZXQgayA9IDE7CiAgICB3aGlsZSAoayA8IDY0KSB7CiAgICAgIGNvbnN0IHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICBjb25zdCBzID0gcnMgJiAxNTsKICAgICAgY29uc3QgciA9IHJzID4+IDQ7CiAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGsgKz0gMTY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgayArPSByOwogICAgICAgIGNvbnN0IHogPSBkY3RaaWdaYWdba107CiAgICAgICAgenpbel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgIGsrKzsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ0ZpcnN0KGNvbXBvbmVudCwgenopIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiAocmVjZWl2ZUFuZEV4dGVuZCh0KSA8PCBzdWNjZXNzaXZlKTsKICAgIGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgICB6elswXSA9IGNvbXBvbmVudC5wcmVkOwogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCB6eikgewogICAgenpbMF0gfD0gcmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmU7CiAgfQogIGxldCBlb2JydW4gPSAwOwogIGZ1bmN0aW9uIGRlY29kZUFDRmlyc3QoY29tcG9uZW50LCB6eikgewogICAgaWYgKGVvYnJ1biA+IDApIHsKICAgICAgZW9icnVuLS07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBrID0gc3BlY3RyYWxTdGFydDsKICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgIHdoaWxlIChrIDw9IGUpIHsKICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICBjb25zdCByID0gcnMgPj4gNDsKICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcikgLSAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGsgKz0gMTY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgayArPSByOwogICAgICAgIGNvbnN0IHogPSBkY3RaaWdaYWdba107CiAgICAgICAgenpbel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpICogKDEgPDwgc3VjY2Vzc2l2ZSk7CiAgICAgICAgaysrOwogICAgICB9CiAgICB9CiAgfQogIGxldCBzdWNjZXNzaXZlQUNTdGF0ZSA9IDA7CiAgbGV0IHN1Y2Nlc3NpdmVBQ05leHRWYWx1ZTsKICBmdW5jdGlvbiBkZWNvZGVBQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCB6eikgewogICAgbGV0IGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgY29uc3QgZSA9IHNwZWN0cmFsRW5kOwogICAgbGV0IHIgPSAwOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2tdOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB6elt6XSA8IDAgPyAtMSA6IDE7CiAgICAgIHN3aXRjaCAoc3VjY2Vzc2l2ZUFDU3RhdGUpIHsKICAgICAgICBjYXNlIDA6IHsgLy8gaW5pdGlhbCBzdGF0ZQogICAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgICBjb25zdCBzID0gcnMgJiAxNTsKICAgICAgICAgIHIgPSBycyA+PiA0OwogICAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgICAgIGVvYnJ1biA9IHJlY2VpdmUocikgKyAoMSA8PCByKTsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgciA9IDE2OwogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHMgIT09IDEpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgQUNuIGVuY29kaW5nJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSByID8gMiA6IDM7CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgIH0KICAgICAgICBjYXNlIDE6IC8vIHNraXBwaW5nIHIgemVybyBpdGVtcwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmICh6elt6XSkgewogICAgICAgICAgICB6elt6XSArPSAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpICogZGlyZWN0aW9uOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgci0tOwogICAgICAgICAgICBpZiAociA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOiAvLyBzZXQgdmFsdWUgZm9yIGEgemVybyBpdGVtCiAgICAgICAgICBpZiAoenpbel0pIHsKICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHp6W3pdID0gc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlIDw8IHN1Y2Nlc3NpdmU7CiAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNDogLy8gZW9iCiAgICAgICAgICBpZiAoenpbel0pIHsKICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChzdWNjZXNzaXZlQUNTdGF0ZSA9PT0gNCkgewogICAgICBlb2JydW4tLTsKICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGdW5jdGlvbiwgbWN1LCByb3csIGNvbCkgewogICAgY29uc3QgbWN1Um93ID0gKG1jdSAvIG1jdXNQZXJMaW5lKSB8IDA7CiAgICBjb25zdCBtY3VDb2wgPSBtY3UgJSBtY3VzUGVyTGluZTsKICAgIGNvbnN0IGJsb2NrUm93ID0gKG1jdVJvdyAqIGNvbXBvbmVudC52KSArIHJvdzsKICAgIGNvbnN0IGJsb2NrQ29sID0gKG1jdUNvbCAqIGNvbXBvbmVudC5oKSArIGNvbDsKICAgIGRlY29kZUZ1bmN0aW9uKGNvbXBvbmVudCwgY29tcG9uZW50LmJsb2Nrc1tibG9ja1Jvd11bYmxvY2tDb2xdKTsKICB9CiAgZnVuY3Rpb24gZGVjb2RlQmxvY2soY29tcG9uZW50LCBkZWNvZGVGdW5jdGlvbiwgbWN1KSB7CiAgICBjb25zdCBibG9ja1JvdyA9IChtY3UgLyBjb21wb25lbnQuYmxvY2tzUGVyTGluZSkgfCAwOwogICAgY29uc3QgYmxvY2tDb2wgPSBtY3UgJSBjb21wb25lbnQuYmxvY2tzUGVyTGluZTsKICAgIGRlY29kZUZ1bmN0aW9uKGNvbXBvbmVudCwgY29tcG9uZW50LmJsb2Nrc1tibG9ja1Jvd11bYmxvY2tDb2xdKTsKICB9CgogIGNvbnN0IGNvbXBvbmVudHNMZW5ndGggPSBjb21wb25lbnRzLmxlbmd0aDsKICBsZXQgY29tcG9uZW50OwogIGxldCBpOwogIGxldCBqOwogIGxldCBrOwogIGxldCBuOwogIGxldCBkZWNvZGVGbjsKICBpZiAocHJvZ3Jlc3NpdmUpIHsKICAgIGlmIChzcGVjdHJhbFN0YXJ0ID09PSAwKSB7CiAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVEQ0ZpcnN0IDogZGVjb2RlRENTdWNjZXNzaXZlOwogICAgfSBlbHNlIHsKICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZUFDRmlyc3QgOiBkZWNvZGVBQ1N1Y2Nlc3NpdmU7CiAgICB9CiAgfSBlbHNlIHsKICAgIGRlY29kZUZuID0gZGVjb2RlQmFzZWxpbmU7CiAgfQoKICBsZXQgbWN1ID0gMDsKICBsZXQgbWFya2VyOwogIGxldCBtY3VFeHBlY3RlZDsKICBpZiAoY29tcG9uZW50c0xlbmd0aCA9PT0gMSkgewogICAgbWN1RXhwZWN0ZWQgPSBjb21wb25lbnRzWzBdLmJsb2Nrc1BlckxpbmUgKiBjb21wb25lbnRzWzBdLmJsb2Nrc1BlckNvbHVtbjsKICB9IGVsc2UgewogICAgbWN1RXhwZWN0ZWQgPSBtY3VzUGVyTGluZSAqIGZyYW1lLm1jdXNQZXJDb2x1bW47CiAgfQoKICBjb25zdCB1c2VkUmVzZXRJbnRlcnZhbCA9IHJlc2V0SW50ZXJ2YWwgfHwgbWN1RXhwZWN0ZWQ7CgogIHdoaWxlIChtY3UgPCBtY3VFeHBlY3RlZCkgewogICAgLy8gcmVzZXQgaW50ZXJ2YWwgc3R1ZmYKICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgY29tcG9uZW50c1tpXS5wcmVkID0gMDsKICAgIH0KICAgIGVvYnJ1biA9IDA7CgogICAgaWYgKGNvbXBvbmVudHNMZW5ndGggPT09IDEpIHsKICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1swXTsKICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZUZuLCBtY3UpOwogICAgICAgIG1jdSsrOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKG4gPSAwOyBuIDwgdXNlZFJlc2V0SW50ZXJ2YWw7IG4rKykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CiAgICAgICAgICBjb25zdCB7IGgsIHYgfSA9IGNvbXBvbmVudDsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2OyBqKyspIHsKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZUZuLCBtY3UsIGosIGspOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG1jdSsrOwoKICAgICAgICAvLyBJZiB3ZSd2ZSByZWFjaGVkIG91ciBleHBlY3RlZCBNQ1Uncywgc3RvcCBkZWNvZGluZwogICAgICAgIGlmIChtY3UgPT09IG1jdUV4cGVjdGVkKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBmaW5kIG1hcmtlcgogICAgYml0c0NvdW50ID0gMDsKICAgIG1hcmtlciA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgaWYgKG1hcmtlciA8IDB4RkYwMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hcmtlciB3YXMgbm90IGZvdW5kJyk7CiAgICB9CgogICAgaWYgKG1hcmtlciA+PSAweEZGRDAgJiYgbWFya2VyIDw9IDB4RkZENykgeyAvLyBSU1R4CiAgICAgIG9mZnNldCArPSAyOwogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gb2Zmc2V0IC0gc3RhcnRPZmZzZXQ7Cn0KCmZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgY29uc3QgbGluZXMgPSBbXTsKICBjb25zdCB7IGJsb2Nrc1BlckxpbmUsIGJsb2Nrc1BlckNvbHVtbiB9ID0gY29tcG9uZW50OwogIGNvbnN0IHNhbXBsZXNQZXJMaW5lID0gYmxvY2tzUGVyTGluZSA8PCAzOwogIGNvbnN0IFIgPSBuZXcgSW50MzJBcnJheSg2NCk7CiAgY29uc3QgciA9IG5ldyBVaW50OEFycmF5KDY0KTsKCiAgLy8gQSBwb3J0IG9mIHBvcHBsZXIncyBJRENUIG1ldGhvZCB3aGljaCBpbiB0dXJuIGlzIHRha2VuIGZyb206CiAgLy8gICBDaHJpc3RvcGggTG9lZmZsZXIsIEFkcmlhYW4gTGlndGVuYmVyZywgR2VvcmdlIFMuIE1vc2NoeXR6LAogIC8vICAgIlByYWN0aWNhbCBGYXN0IDEtRCBEQ1QgQWxnb3JpdGhtcyB3aXRoIDExIE11bHRpcGxpY2F0aW9ucyIsCiAgLy8gICBJRUVFIEludGwuIENvbmYuIG9uIEFjb3VzdGljcywgU3BlZWNoICYgU2lnbmFsIFByb2Nlc3NpbmcsIDE5ODksCiAgLy8gICA5ODgtOTkxLgogIGZ1bmN0aW9uIHF1YW50aXplQW5kSW52ZXJzZSh6eiwgZGF0YU91dCwgZGF0YUluKSB7CiAgICBjb25zdCBxdCA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25UYWJsZTsKICAgIGxldCB2MDsKICAgIGxldCB2MTsKICAgIGxldCB2MjsKICAgIGxldCB2MzsKICAgIGxldCB2NDsKICAgIGxldCB2NTsKICAgIGxldCB2NjsKICAgIGxldCB2NzsKICAgIGxldCB0OwogICAgY29uc3QgcCA9IGRhdGFJbjsKICAgIGxldCBpOwoKICAgIC8vIGRlcXVhbnQKICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKSB7CiAgICAgIHBbaV0gPSB6eltpXSAqIHF0W2ldOwogICAgfQoKICAgIC8vIGludmVyc2UgRENUIG9uIHJvd3MKICAgIGZvciAoaSA9IDA7IGkgPCA4OyArK2kpIHsKICAgICAgY29uc3Qgcm93ID0gOCAqIGk7CgogICAgICAvLyBjaGVjayBmb3IgYWxsLXplcm8gQUMgY29lZmZpY2llbnRzCiAgICAgIGlmIChwWzEgKyByb3ddID09PSAwICYmIHBbMiArIHJvd10gPT09IDAgJiYgcFszICsgcm93XSA9PT0gMAogICAgICAgICYmIHBbNCArIHJvd10gPT09IDAgJiYgcFs1ICsgcm93XSA9PT0gMCAmJiBwWzYgKyByb3ddID09PSAwCiAgICAgICAgJiYgcFs3ICsgcm93XSA9PT0gMCkgewogICAgICAgIHQgPSAoKGRjdFNxcnQyICogcFswICsgcm93XSkgKyA1MTIpID4+IDEwOwogICAgICAgIHBbMCArIHJvd10gPSB0OwogICAgICAgIHBbMSArIHJvd10gPSB0OwogICAgICAgIHBbMiArIHJvd10gPSB0OwogICAgICAgIHBbMyArIHJvd10gPSB0OwogICAgICAgIHBbNCArIHJvd10gPSB0OwogICAgICAgIHBbNSArIHJvd10gPSB0OwogICAgICAgIHBbNiArIHJvd10gPSB0OwogICAgICAgIHBbNyArIHJvd10gPSB0OwogICAgICAgIGNvbnRpbnVlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnRpbnVlCiAgICAgIH0KCiAgICAgIC8vIHN0YWdlIDQKICAgICAgdjAgPSAoKGRjdFNxcnQyICogcFswICsgcm93XSkgKyAxMjgpID4+IDg7CiAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbNCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICB2MiA9IHBbMiArIHJvd107CiAgICAgIHYzID0gcFs2ICsgcm93XTsKICAgICAgdjQgPSAoKGRjdFNxcnQxZDIgKiAocFsxICsgcm93XSAtIHBbNyArIHJvd10pKSArIDEyOCkgPj4gODsKICAgICAgdjcgPSAoKGRjdFNxcnQxZDIgKiAocFsxICsgcm93XSArIHBbNyArIHJvd10pKSArIDEyOCkgPj4gODsKICAgICAgdjUgPSBwWzMgKyByb3ddIDw8IDQ7CiAgICAgIHY2ID0gcFs1ICsgcm93XSA8PCA0OwoKICAgICAgLy8gc3RhZ2UgMwogICAgICB0ID0gKHYwIC0gdjEgKyAxKSA+PiAxOwogICAgICB2MCA9ICh2MCArIHYxICsgMSkgPj4gMTsKICAgICAgdjEgPSB0OwogICAgICB0ID0gKCh2MiAqIGRjdFNpbjYpICsgKHYzICogZGN0Q29zNikgKyAxMjgpID4+IDg7CiAgICAgIHYyID0gKCh2MiAqIGRjdENvczYpIC0gKHYzICogZGN0U2luNikgKyAxMjgpID4+IDg7CiAgICAgIHYzID0gdDsKICAgICAgdCA9ICh2NCAtIHY2ICsgMSkgPj4gMTsKICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgIHY2ID0gdDsKICAgICAgdCA9ICh2NyArIHY1ICsgMSkgPj4gMTsKICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgIHY3ID0gdDsKCiAgICAgIC8vIHN0YWdlIDIKICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgdjAgPSAodjAgKyB2MyArIDEpID4+IDE7CiAgICAgIHYzID0gdDsKICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgdjEgPSAodjEgKyB2MiArIDEpID4+IDE7CiAgICAgIHYyID0gdDsKICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgIHY0ID0gKCh2NCAqIGRjdENvczMpIC0gKHY3ICogZGN0U2luMykgKyAyMDQ4KSA+PiAxMjsKICAgICAgdjcgPSB0OwogICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgdjUgPSAoKHY1ICogZGN0Q29zMSkgLSAodjYgKiBkY3RTaW4xKSArIDIwNDgpID4+IDEyOwogICAgICB2NiA9IHQ7CgogICAgICAvLyBzdGFnZSAxCiAgICAgIHBbMCArIHJvd10gPSB2MCArIHY3OwogICAgICBwWzcgKyByb3ddID0gdjAgLSB2NzsKICAgICAgcFsxICsgcm93XSA9IHYxICsgdjY7CiAgICAgIHBbNiArIHJvd10gPSB2MSAtIHY2OwogICAgICBwWzIgKyByb3ddID0gdjIgKyB2NTsKICAgICAgcFs1ICsgcm93XSA9IHYyIC0gdjU7CiAgICAgIHBbMyArIHJvd10gPSB2MyArIHY0OwogICAgICBwWzQgKyByb3ddID0gdjMgLSB2NDsKICAgIH0KCiAgICAvLyBpbnZlcnNlIERDVCBvbiBjb2x1bW5zCiAgICBmb3IgKGkgPSAwOyBpIDwgODsgKytpKSB7CiAgICAgIGNvbnN0IGNvbCA9IGk7CgogICAgICAvLyBjaGVjayBmb3IgYWxsLXplcm8gQUMgY29lZmZpY2llbnRzCiAgICAgIGlmIChwWygxICogOCkgKyBjb2xdID09PSAwICYmIHBbKDIgKiA4KSArIGNvbF0gPT09IDAgJiYgcFsoMyAqIDgpICsgY29sXSA9PT0gMAogICAgICAgICYmIHBbKDQgKiA4KSArIGNvbF0gPT09IDAgJiYgcFsoNSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWyg2ICogOCkgKyBjb2xdID09PSAwCiAgICAgICAgJiYgcFsoNyAqIDgpICsgY29sXSA9PT0gMCkgewogICAgICAgIHQgPSAoKGRjdFNxcnQyICogZGF0YUluW2kgKyAwXSkgKyA4MTkyKSA+PiAxNDsKICAgICAgICBwWygwICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWygxICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWygyICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWygzICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWyg0ICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWyg1ICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWyg2ICogOCkgKyBjb2xdID0gdDsKICAgICAgICBwWyg3ICogOCkgKyBjb2xdID0gdDsKICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICB9CgogICAgICAvLyBzdGFnZSA0CiAgICAgIHYwID0gKChkY3RTcXJ0MiAqIHBbKDAgKiA4KSArIGNvbF0pICsgMjA0OCkgPj4gMTI7CiAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbKDQgKiA4KSArIGNvbF0pICsgMjA0OCkgPj4gMTI7CiAgICAgIHYyID0gcFsoMiAqIDgpICsgY29sXTsKICAgICAgdjMgPSBwWyg2ICogOCkgKyBjb2xdOwogICAgICB2NCA9ICgoZGN0U3FydDFkMiAqIChwWygxICogOCkgKyBjb2xdIC0gcFsoNyAqIDgpICsgY29sXSkpICsgMjA0OCkgPj4gMTI7CiAgICAgIHY3ID0gKChkY3RTcXJ0MWQyICogKHBbKDEgKiA4KSArIGNvbF0gKyBwWyg3ICogOCkgKyBjb2xdKSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgdjUgPSBwWygzICogOCkgKyBjb2xdOwogICAgICB2NiA9IHBbKDUgKiA4KSArIGNvbF07CgogICAgICAvLyBzdGFnZSAzCiAgICAgIHQgPSAodjAgLSB2MSArIDEpID4+IDE7CiAgICAgIHYwID0gKHYwICsgdjEgKyAxKSA+PiAxOwogICAgICB2MSA9IHQ7CiAgICAgIHQgPSAoKHYyICogZGN0U2luNikgKyAodjMgKiBkY3RDb3M2KSArIDIwNDgpID4+IDEyOwogICAgICB2MiA9ICgodjIgKiBkY3RDb3M2KSAtICh2MyAqIGRjdFNpbjYpICsgMjA0OCkgPj4gMTI7CiAgICAgIHYzID0gdDsKICAgICAgdCA9ICh2NCAtIHY2ICsgMSkgPj4gMTsKICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgIHY2ID0gdDsKICAgICAgdCA9ICh2NyArIHY1ICsgMSkgPj4gMTsKICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgIHY3ID0gdDsKCiAgICAgIC8vIHN0YWdlIDIKICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgdjAgPSAodjAgKyB2MyArIDEpID4+IDE7CiAgICAgIHYzID0gdDsKICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgdjEgPSAodjEgKyB2MiArIDEpID4+IDE7CiAgICAgIHYyID0gdDsKICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgIHY0ID0gKCh2NCAqIGRjdENvczMpIC0gKHY3ICogZGN0U2luMykgKyAyMDQ4KSA+PiAxMjsKICAgICAgdjcgPSB0OwogICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgdjUgPSAoKHY1ICogZGN0Q29zMSkgLSAodjYgKiBkY3RTaW4xKSArIDIwNDgpID4+IDEyOwogICAgICB2NiA9IHQ7CgogICAgICAvLyBzdGFnZSAxCiAgICAgIHBbKDAgKiA4KSArIGNvbF0gPSB2MCArIHY3OwogICAgICBwWyg3ICogOCkgKyBjb2xdID0gdjAgLSB2NzsKICAgICAgcFsoMSAqIDgpICsgY29sXSA9IHYxICsgdjY7CiAgICAgIHBbKDYgKiA4KSArIGNvbF0gPSB2MSAtIHY2OwogICAgICBwWygyICogOCkgKyBjb2xdID0gdjIgKyB2NTsKICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHYyIC0gdjU7CiAgICAgIHBbKDMgKiA4KSArIGNvbF0gPSB2MyArIHY0OwogICAgICBwWyg0ICogOCkgKyBjb2xdID0gdjMgLSB2NDsKICAgIH0KCiAgICAvLyBjb252ZXJ0IHRvIDgtYml0IGludGVnZXJzCiAgICBmb3IgKGkgPSAwOyBpIDwgNjQ7ICsraSkgewogICAgICBjb25zdCBzYW1wbGUgPSAxMjggKyAoKHBbaV0gKyA4KSA+PiA0KTsKICAgICAgaWYgKHNhbXBsZSA8IDApIHsKICAgICAgICBkYXRhT3V0W2ldID0gMDsKICAgICAgfSBlbHNlIGlmIChzYW1wbGUgPiAwWEZGKSB7CiAgICAgICAgZGF0YU91dFtpXSA9IDB4RkY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YU91dFtpXSA9IHNhbXBsZTsKICAgICAgfQogICAgfQogIH0KCiAgZm9yIChsZXQgYmxvY2tSb3cgPSAwOyBibG9ja1JvdyA8IGJsb2Nrc1BlckNvbHVtbjsgYmxvY2tSb3crKykgewogICAgY29uc3Qgc2NhbkxpbmUgPSBibG9ja1JvdyA8PCAzOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgbGluZXMucHVzaChuZXcgVWludDhBcnJheShzYW1wbGVzUGVyTGluZSkpOwogICAgfQogICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgcXVhbnRpemVBbmRJbnZlcnNlKGNvbXBvbmVudC5ibG9ja3NbYmxvY2tSb3ddW2Jsb2NrQ29sXSwgciwgUik7CgogICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgY29uc3Qgc2FtcGxlID0gYmxvY2tDb2wgPDwgMzsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA4OyBqKyspIHsKICAgICAgICBjb25zdCBsaW5lID0gbGluZXNbc2NhbkxpbmUgKyBqXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgewogICAgICAgICAgbGluZVtzYW1wbGUgKyBpXSA9IHJbb2Zmc2V0KytdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICByZXR1cm4gbGluZXM7Cn0KCmNsYXNzIEpwZWdTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5qZmlmID0gbnVsbDsKICAgIHRoaXMuYWRvYmUgPSBudWxsOwoKICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzID0gW107CiAgICB0aGlzLmh1ZmZtYW5UYWJsZXNBQyA9IFtdOwogICAgdGhpcy5odWZmbWFuVGFibGVzREMgPSBbXTsKICAgIHRoaXMucmVzZXRGcmFtZXMoKTsKICB9CgogIHJlc2V0RnJhbWVzKCkgewogICAgdGhpcy5mcmFtZXMgPSBbXTsKICB9CgogIHBhcnNlKGRhdGEpIHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgLy8gY29uc3QgeyBsZW5ndGggfSA9IGRhdGE7CiAgICBmdW5jdGlvbiByZWFkVWludDE2KCkgewogICAgICBjb25zdCB2YWx1ZSA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICBvZmZzZXQgKz0gMjsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgZnVuY3Rpb24gcmVhZERhdGFCbG9jaygpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gcmVhZFVpbnQxNigpOwogICAgICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggLSAyKTsKICAgICAgb2Zmc2V0ICs9IGFycmF5Lmxlbmd0aDsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgZnVuY3Rpb24gcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpIHsKICAgICAgbGV0IG1heEggPSAwOwogICAgICBsZXQgbWF4ViA9IDA7CiAgICAgIGxldCBjb21wb25lbnQ7CiAgICAgIGxldCBjb21wb25lbnRJZDsKICAgICAgZm9yIChjb21wb25lbnRJZCBpbiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgaWYgKGZyYW1lLmNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoY29tcG9uZW50SWQpKSB7CiAgICAgICAgICBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXTsKICAgICAgICAgIGlmIChtYXhIIDwgY29tcG9uZW50LmgpIHsKICAgICAgICAgICAgbWF4SCA9IGNvbXBvbmVudC5oOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1heFYgPCBjb21wb25lbnQudikgewogICAgICAgICAgICBtYXhWID0gY29tcG9uZW50LnY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IG1jdXNQZXJMaW5lID0gTWF0aC5jZWlsKGZyYW1lLnNhbXBsZXNQZXJMaW5lIC8gOCAvIG1heEgpOwogICAgICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBtYXhWKTsKICAgICAgZm9yIChjb21wb25lbnRJZCBpbiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgaWYgKGZyYW1lLmNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoY29tcG9uZW50SWQpKSB7CiAgICAgICAgICBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXTsKICAgICAgICAgIGNvbnN0IGJsb2Nrc1BlckxpbmUgPSBNYXRoLmNlaWwoTWF0aC5jZWlsKGZyYW1lLnNhbXBsZXNQZXJMaW5lIC8gOCkgKiBjb21wb25lbnQuaCAvIG1heEgpOwogICAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uID0gTWF0aC5jZWlsKE1hdGguY2VpbChmcmFtZS5zY2FuTGluZXMgLyA4KSAqIGNvbXBvbmVudC52IC8gbWF4Vik7CiAgICAgICAgICBjb25zdCBibG9ja3NQZXJMaW5lRm9yTWN1ID0gbWN1c1BlckxpbmUgKiBjb21wb25lbnQuaDsKICAgICAgICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbkZvck1jdSA9IG1jdXNQZXJDb2x1bW4gKiBjb21wb25lbnQudjsKICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IFtdOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3NQZXJDb2x1bW5Gb3JNY3U7IGkrKykgewogICAgICAgICAgICBjb25zdCByb3cgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBibG9ja3NQZXJMaW5lRm9yTWN1OyBqKyspIHsKICAgICAgICAgICAgICByb3cucHVzaChuZXcgSW50MzJBcnJheSg2NCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJsb2Nrcy5wdXNoKHJvdyk7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wb25lbnQuYmxvY2tzUGVyTGluZSA9IGJsb2Nrc1BlckxpbmU7CiAgICAgICAgICBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uID0gYmxvY2tzUGVyQ29sdW1uOwogICAgICAgICAgY29tcG9uZW50LmJsb2NrcyA9IGJsb2NrczsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgIGZyYW1lLm1heFYgPSBtYXhWOwogICAgICBmcmFtZS5tY3VzUGVyTGluZSA9IG1jdXNQZXJMaW5lOwogICAgICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKICAgIH0KCiAgICBsZXQgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoKTsKICAgIGlmIChmaWxlTWFya2VyICE9PSAweEZGRDgpIHsgLy8gU09JIChTdGFydCBvZiBJbWFnZSkKICAgICAgdGhyb3cgbmV3IEVycm9yKCdTT0kgbm90IGZvdW5kJyk7CiAgICB9CgogICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoKTsKICAgIHdoaWxlIChmaWxlTWFya2VyICE9PSAweEZGRDkpIHsgLy8gRU9JIChFbmQgb2YgaW1hZ2UpCiAgICAgIHN3aXRjaCAoZmlsZU1hcmtlcikgewogICAgICAgIGNhc2UgMHhGRjAwOiBicmVhazsKICAgICAgICBjYXNlIDB4RkZFMDogLy8gQVBQMCAoQXBwbGljYXRpb24gU3BlY2lmaWMpCiAgICAgICAgY2FzZSAweEZGRTE6IC8vIEFQUDEKICAgICAgICBjYXNlIDB4RkZFMjogLy8gQVBQMgogICAgICAgIGNhc2UgMHhGRkUzOiAvLyBBUFAzCiAgICAgICAgY2FzZSAweEZGRTQ6IC8vIEFQUDQKICAgICAgICBjYXNlIDB4RkZFNTogLy8gQVBQNQogICAgICAgIGNhc2UgMHhGRkU2OiAvLyBBUFA2CiAgICAgICAgY2FzZSAweEZGRTc6IC8vIEFQUDcKICAgICAgICBjYXNlIDB4RkZFODogLy8gQVBQOAogICAgICAgIGNhc2UgMHhGRkU5OiAvLyBBUFA5CiAgICAgICAgY2FzZSAweEZGRUE6IC8vIEFQUDEwCiAgICAgICAgY2FzZSAweEZGRUI6IC8vIEFQUDExCiAgICAgICAgY2FzZSAweEZGRUM6IC8vIEFQUDEyCiAgICAgICAgY2FzZSAweEZGRUQ6IC8vIEFQUDEzCiAgICAgICAgY2FzZSAweEZGRUU6IC8vIEFQUDE0CiAgICAgICAgY2FzZSAweEZGRUY6IC8vIEFQUDE1CiAgICAgICAgY2FzZSAweEZGRkU6IHsgLy8gQ09NIChDb21tZW50KQogICAgICAgICAgY29uc3QgYXBwRGF0YSA9IHJlYWREYXRhQmxvY2soKTsKCiAgICAgICAgICBpZiAoZmlsZU1hcmtlciA9PT0gMHhGRkUwKSB7CiAgICAgICAgICAgIGlmIChhcHBEYXRhWzBdID09PSAweDRBICYmIGFwcERhdGFbMV0gPT09IDB4NDYgJiYgYXBwRGF0YVsyXSA9PT0gMHg0OQogICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgeyAvLyAnSkZJRlx4MDAnCiAgICAgICAgICAgICAgdGhpcy5qZmlmID0gewogICAgICAgICAgICAgICAgdmVyc2lvbjogeyBtYWpvcjogYXBwRGF0YVs1XSwgbWlub3I6IGFwcERhdGFbNl0gfSwKICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgIHhEZW5zaXR5OiAoYXBwRGF0YVs4XSA8PCA4KSB8IGFwcERhdGFbOV0sCiAgICAgICAgICAgICAgICB5RGVuc2l0eTogKGFwcERhdGFbMTBdIDw8IDgpIHwgYXBwRGF0YVsxMV0sCiAgICAgICAgICAgICAgICB0aHVtYldpZHRoOiBhcHBEYXRhWzEyXSwKICAgICAgICAgICAgICAgIHRodW1iSGVpZ2h0OiBhcHBEYXRhWzEzXSwKICAgICAgICAgICAgICAgIHRodW1iRGF0YTogYXBwRGF0YS5zdWJhcnJheSgxNCwgMTQgKyAoMyAqIGFwcERhdGFbMTJdICogYXBwRGF0YVsxM10pKSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBUT0RPIEFQUDEgLSBFeGlmCiAgICAgICAgICBpZiAoZmlsZU1hcmtlciA9PT0gMHhGRkVFKSB7CiAgICAgICAgICAgIGlmIChhcHBEYXRhWzBdID09PSAweDQxICYmIGFwcERhdGFbMV0gPT09IDB4NjQgJiYgYXBwRGF0YVsyXSA9PT0gMHg2RgogICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSAmJiBhcHBEYXRhWzVdID09PSAwKSB7IC8vICdBZG9iZVx4MDAnCiAgICAgICAgICAgICAgdGhpcy5hZG9iZSA9IHsKICAgICAgICAgICAgICAgIHZlcnNpb246IGFwcERhdGFbNl0sCiAgICAgICAgICAgICAgICBmbGFnczA6IChhcHBEYXRhWzddIDw8IDgpIHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgIGZsYWdzMTogKGFwcERhdGFbOV0gPDwgOCkgfCBhcHBEYXRhWzEwXSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvZGU6IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgY2FzZSAweEZGREI6IHsgLy8gRFFUIChEZWZpbmUgUXVhbnRpemF0aW9uIFRhYmxlcykKICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlc0xlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlc0VuZCA9IHF1YW50aXphdGlvblRhYmxlc0xlbmd0aCArIG9mZnNldCAtIDI7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgcXVhbnRpemF0aW9uVGFibGVzRW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCB0YWJsZURhdGEgPSBuZXcgSW50MzJBcnJheSg2NCk7CiAgICAgICAgICAgIGlmICgocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQpID09PSAwKSB7IC8vIDggYml0IHZhbHVlcwogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQpID09PSAxKSB7IC8vIDE2IGJpdAogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEUVQ6IGludmFsaWQgdGFibGUgc3BlYycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzW3F1YW50aXphdGlvblRhYmxlU3BlYyAmIDE1XSA9IHRhYmxlRGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgY2FzZSAweEZGQzA6IC8vIFNPRjAgKFN0YXJ0IG9mIEZyYW1lLCBCYXNlbGluZSBEQ1QpCiAgICAgICAgY2FzZSAweEZGQzE6IC8vIFNPRjEgKFN0YXJ0IG9mIEZyYW1lLCBFeHRlbmRlZCBEQ1QpCiAgICAgICAgY2FzZSAweEZGQzI6IHsgLy8gU09GMiAoU3RhcnQgb2YgRnJhbWUsIFByb2dyZXNzaXZlIERDVCkKICAgICAgICAgIHJlYWRVaW50MTYoKTsgLy8gc2tpcCBkYXRhIGxlbmd0aAogICAgICAgICAgY29uc3QgZnJhbWUgPSB7CiAgICAgICAgICAgIGV4dGVuZGVkOiAoZmlsZU1hcmtlciA9PT0gMHhGRkMxKSwKICAgICAgICAgICAgcHJvZ3Jlc3NpdmU6IChmaWxlTWFya2VyID09PSAweEZGQzIpLAogICAgICAgICAgICBwcmVjaXNpb246IGRhdGFbb2Zmc2V0KytdLAogICAgICAgICAgICBzY2FuTGluZXM6IHJlYWRVaW50MTYoKSwKICAgICAgICAgICAgc2FtcGxlc1BlckxpbmU6IHJlYWRVaW50MTYoKSwKICAgICAgICAgICAgY29tcG9uZW50czoge30sCiAgICAgICAgICAgIGNvbXBvbmVudHNPcmRlcjogW10sCiAgICAgICAgICB9OwoKICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgbGV0IGNvbXBvbmVudElkOwogICAgICAgICAgLy8gbGV0IG1heEggPSAwOwogICAgICAgICAgLy8gbGV0IG1heFYgPSAwOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb21wb25lbnRJZCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgICAgICAgY29uc3QgaCA9IGRhdGFbb2Zmc2V0ICsgMV0gPj4gNDsKICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgY29uc3QgcUlkID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgZnJhbWUuY29tcG9uZW50c09yZGVyLnB1c2goY29tcG9uZW50SWQpOwogICAgICAgICAgICBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXSA9IHsKICAgICAgICAgICAgICBoLAogICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgcXVhbnRpemF0aW9uSWR4OiBxSWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG9mZnNldCArPSAzOwogICAgICAgICAgfQogICAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpOwogICAgICAgICAgdGhpcy5mcmFtZXMucHVzaChmcmFtZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGNhc2UgMHhGRkM0OiB7IC8vIERIVCAoRGVmaW5lIEh1ZmZtYW4gVGFibGVzKQogICAgICAgICAgY29uc3QgaHVmZm1hbkxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgaHVmZm1hblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgbGV0IGNvZGVMZW5ndGhTdW0gPSAwOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyBqKyssIG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgY29kZUxlbmd0aHNbal0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgICAgY29kZUxlbmd0aFN1bSArPSBjb2RlTGVuZ3Roc1tqXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBodWZmbWFuVmFsdWVzID0gbmV3IFVpbnQ4QXJyYXkoY29kZUxlbmd0aFN1bSk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29kZUxlbmd0aFN1bTsgaisrLCBvZmZzZXQrKykgewogICAgICAgICAgICAgIGh1ZmZtYW5WYWx1ZXNbal0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAxNyArIGNvZGVMZW5ndGhTdW07CgogICAgICAgICAgICBpZiAoKGh1ZmZtYW5UYWJsZVNwZWMgPj4gNCkgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1todWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoCiAgICAgICAgICAgICAgICBjb2RlTGVuZ3RocywgaHVmZm1hblZhbHVlcywKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0FDW2h1ZmZtYW5UYWJsZVNwZWMgJiAxNV0gPSBidWlsZEh1ZmZtYW5UYWJsZSgKICAgICAgICAgICAgICAgIGNvZGVMZW5ndGhzLCBodWZmbWFuVmFsdWVzLAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgY2FzZSAweEZGREQ6IC8vIERSSSAoRGVmaW5lIFJlc3RhcnQgSW50ZXJ2YWwpCiAgICAgICAgICByZWFkVWludDE2KCk7IC8vIHNraXAgZGF0YSBsZW5ndGgKICAgICAgICAgIHRoaXMucmVzZXRJbnRlcnZhbCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDB4RkZEQTogeyAvLyBTT1MgKFN0YXJ0IG9mIFNjYW4pCiAgICAgICAgICByZWFkVWludDE2KCk7IC8vIHNraXAgbGVuZ3RoCiAgICAgICAgICBjb25zdCBzZWxlY3RvcnNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLmZyYW1lc1swXTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0b3JzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2RhdGFbb2Zmc2V0KytdXTsKICAgICAgICAgICAgY29uc3QgdGFibGVTcGVjID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgIGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyA9IHRoaXMuaHVmZm1hblRhYmxlc0RDW3RhYmxlU3BlYyA+PiA0XTsKICAgICAgICAgICAgY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDID0gdGhpcy5odWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGNvbnN0IHNwZWN0cmFsRW5kID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICBjb25zdCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsCiAgICAgICAgICAgIGZyYW1lLCBjb21wb25lbnRzLCB0aGlzLnJlc2V0SW50ZXJ2YWwsCiAgICAgICAgICAgIHNwZWN0cmFsU3RhcnQsIHNwZWN0cmFsRW5kLAogICAgICAgICAgICBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA+PiA0LCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiAmIDE1KTsKICAgICAgICAgIG9mZnNldCArPSBwcm9jZXNzZWQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGNhc2UgMHhGRkZGOiAvLyBGaWxsIGJ5dGVzCiAgICAgICAgICBpZiAoZGF0YVtvZmZzZXRdICE9PSAweEZGKSB7IC8vIEF2b2lkIHNraXBwaW5nIGEgdmFsaWQgbWFya2VyLgogICAgICAgICAgICBvZmZzZXQtLTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0IC0gM10gPT09IDB4RkYKICAgICAgICAgICAgJiYgZGF0YVtvZmZzZXQgLSAyXSA+PSAweEMwICYmIGRhdGFbb2Zmc2V0IC0gMl0gPD0gMHhGRSkgewogICAgICAgICAgICAvLyBjb3VsZCBiZSBpbmNvcnJlY3QgZW5jb2RpbmcgLS0gbGFzdCAweEZGIGJ5dGUgb2YgdGhlIHByZXZpb3VzCiAgICAgICAgICAgIC8vIGJsb2NrIHdhcyBlYXRlbiBieSB0aGUgZW5jb2RlcgogICAgICAgICAgICBvZmZzZXQgLT0gMzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHVua25vd24gSlBFRyBtYXJrZXIgJHtmaWxlTWFya2VyLnRvU3RyaW5nKDE2KX1gKTsKICAgICAgfQogICAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNigpOwogICAgfQogIH0KCiAgZ2V0UmVzdWx0KCkgewogICAgY29uc3QgeyBmcmFtZXMgfSA9IHRoaXM7CiAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbm8gZnJhbWVzIHdlcmUgZGVjb2RlZCcpOwogICAgfSBlbHNlIGlmICh0aGlzLmZyYW1lcy5sZW5ndGggPiAxKSB7CiAgICAgIGNvbnNvbGUud2FybignbW9yZSB0aGFuIG9uZSBmcmFtZSBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgICB9CgogICAgLy8gc2V0IGVhY2ggZnJhbWUncyBjb21wb25lbnRzIHF1YW50aXphdGlvbiB0YWJsZQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZyYW1lcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBjcCA9IHRoaXMuZnJhbWVzW2ldLmNvbXBvbmVudHM7CiAgICAgIGZvciAoY29uc3QgaiBvZiBPYmplY3Qua2V5cyhjcCkpIHsKICAgICAgICBjcFtqXS5xdWFudGl6YXRpb25UYWJsZSA9IHRoaXMucXVhbnRpemF0aW9uVGFibGVzW2NwW2pdLnF1YW50aXphdGlvbklkeF07CiAgICAgICAgZGVsZXRlIGNwW2pdLnF1YW50aXphdGlvbklkeDsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IGZyYW1lID0gZnJhbWVzWzBdOwogICAgY29uc3QgeyBjb21wb25lbnRzLCBjb21wb25lbnRzT3JkZXIgfSA9IGZyYW1lOwogICAgY29uc3Qgb3V0Q29tcG9uZW50cyA9IFtdOwogICAgY29uc3Qgd2lkdGggPSBmcmFtZS5zYW1wbGVzUGVyTGluZTsKICAgIGNvbnN0IGhlaWdodCA9IGZyYW1lLnNjYW5MaW5lczsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBvbmVudHNPcmRlci5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2NvbXBvbmVudHNPcmRlcltpXV07CiAgICAgIG91dENvbXBvbmVudHMucHVzaCh7CiAgICAgICAgbGluZXM6IGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSwKICAgICAgICBzY2FsZVg6IGNvbXBvbmVudC5oIC8gZnJhbWUubWF4SCwKICAgICAgICBzY2FsZVk6IGNvbXBvbmVudC52IC8gZnJhbWUubWF4ViwKICAgICAgfSk7CiAgICB9CgogICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGggKiBoZWlnaHQgKiBvdXRDb21wb25lbnRzLmxlbmd0aCk7CiAgICBsZXQgb2kgPSAwOwogICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkgewogICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dENvbXBvbmVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IG91dENvbXBvbmVudHNbaV07CiAgICAgICAgICBvdXRbb2ldID0gY29tcG9uZW50LmxpbmVzWzAgfCB5ICogY29tcG9uZW50LnNjYWxlWV1bMCB8IHggKiBjb21wb25lbnQuc2NhbGVYXTsKICAgICAgICAgICsrb2k7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gb3V0OwogIH0KfQoKY2xhc3MgSnBlZ0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgY29uc3RydWN0b3IoZmlsZURpcmVjdG9yeSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMucmVhZGVyID0gbmV3IEpwZWdTdHJlYW1SZWFkZXIoKTsKICAgIGlmIChmaWxlRGlyZWN0b3J5LkpQRUdUYWJsZXMpIHsKICAgICAgdGhpcy5yZWFkZXIucGFyc2UoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKTsKICAgIH0KICB9CgogIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgdGhpcy5yZWFkZXIucmVzZXRGcmFtZXMoKTsKICAgIHRoaXMucmVhZGVyLnBhcnNlKG5ldyBVaW50OEFycmF5KGJ1ZmZlcikpOwogICAgcmV0dXJuIHRoaXMucmVhZGVyLmdldFJlc3VsdCgpLmJ1ZmZlcjsKICB9Cn0KCnZhciBqcGVnID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogIF9fcHJvdG9fXzogbnVsbCwKICAnZGVmYXVsdCc6IEpwZWdEZWNvZGVyCn0pOwoKLyohIHBha28gMi4wLjQgaHR0cHM6Ly9naXRodWIuY29tL25vZGVjYS9wYWtvIEBsaWNlbnNlIChNSVQgQU5EIFpsaWIpICovCi8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgovLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgovLwovLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAovLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KLy8KLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCi8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgovLwovLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAovLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCi8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCi8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCi8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgovKiBlc2xpbnQtZGlzYWJsZSBzcGFjZS11bmFyeS1vcHMgKi8KCi8qIFB1YmxpYyBjb25zdGFudHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKLy9jb25zdCBaX0ZJTFRFUkVEICAgICAgICAgID0gMTsKLy9jb25zdCBaX0hVRkZNQU5fT05MWSAgICAgID0gMjsKLy9jb25zdCBaX1JMRSAgICAgICAgICAgICAgID0gMzsKY29uc3QgWl9GSVhFRCQxICAgICAgICAgICAgICAgPSA0OwovL2NvbnN0IFpfREVGQVVMVF9TVFJBVEVHWSAgPSAwOwoKLyogUG9zc2libGUgdmFsdWVzIG9mIHRoZSBkYXRhX3R5cGUgZmllbGQgKHRob3VnaCBzZWUgaW5mbGF0ZSgpKSAqLwpjb25zdCBaX0JJTkFSWSAgICAgICAgICAgICAgPSAwOwpjb25zdCBaX1RFWFQgICAgICAgICAgICAgICAgPSAxOwovL2NvbnN0IFpfQVNDSUkgICAgICAgICAgICAgPSAxOyAvLyA9IFpfVEVYVApjb25zdCBaX1VOS05PV04kMSAgICAgICAgICAgICA9IDI7CgovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCmZ1bmN0aW9uIHplcm8kMShidWYpIHsgbGV0IGxlbiA9IGJ1Zi5sZW5ndGg7IHdoaWxlICgtLWxlbiA+PSAwKSB7IGJ1ZltsZW5dID0gMDsgfSB9CgovLyBGcm9tIHp1dGlsLmgKCmNvbnN0IFNUT1JFRF9CTE9DSyA9IDA7CmNvbnN0IFNUQVRJQ19UUkVFUyA9IDE7CmNvbnN0IERZTl9UUkVFUyAgICA9IDI7Ci8qIFRoZSB0aHJlZSBraW5kcyBvZiBibG9jayB0eXBlICovCgpjb25zdCBNSU5fTUFUQ0gkMSAgICA9IDM7CmNvbnN0IE1BWF9NQVRDSCQxICAgID0gMjU4OwovKiBUaGUgbWluaW11bSBhbmQgbWF4aW11bSBtYXRjaCBsZW5ndGhzICovCgovLyBGcm9tIGRlZmxhdGUuaAovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogSW50ZXJuYWwgY29tcHJlc3Npb24gc3RhdGUuCiAqLwoKY29uc3QgTEVOR1RIX0NPREVTJDEgID0gMjk7Ci8qIG51bWJlciBvZiBsZW5ndGggY29kZXMsIG5vdCBjb3VudGluZyB0aGUgc3BlY2lhbCBFTkRfQkxPQ0sgY29kZSAqLwoKY29uc3QgTElURVJBTFMkMSAgICAgID0gMjU2OwovKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KCmNvbnN0IExfQ09ERVMkMSAgICAgICA9IExJVEVSQUxTJDEgKyAxICsgTEVOR1RIX0NPREVTJDE7Ci8qIG51bWJlciBvZiBMaXRlcmFsIG9yIExlbmd0aCBjb2RlcywgaW5jbHVkaW5nIHRoZSBFTkRfQkxPQ0sgY29kZSAqLwoKY29uc3QgRF9DT0RFUyQxICAgICAgID0gMzA7Ci8qIG51bWJlciBvZiBkaXN0YW5jZSBjb2RlcyAqLwoKY29uc3QgQkxfQ09ERVMkMSAgICAgID0gMTk7Ci8qIG51bWJlciBvZiBjb2RlcyB1c2VkIHRvIHRyYW5zZmVyIHRoZSBiaXQgbGVuZ3RocyAqLwoKY29uc3QgSEVBUF9TSVpFJDEgICAgID0gMiAqIExfQ09ERVMkMSArIDE7Ci8qIG1heGltdW0gaGVhcCBzaXplICovCgpjb25zdCBNQVhfQklUUyQxICAgICAgPSAxNTsKLyogQWxsIGNvZGVzIG11c3Qgbm90IGV4Y2VlZCBNQVhfQklUUyBiaXRzICovCgpjb25zdCBCdWZfc2l6ZSAgICAgID0gMTY7Ci8qIHNpemUgb2YgYml0IGJ1ZmZlciBpbiBiaV9idWYgKi8KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29uc3RhbnRzCiAqLwoKY29uc3QgTUFYX0JMX0JJVFMgPSA3OwovKiBCaXQgbGVuZ3RoIGNvZGVzIG11c3Qgbm90IGV4Y2VlZCBNQVhfQkxfQklUUyBiaXRzICovCgpjb25zdCBFTkRfQkxPQ0sgICA9IDI1NjsKLyogZW5kIG9mIGJsb2NrIGxpdGVyYWwgY29kZSAqLwoKY29uc3QgUkVQXzNfNiAgICAgPSAxNjsKLyogcmVwZWF0IHByZXZpb3VzIGJpdCBsZW5ndGggMy02IHRpbWVzICgyIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKY29uc3QgUkVQWl8zXzEwICAgPSAxNzsKLyogcmVwZWF0IGEgemVybyBsZW5ndGggMy0xMCB0aW1lcyAgKDMgYml0cyBvZiByZXBlYXQgY291bnQpICovCgpjb25zdCBSRVBaXzExXzEzOCA9IDE4OwovKiByZXBlYXQgYSB6ZXJvIGxlbmd0aCAxMS0xMzggdGltZXMgICg3IGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKLyogZXNsaW50LWRpc2FibGUgY29tbWEtc3BhY2luZyxhcnJheS1icmFja2V0LXNwYWNpbmcgKi8KY29uc3QgZXh0cmFfbGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggbGVuZ3RoIGNvZGUgKi8KICBuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSk7Cgpjb25zdCBleHRyYV9kYml0cyA9ICAgLyogZXh0cmEgYml0cyBmb3IgZWFjaCBkaXN0YW5jZSBjb2RlICovCiAgbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTNdKTsKCmNvbnN0IGV4dHJhX2JsYml0cyA9ICAvKiBleHRyYSBiaXRzIGZvciBlYWNoIGJpdCBsZW5ndGggY29kZSAqLwogIG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDIsMyw3XSk7Cgpjb25zdCBibF9vcmRlciA9CiAgbmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKTsKLyogZXNsaW50LWVuYWJsZSBjb21tYS1zcGFjaW5nLGFycmF5LWJyYWNrZXQtc3BhY2luZyAqLwoKLyogVGhlIGxlbmd0aHMgb2YgdGhlIGJpdCBsZW5ndGggY29kZXMgYXJlIHNlbnQgaW4gb3JkZXIgb2YgZGVjcmVhc2luZwogKiBwcm9iYWJpbGl0eSwgdG8gYXZvaWQgdHJhbnNtaXR0aW5nIHRoZSBsZW5ndGhzIGZvciB1bnVzZWQgYml0IGxlbmd0aCBjb2Rlcy4KICovCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogTG9jYWwgZGF0YS4gVGhlc2UgYXJlIGluaXRpYWxpemVkIG9ubHkgb25jZS4KICovCgovLyBXZSBwcmUtZmlsbCBhcnJheXMgd2l0aCAwIHRvIGF2b2lkIHVuaW5pdGlhbGl6ZWQgZ2FwcwoKY29uc3QgRElTVF9DT0RFX0xFTiA9IDUxMjsgLyogc2VlIGRlZmluaXRpb24gb2YgYXJyYXkgZGlzdF9jb2RlIGJlbG93ICovCgovLyAhISEhIFVzZSBmbGF0IGFycmF5IGluc3RlYWQgb2Ygc3RydWN0dXJlLCBGcmVxID0gaSoyLCBMZW4gPSBpKjIrMQpjb25zdCBzdGF0aWNfbHRyZWUgID0gbmV3IEFycmF5KChMX0NPREVTJDEgKyAyKSAqIDIpOwp6ZXJvJDEoc3RhdGljX2x0cmVlKTsKLyogVGhlIHN0YXRpYyBsaXRlcmFsIHRyZWUuIFNpbmNlIHRoZSBiaXQgbGVuZ3RocyBhcmUgaW1wb3NlZCwgdGhlcmUgaXMgbm8KICogbmVlZCBmb3IgdGhlIExfQ09ERVMgZXh0cmEgY29kZXMgdXNlZCBkdXJpbmcgaGVhcCBjb25zdHJ1Y3Rpb24uIEhvd2V2ZXIKICogVGhlIGNvZGVzIDI4NiBhbmQgMjg3IGFyZSBuZWVkZWQgdG8gYnVpbGQgYSBjYW5vbmljYWwgdHJlZSAoc2VlIF90cl9pbml0CiAqIGJlbG93KS4KICovCgpjb25zdCBzdGF0aWNfZHRyZWUgID0gbmV3IEFycmF5KERfQ09ERVMkMSAqIDIpOwp6ZXJvJDEoc3RhdGljX2R0cmVlKTsKLyogVGhlIHN0YXRpYyBkaXN0YW5jZSB0cmVlLiAoQWN0dWFsbHkgYSB0cml2aWFsIHRyZWUgc2luY2UgYWxsIGNvZGVzIHVzZQogKiA1IGJpdHMuKQogKi8KCmNvbnN0IF9kaXN0X2NvZGUgICAgPSBuZXcgQXJyYXkoRElTVF9DT0RFX0xFTik7Cnplcm8kMShfZGlzdF9jb2RlKTsKLyogRGlzdGFuY2UgY29kZXMuIFRoZSBmaXJzdCAyNTYgdmFsdWVzIGNvcnJlc3BvbmQgdG8gdGhlIGRpc3RhbmNlcwogKiAzIC4uIDI1OCwgdGhlIGxhc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSB0b3AgOCBiaXRzIG9mCiAqIHRoZSAxNSBiaXQgZGlzdGFuY2VzLgogKi8KCmNvbnN0IF9sZW5ndGhfY29kZSAgPSBuZXcgQXJyYXkoTUFYX01BVENIJDEgLSBNSU5fTUFUQ0gkMSArIDEpOwp6ZXJvJDEoX2xlbmd0aF9jb2RlKTsKLyogbGVuZ3RoIGNvZGUgZm9yIGVhY2ggbm9ybWFsaXplZCBtYXRjaCBsZW5ndGggKDAgPT0gTUlOX01BVENIKSAqLwoKY29uc3QgYmFzZV9sZW5ndGggICA9IG5ldyBBcnJheShMRU5HVEhfQ09ERVMkMSk7Cnplcm8kMShiYXNlX2xlbmd0aCk7Ci8qIEZpcnN0IG5vcm1hbGl6ZWQgbGVuZ3RoIGZvciBlYWNoIGNvZGUgKDAgPSBNSU5fTUFUQ0gpICovCgpjb25zdCBiYXNlX2Rpc3QgICAgID0gbmV3IEFycmF5KERfQ09ERVMkMSk7Cnplcm8kMShiYXNlX2Rpc3QpOwovKiBGaXJzdCBub3JtYWxpemVkIGRpc3RhbmNlIGZvciBlYWNoIGNvZGUgKDAgPSBkaXN0YW5jZSBvZiAxKSAqLwoKCmZ1bmN0aW9uIFN0YXRpY1RyZWVEZXNjKHN0YXRpY190cmVlLCBleHRyYV9iaXRzLCBleHRyYV9iYXNlLCBlbGVtcywgbWF4X2xlbmd0aCkgewoKICB0aGlzLnN0YXRpY190cmVlICA9IHN0YXRpY190cmVlOyAgLyogc3RhdGljIHRyZWUgb3IgTlVMTCAqLwogIHRoaXMuZXh0cmFfYml0cyAgID0gZXh0cmFfYml0czsgICAvKiBleHRyYSBiaXRzIGZvciBlYWNoIGNvZGUgb3IgTlVMTCAqLwogIHRoaXMuZXh0cmFfYmFzZSAgID0gZXh0cmFfYmFzZTsgICAvKiBiYXNlIGluZGV4IGZvciBleHRyYV9iaXRzICovCiAgdGhpcy5lbGVtcyAgICAgICAgPSBlbGVtczsgICAgICAgIC8qIG1heCBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhlIHRyZWUgKi8KICB0aGlzLm1heF9sZW5ndGggICA9IG1heF9sZW5ndGg7ICAgLyogbWF4IGJpdCBsZW5ndGggZm9yIHRoZSBjb2RlcyAqLwoKICAvLyBzaG93IGlmIGBzdGF0aWNfdHJlZWAgaGFzIGRhdGEgb3IgZHVtbXkgLSBuZWVkZWQgZm9yIG1vbm9tb3JwaGljIG9iamVjdHMKICB0aGlzLmhhc19zdHJlZSAgICA9IHN0YXRpY190cmVlICYmIHN0YXRpY190cmVlLmxlbmd0aDsKfQoKCmxldCBzdGF0aWNfbF9kZXNjOwpsZXQgc3RhdGljX2RfZGVzYzsKbGV0IHN0YXRpY19ibF9kZXNjOwoKCmZ1bmN0aW9uIFRyZWVEZXNjKGR5bl90cmVlLCBzdGF0X2Rlc2MpIHsKICB0aGlzLmR5bl90cmVlID0gZHluX3RyZWU7ICAgICAvKiB0aGUgZHluYW1pYyB0cmVlICovCiAgdGhpcy5tYXhfY29kZSA9IDA7ICAgICAgICAgICAgLyogbGFyZ2VzdCBjb2RlIHdpdGggbm9uIHplcm8gZnJlcXVlbmN5ICovCiAgdGhpcy5zdGF0X2Rlc2MgPSBzdGF0X2Rlc2M7ICAgLyogdGhlIGNvcnJlc3BvbmRpbmcgc3RhdGljIHRyZWUgKi8KfQoKCgpjb25zdCBkX2NvZGUgPSAoZGlzdCkgPT4gewoKICByZXR1cm4gZGlzdCA8IDI1NiA/IF9kaXN0X2NvZGVbZGlzdF0gOiBfZGlzdF9jb2RlWzI1NiArIChkaXN0ID4+PiA3KV07Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIE91dHB1dCBhIHNob3J0IExTQiBmaXJzdCBvbiB0aGUgc3RyZWFtLgogKiBJTiBhc3NlcnRpb246IHRoZXJlIGlzIGVub3VnaCByb29tIGluIHBlbmRpbmdCdWYuCiAqLwpjb25zdCBwdXRfc2hvcnQgPSAocywgdykgPT4gewovLyAgICBwdXRfYnl0ZShzLCAodWNoKSgodykgJiAweGZmKSk7Ci8vICAgIHB1dF9ieXRlKHMsICh1Y2gpKCh1c2gpKHcpID4+IDgpKTsKICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3KSAmIDB4ZmY7CiAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSAodyA+Pj4gOCkgJiAweGZmOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBTZW5kIGEgdmFsdWUgb24gYSBnaXZlbiBudW1iZXIgb2YgYml0cy4KICogSU4gYXNzZXJ0aW9uOiBsZW5ndGggPD0gMTYgYW5kIHZhbHVlIGZpdHMgaW4gbGVuZ3RoIGJpdHMuCiAqLwpjb25zdCBzZW5kX2JpdHMgPSAocywgdmFsdWUsIGxlbmd0aCkgPT4gewoKICBpZiAocy5iaV92YWxpZCA+IChCdWZfc2l6ZSAtIGxlbmd0aCkpIHsKICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgIHB1dF9zaG9ydChzLCBzLmJpX2J1Zik7CiAgICBzLmJpX2J1ZiA9IHZhbHVlID4+IChCdWZfc2l6ZSAtIHMuYmlfdmFsaWQpOwogICAgcy5iaV92YWxpZCArPSBsZW5ndGggLSBCdWZfc2l6ZTsKICB9IGVsc2UgewogICAgcy5iaV9idWYgfD0gKHZhbHVlIDw8IHMuYmlfdmFsaWQpICYgMHhmZmZmOwogICAgcy5iaV92YWxpZCArPSBsZW5ndGg7CiAgfQp9OwoKCmNvbnN0IHNlbmRfY29kZSA9IChzLCBjLCB0cmVlKSA9PiB7CgogIHNlbmRfYml0cyhzLCB0cmVlW2MgKiAyXS8qLkNvZGUqLywgdHJlZVtjICogMiArIDFdLyouTGVuKi8pOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBSZXZlcnNlIHRoZSBmaXJzdCBsZW4gYml0cyBvZiBhIGNvZGUsIHVzaW5nIHN0cmFpZ2h0Zm9yd2FyZCBjb2RlIChhIGZhc3RlcgogKiBtZXRob2Qgd291bGQgdXNlIGEgdGFibGUpCiAqIElOIGFzc2VydGlvbjogMSA8PSBsZW4gPD0gMTUKICovCmNvbnN0IGJpX3JldmVyc2UgPSAoY29kZSwgbGVuKSA9PiB7CgogIGxldCByZXMgPSAwOwogIGRvIHsKICAgIHJlcyB8PSBjb2RlICYgMTsKICAgIGNvZGUgPj4+PSAxOwogICAgcmVzIDw8PSAxOwogIH0gd2hpbGUgKC0tbGVuID4gMCk7CiAgcmV0dXJuIHJlcyA+Pj4gMTsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogRmx1c2ggdGhlIGJpdCBidWZmZXIsIGtlZXBpbmcgYXQgbW9zdCA3IGJpdHMgaW4gaXQuCiAqLwpjb25zdCBiaV9mbHVzaCA9IChzKSA9PiB7CgogIGlmIChzLmJpX3ZhbGlkID09PSAxNikgewogICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgIHMuYmlfYnVmID0gMDsKICAgIHMuYmlfdmFsaWQgPSAwOwoKICB9IGVsc2UgaWYgKHMuYmlfdmFsaWQgPj0gOCkgewogICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBzLmJpX2J1ZiAmIDB4ZmY7CiAgICBzLmJpX2J1ZiA+Pj0gODsKICAgIHMuYmlfdmFsaWQgLT0gODsKICB9Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvbXB1dGUgdGhlIG9wdGltYWwgYml0IGxlbmd0aHMgZm9yIGEgdHJlZSBhbmQgdXBkYXRlIHRoZSB0b3RhbCBiaXQgbGVuZ3RoCiAqIGZvciB0aGUgY3VycmVudCBibG9jay4KICogSU4gYXNzZXJ0aW9uOiB0aGUgZmllbGRzIGZyZXEgYW5kIGRhZCBhcmUgc2V0LCBoZWFwW2hlYXBfbWF4XSBhbmQKICogICAgYWJvdmUgYXJlIHRoZSB0cmVlIG5vZGVzIHNvcnRlZCBieSBpbmNyZWFzaW5nIGZyZXF1ZW5jeS4KICogT1VUIGFzc2VydGlvbnM6IHRoZSBmaWVsZCBsZW4gaXMgc2V0IHRvIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGgsIHRoZQogKiAgICAgYXJyYXkgYmxfY291bnQgY29udGFpbnMgdGhlIGZyZXF1ZW5jaWVzIGZvciBlYWNoIGJpdCBsZW5ndGguCiAqICAgICBUaGUgbGVuZ3RoIG9wdF9sZW4gaXMgdXBkYXRlZDsgc3RhdGljX2xlbiBpcyBhbHNvIHVwZGF0ZWQgaWYgc3RyZWUgaXMKICogICAgIG5vdCBudWxsLgogKi8KY29uc3QgZ2VuX2JpdGxlbiA9IChzLCBkZXNjKSA9PgovLyAgICBkZWZsYXRlX3N0YXRlICpzOwovLyAgICB0cmVlX2Rlc2MgKmRlc2M7ICAgIC8qIHRoZSB0cmVlIGRlc2NyaXB0b3IgKi8KewogIGNvbnN0IHRyZWUgICAgICAgICAgICA9IGRlc2MuZHluX3RyZWU7CiAgY29uc3QgbWF4X2NvZGUgICAgICAgID0gZGVzYy5tYXhfY29kZTsKICBjb25zdCBzdHJlZSAgICAgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5zdGF0aWNfdHJlZTsKICBjb25zdCBoYXNfc3RyZWUgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgY29uc3QgZXh0cmEgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2MuZXh0cmFfYml0czsKICBjb25zdCBiYXNlICAgICAgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iYXNlOwogIGNvbnN0IG1heF9sZW5ndGggICAgICA9IGRlc2Muc3RhdF9kZXNjLm1heF9sZW5ndGg7CiAgbGV0IGg7ICAgICAgICAgICAgICAvKiBoZWFwIGluZGV4ICovCiAgbGV0IG4sIG07ICAgICAgICAgICAvKiBpdGVyYXRlIG92ZXIgdGhlIHRyZWUgZWxlbWVudHMgKi8KICBsZXQgYml0czsgICAgICAgICAgIC8qIGJpdCBsZW5ndGggKi8KICBsZXQgeGJpdHM7ICAgICAgICAgIC8qIGV4dHJhIGJpdHMgKi8KICBsZXQgZjsgICAgICAgICAgICAgIC8qIGZyZXF1ZW5jeSAqLwogIGxldCBvdmVyZmxvdyA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIHdpdGggYml0IGxlbmd0aCB0b28gbGFyZ2UgKi8KCiAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgIHMuYmxfY291bnRbYml0c10gPSAwOwogIH0KCiAgLyogSW4gYSBmaXJzdCBwYXNzLCBjb21wdXRlIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGhzICh3aGljaCBtYXkKICAgKiBvdmVyZmxvdyBpbiB0aGUgY2FzZSBvZiB0aGUgYml0IGxlbmd0aCB0cmVlKS4KICAgKi8KICB0cmVlW3MuaGVhcFtzLmhlYXBfbWF4XSAqIDIgKyAxXS8qLkxlbiovID0gMDsgLyogcm9vdCBvZiB0aGUgaGVhcCAqLwoKICBmb3IgKGggPSBzLmhlYXBfbWF4ICsgMTsgaCA8IEhFQVBfU0laRSQxOyBoKyspIHsKICAgIG4gPSBzLmhlYXBbaF07CiAgICBiaXRzID0gdHJlZVt0cmVlW24gKiAyICsgMV0vKi5EYWQqLyAqIDIgKyAxXS8qLkxlbiovICsgMTsKICAgIGlmIChiaXRzID4gbWF4X2xlbmd0aCkgewogICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgb3ZlcmZsb3crKzsKICAgIH0KICAgIHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gYml0czsKICAgIC8qIFdlIG92ZXJ3cml0ZSB0cmVlW25dLkRhZCB3aGljaCBpcyBubyBsb25nZXIgbmVlZGVkICovCgogICAgaWYgKG4gPiBtYXhfY29kZSkgeyBjb250aW51ZTsgfSAvKiBub3QgYSBsZWFmIG5vZGUgKi8KCiAgICBzLmJsX2NvdW50W2JpdHNdKys7CiAgICB4Yml0cyA9IDA7CiAgICBpZiAobiA+PSBiYXNlKSB7CiAgICAgIHhiaXRzID0gZXh0cmFbbiAtIGJhc2VdOwogICAgfQogICAgZiA9IHRyZWVbbiAqIDJdLyouRnJlcSovOwogICAgcy5vcHRfbGVuICs9IGYgKiAoYml0cyArIHhiaXRzKTsKICAgIGlmIChoYXNfc3RyZWUpIHsKICAgICAgcy5zdGF0aWNfbGVuICs9IGYgKiAoc3RyZWVbbiAqIDIgKyAxXS8qLkxlbiovICsgeGJpdHMpOwogICAgfQogIH0KICBpZiAob3ZlcmZsb3cgPT09IDApIHsgcmV0dXJuOyB9CgogIC8vIFRyYWNlKChzdGRlcnIsIlxuYml0IGxlbmd0aCBvdmVyZmxvd1xuIikpOwogIC8qIFRoaXMgaGFwcGVucyBmb3IgZXhhbXBsZSBvbiBvYmoyIGFuZCBwaWMgb2YgdGhlIENhbGdhcnkgY29ycHVzICovCgogIC8qIEZpbmQgdGhlIGZpcnN0IGJpdCBsZW5ndGggd2hpY2ggY291bGQgaW5jcmVhc2U6ICovCiAgZG8gewogICAgYml0cyA9IG1heF9sZW5ndGggLSAxOwogICAgd2hpbGUgKHMuYmxfY291bnRbYml0c10gPT09IDApIHsgYml0cy0tOyB9CiAgICBzLmJsX2NvdW50W2JpdHNdLS07ICAgICAgLyogbW92ZSBvbmUgbGVhZiBkb3duIHRoZSB0cmVlICovCiAgICBzLmJsX2NvdW50W2JpdHMgKyAxXSArPSAyOyAvKiBtb3ZlIG9uZSBvdmVyZmxvdyBpdGVtIGFzIGl0cyBicm90aGVyICovCiAgICBzLmJsX2NvdW50W21heF9sZW5ndGhdLS07CiAgICAvKiBUaGUgYnJvdGhlciBvZiB0aGUgb3ZlcmZsb3cgaXRlbSBhbHNvIG1vdmVzIG9uZSBzdGVwIHVwLAogICAgICogYnV0IHRoaXMgZG9lcyBub3QgYWZmZWN0IGJsX2NvdW50W21heF9sZW5ndGhdCiAgICAgKi8KICAgIG92ZXJmbG93IC09IDI7CiAgfSB3aGlsZSAob3ZlcmZsb3cgPiAwKTsKCiAgLyogTm93IHJlY29tcHV0ZSBhbGwgYml0IGxlbmd0aHMsIHNjYW5uaW5nIGluIGluY3JlYXNpbmcgZnJlcXVlbmN5LgogICAqIGggaXMgc3RpbGwgZXF1YWwgdG8gSEVBUF9TSVpFLiAoSXQgaXMgc2ltcGxlciB0byByZWNvbnN0cnVjdCBhbGwKICAgKiBsZW5ndGhzIGluc3RlYWQgb2YgZml4aW5nIG9ubHkgdGhlIHdyb25nIG9uZXMuIFRoaXMgaWRlYSBpcyB0YWtlbgogICAqIGZyb20gJ2FyJyB3cml0dGVuIGJ5IEhhcnVoaWtvIE9rdW11cmEuKQogICAqLwogIGZvciAoYml0cyA9IG1heF9sZW5ndGg7IGJpdHMgIT09IDA7IGJpdHMtLSkgewogICAgbiA9IHMuYmxfY291bnRbYml0c107CiAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICBtID0gcy5oZWFwWy0taF07CiAgICAgIGlmIChtID4gbWF4X2NvZGUpIHsgY29udGludWU7IH0KICAgICAgaWYgKHRyZWVbbSAqIDIgKyAxXS8qLkxlbiovICE9PSBiaXRzKSB7CiAgICAgICAgLy8gVHJhY2UoKHN0ZGVyciwiY29kZSAlZCBiaXRzICVkLT4lZFxuIiwgbSwgdHJlZVttXS5MZW4sIGJpdHMpKTsKICAgICAgICBzLm9wdF9sZW4gKz0gKGJpdHMgLSB0cmVlW20gKiAyICsgMV0vKi5MZW4qLykgKiB0cmVlW20gKiAyXS8qLkZyZXEqLzsKICAgICAgICB0cmVlW20gKiAyICsgMV0vKi5MZW4qLyA9IGJpdHM7CiAgICAgIH0KICAgICAgbi0tOwogICAgfQogIH0KfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogR2VuZXJhdGUgdGhlIGNvZGVzIGZvciBhIGdpdmVuIHRyZWUgYW5kIGJpdCBjb3VudHMgKHdoaWNoIG5lZWQgbm90IGJlCiAqIG9wdGltYWwpLgogKiBJTiBhc3NlcnRpb246IHRoZSBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgYml0IGxlbmd0aCBzdGF0aXN0aWNzIGZvcgogKiB0aGUgZ2l2ZW4gdHJlZSBhbmQgdGhlIGZpZWxkIGxlbiBpcyBzZXQgZm9yIGFsbCB0cmVlIGVsZW1lbnRzLgogKiBPVVQgYXNzZXJ0aW9uOiB0aGUgZmllbGQgY29kZSBpcyBzZXQgZm9yIGFsbCB0cmVlIGVsZW1lbnRzIG9mIG5vbgogKiAgICAgemVybyBjb2RlIGxlbmd0aC4KICovCmNvbnN0IGdlbl9jb2RlcyA9ICh0cmVlLCBtYXhfY29kZSwgYmxfY291bnQpID0+Ci8vICAgIGN0X2RhdGEgKnRyZWU7ICAgICAgICAgICAgIC8qIHRoZSB0cmVlIHRvIGRlY29yYXRlICovCi8vICAgIGludCBtYXhfY29kZTsgICAgICAgICAgICAgIC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwovLyAgICB1c2hmICpibF9jb3VudDsgICAgICAgICAgICAvKiBudW1iZXIgb2YgY29kZXMgYXQgZWFjaCBiaXQgbGVuZ3RoICovCnsKICBjb25zdCBuZXh0X2NvZGUgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOyAvKiBuZXh0IGNvZGUgdmFsdWUgZm9yIGVhY2ggYml0IGxlbmd0aCAqLwogIGxldCBjb2RlID0gMDsgICAgICAgICAgICAgIC8qIHJ1bm5pbmcgY29kZSB2YWx1ZSAqLwogIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgIC8qIGJpdCBpbmRleCAqLwogIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGNvZGUgaW5kZXggKi8KCiAgLyogVGhlIGRpc3RyaWJ1dGlvbiBjb3VudHMgYXJlIGZpcnN0IHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGNvZGUgdmFsdWVzCiAgICogd2l0aG91dCBiaXQgcmV2ZXJzYWwuCiAgICovCiAgZm9yIChiaXRzID0gMTsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSAoY29kZSArIGJsX2NvdW50W2JpdHMgLSAxXSkgPDwgMTsKICB9CiAgLyogQ2hlY2sgdGhhdCB0aGUgYml0IGNvdW50cyBpbiBibF9jb3VudCBhcmUgY29uc2lzdGVudC4gVGhlIGxhc3QgY29kZQogICAqIG11c3QgYmUgYWxsIG9uZXMuCiAgICovCiAgLy9Bc3NlcnQgKGNvZGUgKyBibF9jb3VudFtNQVhfQklUU10tMSA9PSAoMTw8TUFYX0JJVFMpLTEsCiAgLy8gICAgICAgICJpbmNvbnNpc3RlbnQgYml0IGNvdW50cyIpOwogIC8vVHJhY2V2KChzdGRlcnIsIlxuZ2VuX2NvZGVzOiBtYXhfY29kZSAlZCAiLCBtYXhfY29kZSkpOwoKICBmb3IgKG4gPSAwOyAgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICBsZXQgbGVuID0gdHJlZVtuICogMiArIDFdLyouTGVuKi87CiAgICBpZiAobGVuID09PSAwKSB7IGNvbnRpbnVlOyB9CiAgICAvKiBOb3cgcmV2ZXJzZSB0aGUgYml0cyAqLwogICAgdHJlZVtuICogMl0vKi5Db2RlKi8gPSBiaV9yZXZlcnNlKG5leHRfY29kZVtsZW5dKyssIGxlbik7CgogICAgLy9UcmFjZWN2KHRyZWUgIT0gc3RhdGljX2x0cmVlLCAoc3RkZXJyLCJcbm4gJTNkICVjIGwgJTJkIGMgJTR4ICgleCkgIiwKICAgIC8vICAgICBuLCAoaXNncmFwaChuKSA/IG4gOiAnICcpLCBsZW4sIHRyZWVbbl0uQ29kZSwgbmV4dF9jb2RlW2xlbl0tMSkpOwogIH0KfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogSW5pdGlhbGl6ZSB0aGUgdmFyaW91cyAnY29uc3RhbnQnIHRhYmxlcy4KICovCmNvbnN0IHRyX3N0YXRpY19pbml0ID0gKCkgPT4gewoKICBsZXQgbjsgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgdHJlZSBlbGVtZW50cyAqLwogIGxldCBiaXRzOyAgICAgLyogYml0IGNvdW50ZXIgKi8KICBsZXQgbGVuZ3RoOyAgIC8qIGxlbmd0aCB2YWx1ZSAqLwogIGxldCBjb2RlOyAgICAgLyogY29kZSB2YWx1ZSAqLwogIGxldCBkaXN0OyAgICAgLyogZGlzdGFuY2UgaW5kZXggKi8KICBjb25zdCBibF9jb3VudCA9IG5ldyBBcnJheShNQVhfQklUUyQxICsgMSk7CiAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogIC8vIGRvIGNoZWNrIGluIF90cl9pbml0KCkKICAvL2lmIChzdGF0aWNfaW5pdF9kb25lKSByZXR1cm47CgogIC8qIEZvciBzb21lIGVtYmVkZGVkIHRhcmdldHMsIGdsb2JhbCB2YXJpYWJsZXMgYXJlIG5vdCBpbml0aWFsaXplZDogKi8KLyojaWZkZWYgTk9fSU5JVF9HTE9CQUxfUE9JTlRFUlMKICBzdGF0aWNfbF9kZXNjLnN0YXRpY190cmVlID0gc3RhdGljX2x0cmVlOwogIHN0YXRpY19sX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2xiaXRzOwogIHN0YXRpY19kX2Rlc2Muc3RhdGljX3RyZWUgPSBzdGF0aWNfZHRyZWU7CiAgc3RhdGljX2RfZGVzYy5leHRyYV9iaXRzID0gZXh0cmFfZGJpdHM7CiAgc3RhdGljX2JsX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2JsYml0czsKI2VuZGlmKi8KCiAgLyogSW5pdGlhbGl6ZSB0aGUgbWFwcGluZyBsZW5ndGggKDAuLjI1NSkgLT4gbGVuZ3RoIGNvZGUgKDAuLjI4KSAqLwogIGxlbmd0aCA9IDA7CiAgZm9yIChjb2RlID0gMDsgY29kZSA8IExFTkdUSF9DT0RFUyQxIC0gMTsgY29kZSsrKSB7CiAgICBiYXNlX2xlbmd0aFtjb2RlXSA9IGxlbmd0aDsKICAgIGZvciAobiA9IDA7IG4gPCAoMSA8PCBleHRyYV9sYml0c1tjb2RlXSk7IG4rKykgewogICAgICBfbGVuZ3RoX2NvZGVbbGVuZ3RoKytdID0gY29kZTsKICAgIH0KICB9CiAgLy9Bc3NlcnQgKGxlbmd0aCA9PSAyNTYsICJ0cl9zdGF0aWNfaW5pdDogbGVuZ3RoICE9IDI1NiIpOwogIC8qIE5vdGUgdGhhdCB0aGUgbGVuZ3RoIDI1NSAobWF0Y2ggbGVuZ3RoIDI1OCkgY2FuIGJlIHJlcHJlc2VudGVkCiAgICogaW4gdHdvIGRpZmZlcmVudCB3YXlzOiBjb2RlIDI4NCArIDUgYml0cyBvciBjb2RlIDI4NSwgc28gd2UKICAgKiBvdmVyd3JpdGUgbGVuZ3RoX2NvZGVbMjU1XSB0byB1c2UgdGhlIGJlc3QgZW5jb2Rpbmc6CiAgICovCiAgX2xlbmd0aF9jb2RlW2xlbmd0aCAtIDFdID0gY29kZTsKCiAgLyogSW5pdGlhbGl6ZSB0aGUgbWFwcGluZyBkaXN0ICgwLi4zMkspIC0+IGRpc3QgY29kZSAoMC4uMjkpICovCiAgZGlzdCA9IDA7CiAgZm9yIChjb2RlID0gMDsgY29kZSA8IDE2OyBjb2RlKyspIHsKICAgIGJhc2VfZGlzdFtjb2RlXSA9IGRpc3Q7CiAgICBmb3IgKG4gPSAwOyBuIDwgKDEgPDwgZXh0cmFfZGJpdHNbY29kZV0pOyBuKyspIHsKICAgICAgX2Rpc3RfY29kZVtkaXN0KytdID0gY29kZTsKICAgIH0KICB9CiAgLy9Bc3NlcnQgKGRpc3QgPT0gMjU2LCAidHJfc3RhdGljX2luaXQ6IGRpc3QgIT0gMjU2Iik7CiAgZGlzdCA+Pj0gNzsgLyogZnJvbSBub3cgb24sIGFsbCBkaXN0YW5jZXMgYXJlIGRpdmlkZWQgYnkgMTI4ICovCiAgZm9yICg7IGNvZGUgPCBEX0NPREVTJDE7IGNvZGUrKykgewogICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdCA8PCA3OwogICAgZm9yIChuID0gMDsgbiA8ICgxIDw8IChleHRyYV9kYml0c1tjb2RlXSAtIDcpKTsgbisrKSB7CiAgICAgIF9kaXN0X2NvZGVbMjU2ICsgZGlzdCsrXSA9IGNvZGU7CiAgICB9CiAgfQogIC8vQXNzZXJ0IChkaXN0ID09IDI1NiwgInRyX3N0YXRpY19pbml0OiAyNTYrZGlzdCAhPSA1MTIiKTsKCiAgLyogQ29uc3RydWN0IHRoZSBjb2RlcyBvZiB0aGUgc3RhdGljIGxpdGVyYWwgdHJlZSAqLwogIGZvciAoYml0cyA9IDA7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICBibF9jb3VudFtiaXRzXSA9IDA7CiAgfQoKICBuID0gMDsKICB3aGlsZSAobiA8PSAxNDMpIHsKICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgbisrOwogICAgYmxfY291bnRbOF0rKzsKICB9CiAgd2hpbGUgKG4gPD0gMjU1KSB7CiAgICBzdGF0aWNfbHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gOTsKICAgIG4rKzsKICAgIGJsX2NvdW50WzldKys7CiAgfQogIHdoaWxlIChuIDw9IDI3OSkgewogICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDc7CiAgICBuKys7CiAgICBibF9jb3VudFs3XSsrOwogIH0KICB3aGlsZSAobiA8PSAyODcpIHsKICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgbisrOwogICAgYmxfY291bnRbOF0rKzsKICB9CiAgLyogQ29kZXMgMjg2IGFuZCAyODcgZG8gbm90IGV4aXN0LCBidXQgd2UgbXVzdCBpbmNsdWRlIHRoZW0gaW4gdGhlCiAgICogdHJlZSBjb25zdHJ1Y3Rpb24gdG8gZ2V0IGEgY2Fub25pY2FsIEh1ZmZtYW4gdHJlZSAobG9uZ2VzdCBjb2RlCiAgICogYWxsIG9uZXMpCiAgICovCiAgZ2VuX2NvZGVzKHN0YXRpY19sdHJlZSwgTF9DT0RFUyQxICsgMSwgYmxfY291bnQpOwoKICAvKiBUaGUgc3RhdGljIGRpc3RhbmNlIHRyZWUgaXMgdHJpdmlhbDogKi8KICBmb3IgKG4gPSAwOyBuIDwgRF9DT0RFUyQxOyBuKyspIHsKICAgIHN0YXRpY19kdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA1OwogICAgc3RhdGljX2R0cmVlW24gKiAyXS8qLkNvZGUqLyA9IGJpX3JldmVyc2UobiwgNSk7CiAgfQoKICAvLyBOb3cgZGF0YSByZWFkeSBhbmQgd2UgY2FuIGluaXQgc3RhdGljIHRyZWVzCiAgc3RhdGljX2xfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfbHRyZWUsIGV4dHJhX2xiaXRzLCBMSVRFUkFMUyQxICsgMSwgTF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICBzdGF0aWNfZF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKHN0YXRpY19kdHJlZSwgZXh0cmFfZGJpdHMsIDAsICAgICAgICAgIERfQ09ERVMkMSwgTUFYX0JJVFMkMSk7CiAgc3RhdGljX2JsX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2MobmV3IEFycmF5KDApLCBleHRyYV9ibGJpdHMsIDAsICAgICAgICAgQkxfQ09ERVMkMSwgTUFYX0JMX0JJVFMpOwoKICAvL3N0YXRpY19pbml0X2RvbmUgPSB0cnVlOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBJbml0aWFsaXplIGEgbmV3IGJsb2NrLgogKi8KY29uc3QgaW5pdF9ibG9jayA9IChzKSA9PiB7CgogIGxldCBuOyAvKiBpdGVyYXRlcyBvdmVyIHRyZWUgZWxlbWVudHMgKi8KCiAgLyogSW5pdGlhbGl6ZSB0aGUgdHJlZXMuICovCiAgZm9yIChuID0gMDsgbiA8IExfQ09ERVMkMTsgIG4rKykgeyBzLmR5bl9sdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CiAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgIG4rKykgeyBzLmR5bl9kdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CiAgZm9yIChuID0gMDsgbiA8IEJMX0NPREVTJDE7IG4rKykgeyBzLmJsX3RyZWVbbiAqIDJdLyouRnJlcSovID0gMDsgfQoKICBzLmR5bl9sdHJlZVtFTkRfQkxPQ0sgKiAyXS8qLkZyZXEqLyA9IDE7CiAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICBzLmxhc3RfbGl0ID0gcy5tYXRjaGVzID0gMDsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogRmx1c2ggdGhlIGJpdCBidWZmZXIgYW5kIGFsaWduIHRoZSBvdXRwdXQgb24gYSBieXRlIGJvdW5kYXJ5CiAqLwpjb25zdCBiaV93aW5kdXAgPSAocykgPT4KewogIGlmIChzLmJpX3ZhbGlkID4gOCkgewogICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICB9IGVsc2UgaWYgKHMuYmlfdmFsaWQgPiAwKSB7CiAgICAvL3B1dF9ieXRlKHMsIChCeXRlKXMtPmJpX2J1Zik7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmOwogIH0KICBzLmJpX2J1ZiA9IDA7CiAgcy5iaV92YWxpZCA9IDA7Cn07CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29weSBhIHN0b3JlZCBibG9jaywgc3RvcmluZyBmaXJzdCB0aGUgbGVuZ3RoIGFuZCBpdHMKICogb25lJ3MgY29tcGxlbWVudCBpZiByZXF1ZXN0ZWQuCiAqLwpjb25zdCBjb3B5X2Jsb2NrID0gKHMsIGJ1ZiwgbGVuLCBoZWFkZXIpID0+Ci8vRGVmbGF0ZVN0YXRlICpzOwovL2NoYXJmICAgICpidWY7ICAgIC8qIHRoZSBpbnB1dCBkYXRhICovCi8vdW5zaWduZWQgbGVuOyAgICAgLyogaXRzIGxlbmd0aCAqLwovL2ludCAgICAgIGhlYWRlcjsgIC8qIHRydWUgaWYgYmxvY2sgaGVhZGVyIG11c3QgYmUgd3JpdHRlbiAqLwp7CiAgYmlfd2luZHVwKHMpOyAgICAgICAgLyogYWxpZ24gb24gYnl0ZSBib3VuZGFyeSAqLwoKICBpZiAoaGVhZGVyKSB7CiAgICBwdXRfc2hvcnQocywgbGVuKTsKICAgIHB1dF9zaG9ydChzLCB+bGVuKTsKICB9Ci8vICB3aGlsZSAobGVuLS0pIHsKLy8gICAgcHV0X2J5dGUocywgKmJ1ZisrKTsKLy8gIH0KICBzLnBlbmRpbmdfYnVmLnNldChzLndpbmRvdy5zdWJhcnJheShidWYsIGJ1ZiArIGxlbiksIHMucGVuZGluZyk7CiAgcy5wZW5kaW5nICs9IGxlbjsKfTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb21wYXJlcyB0byBzdWJ0cmVlcywgdXNpbmcgdGhlIHRyZWUgZGVwdGggYXMgdGllIGJyZWFrZXIgd2hlbgogKiB0aGUgc3VidHJlZXMgaGF2ZSBlcXVhbCBmcmVxdWVuY3kuIFRoaXMgbWluaW1pemVzIHRoZSB3b3JzdCBjYXNlIGxlbmd0aC4KICovCmNvbnN0IHNtYWxsZXIgPSAodHJlZSwgbiwgbSwgZGVwdGgpID0+IHsKCiAgY29uc3QgX24yID0gbiAqIDI7CiAgY29uc3QgX20yID0gbSAqIDI7CiAgcmV0dXJuICh0cmVlW19uMl0vKi5GcmVxKi8gPCB0cmVlW19tMl0vKi5GcmVxKi8gfHwKICAgICAgICAgKHRyZWVbX24yXS8qLkZyZXEqLyA9PT0gdHJlZVtfbTJdLyouRnJlcSovICYmIGRlcHRoW25dIDw9IGRlcHRoW21dKSk7Cn07CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogUmVzdG9yZSB0aGUgaGVhcCBwcm9wZXJ0eSBieSBtb3ZpbmcgZG93biB0aGUgdHJlZSBzdGFydGluZyBhdCBub2RlIGssCiAqIGV4Y2hhbmdpbmcgYSBub2RlIHdpdGggdGhlIHNtYWxsZXN0IG9mIGl0cyB0d28gc29ucyBpZiBuZWNlc3NhcnksIHN0b3BwaW5nCiAqIHdoZW4gdGhlIGhlYXAgcHJvcGVydHkgaXMgcmUtZXN0YWJsaXNoZWQgKGVhY2ggZmF0aGVyIHNtYWxsZXIgdGhhbiBpdHMKICogdHdvIHNvbnMpLgogKi8KY29uc3QgcHFkb3duaGVhcCA9IChzLCB0cmVlLCBrKSA9PgovLyAgICBkZWZsYXRlX3N0YXRlICpzOwovLyAgICBjdF9kYXRhICp0cmVlOyAgLyogdGhlIHRyZWUgdG8gcmVzdG9yZSAqLwovLyAgICBpbnQgazsgICAgICAgICAgICAgICAvKiBub2RlIHRvIG1vdmUgZG93biAqLwp7CiAgY29uc3QgdiA9IHMuaGVhcFtrXTsKICBsZXQgaiA9IGsgPDwgMTsgIC8qIGxlZnQgc29uIG9mIGsgKi8KICB3aGlsZSAoaiA8PSBzLmhlYXBfbGVuKSB7CiAgICAvKiBTZXQgaiB0byB0aGUgc21hbGxlc3Qgb2YgdGhlIHR3byBzb25zOiAqLwogICAgaWYgKGogPCBzLmhlYXBfbGVuICYmCiAgICAgIHNtYWxsZXIodHJlZSwgcy5oZWFwW2ogKyAxXSwgcy5oZWFwW2pdLCBzLmRlcHRoKSkgewogICAgICBqKys7CiAgICB9CiAgICAvKiBFeGl0IGlmIHYgaXMgc21hbGxlciB0aGFuIGJvdGggc29ucyAqLwogICAgaWYgKHNtYWxsZXIodHJlZSwgdiwgcy5oZWFwW2pdLCBzLmRlcHRoKSkgeyBicmVhazsgfQoKICAgIC8qIEV4Y2hhbmdlIHYgd2l0aCB0aGUgc21hbGxlc3Qgc29uICovCiAgICBzLmhlYXBba10gPSBzLmhlYXBbal07CiAgICBrID0gajsKCiAgICAvKiBBbmQgY29udGludWUgZG93biB0aGUgdHJlZSwgc2V0dGluZyBqIHRvIHRoZSBsZWZ0IHNvbiBvZiBrICovCiAgICBqIDw8PSAxOwogIH0KICBzLmhlYXBba10gPSB2Owp9OwoKCi8vIGlubGluZWQgbWFudWFsbHkKLy8gY29uc3QgU01BTExFU1QgPSAxOwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIFNlbmQgdGhlIGJsb2NrIGRhdGEgY29tcHJlc3NlZCB1c2luZyB0aGUgZ2l2ZW4gSHVmZm1hbiB0cmVlcwogKi8KY29uc3QgY29tcHJlc3NfYmxvY2sgPSAocywgbHRyZWUsIGR0cmVlKSA9PgovLyAgICBkZWZsYXRlX3N0YXRlICpzOwovLyAgICBjb25zdCBjdF9kYXRhICpsdHJlZTsgLyogbGl0ZXJhbCB0cmVlICovCi8vICAgIGNvbnN0IGN0X2RhdGEgKmR0cmVlOyAvKiBkaXN0YW5jZSB0cmVlICovCnsKICBsZXQgZGlzdDsgICAgICAgICAgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgbGV0IGxjOyAgICAgICAgICAgICAvKiBtYXRjaCBsZW5ndGggb3IgdW5tYXRjaGVkIGNoYXIgKGlmIGRpc3QgPT0gMCkgKi8KICBsZXQgbHggPSAwOyAgICAgICAgIC8qIHJ1bm5pbmcgaW5kZXggaW4gbF9idWYgKi8KICBsZXQgY29kZTsgICAgICAgICAgIC8qIHRoZSBjb2RlIHRvIHNlbmQgKi8KICBsZXQgZXh0cmE7ICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzIHRvIHNlbmQgKi8KCiAgaWYgKHMubGFzdF9saXQgIT09IDApIHsKICAgIGRvIHsKICAgICAgZGlzdCA9IChzLnBlbmRpbmdfYnVmW3MuZF9idWYgKyBseCAqIDJdIDw8IDgpIHwgKHMucGVuZGluZ19idWZbcy5kX2J1ZiArIGx4ICogMiArIDFdKTsKICAgICAgbGMgPSBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBseF07CiAgICAgIGx4Kys7CgogICAgICBpZiAoZGlzdCA9PT0gMCkgewogICAgICAgIHNlbmRfY29kZShzLCBsYywgbHRyZWUpOyAvKiBzZW5kIGEgbGl0ZXJhbCBieXRlICovCiAgICAgICAgLy9UcmFjZWN2KGlzZ3JhcGgobGMpLCAoc3RkZXJyLCIgJyVjJyAiLCBsYykpOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIEhlcmUsIGxjIGlzIHRoZSBtYXRjaCBsZW5ndGggLSBNSU5fTUFUQ0ggKi8KICAgICAgICBjb2RlID0gX2xlbmd0aF9jb2RlW2xjXTsKICAgICAgICBzZW5kX2NvZGUocywgY29kZSArIExJVEVSQUxTJDEgKyAxLCBsdHJlZSk7IC8qIHNlbmQgdGhlIGxlbmd0aCBjb2RlICovCiAgICAgICAgZXh0cmEgPSBleHRyYV9sYml0c1tjb2RlXTsKICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgIGxjIC09IGJhc2VfbGVuZ3RoW2NvZGVdOwogICAgICAgICAgc2VuZF9iaXRzKHMsIGxjLCBleHRyYSk7ICAgICAgIC8qIHNlbmQgdGhlIGV4dHJhIGxlbmd0aCBiaXRzICovCiAgICAgICAgfQogICAgICAgIGRpc3QtLTsgLyogZGlzdCBpcyBub3cgdGhlIG1hdGNoIGRpc3RhbmNlIC0gMSAqLwogICAgICAgIGNvZGUgPSBkX2NvZGUoZGlzdCk7CiAgICAgICAgLy9Bc3NlcnQgKGNvZGUgPCBEX0NPREVTLCAiYmFkIGRfY29kZSIpOwoKICAgICAgICBzZW5kX2NvZGUocywgY29kZSwgZHRyZWUpOyAgICAgICAvKiBzZW5kIHRoZSBkaXN0YW5jZSBjb2RlICovCiAgICAgICAgZXh0cmEgPSBleHRyYV9kYml0c1tjb2RlXTsKICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgIGRpc3QgLT0gYmFzZV9kaXN0W2NvZGVdOwogICAgICAgICAgc2VuZF9iaXRzKHMsIGRpc3QsIGV4dHJhKTsgICAvKiBzZW5kIHRoZSBleHRyYSBkaXN0YW5jZSBiaXRzICovCiAgICAgICAgfQogICAgICB9IC8qIGxpdGVyYWwgb3IgbWF0Y2ggcGFpciA/ICovCgogICAgICAvKiBDaGVjayB0aGF0IHRoZSBvdmVybGF5IGJldHdlZW4gcGVuZGluZ19idWYgYW5kIGRfYnVmK2xfYnVmIGlzIG9rOiAqLwogICAgICAvL0Fzc2VydCgodUludCkocy0+cGVuZGluZykgPCBzLT5saXRfYnVmc2l6ZSArIDIqbHgsCiAgICAgIC8vICAgICAgICJwZW5kaW5nQnVmIG92ZXJmbG93Iik7CgogICAgfSB3aGlsZSAobHggPCBzLmxhc3RfbGl0KTsKICB9CgogIHNlbmRfY29kZShzLCBFTkRfQkxPQ0ssIGx0cmVlKTsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29uc3RydWN0IG9uZSBIdWZmbWFuIHRyZWUgYW5kIGFzc2lnbnMgdGhlIGNvZGUgYml0IHN0cmluZ3MgYW5kIGxlbmd0aHMuCiAqIFVwZGF0ZSB0aGUgdG90YWwgYml0IGxlbmd0aCBmb3IgdGhlIGN1cnJlbnQgYmxvY2suCiAqIElOIGFzc2VydGlvbjogdGhlIGZpZWxkIGZyZXEgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cy4KICogT1VUIGFzc2VydGlvbnM6IHRoZSBmaWVsZHMgbGVuIGFuZCBjb2RlIGFyZSBzZXQgdG8gdGhlIG9wdGltYWwgYml0IGxlbmd0aAogKiAgICAgYW5kIGNvcnJlc3BvbmRpbmcgY29kZS4gVGhlIGxlbmd0aCBvcHRfbGVuIGlzIHVwZGF0ZWQ7IHN0YXRpY19sZW4gaXMKICogICAgIGFsc28gdXBkYXRlZCBpZiBzdHJlZSBpcyBub3QgbnVsbC4gVGhlIGZpZWxkIG1heF9jb2RlIGlzIHNldC4KICovCmNvbnN0IGJ1aWxkX3RyZWUgPSAocywgZGVzYykgPT4KLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKLy8gICAgdHJlZV9kZXNjICpkZXNjOyAvKiB0aGUgdHJlZSBkZXNjcmlwdG9yICovCnsKICBjb25zdCB0cmVlICAgICA9IGRlc2MuZHluX3RyZWU7CiAgY29uc3Qgc3RyZWUgICAgPSBkZXNjLnN0YXRfZGVzYy5zdGF0aWNfdHJlZTsKICBjb25zdCBoYXNfc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgY29uc3QgZWxlbXMgICAgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICBsZXQgbiwgbTsgICAgICAgICAgLyogaXRlcmF0ZSBvdmVyIGhlYXAgZWxlbWVudHMgKi8KICBsZXQgbWF4X2NvZGUgPSAtMTsgLyogbGFyZ2VzdCBjb2RlIHdpdGggbm9uIHplcm8gZnJlcXVlbmN5ICovCiAgbGV0IG5vZGU7ICAgICAgICAgIC8qIG5ldyBub2RlIGJlaW5nIGNyZWF0ZWQgKi8KCiAgLyogQ29uc3RydWN0IHRoZSBpbml0aWFsIGhlYXAsIHdpdGggbGVhc3QgZnJlcXVlbnQgZWxlbWVudCBpbgogICAqIGhlYXBbU01BTExFU1RdLiBUaGUgc29ucyBvZiBoZWFwW25dIGFyZSBoZWFwWzIqbl0gYW5kIGhlYXBbMipuKzFdLgogICAqIGhlYXBbMF0gaXMgbm90IHVzZWQuCiAgICovCiAgcy5oZWFwX2xlbiA9IDA7CiAgcy5oZWFwX21heCA9IEhFQVBfU0laRSQxOwoKICBmb3IgKG4gPSAwOyBuIDwgZWxlbXM7IG4rKykgewogICAgaWYgKHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICBzLmRlcHRoW25dID0gMDsKCiAgICB9IGVsc2UgewogICAgICB0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDA7CiAgICB9CiAgfQoKICAvKiBUaGUgcGt6aXAgZm9ybWF0IHJlcXVpcmVzIHRoYXQgYXQgbGVhc3Qgb25lIGRpc3RhbmNlIGNvZGUgZXhpc3RzLAogICAqIGFuZCB0aGF0IGF0IGxlYXN0IG9uZSBiaXQgc2hvdWxkIGJlIHNlbnQgZXZlbiBpZiB0aGVyZSBpcyBvbmx5IG9uZQogICAqIHBvc3NpYmxlIGNvZGUuIFNvIHRvIGF2b2lkIHNwZWNpYWwgY2hlY2tzIGxhdGVyIG9uIHdlIGZvcmNlIGF0IGxlYXN0CiAgICogdHdvIGNvZGVzIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeS4KICAgKi8KICB3aGlsZSAocy5oZWFwX2xlbiA8IDIpIHsKICAgIG5vZGUgPSBzLmhlYXBbKytzLmhlYXBfbGVuXSA9IChtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMCk7CiAgICB0cmVlW25vZGUgKiAyXS8qLkZyZXEqLyA9IDE7CiAgICBzLmRlcHRoW25vZGVdID0gMDsKICAgIHMub3B0X2xlbi0tOwoKICAgIGlmIChoYXNfc3RyZWUpIHsKICAgICAgcy5zdGF0aWNfbGVuIC09IHN0cmVlW25vZGUgKiAyICsgMV0vKi5MZW4qLzsKICAgIH0KICAgIC8qIG5vZGUgaXMgMCBvciAxIHNvIGl0IGRvZXMgbm90IGhhdmUgZXh0cmEgYml0cyAqLwogIH0KICBkZXNjLm1heF9jb2RlID0gbWF4X2NvZGU7CgogIC8qIFRoZSBlbGVtZW50cyBoZWFwW2hlYXBfbGVuLzIrMSAuLiBoZWFwX2xlbl0gYXJlIGxlYXZlcyBvZiB0aGUgdHJlZSwKICAgKiBlc3RhYmxpc2ggc3ViLWhlYXBzIG9mIGluY3JlYXNpbmcgbGVuZ3RoczoKICAgKi8KICBmb3IgKG4gPSAocy5oZWFwX2xlbiA+PiAxLyppbnQgLzIqLyk7IG4gPj0gMTsgbi0tKSB7IHBxZG93bmhlYXAocywgdHJlZSwgbik7IH0KCiAgLyogQ29uc3RydWN0IHRoZSBIdWZmbWFuIHRyZWUgYnkgcmVwZWF0ZWRseSBjb21iaW5pbmcgdGhlIGxlYXN0IHR3bwogICAqIGZyZXF1ZW50IG5vZGVzLgogICAqLwogIG5vZGUgPSBlbGVtczsgICAgICAgICAgICAgIC8qIG5leHQgaW50ZXJuYWwgbm9kZSBvZiB0aGUgdHJlZSAqLwogIGRvIHsKICAgIC8vcHFyZW1vdmUocywgdHJlZSwgbik7ICAvKiBuID0gbm9kZSBvZiBsZWFzdCBmcmVxdWVuY3kgKi8KICAgIC8qKiogcHFyZW1vdmUgKioqLwogICAgbiA9IHMuaGVhcFsxLypTTUFMTEVTVCovXTsKICAgIHMuaGVhcFsxLypTTUFMTEVTVCovXSA9IHMuaGVhcFtzLmhlYXBfbGVuLS1dOwogICAgcHFkb3duaGVhcChzLCB0cmVlLCAxLypTTUFMTEVTVCovKTsKICAgIC8qKiovCgogICAgbSA9IHMuaGVhcFsxLypTTUFMTEVTVCovXTsgLyogbSA9IG5vZGUgb2YgbmV4dCBsZWFzdCBmcmVxdWVuY3kgKi8KCiAgICBzLmhlYXBbLS1zLmhlYXBfbWF4XSA9IG47IC8qIGtlZXAgdGhlIG5vZGVzIHNvcnRlZCBieSBmcmVxdWVuY3kgKi8KICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gbTsKCiAgICAvKiBDcmVhdGUgYSBuZXcgbm9kZSBmYXRoZXIgb2YgbiBhbmQgbSAqLwogICAgdHJlZVtub2RlICogMl0vKi5GcmVxKi8gPSB0cmVlW24gKiAyXS8qLkZyZXEqLyArIHRyZWVbbSAqIDJdLyouRnJlcSovOwogICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgdHJlZVtuICogMiArIDFdLyouRGFkKi8gPSB0cmVlW20gKiAyICsgMV0vKi5EYWQqLyA9IG5vZGU7CgogICAgLyogYW5kIGluc2VydCB0aGUgbmV3IG5vZGUgaW4gdGhlIGhlYXAgKi8KICAgIHMuaGVhcFsxLypTTUFMTEVTVCovXSA9IG5vZGUrKzsKICAgIHBxZG93bmhlYXAocywgdHJlZSwgMS8qU01BTExFU1QqLyk7CgogIH0gd2hpbGUgKHMuaGVhcF9sZW4gPj0gMik7CgogIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOwoKICAvKiBBdCB0aGlzIHBvaW50LCB0aGUgZmllbGRzIGZyZXEgYW5kIGRhZCBhcmUgc2V0LiBXZSBjYW4gbm93CiAgICogZ2VuZXJhdGUgdGhlIGJpdCBsZW5ndGhzLgogICAqLwogIGdlbl9iaXRsZW4ocywgZGVzYyk7CgogIC8qIFRoZSBmaWVsZCBsZW4gaXMgbm93IHNldCwgd2UgY2FuIGdlbmVyYXRlIHRoZSBiaXQgY29kZXMgKi8KICBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIHMuYmxfY291bnQpOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBTY2FuIGEgbGl0ZXJhbCBvciBkaXN0YW5jZSB0cmVlIHRvIGRldGVybWluZSB0aGUgZnJlcXVlbmNpZXMgb2YgdGhlIGNvZGVzCiAqIGluIHRoZSBiaXQgbGVuZ3RoIHRyZWUuCiAqLwpjb25zdCBzY2FuX3RyZWUgPSAocywgdHJlZSwgbWF4X2NvZGUpID0+Ci8vICAgIGRlZmxhdGVfc3RhdGUgKnM7Ci8vICAgIGN0X2RhdGEgKnRyZWU7ICAgLyogdGhlIHRyZWUgdG8gYmUgc2Nhbm5lZCAqLwovLyAgICBpbnQgbWF4X2NvZGU7ICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwp7CiAgbGV0IG47ICAgICAgICAgICAgICAgICAgICAgLyogaXRlcmF0ZXMgb3ZlciBhbGwgdHJlZSBlbGVtZW50cyAqLwogIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICBsZXQgY3VybGVuOyAgICAgICAgICAgICAgICAvKiBsZW5ndGggb2YgY3VycmVudCBjb2RlICovCgogIGxldCBuZXh0bGVuID0gdHJlZVswICogMiArIDFdLyouTGVuKi87IC8qIGxlbmd0aCBvZiBuZXh0IGNvZGUgKi8KCiAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICBsZXQgbWF4X2NvdW50ID0gNzsgICAgICAgICAvKiBtYXggcmVwZWF0IGNvdW50ICovCiAgbGV0IG1pbl9jb3VudCA9IDQ7ICAgICAgICAgLyogbWluIHJlcGVhdCBjb3VudCAqLwoKICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgbWF4X2NvdW50ID0gMTM4OwogICAgbWluX2NvdW50ID0gMzsKICB9CiAgdHJlZVsobWF4X2NvZGUgKyAxKSAqIDIgKyAxXS8qLkxlbiovID0gMHhmZmZmOyAvKiBndWFyZCAqLwoKICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICBuZXh0bGVuID0gdHJlZVsobiArIDEpICogMiArIDFdLyouTGVuKi87CgogICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgIGNvbnRpbnVlOwoKICAgIH0gZWxzZSBpZiAoY291bnQgPCBtaW5fY291bnQpIHsKICAgICAgcy5ibF90cmVlW2N1cmxlbiAqIDJdLyouRnJlcSovICs9IGNvdW50OwoKICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CgogICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7IHMuYmxfdHJlZVtjdXJsZW4gKiAyXS8qLkZyZXEqLysrOyB9CiAgICAgIHMuYmxfdHJlZVtSRVBfM182ICogMl0vKi5GcmVxKi8rKzsKCiAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgIHMuYmxfdHJlZVtSRVBaXzNfMTAgKiAyXS8qLkZyZXEqLysrOwoKICAgIH0gZWxzZSB7CiAgICAgIHMuYmxfdHJlZVtSRVBaXzExXzEzOCAqIDJdLyouRnJlcSovKys7CiAgICB9CgogICAgY291bnQgPSAwOwogICAgcHJldmxlbiA9IGN1cmxlbjsKCiAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgfSBlbHNlIGlmIChjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgbWF4X2NvdW50ID0gNjsKICAgICAgbWluX2NvdW50ID0gMzsKCiAgICB9IGVsc2UgewogICAgICBtYXhfY291bnQgPSA3OwogICAgICBtaW5fY291bnQgPSA0OwogICAgfQogIH0KfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogU2VuZCBhIGxpdGVyYWwgb3IgZGlzdGFuY2UgdHJlZSBpbiBjb21wcmVzc2VkIGZvcm0sIHVzaW5nIHRoZSBjb2RlcyBpbgogKiBibF90cmVlLgogKi8KY29uc3Qgc2VuZF90cmVlID0gKHMsIHRyZWUsIG1heF9jb2RlKSA9PgovLyAgICBkZWZsYXRlX3N0YXRlICpzOwovLyAgICBjdF9kYXRhICp0cmVlOyAvKiB0aGUgdHJlZSB0byBiZSBzY2FubmVkICovCi8vICAgIGludCBtYXhfY29kZTsgICAgICAgLyogYW5kIGl0cyBsYXJnZXN0IGNvZGUgb2Ygbm9uIHplcm8gZnJlcXVlbmN5ICovCnsKICBsZXQgbjsgICAgICAgICAgICAgICAgICAgICAvKiBpdGVyYXRlcyBvdmVyIGFsbCB0cmVlIGVsZW1lbnRzICovCiAgbGV0IHByZXZsZW4gPSAtMTsgICAgICAgICAgLyogbGFzdCBlbWl0dGVkIGxlbmd0aCAqLwogIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgbGV0IG5leHRsZW4gPSB0cmVlWzAgKiAyICsgMV0vKi5MZW4qLzsgLyogbGVuZ3RoIG9mIG5leHQgY29kZSAqLwoKICBsZXQgY291bnQgPSAwOyAgICAgICAgICAgICAvKiByZXBlYXQgY291bnQgb2YgdGhlIGN1cnJlbnQgY29kZSAqLwogIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICBsZXQgbWluX2NvdW50ID0gNDsgICAgICAgICAvKiBtaW4gcmVwZWF0IGNvdW50ICovCgogIC8qIHRyZWVbbWF4X2NvZGUrMV0uTGVuID0gLTE7ICovICAvKiBndWFyZCBhbHJlYWR5IHNldCAqLwogIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICBtYXhfY291bnQgPSAxMzg7CiAgICBtaW5fY291bnQgPSAzOwogIH0KCiAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICBjdXJsZW4gPSBuZXh0bGVuOwogICAgbmV4dGxlbiA9IHRyZWVbKG4gKyAxKSAqIDIgKyAxXS8qLkxlbiovOwoKICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICBjb250aW51ZTsKCiAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgIGRvIHsgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsgfSB3aGlsZSAoLS1jb3VudCAhPT0gMCk7CgogICAgfSBlbHNlIGlmIChjdXJsZW4gIT09IDApIHsKICAgICAgaWYgKGN1cmxlbiAhPT0gcHJldmxlbikgewogICAgICAgIHNlbmRfY29kZShzLCBjdXJsZW4sIHMuYmxfdHJlZSk7CiAgICAgICAgY291bnQtLTsKICAgICAgfQogICAgICAvL0Fzc2VydChjb3VudCA+PSAzICYmIGNvdW50IDw9IDYsICIgM182PyIpOwogICAgICBzZW5kX2NvZGUocywgUkVQXzNfNiwgcy5ibF90cmVlKTsKICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CgogICAgfSBlbHNlIGlmIChjb3VudCA8PSAxMCkgewogICAgICBzZW5kX2NvZGUocywgUkVQWl8zXzEwLCBzLmJsX3RyZWUpOwogICAgICBzZW5kX2JpdHMocywgY291bnQgLSAzLCAzKTsKCiAgICB9IGVsc2UgewogICAgICBzZW5kX2NvZGUocywgUkVQWl8xMV8xMzgsIHMuYmxfdHJlZSk7CiAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDExLCA3KTsKICAgIH0KCiAgICBjb3VudCA9IDA7CiAgICBwcmV2bGVuID0gY3VybGVuOwogICAgaWYgKG5leHRsZW4gPT09IDApIHsKICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICBtaW5fY291bnQgPSAzOwoKICAgIH0gZWxzZSBpZiAoY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgfSBlbHNlIHsKICAgICAgbWF4X2NvdW50ID0gNzsKICAgICAgbWluX2NvdW50ID0gNDsKICAgIH0KICB9Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvbnN0cnVjdCB0aGUgSHVmZm1hbiB0cmVlIGZvciB0aGUgYml0IGxlbmd0aHMgYW5kIHJldHVybiB0aGUgaW5kZXggaW4KICogYmxfb3JkZXIgb2YgdGhlIGxhc3QgYml0IGxlbmd0aCBjb2RlIHRvIHNlbmQuCiAqLwpjb25zdCBidWlsZF9ibF90cmVlID0gKHMpID0+IHsKCiAgbGV0IG1heF9ibGluZGV4OyAgLyogaW5kZXggb2YgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgb2Ygbm9uIHplcm8gZnJlcSAqLwoKICAvKiBEZXRlcm1pbmUgdGhlIGJpdCBsZW5ndGggZnJlcXVlbmNpZXMgZm9yIGxpdGVyYWwgYW5kIGRpc3RhbmNlIHRyZWVzICovCiAgc2Nhbl90cmVlKHMsIHMuZHluX2x0cmVlLCBzLmxfZGVzYy5tYXhfY29kZSk7CiAgc2Nhbl90cmVlKHMsIHMuZHluX2R0cmVlLCBzLmRfZGVzYy5tYXhfY29kZSk7CgogIC8qIEJ1aWxkIHRoZSBiaXQgbGVuZ3RoIHRyZWU6ICovCiAgYnVpbGRfdHJlZShzLCBzLmJsX2Rlc2MpOwogIC8qIG9wdF9sZW4gbm93IGluY2x1ZGVzIHRoZSBsZW5ndGggb2YgdGhlIHRyZWUgcmVwcmVzZW50YXRpb25zLCBleGNlcHQKICAgKiB0aGUgbGVuZ3RocyBvZiB0aGUgYml0IGxlbmd0aHMgY29kZXMgYW5kIHRoZSA1KzUrNCBiaXRzIGZvciB0aGUgY291bnRzLgogICAqLwoKICAvKiBEZXRlcm1pbmUgdGhlIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzIHRvIHNlbmQuIFRoZSBwa3ppcCBmb3JtYXQKICAgKiByZXF1aXJlcyB0aGF0IGF0IGxlYXN0IDQgYml0IGxlbmd0aCBjb2RlcyBiZSBzZW50LiAoYXBwbm90ZS50eHQgc2F5cwogICAqIDMgYnV0IHRoZSBhY3R1YWwgdmFsdWUgdXNlZCBpcyA0LikKICAgKi8KICBmb3IgKG1heF9ibGluZGV4ID0gQkxfQ09ERVMkMSAtIDE7IG1heF9ibGluZGV4ID49IDM7IG1heF9ibGluZGV4LS0pIHsKICAgIGlmIChzLmJsX3RyZWVbYmxfb3JkZXJbbWF4X2JsaW5kZXhdICogMiArIDFdLyouTGVuKi8gIT09IDApIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIC8qIFVwZGF0ZSBvcHRfbGVuIHRvIGluY2x1ZGUgdGhlIGJpdCBsZW5ndGggdHJlZSBhbmQgY291bnRzICovCiAgcy5vcHRfbGVuICs9IDMgKiAobWF4X2JsaW5kZXggKyAxKSArIDUgKyA1ICsgNDsKICAvL1RyYWNldigoc3RkZXJyLCAiXG5keW4gdHJlZXM6IGR5biAlbGQsIHN0YXQgJWxkIiwKICAvLyAgICAgICAgcy0+b3B0X2xlbiwgcy0+c3RhdGljX2xlbikpOwoKICByZXR1cm4gbWF4X2JsaW5kZXg7Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIFNlbmQgdGhlIGhlYWRlciBmb3IgYSBibG9jayB1c2luZyBkeW5hbWljIEh1ZmZtYW4gdHJlZXM6IHRoZSBjb3VudHMsIHRoZQogKiBsZW5ndGhzIG9mIHRoZSBiaXQgbGVuZ3RoIGNvZGVzLCB0aGUgbGl0ZXJhbCB0cmVlIGFuZCB0aGUgZGlzdGFuY2UgdHJlZS4KICogSU4gYXNzZXJ0aW9uOiBsY29kZXMgPj0gMjU3LCBkY29kZXMgPj0gMSwgYmxjb2RlcyA+PSA0LgogKi8KY29uc3Qgc2VuZF9hbGxfdHJlZXMgPSAocywgbGNvZGVzLCBkY29kZXMsIGJsY29kZXMpID0+Ci8vICAgIGRlZmxhdGVfc3RhdGUgKnM7Ci8vICAgIGludCBsY29kZXMsIGRjb2RlcywgYmxjb2RlczsgLyogbnVtYmVyIG9mIGNvZGVzIGZvciBlYWNoIHRyZWUgKi8KewogIGxldCByYW5rOyAgICAgICAgICAgICAgICAgICAgLyogaW5kZXggaW4gYmxfb3JkZXIgKi8KCiAgLy9Bc3NlcnQgKGxjb2RlcyA+PSAyNTcgJiYgZGNvZGVzID49IDEgJiYgYmxjb2RlcyA+PSA0LCAibm90IGVub3VnaCBjb2RlcyIpOwogIC8vQXNzZXJ0IChsY29kZXMgPD0gTF9DT0RFUyAmJiBkY29kZXMgPD0gRF9DT0RFUyAmJiBibGNvZGVzIDw9IEJMX0NPREVTLAogIC8vICAgICAgICAidG9vIG1hbnkgY29kZXMiKTsKICAvL1RyYWNldigoc3RkZXJyLCAiXG5ibCBjb3VudHM6ICIpKTsKICBzZW5kX2JpdHMocywgbGNvZGVzIC0gMjU3LCA1KTsgLyogbm90ICsyNTUgYXMgc3RhdGVkIGluIGFwcG5vdGUudHh0ICovCiAgc2VuZF9iaXRzKHMsIGRjb2RlcyAtIDEsICAgNSk7CiAgc2VuZF9iaXRzKHMsIGJsY29kZXMgLSA0LCAgNCk7IC8qIG5vdCAtMyBhcyBzdGF0ZWQgaW4gYXBwbm90ZS50eHQgKi8KICBmb3IgKHJhbmsgPSAwOyByYW5rIDwgYmxjb2RlczsgcmFuaysrKSB7CiAgICAvL1RyYWNldigoc3RkZXJyLCAiXG5ibCBjb2RlICUyZCAiLCBibF9vcmRlcltyYW5rXSkpOwogICAgc2VuZF9iaXRzKHMsIHMuYmxfdHJlZVtibF9vcmRlcltyYW5rXSAqIDIgKyAxXS8qLkxlbiovLCAzKTsKICB9CiAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuYmwgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKCiAgc2VuZF90cmVlKHMsIHMuZHluX2x0cmVlLCBsY29kZXMgLSAxKTsgLyogbGl0ZXJhbCB0cmVlICovCiAgLy9UcmFjZXYoKHN0ZGVyciwgIlxubGl0IHRyZWU6IHNlbnQgJWxkIiwgcy0+Yml0c19zZW50KSk7CgogIHNlbmRfdHJlZShzLCBzLmR5bl9kdHJlZSwgZGNvZGVzIC0gMSk7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICAvL1RyYWNldigoc3RkZXJyLCAiXG5kaXN0IHRyZWU6IHNlbnQgJWxkIiwgcy0+Yml0c19zZW50KSk7Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENoZWNrIGlmIHRoZSBkYXRhIHR5cGUgaXMgVEVYVCBvciBCSU5BUlksIHVzaW5nIHRoZSBmb2xsb3dpbmcgYWxnb3JpdGhtOgogKiAtIFRFWFQgaWYgdGhlIHR3byBjb25kaXRpb25zIGJlbG93IGFyZSBzYXRpc2ZpZWQ6CiAqICAgIGEpIFRoZXJlIGFyZSBubyBub24tcG9ydGFibGUgY29udHJvbCBjaGFyYWN0ZXJzIGJlbG9uZ2luZyB0byB0aGUKICogICAgICAgImJsYWNrIGxpc3QiICgwLi42LCAxNC4uMjUsIDI4Li4zMSkuCiAqICAgIGIpIFRoZXJlIGlzIGF0IGxlYXN0IG9uZSBwcmludGFibGUgY2hhcmFjdGVyIGJlbG9uZ2luZyB0byB0aGUKICogICAgICAgIndoaXRlIGxpc3QiICg5IHtUQUJ9LCAxMCB7TEZ9LCAxMyB7Q1J9LCAzMi4uMjU1KS4KICogLSBCSU5BUlkgb3RoZXJ3aXNlLgogKiAtIFRoZSBmb2xsb3dpbmcgcGFydGlhbGx5LXBvcnRhYmxlIGNvbnRyb2wgY2hhcmFjdGVycyBmb3JtIGEKICogICAiZ3JheSBsaXN0IiB0aGF0IGlzIGlnbm9yZWQgaW4gdGhpcyBkZXRlY3Rpb24gYWxnb3JpdGhtOgogKiAgICg3IHtCRUx9LCA4IHtCU30sIDExIHtWVH0sIDEyIHtGRn0sIDI2IHtTVUJ9LCAyNyB7RVNDfSkuCiAqIElOIGFzc2VydGlvbjogdGhlIGZpZWxkcyBGcmVxIG9mIGR5bl9sdHJlZSBhcmUgc2V0LgogKi8KY29uc3QgZGV0ZWN0X2RhdGFfdHlwZSA9IChzKSA9PiB7CiAgLyogYmxhY2tfbWFzayBpcyB0aGUgYml0IG1hc2sgb2YgYmxhY2stbGlzdGVkIGJ5dGVzCiAgICogc2V0IGJpdHMgMC4uNiwgMTQuLjI1LCBhbmQgMjguLjMxCiAgICogMHhmM2ZmYzA3ZiA9IGJpbmFyeSAxMTExMDAxMTExMTExMTExMTEwMDAwMDAwMTExMTExMQogICAqLwogIGxldCBibGFja19tYXNrID0gMHhmM2ZmYzA3ZjsKICBsZXQgbjsKCiAgLyogQ2hlY2sgZm9yIG5vbi10ZXh0dWFsICgiYmxhY2stbGlzdGVkIikgYnl0ZXMuICovCiAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgaWYgKChibGFja19tYXNrICYgMSkgJiYgKHMuZHluX2x0cmVlW24gKiAyXS8qLkZyZXEqLyAhPT0gMCkpIHsKICAgICAgcmV0dXJuIFpfQklOQVJZOwogICAgfQogIH0KCiAgLyogQ2hlY2sgZm9yIHRleHR1YWwgKCJ3aGl0ZS1saXN0ZWQiKSBieXRlcy4gKi8KICBpZiAocy5keW5fbHRyZWVbOSAqIDJdLyouRnJlcSovICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0vKi5GcmVxKi8gIT09IDAgfHwKICAgICAgcy5keW5fbHRyZWVbMTMgKiAyXS8qLkZyZXEqLyAhPT0gMCkgewogICAgcmV0dXJuIFpfVEVYVDsKICB9CiAgZm9yIChuID0gMzI7IG4gPCBMSVRFUkFMUyQxOyBuKyspIHsKICAgIGlmIChzLmR5bl9sdHJlZVtuICogMl0vKi5GcmVxKi8gIT09IDApIHsKICAgICAgcmV0dXJuIFpfVEVYVDsKICAgIH0KICB9CgogIC8qIFRoZXJlIGFyZSBubyAiYmxhY2stbGlzdGVkIiBvciAid2hpdGUtbGlzdGVkIiBieXRlczoKICAgKiB0aGlzIHN0cmVhbSBlaXRoZXIgaXMgZW1wdHkgb3IgaGFzIHRvbGVyYXRlZCAoImdyYXktbGlzdGVkIikgYnl0ZXMgb25seS4KICAgKi8KICByZXR1cm4gWl9CSU5BUlk7Cn07CgoKbGV0IHN0YXRpY19pbml0X2RvbmUgPSBmYWxzZTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBJbml0aWFsaXplIHRoZSB0cmVlIGRhdGEgc3RydWN0dXJlcyBmb3IgYSBuZXcgemxpYiBzdHJlYW0uCiAqLwpjb25zdCBfdHJfaW5pdCQxID0gKHMpID0+CnsKCiAgaWYgKCFzdGF0aWNfaW5pdF9kb25lKSB7CiAgICB0cl9zdGF0aWNfaW5pdCgpOwogICAgc3RhdGljX2luaXRfZG9uZSA9IHRydWU7CiAgfQoKICBzLmxfZGVzYyAgPSBuZXcgVHJlZURlc2Mocy5keW5fbHRyZWUsIHN0YXRpY19sX2Rlc2MpOwogIHMuZF9kZXNjICA9IG5ldyBUcmVlRGVzYyhzLmR5bl9kdHJlZSwgc3RhdGljX2RfZGVzYyk7CiAgcy5ibF9kZXNjID0gbmV3IFRyZWVEZXNjKHMuYmxfdHJlZSwgc3RhdGljX2JsX2Rlc2MpOwoKICBzLmJpX2J1ZiA9IDA7CiAgcy5iaV92YWxpZCA9IDA7CgogIC8qIEluaXRpYWxpemUgdGhlIGZpcnN0IGJsb2NrIG9mIHRoZSBmaXJzdCBmaWxlOiAqLwogIGluaXRfYmxvY2socyk7Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIFNlbmQgYSBzdG9yZWQgYmxvY2sKICovCmNvbnN0IF90cl9zdG9yZWRfYmxvY2skMSA9IChzLCBidWYsIHN0b3JlZF9sZW4sIGxhc3QpID0+Ci8vRGVmbGF0ZVN0YXRlICpzOwovL2NoYXJmICpidWY7ICAgICAgIC8qIGlucHV0IGJsb2NrICovCi8vdWxnIHN0b3JlZF9sZW47ICAgLyogbGVuZ3RoIG9mIGlucHV0IGJsb2NrICovCi8vaW50IGxhc3Q7ICAgICAgICAgLyogb25lIGlmIHRoaXMgaXMgdGhlIGxhc3QgYmxvY2sgZm9yIGEgZmlsZSAqLwp7CiAgc2VuZF9iaXRzKHMsIChTVE9SRURfQkxPQ0sgPDwgMSkgKyAobGFzdCA/IDEgOiAwKSwgMyk7ICAgIC8qIHNlbmQgYmxvY2sgdHlwZSAqLwogIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsgLyogd2l0aCBoZWFkZXIgKi8KfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogU2VuZCBvbmUgZW1wdHkgc3RhdGljIGJsb2NrIHRvIGdpdmUgZW5vdWdoIGxvb2thaGVhZCBmb3IgaW5mbGF0ZS4KICogVGhpcyB0YWtlcyAxMCBiaXRzLCBvZiB3aGljaCA3IG1heSByZW1haW4gaW4gdGhlIGJpdCBidWZmZXIuCiAqLwpjb25zdCBfdHJfYWxpZ24kMSA9IChzKSA9PiB7CiAgc2VuZF9iaXRzKHMsIFNUQVRJQ19UUkVFUyA8PCAxLCAzKTsKICBzZW5kX2NvZGUocywgRU5EX0JMT0NLLCBzdGF0aWNfbHRyZWUpOwogIGJpX2ZsdXNoKHMpOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBEZXRlcm1pbmUgdGhlIGJlc3QgZW5jb2RpbmcgZm9yIHRoZSBjdXJyZW50IGJsb2NrOiBkeW5hbWljIHRyZWVzLCBzdGF0aWMKICogdHJlZXMgb3Igc3RvcmUsIGFuZCBvdXRwdXQgdGhlIGVuY29kZWQgYmxvY2sgdG8gdGhlIHppcCBmaWxlLgogKi8KY29uc3QgX3RyX2ZsdXNoX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgovL0RlZmxhdGVTdGF0ZSAqczsKLy9jaGFyZiAqYnVmOyAgICAgICAvKiBpbnB1dCBibG9jaywgb3IgTlVMTCBpZiB0b28gb2xkICovCi8vdWxnIHN0b3JlZF9sZW47ICAgLyogbGVuZ3RoIG9mIGlucHV0IGJsb2NrICovCi8vaW50IGxhc3Q7ICAgICAgICAgLyogb25lIGlmIHRoaXMgaXMgdGhlIGxhc3QgYmxvY2sgZm9yIGEgZmlsZSAqLwp7CiAgbGV0IG9wdF9sZW5iLCBzdGF0aWNfbGVuYjsgIC8qIG9wdF9sZW4gYW5kIHN0YXRpY19sZW4gaW4gYnl0ZXMgKi8KICBsZXQgbWF4X2JsaW5kZXggPSAwOyAgICAgICAgLyogaW5kZXggb2YgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgb2Ygbm9uIHplcm8gZnJlcSAqLwoKICAvKiBCdWlsZCB0aGUgSHVmZm1hbiB0cmVlcyB1bmxlc3MgYSBzdG9yZWQgYmxvY2sgaXMgZm9yY2VkICovCiAgaWYgKHMubGV2ZWwgPiAwKSB7CgogICAgLyogQ2hlY2sgaWYgdGhlIGZpbGUgaXMgYmluYXJ5IG9yIHRleHQgKi8KICAgIGlmIChzLnN0cm0uZGF0YV90eXBlID09PSBaX1VOS05PV04kMSkgewogICAgICBzLnN0cm0uZGF0YV90eXBlID0gZGV0ZWN0X2RhdGFfdHlwZShzKTsKICAgIH0KCiAgICAvKiBDb25zdHJ1Y3QgdGhlIGxpdGVyYWwgYW5kIGRpc3RhbmNlIHRyZWVzICovCiAgICBidWlsZF90cmVlKHMsIHMubF9kZXNjKTsKICAgIC8vIFRyYWNldigoc3RkZXJyLCAiXG5saXQgZGF0YTogZHluICVsZCwgc3RhdCAlbGQiLCBzLT5vcHRfbGVuLAogICAgLy8gICAgICAgIHMtPnN0YXRpY19sZW4pKTsKCiAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgIC8vIFRyYWNldigoc3RkZXJyLCAiXG5kaXN0IGRhdGE6IGR5biAlbGQsIHN0YXQgJWxkIiwgcy0+b3B0X2xlbiwKICAgIC8vICAgICAgICBzLT5zdGF0aWNfbGVuKSk7CiAgICAvKiBBdCB0aGlzIHBvaW50LCBvcHRfbGVuIGFuZCBzdGF0aWNfbGVuIGFyZSB0aGUgdG90YWwgYml0IGxlbmd0aHMgb2YKICAgICAqIHRoZSBjb21wcmVzc2VkIGJsb2NrIGRhdGEsIGV4Y2x1ZGluZyB0aGUgdHJlZSByZXByZXNlbnRhdGlvbnMuCiAgICAgKi8KCiAgICAvKiBCdWlsZCB0aGUgYml0IGxlbmd0aCB0cmVlIGZvciB0aGUgYWJvdmUgdHdvIHRyZWVzLCBhbmQgZ2V0IHRoZSBpbmRleAogICAgICogaW4gYmxfb3JkZXIgb2YgdGhlIGxhc3QgYml0IGxlbmd0aCBjb2RlIHRvIHNlbmQuCiAgICAgKi8KICAgIG1heF9ibGluZGV4ID0gYnVpbGRfYmxfdHJlZShzKTsKCiAgICAvKiBEZXRlcm1pbmUgdGhlIGJlc3QgZW5jb2RpbmcuIENvbXB1dGUgdGhlIGJsb2NrIGxlbmd0aHMgaW4gYnl0ZXMuICovCiAgICBvcHRfbGVuYiA9IChzLm9wdF9sZW4gKyAzICsgNykgPj4+IDM7CiAgICBzdGF0aWNfbGVuYiA9IChzLnN0YXRpY19sZW4gKyAzICsgNykgPj4+IDM7CgogICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbm9wdCAlbHUoJWx1KSBzdGF0ICVsdSglbHUpIHN0b3JlZCAlbHUgbGl0ICV1ICIsCiAgICAvLyAgICAgICAgb3B0X2xlbmIsIHMtPm9wdF9sZW4sIHN0YXRpY19sZW5iLCBzLT5zdGF0aWNfbGVuLCBzdG9yZWRfbGVuLAogICAgLy8gICAgICAgIHMtPmxhc3RfbGl0KSk7CgogICAgaWYgKHN0YXRpY19sZW5iIDw9IG9wdF9sZW5iKSB7IG9wdF9sZW5iID0gc3RhdGljX2xlbmI7IH0KCiAgfSBlbHNlIHsKICAgIC8vIEFzc2VydChidWYgIT0gKGNoYXIqKTAsICJsb3N0IGJ1ZiIpOwogICAgb3B0X2xlbmIgPSBzdGF0aWNfbGVuYiA9IHN0b3JlZF9sZW4gKyA1OyAvKiBmb3JjZSBhIHN0b3JlZCBibG9jayAqLwogIH0KCiAgaWYgKChzdG9yZWRfbGVuICsgNCA8PSBvcHRfbGVuYikgJiYgKGJ1ZiAhPT0gLTEpKSB7CiAgICAvKiA0OiB0d28gd29yZHMgZm9yIHRoZSBsZW5ndGhzICovCgogICAgLyogVGhlIHRlc3QgYnVmICE9IE5VTEwgaXMgb25seSBuZWNlc3NhcnkgaWYgTElUX0JVRlNJWkUgPiBXU0laRS4KICAgICAqIE90aGVyd2lzZSB3ZSBjYW4ndCBoYXZlIHByb2Nlc3NlZCBtb3JlIHRoYW4gV1NJWkUgaW5wdXQgYnl0ZXMgc2luY2UKICAgICAqIHRoZSBsYXN0IGJsb2NrIGZsdXNoLCBiZWNhdXNlIGNvbXByZXNzaW9uIHdvdWxkIGhhdmUgYmVlbgogICAgICogc3VjY2Vzc2Z1bC4gSWYgTElUX0JVRlNJWkUgPD0gV1NJWkUsIGl0IGlzIG5ldmVyIHRvbyBsYXRlIHRvCiAgICAgKiB0cmFuc2Zvcm0gYSBibG9jayBpbnRvIGEgc3RvcmVkIGJsb2NrLgogICAgICovCiAgICBfdHJfc3RvcmVkX2Jsb2NrJDEocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KTsKCiAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEJDEgfHwgc3RhdGljX2xlbmIgPT09IG9wdF9sZW5iKSB7CgogICAgc2VuZF9iaXRzKHMsIChTVEFUSUNfVFJFRVMgPDwgMSkgKyAobGFzdCA/IDEgOiAwKSwgMyk7CiAgICBjb21wcmVzc19ibG9jayhzLCBzdGF0aWNfbHRyZWUsIHN0YXRpY19kdHJlZSk7CgogIH0gZWxzZSB7CiAgICBzZW5kX2JpdHMocywgKERZTl9UUkVFUyA8PCAxKSArIChsYXN0ID8gMSA6IDApLCAzKTsKICAgIHNlbmRfYWxsX3RyZWVzKHMsIHMubF9kZXNjLm1heF9jb2RlICsgMSwgcy5kX2Rlc2MubWF4X2NvZGUgKyAxLCBtYXhfYmxpbmRleCArIDEpOwogICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICB9CiAgLy8gQXNzZXJ0IChzLT5jb21wcmVzc2VkX2xlbiA9PSBzLT5iaXRzX3NlbnQsICJiYWQgY29tcHJlc3NlZCBzaXplIik7CiAgLyogVGhlIGFib3ZlIGNoZWNrIGlzIG1hZGUgbW9kIDJeMzIsIGZvciBmaWxlcyBsYXJnZXIgdGhhbiA1MTIgTUIKICAgKiBhbmQgdUxvbmcgaW1wbGVtZW50ZWQgb24gMzIgYml0cy4KICAgKi8KICBpbml0X2Jsb2NrKHMpOwoKICBpZiAobGFzdCkgewogICAgYmlfd2luZHVwKHMpOwogIH0KICAvLyBUcmFjZXYoKHN0ZGVyciwiXG5jb21wcmxlbiAlbHUoJWx1KSAiLCBzLT5jb21wcmVzc2VkX2xlbj4+MywKICAvLyAgICAgICBzLT5jb21wcmVzc2VkX2xlbi03Kmxhc3QpKTsKfTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBTYXZlIHRoZSBtYXRjaCBpbmZvIGFuZCB0YWxseSB0aGUgZnJlcXVlbmN5IGNvdW50cy4gUmV0dXJuIHRydWUgaWYKICogdGhlIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkLgogKi8KY29uc3QgX3RyX3RhbGx5JDEgPSAocywgZGlzdCwgbGMpID0+Ci8vICAgIGRlZmxhdGVfc3RhdGUgKnM7Ci8vICAgIHVuc2lnbmVkIGRpc3Q7ICAvKiBkaXN0YW5jZSBvZiBtYXRjaGVkIHN0cmluZyAqLwovLyAgICB1bnNpZ25lZCBsYzsgICAgLyogbWF0Y2ggbGVuZ3RoLU1JTl9NQVRDSCBvciB1bm1hdGNoZWQgY2hhciAoaWYgZGlzdD09MCkgKi8KewogIC8vbGV0IG91dF9sZW5ndGgsIGluX2xlbmd0aCwgZGNvZGU7CgogIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyXSAgICAgPSAoZGlzdCA+Pj4gOCkgJiAweGZmOwogIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyICsgMV0gPSBkaXN0ICYgMHhmZjsKCiAgcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgcy5sYXN0X2xpdF0gPSBsYyAmIDB4ZmY7CiAgcy5sYXN0X2xpdCsrOwoKICBpZiAoZGlzdCA9PT0gMCkgewogICAgLyogbGMgaXMgdGhlIHVubWF0Y2hlZCBjaGFyICovCiAgICBzLmR5bl9sdHJlZVtsYyAqIDJdLyouRnJlcSovKys7CiAgfSBlbHNlIHsKICAgIHMubWF0Y2hlcysrOwogICAgLyogSGVyZSwgbGMgaXMgdGhlIG1hdGNoIGxlbmd0aCAtIE1JTl9NQVRDSCAqLwogICAgZGlzdC0tOyAgICAgICAgICAgICAvKiBkaXN0ID0gbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAvL0Fzc2VydCgodXNoKWRpc3QgPCAodXNoKU1BWF9ESVNUKHMpICYmCiAgICAvLyAgICAgICAodXNoKWxjIDw9ICh1c2gpKE1BWF9NQVRDSC1NSU5fTUFUQ0gpICYmCiAgICAvLyAgICAgICAodXNoKWRfY29kZShkaXN0KSA8ICh1c2gpRF9DT0RFUywgICJfdHJfdGFsbHk6IGJhZCBtYXRjaCIpOwoKICAgIHMuZHluX2x0cmVlWyhfbGVuZ3RoX2NvZGVbbGNdICsgTElURVJBTFMkMSArIDEpICogMl0vKi5GcmVxKi8rKzsKICAgIHMuZHluX2R0cmVlW2RfY29kZShkaXN0KSAqIDJdLyouRnJlcSovKys7CiAgfQoKLy8gKCEpIFRoaXMgYmxvY2sgaXMgZGlzYWJsZWQgaW4gemxpYiBkZWZhdWx0cywKLy8gZG9uJ3QgZW5hYmxlIGl0IGZvciBiaW5hcnkgY29tcGF0aWJpbGl0eQoKLy8jaWZkZWYgVFJVTkNBVEVfQkxPQ0sKLy8gIC8qIFRyeSB0byBndWVzcyBpZiBpdCBpcyBwcm9maXRhYmxlIHRvIHN0b3AgdGhlIGN1cnJlbnQgYmxvY2sgaGVyZSAqLwovLyAgaWYgKChzLmxhc3RfbGl0ICYgMHgxZmZmKSA9PT0gMCAmJiBzLmxldmVsID4gMikgewovLyAgICAvKiBDb21wdXRlIGFuIHVwcGVyIGJvdW5kIGZvciB0aGUgY29tcHJlc3NlZCBsZW5ndGggKi8KLy8gICAgb3V0X2xlbmd0aCA9IHMubGFzdF9saXQqODsKLy8gICAgaW5fbGVuZ3RoID0gcy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQ7Ci8vCi8vICAgIGZvciAoZGNvZGUgPSAwOyBkY29kZSA8IERfQ09ERVM7IGRjb2RlKyspIHsKLy8gICAgICBvdXRfbGVuZ3RoICs9IHMuZHluX2R0cmVlW2Rjb2RlKjJdLyouRnJlcSovICogKDUgKyBleHRyYV9kYml0c1tkY29kZV0pOwovLyAgICB9Ci8vICAgIG91dF9sZW5ndGggPj4+PSAzOwovLyAgICAvL1RyYWNldigoc3RkZXJyLCJcbmxhc3RfbGl0ICV1LCBpbiAlbGQsIG91dCB+JWxkKCVsZCUlKSAiLAovLyAgICAvLyAgICAgICBzLT5sYXN0X2xpdCwgaW5fbGVuZ3RoLCBvdXRfbGVuZ3RoLAovLyAgICAvLyAgICAgICAxMDBMIC0gb3V0X2xlbmd0aCoxMDBML2luX2xlbmd0aCkpOwovLyAgICBpZiAocy5tYXRjaGVzIDwgKHMubGFzdF9saXQ+PjEpLyppbnQgLzIqLyAmJiBvdXRfbGVuZ3RoIDwgKGluX2xlbmd0aD4+MSkvKmludCAvMiovKSB7Ci8vICAgICAgcmV0dXJuIHRydWU7Ci8vICAgIH0KLy8gIH0KLy8jZW5kaWYKCiAgcmV0dXJuIChzLmxhc3RfbGl0ID09PSBzLmxpdF9idWZzaXplIC0gMSk7CiAgLyogV2UgYXZvaWQgZXF1YWxpdHkgd2l0aCBsaXRfYnVmc2l6ZSBiZWNhdXNlIG9mIHdyYXBhcm91bmQgYXQgNjRLCiAgICogb24gMTYgYml0IG1hY2hpbmVzIGFuZCBiZWNhdXNlIHN0b3JlZCBibG9ja3MgYXJlIHJlc3RyaWN0ZWQgdG8KICAgKiA2NEstMSBieXRlcy4KICAgKi8KfTsKCnZhciBfdHJfaW5pdF8xICA9IF90cl9pbml0JDE7CnZhciBfdHJfc3RvcmVkX2Jsb2NrXzEgPSBfdHJfc3RvcmVkX2Jsb2NrJDE7CnZhciBfdHJfZmx1c2hfYmxvY2tfMSAgPSBfdHJfZmx1c2hfYmxvY2skMTsKdmFyIF90cl90YWxseV8xID0gX3RyX3RhbGx5JDE7CnZhciBfdHJfYWxpZ25fMSA9IF90cl9hbGlnbiQxOwoKdmFyIHRyZWVzID0gewoJX3RyX2luaXQ6IF90cl9pbml0XzEsCglfdHJfc3RvcmVkX2Jsb2NrOiBfdHJfc3RvcmVkX2Jsb2NrXzEsCglfdHJfZmx1c2hfYmxvY2s6IF90cl9mbHVzaF9ibG9ja18xLAoJX3RyX3RhbGx5OiBfdHJfdGFsbHlfMSwKCV90cl9hbGlnbjogX3RyX2FsaWduXzEKfTsKCi8vIE5vdGU6IGFkbGVyMzIgdGFrZXMgMTIlIGZvciBsZXZlbCAwIGFuZCAyJSBmb3IgbGV2ZWwgNi4KLy8gSXQgaXNuJ3Qgd29ydGggaXQgdG8gbWFrZSBhZGRpdGlvbmFsIG9wdGltaXphdGlvbnMgYXMgaW4gb3JpZ2luYWwuCi8vIFNtYWxsIHNpemUgaXMgcHJlZmVyYWJsZS4KCi8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgovLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgovLwovLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAovLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KLy8KLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCi8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgovLwovLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAovLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCi8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCi8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCi8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgpjb25zdCBhZGxlcjMyID0gKGFkbGVyLCBidWYsIGxlbiwgcG9zKSA9PiB7CiAgbGV0IHMxID0gKGFkbGVyICYgMHhmZmZmKSB8MCwKICAgICAgczIgPSAoKGFkbGVyID4+PiAxNikgJiAweGZmZmYpIHwwLAogICAgICBuID0gMDsKCiAgd2hpbGUgKGxlbiAhPT0gMCkgewogICAgLy8gU2V0IGxpbWl0IH4gdHdpY2UgbGVzcyB0aGFuIDU1NTIsIHRvIGtlZXAKICAgIC8vIHMyIGluIDMxLWJpdHMsIGJlY2F1c2Ugd2UgZm9yY2Ugc2lnbmVkIGludHMuCiAgICAvLyBpbiBvdGhlciBjYXNlICU9IHdpbGwgZmFpbC4KICAgIG4gPSBsZW4gPiAyMDAwID8gMjAwMCA6IGxlbjsKICAgIGxlbiAtPSBuOwoKICAgIGRvIHsKICAgICAgczEgPSAoczEgKyBidWZbcG9zKytdKSB8MDsKICAgICAgczIgPSAoczIgKyBzMSkgfDA7CiAgICB9IHdoaWxlICgtLW4pOwoKICAgIHMxICU9IDY1NTIxOwogICAgczIgJT0gNjU1MjE7CiAgfQoKICByZXR1cm4gKHMxIHwgKHMyIDw8IDE2KSkgfDA7Cn07CgoKdmFyIGFkbGVyMzJfMSA9IGFkbGVyMzI7CgovLyBOb3RlOiB3ZSBjYW4ndCBnZXQgc2lnbmlmaWNhbnQgc3BlZWQgYm9vc3QgaGVyZS4KLy8gU28gd3JpdGUgY29kZSB0byBtaW5pbWl6ZSBzaXplIC0gbm8gcHJlZ2VuZXJhdGVkIHRhYmxlcwovLyBhbmQgYXJyYXkgdG9vbHMgZGVwZW5kZW5jaWVzLgoKLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCi8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCi8vCi8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCi8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwovLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgovLwovLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAovLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6Ci8vCi8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90Ci8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgovLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQovLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCi8vIFVzZSBvcmRpbmFyeSBhcnJheSwgc2luY2UgdW50eXBlZCBtYWtlcyBubyBib29zdCBoZXJlCmNvbnN0IG1ha2VUYWJsZSA9ICgpID0+IHsKICBsZXQgYywgdGFibGUgPSBbXTsKCiAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgYyA9IG47CiAgICBmb3IgKHZhciBrID0gMDsgayA8IDg7IGsrKykgewogICAgICBjID0gKChjICYgMSkgPyAoMHhFREI4ODMyMCBeIChjID4+PiAxKSkgOiAoYyA+Pj4gMSkpOwogICAgfQogICAgdGFibGVbbl0gPSBjOwogIH0KCiAgcmV0dXJuIHRhYmxlOwp9OwoKLy8gQ3JlYXRlIHRhYmxlIG9uIGxvYWQuIEp1c3QgMjU1IHNpZ25lZCBsb25ncy4gTm90IGEgcHJvYmxlbS4KY29uc3QgY3JjVGFibGUgPSBuZXcgVWludDMyQXJyYXkobWFrZVRhYmxlKCkpOwoKCmNvbnN0IGNyYzMyID0gKGNyYywgYnVmLCBsZW4sIHBvcykgPT4gewogIGNvbnN0IHQgPSBjcmNUYWJsZTsKICBjb25zdCBlbmQgPSBwb3MgKyBsZW47CgogIGNyYyBePSAtMTsKCiAgZm9yIChsZXQgaSA9IHBvczsgaSA8IGVuZDsgaSsrKSB7CiAgICBjcmMgPSAoY3JjID4+PiA4KSBeIHRbKGNyYyBeIGJ1ZltpXSkgJiAweEZGXTsKICB9CgogIHJldHVybiAoY3JjIF4gKC0xKSk7IC8vID4+PiAwOwp9OwoKCnZhciBjcmMzMl8xID0gY3JjMzI7CgovLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KLy8KLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCi8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCi8vCi8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAovLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0Ci8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKLy8KLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQovLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQovLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCi8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCi8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgovLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKdmFyIG1lc3NhZ2VzID0gewogIDI6ICAgICAgJ25lZWQgZGljdGlvbmFyeScsICAgICAvKiBaX05FRURfRElDVCAgICAgICAyICAqLwogIDE6ICAgICAgJ3N0cmVhbSBlbmQnLCAgICAgICAgICAvKiBaX1NUUkVBTV9FTkQgICAgICAxICAqLwogIDA6ICAgICAgJycsICAgICAgICAgICAgICAgICAgICAvKiBaX09LICAgICAgICAgICAgICAwICAqLwogICctMSc6ICAgJ2ZpbGUgZXJyb3InLCAgICAgICAgICAvKiBaX0VSUk5PICAgICAgICAgKC0xKSAqLwogICctMic6ICAgJ3N0cmVhbSBlcnJvcicsICAgICAgICAvKiBaX1NUUkVBTV9FUlJPUiAgKC0yKSAqLwogICctMyc6ICAgJ2RhdGEgZXJyb3InLCAgICAgICAgICAvKiBaX0RBVEFfRVJST1IgICAgKC0zKSAqLwogICctNCc6ICAgJ2luc3VmZmljaWVudCBtZW1vcnknLCAvKiBaX01FTV9FUlJPUiAgICAgKC00KSAqLwogICctNSc6ICAgJ2J1ZmZlciBlcnJvcicsICAgICAgICAvKiBaX0JVRl9FUlJPUiAgICAgKC01KSAqLwogICctNic6ICAgJ2luY29tcGF0aWJsZSB2ZXJzaW9uJyAvKiBaX1ZFUlNJT05fRVJST1IgKC02KSAqLwp9OwoKLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCi8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCi8vCi8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCi8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwovLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgovLwovLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAovLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6Ci8vCi8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90Ci8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgovLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQovLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCnZhciBjb25zdGFudHMkMiA9IHsKCiAgLyogQWxsb3dlZCBmbHVzaCB2YWx1ZXM7IHNlZSBkZWZsYXRlKCkgYW5kIGluZmxhdGUoKSBiZWxvdyBmb3IgZGV0YWlscyAqLwogIFpfTk9fRkxVU0g6ICAgICAgICAgMCwKICBaX1BBUlRJQUxfRkxVU0g6ICAgIDEsCiAgWl9TWU5DX0ZMVVNIOiAgICAgICAyLAogIFpfRlVMTF9GTFVTSDogICAgICAgMywKICBaX0ZJTklTSDogICAgICAgICAgIDQsCiAgWl9CTE9DSzogICAgICAgICAgICA1LAogIFpfVFJFRVM6ICAgICAgICAgICAgNiwKCiAgLyogUmV0dXJuIGNvZGVzIGZvciB0aGUgY29tcHJlc3Npb24vZGVjb21wcmVzc2lvbiBmdW5jdGlvbnMuIE5lZ2F0aXZlIHZhbHVlcwogICogYXJlIGVycm9ycywgcG9zaXRpdmUgdmFsdWVzIGFyZSB1c2VkIGZvciBzcGVjaWFsIGJ1dCBub3JtYWwgZXZlbnRzLgogICovCiAgWl9PSzogICAgICAgICAgICAgICAwLAogIFpfU1RSRUFNX0VORDogICAgICAgMSwKICBaX05FRURfRElDVDogICAgICAgIDIsCiAgWl9FUlJOTzogICAgICAgICAgIC0xLAogIFpfU1RSRUFNX0VSUk9SOiAgICAtMiwKICBaX0RBVEFfRVJST1I6ICAgICAgLTMsCiAgWl9NRU1fRVJST1I6ICAgICAgIC00LAogIFpfQlVGX0VSUk9SOiAgICAgICAtNSwKICAvL1pfVkVSU0lPTl9FUlJPUjogLTYsCgogIC8qIGNvbXByZXNzaW9uIGxldmVscyAqLwogIFpfTk9fQ09NUFJFU1NJT046ICAgICAgICAgMCwKICBaX0JFU1RfU1BFRUQ6ICAgICAgICAgICAgIDEsCiAgWl9CRVNUX0NPTVBSRVNTSU9OOiAgICAgICA5LAogIFpfREVGQVVMVF9DT01QUkVTU0lPTjogICAtMSwKCgogIFpfRklMVEVSRUQ6ICAgICAgICAgICAgICAgMSwKICBaX0hVRkZNQU5fT05MWTogICAgICAgICAgIDIsCiAgWl9STEU6ICAgICAgICAgICAgICAgICAgICAzLAogIFpfRklYRUQ6ICAgICAgICAgICAgICAgICAgNCwKICBaX0RFRkFVTFRfU1RSQVRFR1k6ICAgICAgIDAsCgogIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICBaX0JJTkFSWTogICAgICAgICAgICAgICAgIDAsCiAgWl9URVhUOiAgICAgICAgICAgICAgICAgICAxLAogIC8vWl9BU0NJSTogICAgICAgICAgICAgICAgMSwgLy8gPSBaX1RFWFQgKGRlcHJlY2F0ZWQpCiAgWl9VTktOT1dOOiAgICAgICAgICAgICAgICAyLAoKICAvKiBUaGUgZGVmbGF0ZSBjb21wcmVzc2lvbiBtZXRob2QgKi8KICBaX0RFRkxBVEVEOiAgICAgICAgICAgICAgIDgKICAvL1pfTlVMTDogICAgICAgICAgICAgICAgIG51bGwgLy8gVXNlIC0xIG9yIG51bGwgaW5saW5lLCBkZXBlbmRpbmcgb24gdmFyIHR5cGUKfTsKCi8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgovLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgovLwovLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAovLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KLy8KLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCi8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgovLwovLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAovLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCi8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCi8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCi8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgpjb25zdCB7IF90cl9pbml0LCBfdHJfc3RvcmVkX2Jsb2NrLCBfdHJfZmx1c2hfYmxvY2ssIF90cl90YWxseSwgX3RyX2FsaWduIH0gPSB0cmVlczsKCgoKCi8qIFB1YmxpYyBjb25zdGFudHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgpjb25zdCB7CiAgWl9OT19GTFVTSDogWl9OT19GTFVTSCQyLCBaX1BBUlRJQUxfRkxVU0gsIFpfRlVMTF9GTFVTSDogWl9GVUxMX0ZMVVNIJDEsIFpfRklOSVNIOiBaX0ZJTklTSCQzLCBaX0JMT0NLOiBaX0JMT0NLJDEsCiAgWl9PSzogWl9PSyQzLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQzLCBaX1NUUkVBTV9FUlJPUjogWl9TVFJFQU1fRVJST1IkMiwgWl9EQVRBX0VSUk9SOiBaX0RBVEFfRVJST1IkMiwgWl9CVUZfRVJST1I6IFpfQlVGX0VSUk9SJDEsCiAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBaX0RFRkFVTFRfQ09NUFJFU1NJT04kMSwKICBaX0ZJTFRFUkVELCBaX0hVRkZNQU5fT05MWSwgWl9STEUsIFpfRklYRUQsIFpfREVGQVVMVF9TVFJBVEVHWTogWl9ERUZBVUxUX1NUUkFURUdZJDEsCiAgWl9VTktOT1dOLAogIFpfREVGTEFURUQ6IFpfREVGTEFURUQkMgp9ID0gY29uc3RhbnRzJDI7CgovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCmNvbnN0IE1BWF9NRU1fTEVWRUwgPSA5OwovKiBNYXhpbXVtIHZhbHVlIGZvciBtZW1MZXZlbCBpbiBkZWZsYXRlSW5pdDIgKi8KY29uc3QgTUFYX1dCSVRTJDEgPSAxNTsKLyogMzJLIExaNzcgd2luZG93ICovCmNvbnN0IERFRl9NRU1fTEVWRUwgPSA4OwoKCmNvbnN0IExFTkdUSF9DT0RFUyAgPSAyOTsKLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCmNvbnN0IExJVEVSQUxTICAgICAgPSAyNTY7Ci8qIG51bWJlciBvZiBsaXRlcmFsIGJ5dGVzIDAuLjI1NSAqLwpjb25zdCBMX0NPREVTICAgICAgID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwovKiBudW1iZXIgb2YgTGl0ZXJhbCBvciBMZW5ndGggY29kZXMsIGluY2x1ZGluZyB0aGUgRU5EX0JMT0NLIGNvZGUgKi8KY29uc3QgRF9DT0RFUyAgICAgICA9IDMwOwovKiBudW1iZXIgb2YgZGlzdGFuY2UgY29kZXMgKi8KY29uc3QgQkxfQ09ERVMgICAgICA9IDE5OwovKiBudW1iZXIgb2YgY29kZXMgdXNlZCB0byB0cmFuc2ZlciB0aGUgYml0IGxlbmd0aHMgKi8KY29uc3QgSEVBUF9TSVpFICAgICA9IDIgKiBMX0NPREVTICsgMTsKLyogbWF4aW11bSBoZWFwIHNpemUgKi8KY29uc3QgTUFYX0JJVFMgID0gMTU7Ci8qIEFsbCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JJVFMgYml0cyAqLwoKY29uc3QgTUlOX01BVENIID0gMzsKY29uc3QgTUFYX01BVENIID0gMjU4Owpjb25zdCBNSU5fTE9PS0FIRUFEID0gKE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDEpOwoKY29uc3QgUFJFU0VUX0RJQ1QgPSAweDIwOwoKY29uc3QgSU5JVF9TVEFURSA9IDQyOwpjb25zdCBFWFRSQV9TVEFURSA9IDY5Owpjb25zdCBOQU1FX1NUQVRFID0gNzM7CmNvbnN0IENPTU1FTlRfU1RBVEUgPSA5MTsKY29uc3QgSENSQ19TVEFURSA9IDEwMzsKY29uc3QgQlVTWV9TVEFURSA9IDExMzsKY29uc3QgRklOSVNIX1NUQVRFID0gNjY2OwoKY29uc3QgQlNfTkVFRF9NT1JFICAgICAgPSAxOyAvKiBibG9jayBub3QgY29tcGxldGVkLCBuZWVkIG1vcmUgaW5wdXQgb3IgbW9yZSBvdXRwdXQgKi8KY29uc3QgQlNfQkxPQ0tfRE9ORSAgICAgPSAyOyAvKiBibG9jayBmbHVzaCBwZXJmb3JtZWQgKi8KY29uc3QgQlNfRklOSVNIX1NUQVJURUQgPSAzOyAvKiBmaW5pc2ggc3RhcnRlZCwgbmVlZCBvbmx5IG1vcmUgb3V0cHV0IGF0IG5leHQgZGVmbGF0ZSAqLwpjb25zdCBCU19GSU5JU0hfRE9ORSAgICA9IDQ7IC8qIGZpbmlzaCBkb25lLCBhY2NlcHQgbm8gbW9yZSBpbnB1dCBvciBvdXRwdXQgKi8KCmNvbnN0IE9TX0NPREUgPSAweDAzOyAvLyBVbml4IDopIC4gRG9uJ3QgZGV0ZWN0LCB1c2UgdGhpcyBkZWZhdWx0LgoKY29uc3QgZXJyID0gKHN0cm0sIGVycm9yQ29kZSkgPT4gewogIHN0cm0ubXNnID0gbWVzc2FnZXNbZXJyb3JDb2RlXTsKICByZXR1cm4gZXJyb3JDb2RlOwp9OwoKY29uc3QgcmFuayA9IChmKSA9PiB7CiAgcmV0dXJuICgoZikgPDwgMSkgLSAoKGYpID4gNCA/IDkgOiAwKTsKfTsKCmNvbnN0IHplcm8gPSAoYnVmKSA9PiB7CiAgbGV0IGxlbiA9IGJ1Zi5sZW5ndGg7IHdoaWxlICgtLWxlbiA+PSAwKSB7IGJ1ZltsZW5dID0gMDsgfQp9OwoKCi8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KbGV0IEhBU0hfWkxJQiA9IChzLCBwcmV2LCBkYXRhKSA9PiAoKHByZXYgPDwgcy5oYXNoX3NoaWZ0KSBeIGRhdGEpICYgcy5oYXNoX21hc2s7Ci8vIFRoaXMgaGFzaCBjYXVzZXMgbGVzcyBjb2xsaXNpb25zLCBodHRwczovL2dpdGh1Yi5jb20vbm9kZWNhL3Bha28vaXNzdWVzLzEzNQovLyBCdXQgYnJlYWtzIGJpbmFyeSBjb21wYXRpYmlsaXR5Ci8vbGV0IEhBU0hfRkFTVCA9IChzLCBwcmV2LCBkYXRhKSA9PiAoKHByZXYgPDwgOCkgKyAocHJldiA+PiA4KSArIChkYXRhIDw8IDQpKSAmIHMuaGFzaF9tYXNrOwpsZXQgSEFTSCA9IEhBU0hfWkxJQjsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogRmx1c2ggYXMgbXVjaCBwZW5kaW5nIG91dHB1dCBhcyBwb3NzaWJsZS4gQWxsIGRlZmxhdGUoKSBvdXRwdXQgZ29lcwogKiB0aHJvdWdoIHRoaXMgZnVuY3Rpb24gc28gc29tZSBhcHBsaWNhdGlvbnMgbWF5IHdpc2ggdG8gbW9kaWZ5IGl0CiAqIHRvIGF2b2lkIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5vdXRwdXQgYnVmZmVyIGFuZCBjb3B5aW5nIGludG8gaXQuCiAqIChTZWUgYWxzbyByZWFkX2J1ZigpKS4KICovCmNvbnN0IGZsdXNoX3BlbmRpbmcgPSAoc3RybSkgPT4gewogIGNvbnN0IHMgPSBzdHJtLnN0YXRlOwoKICAvL190cl9mbHVzaF9iaXRzKHMpOwogIGxldCBsZW4gPSBzLnBlbmRpbmc7CiAgaWYgKGxlbiA+IHN0cm0uYXZhaWxfb3V0KSB7CiAgICBsZW4gPSBzdHJtLmF2YWlsX291dDsKICB9CiAgaWYgKGxlbiA9PT0gMCkgeyByZXR1cm47IH0KCiAgc3RybS5vdXRwdXQuc2V0KHMucGVuZGluZ19idWYuc3ViYXJyYXkocy5wZW5kaW5nX291dCwgcy5wZW5kaW5nX291dCArIGxlbiksIHN0cm0ubmV4dF9vdXQpOwogIHN0cm0ubmV4dF9vdXQgKz0gbGVuOwogIHMucGVuZGluZ19vdXQgKz0gbGVuOwogIHN0cm0udG90YWxfb3V0ICs9IGxlbjsKICBzdHJtLmF2YWlsX291dCAtPSBsZW47CiAgcy5wZW5kaW5nIC09IGxlbjsKICBpZiAocy5wZW5kaW5nID09PSAwKSB7CiAgICBzLnBlbmRpbmdfb3V0ID0gMDsKICB9Cn07CgoKY29uc3QgZmx1c2hfYmxvY2tfb25seSA9IChzLCBsYXN0KSA9PiB7CiAgX3RyX2ZsdXNoX2Jsb2NrKHMsIChzLmJsb2NrX3N0YXJ0ID49IDAgPyBzLmJsb2NrX3N0YXJ0IDogLTEpLCBzLnN0cnN0YXJ0IC0gcy5ibG9ja19zdGFydCwgbGFzdCk7CiAgcy5ibG9ja19zdGFydCA9IHMuc3Ryc3RhcnQ7CiAgZmx1c2hfcGVuZGluZyhzLnN0cm0pOwp9OwoKCmNvbnN0IHB1dF9ieXRlID0gKHMsIGIpID0+IHsKICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGI7Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBQdXQgYSBzaG9ydCBpbiB0aGUgcGVuZGluZyBidWZmZXIuIFRoZSAxNi1iaXQgdmFsdWUgaXMgcHV0IGluIE1TQiBvcmRlci4KICogSU4gYXNzZXJ0aW9uOiB0aGUgc3RyZWFtIHN0YXRlIGlzIGNvcnJlY3QgYW5kIHRoZXJlIGlzIGVub3VnaCByb29tIGluCiAqIHBlbmRpbmdfYnVmLgogKi8KY29uc3QgcHV0U2hvcnRNU0IgPSAocywgYikgPT4gewoKICAvLyAgcHV0X2J5dGUocywgKEJ5dGUpKGIgPj4gOCkpOwovLyAgcHV0X2J5dGUocywgKEJ5dGUpKGIgJiAweGZmKSk7CiAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSAoYiA+Pj4gOCkgJiAweGZmOwogIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gYiAmIDB4ZmY7Cn07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIFJlYWQgYSBuZXcgYnVmZmVyIGZyb20gdGhlIGN1cnJlbnQgaW5wdXQgc3RyZWFtLCB1cGRhdGUgdGhlIGFkbGVyMzIKICogYW5kIHRvdGFsIG51bWJlciBvZiBieXRlcyByZWFkLiAgQWxsIGRlZmxhdGUoKSBpbnB1dCBnb2VzIHRocm91Z2gKICogdGhpcyBmdW5jdGlvbiBzbyBzb21lIGFwcGxpY2F0aW9ucyBtYXkgd2lzaCB0byBtb2RpZnkgaXQgdG8gYXZvaWQKICogYWxsb2NhdGluZyBhIGxhcmdlIHN0cm0tPmlucHV0IGJ1ZmZlciBhbmQgY29weWluZyBmcm9tIGl0LgogKiAoU2VlIGFsc28gZmx1c2hfcGVuZGluZygpKS4KICovCmNvbnN0IHJlYWRfYnVmID0gKHN0cm0sIGJ1Ziwgc3RhcnQsIHNpemUpID0+IHsKCiAgbGV0IGxlbiA9IHN0cm0uYXZhaWxfaW47CgogIGlmIChsZW4gPiBzaXplKSB7IGxlbiA9IHNpemU7IH0KICBpZiAobGVuID09PSAwKSB7IHJldHVybiAwOyB9CgogIHN0cm0uYXZhaWxfaW4gLT0gbGVuOwoKICAvLyB6bWVtY3B5KGJ1Ziwgc3RybS0+bmV4dF9pbiwgbGVuKTsKICBidWYuc2V0KHN0cm0uaW5wdXQuc3ViYXJyYXkoc3RybS5uZXh0X2luLCBzdHJtLm5leHRfaW4gKyBsZW4pLCBzdGFydCk7CiAgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMSkgewogICAgc3RybS5hZGxlciA9IGFkbGVyMzJfMShzdHJtLmFkbGVyLCBidWYsIGxlbiwgc3RhcnQpOwogIH0KCiAgZWxzZSBpZiAoc3RybS5zdGF0ZS53cmFwID09PSAyKSB7CiAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBidWYsIGxlbiwgc3RhcnQpOwogIH0KCiAgc3RybS5uZXh0X2luICs9IGxlbjsKICBzdHJtLnRvdGFsX2luICs9IGxlbjsKCiAgcmV0dXJuIGxlbjsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogU2V0IG1hdGNoX3N0YXJ0IHRvIHRoZSBsb25nZXN0IG1hdGNoIHN0YXJ0aW5nIGF0IHRoZSBnaXZlbiBzdHJpbmcgYW5kCiAqIHJldHVybiBpdHMgbGVuZ3RoLiBNYXRjaGVzIHNob3J0ZXIgb3IgZXF1YWwgdG8gcHJldl9sZW5ndGggYXJlIGRpc2NhcmRlZCwKICogaW4gd2hpY2ggY2FzZSB0aGUgcmVzdWx0IGlzIGVxdWFsIHRvIHByZXZfbGVuZ3RoIGFuZCBtYXRjaF9zdGFydCBpcwogKiBnYXJiYWdlLgogKiBJTiBhc3NlcnRpb25zOiBjdXJfbWF0Y2ggaXMgdGhlIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gZm9yIHRoZSBjdXJyZW50CiAqICAgc3RyaW5nIChzdHJzdGFydCkgYW5kIGl0cyBkaXN0YW5jZSBpcyA8PSBNQVhfRElTVCwgYW5kIHByZXZfbGVuZ3RoID49IDEKICogT1VUIGFzc2VydGlvbjogdGhlIG1hdGNoIGxlbmd0aCBpcyBub3QgZ3JlYXRlciB0aGFuIHMtPmxvb2thaGVhZC4KICovCmNvbnN0IGxvbmdlc3RfbWF0Y2ggPSAocywgY3VyX21hdGNoKSA9PiB7CgogIGxldCBjaGFpbl9sZW5ndGggPSBzLm1heF9jaGFpbl9sZW5ndGg7ICAgICAgLyogbWF4IGhhc2ggY2hhaW4gbGVuZ3RoICovCiAgbGV0IHNjYW4gPSBzLnN0cnN0YXJ0OyAvKiBjdXJyZW50IHN0cmluZyAqLwogIGxldCBtYXRjaDsgICAgICAgICAgICAgICAgICAgICAgIC8qIG1hdGNoZWQgc3RyaW5nICovCiAgbGV0IGxlbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBsZW5ndGggb2YgY3VycmVudCBtYXRjaCAqLwogIGxldCBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7ICAgICAgICAgICAgICAvKiBiZXN0IG1hdGNoIGxlbmd0aCBzbyBmYXIgKi8KICBsZXQgbmljZV9tYXRjaCA9IHMubmljZV9tYXRjaDsgICAgICAgICAgICAgLyogc3RvcCBpZiBtYXRjaCBsb25nIGVub3VnaCAqLwogIGNvbnN0IGxpbWl0ID0gKHMuc3Ryc3RhcnQgPiAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkgPwogICAgICBzLnN0cnN0YXJ0IC0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgOiAwLypOSUwqLzsKCiAgY29uc3QgX3dpbiA9IHMud2luZG93OyAvLyBzaG9ydGN1dAoKICBjb25zdCB3bWFzayA9IHMud19tYXNrOwogIGNvbnN0IHByZXYgID0gcy5wcmV2OwoKICAvKiBTdG9wIHdoZW4gY3VyX21hdGNoIGJlY29tZXMgPD0gbGltaXQuIFRvIHNpbXBsaWZ5IHRoZSBjb2RlLAogICAqIHdlIHByZXZlbnQgbWF0Y2hlcyB3aXRoIHRoZSBzdHJpbmcgb2Ygd2luZG93IGluZGV4IDAuCiAgICovCgogIGNvbnN0IHN0cmVuZCA9IHMuc3Ryc3RhcnQgKyBNQVhfTUFUQ0g7CiAgbGV0IHNjYW5fZW5kMSAgPSBfd2luW3NjYW4gKyBiZXN0X2xlbiAtIDFdOwogIGxldCBzY2FuX2VuZCAgID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwoKICAvKiBUaGUgY29kZSBpcyBvcHRpbWl6ZWQgZm9yIEhBU0hfQklUUyA+PSA4IGFuZCBNQVhfTUFUQ0gtMiBtdWx0aXBsZSBvZiAxNi4KICAgKiBJdCBpcyBlYXN5IHRvIGdldCByaWQgb2YgdGhpcyBvcHRpbWl6YXRpb24gaWYgbmVjZXNzYXJ5LgogICAqLwogIC8vIEFzc2VydChzLT5oYXNoX2JpdHMgPj0gOCAmJiBNQVhfTUFUQ0ggPT0gMjU4LCAiQ29kZSB0b28gY2xldmVyIik7CgogIC8qIERvIG5vdCB3YXN0ZSB0b28gbXVjaCB0aW1lIGlmIHdlIGFscmVhZHkgaGF2ZSBhIGdvb2QgbWF0Y2g6ICovCiAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICBjaGFpbl9sZW5ndGggPj49IDI7CiAgfQogIC8qIERvIG5vdCBsb29rIGZvciBtYXRjaGVzIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBpbnB1dC4gVGhpcyBpcyBuZWNlc3NhcnkKICAgKiB0byBtYWtlIGRlZmxhdGUgZGV0ZXJtaW5pc3RpYy4KICAgKi8KICBpZiAobmljZV9tYXRjaCA+IHMubG9va2FoZWFkKSB7IG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsgfQoKICAvLyBBc3NlcnQoKHVsZylzLT5zdHJzdGFydCA8PSBzLT53aW5kb3dfc2l6ZS1NSU5fTE9PS0FIRUFELCAibmVlZCBsb29rYWhlYWQiKTsKCiAgZG8gewogICAgLy8gQXNzZXJ0KGN1cl9tYXRjaCA8IHMtPnN0cnN0YXJ0LCAibm8gZnV0dXJlIik7CiAgICBtYXRjaCA9IGN1cl9tYXRjaDsKCiAgICAvKiBTa2lwIHRvIG5leHQgbWF0Y2ggaWYgdGhlIG1hdGNoIGxlbmd0aCBjYW5ub3QgaW5jcmVhc2UKICAgICAqIG9yIGlmIHRoZSBtYXRjaCBsZW5ndGggaXMgbGVzcyB0aGFuIDIuICBOb3RlIHRoYXQgdGhlIGNoZWNrcyBiZWxvdwogICAgICogZm9yIGluc3VmZmljaWVudCBsb29rYWhlYWQgb25seSBvY2N1ciBvY2Nhc2lvbmFsbHkgZm9yIHBlcmZvcm1hbmNlCiAgICAgKiByZWFzb25zLiAgVGhlcmVmb3JlIHVuaW5pdGlhbGl6ZWQgbWVtb3J5IHdpbGwgYmUgYWNjZXNzZWQsIGFuZAogICAgICogY29uZGl0aW9uYWwganVtcHMgd2lsbCBiZSBtYWRlIHRoYXQgZGVwZW5kIG9uIHRob3NlIHZhbHVlcy4KICAgICAqIEhvd2V2ZXIgdGhlIGxlbmd0aCBvZiB0aGUgbWF0Y2ggaXMgbGltaXRlZCB0byB0aGUgbG9va2FoZWFkLCBzbwogICAgICogdGhlIG91dHB1dCBvZiBkZWZsYXRlIGlzIG5vdCBhZmZlY3RlZCBieSB0aGUgdW5pbml0aWFsaXplZCB2YWx1ZXMuCiAgICAgKi8KCiAgICBpZiAoX3dpblttYXRjaCArIGJlc3RfbGVuXSAgICAgIT09IHNjYW5fZW5kICB8fAogICAgICAgIF93aW5bbWF0Y2ggKyBiZXN0X2xlbiAtIDFdICE9PSBzY2FuX2VuZDEgfHwKICAgICAgICBfd2luW21hdGNoXSAgICAgICAgICAgICAgICAhPT0gX3dpbltzY2FuXSB8fAogICAgICAgIF93aW5bKyttYXRjaF0gICAgICAgICAgICAgICE9PSBfd2luW3NjYW4gKyAxXSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICAvKiBUaGUgY2hlY2sgYXQgYmVzdF9sZW4tMSBjYW4gYmUgcmVtb3ZlZCBiZWNhdXNlIGl0IHdpbGwgYmUgbWFkZQogICAgICogYWdhaW4gbGF0ZXIuIChUaGlzIGhldXJpc3RpYyBpcyBub3QgYWx3YXlzIGEgd2luLikKICAgICAqIEl0IGlzIG5vdCBuZWNlc3NhcnkgdG8gY29tcGFyZSBzY2FuWzJdIGFuZCBtYXRjaFsyXSBzaW5jZSB0aGV5CiAgICAgKiBhcmUgYWx3YXlzIGVxdWFsIHdoZW4gdGhlIG90aGVyIGJ5dGVzIG1hdGNoLCBnaXZlbiB0aGF0CiAgICAgKiB0aGUgaGFzaCBrZXlzIGFyZSBlcXVhbCBhbmQgdGhhdCBIQVNIX0JJVFMgPj0gOC4KICAgICAqLwogICAgc2NhbiArPSAyOwogICAgbWF0Y2grKzsKICAgIC8vIEFzc2VydCgqc2NhbiA9PSAqbWF0Y2gsICJtYXRjaFsyXT8iKTsKCiAgICAvKiBXZSBjaGVjayBmb3IgaW5zdWZmaWNpZW50IGxvb2thaGVhZCBvbmx5IGV2ZXJ5IDh0aCBjb21wYXJpc29uOwogICAgICogdGhlIDI1NnRoIGNoZWNrIHdpbGwgYmUgbWFkZSBhdCBzdHJzdGFydCsyNTguCiAgICAgKi8KICAgIGRvIHsKICAgICAgLypqc2hpbnQgbm9lbXB0eTpmYWxzZSovCiAgICB9IHdoaWxlIChfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICBzY2FuIDwgc3RyZW5kKTsKCiAgICAvLyBBc3NlcnQoc2NhbiA8PSBzLT53aW5kb3crKHVuc2lnbmVkKShzLT53aW5kb3dfc2l6ZS0xKSwgIndpbGQgc2NhbiIpOwoKICAgIGxlbiA9IE1BWF9NQVRDSCAtIChzdHJlbmQgLSBzY2FuKTsKICAgIHNjYW4gPSBzdHJlbmQgLSBNQVhfTUFUQ0g7CgogICAgaWYgKGxlbiA+IGJlc3RfbGVuKSB7CiAgICAgIHMubWF0Y2hfc3RhcnQgPSBjdXJfbWF0Y2g7CiAgICAgIGJlc3RfbGVuID0gbGVuOwogICAgICBpZiAobGVuID49IG5pY2VfbWF0Y2gpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBzY2FuX2VuZDEgID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgICAgc2Nhbl9lbmQgICA9IF93aW5bc2NhbiArIGJlc3RfbGVuXTsKICAgIH0KICB9IHdoaWxlICgoY3VyX21hdGNoID0gcHJldltjdXJfbWF0Y2ggJiB3bWFza10pID4gbGltaXQgJiYgLS1jaGFpbl9sZW5ndGggIT09IDApOwoKICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgIHJldHVybiBiZXN0X2xlbjsKICB9CiAgcmV0dXJuIHMubG9va2FoZWFkOwp9OwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBGaWxsIHRoZSB3aW5kb3cgd2hlbiB0aGUgbG9va2FoZWFkIGJlY29tZXMgaW5zdWZmaWNpZW50LgogKiBVcGRhdGVzIHN0cnN0YXJ0IGFuZCBsb29rYWhlYWQuCiAqCiAqIElOIGFzc2VydGlvbjogbG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRAogKiBPVVQgYXNzZXJ0aW9uczogc3Ryc3RhcnQgPD0gd2luZG93X3NpemUtTUlOX0xPT0tBSEVBRAogKiAgICBBdCBsZWFzdCBvbmUgYnl0ZSBoYXMgYmVlbiByZWFkLCBvciBhdmFpbF9pbiA9PSAwOyByZWFkcyBhcmUKICogICAgcGVyZm9ybWVkIGZvciBhdCBsZWFzdCB0d28gYnl0ZXMgKHJlcXVpcmVkIGZvciB0aGUgemlwIHRyYW5zbGF0ZV9lb2wKICogICAgb3B0aW9uIC0tIG5vdCBzdXBwb3J0ZWQgaGVyZSkuCiAqLwpjb25zdCBmaWxsX3dpbmRvdyA9IChzKSA9PiB7CgogIGNvbnN0IF93X3NpemUgPSBzLndfc2l6ZTsKICBsZXQgcCwgbiwgbSwgbW9yZSwgc3RyOwoKICAvL0Fzc2VydChzLT5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFELCAiYWxyZWFkeSBlbm91Z2ggbG9va2FoZWFkIik7CgogIGRvIHsKICAgIG1vcmUgPSBzLndpbmRvd19zaXplIC0gcy5sb29rYWhlYWQgLSBzLnN0cnN0YXJ0OwoKICAgIC8vIEpTIGludHMgaGF2ZSAzMiBiaXQsIGJsb2NrIGJlbG93IG5vdCBuZWVkZWQKICAgIC8qIERlYWwgd2l0aCAhQCMkJSA2NEsgbGltaXQ6ICovCiAgICAvL2lmIChzaXplb2YoaW50KSA8PSAyKSB7CiAgICAvLyAgICBpZiAobW9yZSA9PSAwICYmIHMtPnN0cnN0YXJ0ID09IDAgJiYgcy0+bG9va2FoZWFkID09IDApIHsKICAgIC8vICAgICAgICBtb3JlID0gd3NpemU7CiAgICAvLwogICAgLy8gIH0gZWxzZSBpZiAobW9yZSA9PSAodW5zaWduZWQpKC0xKSkgewogICAgLy8gICAgICAgIC8qIFZlcnkgdW5saWtlbHksIGJ1dCBwb3NzaWJsZSBvbiAxNiBiaXQgbWFjaGluZSBpZgogICAgLy8gICAgICAgICAqIHN0cnN0YXJ0ID09IDAgJiYgbG9va2FoZWFkID09IDEgKGlucHV0IGRvbmUgYSBieXRlIGF0IHRpbWUpCiAgICAvLyAgICAgICAgICovCiAgICAvLyAgICAgICAgbW9yZS0tOwogICAgLy8gICAgfQogICAgLy99CgoKICAgIC8qIElmIHRoZSB3aW5kb3cgaXMgYWxtb3N0IGZ1bGwgYW5kIHRoZXJlIGlzIGluc3VmZmljaWVudCBsb29rYWhlYWQsCiAgICAgKiBtb3ZlIHRoZSB1cHBlciBoYWxmIHRvIHRoZSBsb3dlciBvbmUgdG8gbWFrZSByb29tIGluIHRoZSB1cHBlciBoYWxmLgogICAgICovCiAgICBpZiAocy5zdHJzdGFydCA+PSBfd19zaXplICsgKF93X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkgewoKICAgICAgcy53aW5kb3cuc2V0KHMud2luZG93LnN1YmFycmF5KF93X3NpemUsIF93X3NpemUgKyBfd19zaXplKSwgMCk7CiAgICAgIHMubWF0Y2hfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgcy5zdHJzdGFydCAtPSBfd19zaXplOwogICAgICAvKiB3ZSBub3cgaGF2ZSBzdHJzdGFydCA+PSBNQVhfRElTVCAqLwogICAgICBzLmJsb2NrX3N0YXJ0IC09IF93X3NpemU7CgogICAgICAvKiBTbGlkZSB0aGUgaGFzaCB0YWJsZSAoY291bGQgYmUgYXZvaWRlZCB3aXRoIDMyIGJpdCB2YWx1ZXMKICAgICAgIGF0IHRoZSBleHBlbnNlIG9mIG1lbW9yeSB1c2FnZSkuIFdlIHNsaWRlIGV2ZW4gd2hlbiBsZXZlbCA9PSAwCiAgICAgICB0byBrZWVwIHRoZSBoYXNoIHRhYmxlIGNvbnNpc3RlbnQgaWYgd2Ugc3dpdGNoIGJhY2sgdG8gbGV2ZWwgPiAwCiAgICAgICBsYXRlci4gKFVzaW5nIGxldmVsIDAgcGVybWFuZW50bHkgaXMgbm90IGFuIG9wdGltYWwgdXNhZ2Ugb2YKICAgICAgIHpsaWIsIHNvIHdlIGRvbid0IGNhcmUgYWJvdXQgdGhpcyBwYXRob2xvZ2ljYWwgY2FzZS4pCiAgICAgICAqLwoKICAgICAgbiA9IHMuaGFzaF9zaXplOwogICAgICBwID0gbjsKCiAgICAgIGRvIHsKICAgICAgICBtID0gcy5oZWFkWy0tcF07CiAgICAgICAgcy5oZWFkW3BdID0gKG0gPj0gX3dfc2l6ZSA/IG0gLSBfd19zaXplIDogMCk7CiAgICAgIH0gd2hpbGUgKC0tbik7CgogICAgICBuID0gX3dfc2l6ZTsKICAgICAgcCA9IG47CgogICAgICBkbyB7CiAgICAgICAgbSA9IHMucHJldlstLXBdOwogICAgICAgIHMucHJldltwXSA9IChtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDApOwogICAgICAgIC8qIElmIG4gaXMgbm90IG9uIGFueSBoYXNoIGNoYWluLCBwcmV2W25dIGlzIGdhcmJhZ2UgYnV0CiAgICAgICAgICogaXRzIHZhbHVlIHdpbGwgbmV2ZXIgYmUgdXNlZC4KICAgICAgICAgKi8KICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgIG1vcmUgKz0gX3dfc2l6ZTsKICAgIH0KICAgIGlmIChzLnN0cm0uYXZhaWxfaW4gPT09IDApIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgLyogSWYgdGhlcmUgd2FzIG5vIHNsaWRpbmc6CiAgICAgKiAgICBzdHJzdGFydCA8PSBXU0laRStNQVhfRElTVC0xICYmIGxvb2thaGVhZCA8PSBNSU5fTE9PS0FIRUFEIC0gMSAmJgogICAgICogICAgbW9yZSA9PSB3aW5kb3dfc2l6ZSAtIGxvb2thaGVhZCAtIHN0cnN0YXJ0CiAgICAgKiA9PiBtb3JlID49IHdpbmRvd19zaXplIC0gKE1JTl9MT09LQUhFQUQtMSArIFdTSVpFICsgTUFYX0RJU1QtMSkKICAgICAqID0+IG1vcmUgPj0gd2luZG93X3NpemUgLSAyKldTSVpFICsgMgogICAgICogSW4gdGhlIEJJR19NRU0gb3IgTU1BUCBjYXNlIChub3QgeWV0IHN1cHBvcnRlZCksCiAgICAgKiAgIHdpbmRvd19zaXplID09IGlucHV0X3NpemUgKyBNSU5fTE9PS0FIRUFEICAmJgogICAgICogICBzdHJzdGFydCArIHMtPmxvb2thaGVhZCA8PSBpbnB1dF9zaXplID0+IG1vcmUgPj0gTUlOX0xPT0tBSEVBRC4KICAgICAqIE90aGVyd2lzZSwgd2luZG93X3NpemUgPT0gMipXU0laRSBzbyBtb3JlID49IDIuCiAgICAgKiBJZiB0aGVyZSB3YXMgc2xpZGluZywgbW9yZSA+PSBXU0laRS4gU28gaW4gYWxsIGNhc2VzLCBtb3JlID49IDIuCiAgICAgKi8KICAgIC8vQXNzZXJ0KG1vcmUgPj0gMiwgIm1vcmUgPCAyIik7CiAgICBuID0gcmVhZF9idWYocy5zdHJtLCBzLndpbmRvdywgcy5zdHJzdGFydCArIHMubG9va2FoZWFkLCBtb3JlKTsKICAgIHMubG9va2FoZWFkICs9IG47CgogICAgLyogSW5pdGlhbGl6ZSB0aGUgaGFzaCB2YWx1ZSBub3cgdGhhdCB3ZSBoYXZlIHNvbWUgaW5wdXQ6ICovCiAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgc3RyID0gcy5zdHJzdGFydCAtIHMuaW5zZXJ0OwogICAgICBzLmluc19oID0gcy53aW5kb3dbc3RyXTsKCiAgICAgIC8qIFVQREFURV9IQVNIKHMsIHMtPmluc19oLCBzLT53aW5kb3dbc3RyICsgMV0pOyAqLwogICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzdHIgKyAxXSk7Ci8vI2lmIE1JTl9NQVRDSCAhPSAzCi8vICAgICAgICBDYWxsIHVwZGF0ZV9oYXNoKCkgTUlOX01BVENILTMgbW9yZSB0aW1lcwovLyNlbmRpZgogICAgICB3aGlsZSAocy5pbnNlcnQpIHsKICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLT5pbnNfaCwgcy0+d2luZG93W3N0ciArIE1JTl9NQVRDSC0xXSk7ICovCiAgICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbc3RyICsgTUlOX01BVENIIC0gMV0pOwoKICAgICAgICBzLnByZXZbc3RyICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICBzdHIrKzsKICAgICAgICBzLmluc2VydC0tOwogICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qIElmIHRoZSB3aG9sZSBpbnB1dCBoYXMgbGVzcyB0aGFuIE1JTl9NQVRDSCBieXRlcywgaW5zX2ggaXMgZ2FyYmFnZSwKICAgICAqIGJ1dCB0aGlzIGlzIG5vdCBpbXBvcnRhbnQgc2luY2Ugb25seSBsaXRlcmFsIGJ5dGVzIHdpbGwgYmUgZW1pdHRlZC4KICAgICAqLwoKICB9IHdoaWxlIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgcy5zdHJtLmF2YWlsX2luICE9PSAwKTsKCiAgLyogSWYgdGhlIFdJTl9JTklUIGJ5dGVzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgZGF0YSBoYXZlIG5ldmVyIGJlZW4KICAgKiB3cml0dGVuLCB0aGVuIHplcm8gdGhvc2UgYnl0ZXMgaW4gb3JkZXIgdG8gYXZvaWQgbWVtb3J5IGNoZWNrIHJlcG9ydHMgb2YKICAgKiB0aGUgdXNlIG9mIHVuaW5pdGlhbGl6ZWQgKG9yIHVuaW5pdGlhbGlzZWQgYXMgSnVsaWFuIHdyaXRlcykgYnl0ZXMgYnkKICAgKiB0aGUgbG9uZ2VzdCBtYXRjaCByb3V0aW5lcy4gIFVwZGF0ZSB0aGUgaGlnaCB3YXRlciBtYXJrIGZvciB0aGUgbmV4dAogICAqIHRpbWUgdGhyb3VnaCBoZXJlLiAgV0lOX0lOSVQgaXMgc2V0IHRvIE1BWF9NQVRDSCBzaW5jZSB0aGUgbG9uZ2VzdCBtYXRjaAogICAqIHJvdXRpbmVzIGFsbG93IHNjYW5uaW5nIHRvIHN0cnN0YXJ0ICsgTUFYX01BVENILCBpZ25vcmluZyBsb29rYWhlYWQuCiAgICovCi8vICBpZiAocy5oaWdoX3dhdGVyIDwgcy53aW5kb3dfc2l6ZSkgewovLyAgICBjb25zdCBjdXJyID0gcy5zdHJzdGFydCArIHMubG9va2FoZWFkOwovLyAgICBsZXQgaW5pdCA9IDA7Ci8vCi8vICAgIGlmIChzLmhpZ2hfd2F0ZXIgPCBjdXJyKSB7Ci8vICAgICAgLyogUHJldmlvdXMgaGlnaCB3YXRlciBtYXJrIGJlbG93IGN1cnJlbnQgZGF0YSAtLSB6ZXJvIFdJTl9JTklUCi8vICAgICAgICogYnl0ZXMgb3IgdXAgdG8gZW5kIG9mIHdpbmRvdywgd2hpY2hldmVyIGlzIGxlc3MuCi8vICAgICAgICovCi8vICAgICAgaW5pdCA9IHMud2luZG93X3NpemUgLSBjdXJyOwovLyAgICAgIGlmIChpbml0ID4gV0lOX0lOSVQpCi8vICAgICAgICBpbml0ID0gV0lOX0lOSVQ7Ci8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgY3VyciwgKHVuc2lnbmVkKWluaXQpOwovLyAgICAgIHMtPmhpZ2hfd2F0ZXIgPSBjdXJyICsgaW5pdDsKLy8gICAgfQovLyAgICBlbHNlIGlmIChzLT5oaWdoX3dhdGVyIDwgKHVsZyljdXJyICsgV0lOX0lOSVQpIHsKLy8gICAgICAvKiBIaWdoIHdhdGVyIG1hcmsgYXQgb3IgYWJvdmUgY3VycmVudCBkYXRhLCBidXQgYmVsb3cgY3VycmVudCBkYXRhCi8vICAgICAgICogcGx1cyBXSU5fSU5JVCAtLSB6ZXJvIG91dCB0byBjdXJyZW50IGRhdGEgcGx1cyBXSU5fSU5JVCwgb3IgdXAKLy8gICAgICAgKiB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KLy8gICAgICAgKi8KLy8gICAgICBpbml0ID0gKHVsZyljdXJyICsgV0lOX0lOSVQgLSBzLT5oaWdoX3dhdGVyOwovLyAgICAgIGlmIChpbml0ID4gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyKQovLyAgICAgICAgaW5pdCA9IHMtPndpbmRvd19zaXplIC0gcy0+aGlnaF93YXRlcjsKLy8gICAgICB6bWVtemVybyhzLT53aW5kb3cgKyBzLT5oaWdoX3dhdGVyLCAodW5zaWduZWQpaW5pdCk7Ci8vICAgICAgcy0+aGlnaF93YXRlciArPSBpbml0OwovLyAgICB9Ci8vICB9Ci8vCi8vICBBc3NlcnQoKHVsZylzLT5zdHJzdGFydCA8PSBzLT53aW5kb3dfc2l6ZSAtIE1JTl9MT09LQUhFQUQsCi8vICAgICJub3QgZW5vdWdoIHJvb20gZm9yIHNlYXJjaCIpOwp9OwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHkgd2l0aG91dCBjb21wcmVzc2lvbiBhcyBtdWNoIGFzIHBvc3NpYmxlIGZyb20gdGhlIGlucHV0IHN0cmVhbSwgcmV0dXJuCiAqIHRoZSBjdXJyZW50IGJsb2NrIHN0YXRlLgogKiBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IGluc2VydCBuZXcgc3RyaW5ncyBpbiB0aGUgZGljdGlvbmFyeSBzaW5jZQogKiB1bmNvbXByZXNzaWJsZSBkYXRhIGlzIHByb2JhYmx5IG5vdCB1c2VmdWwuIFRoaXMgZnVuY3Rpb24gaXMgdXNlZAogKiBvbmx5IGZvciB0aGUgbGV2ZWw9MCBjb21wcmVzc2lvbiBvcHRpb24uCiAqIE5PVEU6IHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIG9wdGltaXplZCB0byBhdm9pZCBleHRyYSBjb3B5aW5nIGZyb20KICogd2luZG93IHRvIHBlbmRpbmdfYnVmLgogKi8KY29uc3QgZGVmbGF0ZV9zdG9yZWQgPSAocywgZmx1c2gpID0+IHsKCiAgLyogU3RvcmVkIGJsb2NrcyBhcmUgbGltaXRlZCB0byAweGZmZmYgYnl0ZXMsIHBlbmRpbmdfYnVmIGlzIGxpbWl0ZWQKICAgKiB0byBwZW5kaW5nX2J1Zl9zaXplLCBhbmQgZWFjaCBzdG9yZWQgYmxvY2sgaGFzIGEgNSBieXRlIGhlYWRlcjoKICAgKi8KICBsZXQgbWF4X2Jsb2NrX3NpemUgPSAweGZmZmY7CgogIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgIG1heF9ibG9ja19zaXplID0gcy5wZW5kaW5nX2J1Zl9zaXplIC0gNTsKICB9CgogIC8qIENvcHkgYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIGlucHV0IHRvIG91dHB1dDogKi8KICBmb3IgKDs7KSB7CiAgICAvKiBGaWxsIHRoZSB3aW5kb3cgYXMgbXVjaCBhcyBwb3NzaWJsZTogKi8KICAgIGlmIChzLmxvb2thaGVhZCA8PSAxKSB7CgogICAgICAvL0Fzc2VydChzLT5zdHJzdGFydCA8IHMtPndfc2l6ZStNQVhfRElTVChzKSB8fAogICAgICAvLyAgcy0+YmxvY2tfc3RhcnQgPj0gKGxvbmcpcy0+d19zaXplLCAic2xpZGUgdG9vIGxhdGUiKTsKLy8gICAgICBpZiAoIShzLnN0cnN0YXJ0IDwgcy53X3NpemUgKyAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSB8fAovLyAgICAgICAgcy5ibG9ja19zdGFydCA+PSBzLndfc2l6ZSkpIHsKLy8gICAgICAgIHRocm93ICBuZXcgRXJyb3IoInNsaWRlIHRvbyBsYXRlIik7Ci8vICAgICAgfQoKICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCAmJiBmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQoKICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgLyogZmx1c2ggdGhlIGN1cnJlbnQgYmxvY2sgKi8KICAgIH0KICAgIC8vQXNzZXJ0KHMtPmJsb2NrX3N0YXJ0ID49IDBMLCAiYmxvY2sgZ29uZSIpOwovLyAgICBpZiAocy5ibG9ja19zdGFydCA8IDApIHRocm93IG5ldyBFcnJvcigiYmxvY2sgZ29uZSIpOwoKICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICBzLmxvb2thaGVhZCA9IDA7CgogICAgLyogRW1pdCBhIHN0b3JlZCBibG9jayBpZiBwZW5kaW5nX2J1ZiB3aWxsIGJlIGZ1bGw6ICovCiAgICBjb25zdCBtYXhfc3RhcnQgPSBzLmJsb2NrX3N0YXJ0ICsgbWF4X2Jsb2NrX3NpemU7CgogICAgaWYgKHMuc3Ryc3RhcnQgPT09IDAgfHwgcy5zdHJzdGFydCA+PSBtYXhfc3RhcnQpIHsKICAgICAgLyogc3Ryc3RhcnQgPT0gMCBpcyBwb3NzaWJsZSB3aGVuIHdyYXBhcm91bmQgb24gMTYtYml0IG1hY2hpbmUgKi8KICAgICAgcy5sb29rYWhlYWQgPSBzLnN0cnN0YXJ0IC0gbWF4X3N0YXJ0OwogICAgICBzLnN0cnN0YXJ0ID0gbWF4X3N0YXJ0OwogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KCgogICAgfQogICAgLyogRmx1c2ggaWYgd2UgbWF5IGhhdmUgdG8gc2xpZGUsIG90aGVyd2lzZSBibG9ja19zdGFydCBtYXkgYmVjb21lCiAgICAgKiBuZWdhdGl2ZSBhbmQgdGhlIGRhdGEgd2lsbCBiZSBnb25lOgogICAgICovCiAgICBpZiAocy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQgPj0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgfQoKICBzLmluc2VydCA9IDA7CgogIGlmIChmbHVzaCA9PT0gWl9GSU5JU0gkMykgewogICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgIH0KICAgIC8qKiovCiAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgfQoKICBpZiAocy5zdHJzdGFydCA+IHMuYmxvY2tfc3RhcnQpIHsKICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgIH0KICAgIC8qKiovCiAgfQoKICByZXR1cm4gQlNfTkVFRF9NT1JFOwp9OwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvbXByZXNzIGFzIG11Y2ggYXMgcG9zc2libGUgZnJvbSB0aGUgaW5wdXQgc3RyZWFtLCByZXR1cm4gdGhlIGN1cnJlbnQKICogYmxvY2sgc3RhdGUuCiAqIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgcGVyZm9ybSBsYXp5IGV2YWx1YXRpb24gb2YgbWF0Y2hlcyBhbmQgaW5zZXJ0cwogKiBuZXcgc3RyaW5ncyBpbiB0aGUgZGljdGlvbmFyeSBvbmx5IGZvciB1bm1hdGNoZWQgc3RyaW5ncyBvciBmb3Igc2hvcnQKICogbWF0Y2hlcy4gSXQgaXMgdXNlZCBvbmx5IGZvciB0aGUgZmFzdCBjb21wcmVzc2lvbiBvcHRpb25zLgogKi8KY29uc3QgZGVmbGF0ZV9mYXN0ID0gKHMsIGZsdXNoKSA9PiB7CgogIGxldCBoYXNoX2hlYWQ7ICAgICAgICAvKiBoZWFkIG9mIHRoZSBoYXNoIGNoYWluICovCiAgbGV0IGJmbHVzaDsgICAgICAgICAgIC8qIHNldCBpZiBjdXJyZW50IGJsb2NrIG11c3QgYmUgZmx1c2hlZCAqLwoKICBmb3IgKDs7KSB7CiAgICAvKiBNYWtlIHN1cmUgdGhhdCB3ZSBhbHdheXMgaGF2ZSBlbm91Z2ggbG9va2FoZWFkLCBleGNlcHQKICAgICAqIGF0IHRoZSBlbmQgb2YgdGhlIGlucHV0IGZpbGUuIFdlIG5lZWQgTUFYX01BVENIIGJ5dGVzCiAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAqIHN0cmluZyBmb2xsb3dpbmcgdGhlIG5leHQgbWF0Y2guCiAgICAgKi8KICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMikgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgYnJlYWs7IC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgIH0KICAgIH0KCiAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgKiBkaWN0aW9uYXJ5LCBhbmQgc2V0IGhhc2hfaGVhZCB0byB0aGUgaGVhZCBvZiB0aGUgaGFzaCBjaGFpbjoKICAgICAqLwogICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgIC8qKiogSU5TRVJUX1NUUklORyhzLCBzLnN0cnN0YXJ0LCBoYXNoX2hlYWQpOyAqKiovCiAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzLnN0cnN0YXJ0OwogICAgICAvKioqLwogICAgfQoKICAgIC8qIEZpbmQgdGhlIGxvbmdlc3QgbWF0Y2gsIGRpc2NhcmRpbmcgdGhvc2UgPD0gcHJldl9sZW5ndGguCiAgICAgKiBBdCB0aGlzIHBvaW50IHdlIGhhdmUgYWx3YXlzIG1hdGNoX2xlbmd0aCA8IE1JTl9NQVRDSAogICAgICovCiAgICBpZiAoaGFzaF9oZWFkICE9PSAwLypOSUwqLyAmJiAoKHMuc3Ryc3RhcnQgLSBoYXNoX2hlYWQpIDw9IChzLndfc2l6ZSAtIE1JTl9MT09LQUhFQUQpKSkgewogICAgICAvKiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgd2UgcHJldmVudCBtYXRjaGVzIHdpdGggdGhlIHN0cmluZwogICAgICAgKiBvZiB3aW5kb3cgaW5kZXggMCAoaW4gcGFydGljdWxhciB3ZSBoYXZlIHRvIGF2b2lkIGEgbWF0Y2gKICAgICAgICogb2YgdGhlIHN0cmluZyB3aXRoIGl0c2VsZiBhdCB0aGUgc3RhcnQgb2YgdGhlIGlucHV0IGZpbGUpLgogICAgICAgKi8KICAgICAgcy5tYXRjaF9sZW5ndGggPSBsb25nZXN0X21hdGNoKHMsIGhhc2hfaGVhZCk7CiAgICAgIC8qIGxvbmdlc3RfbWF0Y2goKSBzZXRzIG1hdGNoX3N0YXJ0ICovCiAgICB9CiAgICBpZiAocy5tYXRjaF9sZW5ndGggPj0gTUlOX01BVENIKSB7CiAgICAgIC8vIGNoZWNrX21hdGNoKHMsIHMuc3Ryc3RhcnQsIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoKTsgLy8gZm9yIGRlYnVnIG9ubHkKCiAgICAgIC8qKiogX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENILCBiZmx1c2gpOyAqKiovCiAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCBzLnN0cnN0YXJ0IC0gcy5tYXRjaF9zdGFydCwgcy5tYXRjaF9sZW5ndGggLSBNSU5fTUFUQ0gpOwoKICAgICAgcy5sb29rYWhlYWQgLT0gcy5tYXRjaF9sZW5ndGg7CgogICAgICAvKiBJbnNlcnQgbmV3IHN0cmluZ3MgaW4gdGhlIGhhc2ggdGFibGUgb25seSBpZiB0aGUgbWF0Y2ggbGVuZ3RoCiAgICAgICAqIGlzIG5vdCB0b28gbGFyZ2UuIFRoaXMgc2F2ZXMgdGltZSBidXQgZGVncmFkZXMgY29tcHJlc3Npb24uCiAgICAgICAqLwogICAgICBpZiAocy5tYXRjaF9sZW5ndGggPD0gcy5tYXhfbGF6eV9tYXRjaC8qbWF4X2luc2VydF9sZW5ndGgqLyAmJiBzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzLm1hdGNoX2xlbmd0aC0tOyAvKiBzdHJpbmcgYXQgc3Ryc3RhcnQgYWxyZWFkeSBpbiB0YWJsZSAqLwogICAgICAgIGRvIHsKICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICAgIC8qKiogSU5TRVJUX1NUUklORyhzLCBzLnN0cnN0YXJ0LCBoYXNoX2hlYWQpOyAqKiovCiAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pOwogICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzLnN0cnN0YXJ0OwogICAgICAgICAgLyoqKi8KICAgICAgICAgIC8qIHN0cnN0YXJ0IG5ldmVyIGV4Y2VlZHMgV1NJWkUtTUFYX01BVENILCBzbyB0aGVyZSBhcmUKICAgICAgICAgICAqIGFsd2F5cyBNSU5fTUFUQ0ggYnl0ZXMgYWhlYWQuCiAgICAgICAgICAgKi8KICAgICAgICB9IHdoaWxlICgtLXMubWF0Y2hfbGVuZ3RoICE9PSAwKTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0gZWxzZQogICAgICB7CiAgICAgICAgcy5zdHJzdGFydCArPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgcy5pbnNfaCA9IHMud2luZG93W3Muc3Ryc3RhcnRdOwogICAgICAgIC8qIFVQREFURV9IQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQrMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyAxXSk7CgovLyNpZiBNSU5fTUFUQ0ggIT0gMwovLyAgICAgICAgICAgICAgICBDYWxsIFVQREFURV9IQVNIKCkgTUlOX01BVENILTMgbW9yZSB0aW1lcwovLyNlbmRpZgogICAgICAgIC8qIElmIGxvb2thaGVhZCA8IE1JTl9NQVRDSCwgaW5zX2ggaXMgZ2FyYmFnZSwgYnV0IGl0IGRvZXMgbm90CiAgICAgICAgICogbWF0dGVyIHNpbmNlIGl0IHdpbGwgYmUgcmVjb21wdXRlZCBhdCBuZXh0IGRlZmxhdGUgY2FsbC4KICAgICAgICAgKi8KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLyogTm8gbWF0Y2gsIG91dHB1dCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSkpOwogICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydF0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgIHMubG9va2FoZWFkLS07CiAgICAgIHMuc3Ryc3RhcnQrKzsKICAgIH0KICAgIGlmIChiZmx1c2gpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgfQogIHMuaW5zZXJ0ID0gKChzLnN0cnN0YXJ0IDwgKE1JTl9NQVRDSCAtIDEpKSA/IHMuc3Ryc3RhcnQgOiBNSU5fTUFUQ0ggLSAxKTsKICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICB9CiAgICAvKioqLwogICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogIH0KICBpZiAocy5sYXN0X2xpdCkgewogICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgfQogICAgLyoqKi8KICB9CiAgcmV0dXJuIEJTX0JMT0NLX0RPTkU7Cn07CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogU2FtZSBhcyBhYm92ZSwgYnV0IGFjaGlldmVzIGJldHRlciBjb21wcmVzc2lvbi4gV2UgdXNlIGEgbGF6eQogKiBldmFsdWF0aW9uIGZvciBtYXRjaGVzOiBhIG1hdGNoIGlzIGZpbmFsbHkgYWRvcHRlZCBvbmx5IGlmIHRoZXJlIGlzCiAqIG5vIGJldHRlciBtYXRjaCBhdCB0aGUgbmV4dCB3aW5kb3cgcG9zaXRpb24uCiAqLwpjb25zdCBkZWZsYXRlX3Nsb3cgPSAocywgZmx1c2gpID0+IHsKCiAgbGV0IGhhc2hfaGVhZDsgICAgICAgICAgLyogaGVhZCBvZiBoYXNoIGNoYWluICovCiAgbGV0IGJmbHVzaDsgICAgICAgICAgICAgIC8qIHNldCBpZiBjdXJyZW50IGJsb2NrIG11c3QgYmUgZmx1c2hlZCAqLwoKICBsZXQgbWF4X2luc2VydDsKCiAgLyogUHJvY2VzcyB0aGUgaW5wdXQgYmxvY2suICovCiAgZm9yICg7OykgewogICAgLyogTWFrZSBzdXJlIHRoYXQgd2UgYWx3YXlzIGhhdmUgZW5vdWdoIGxvb2thaGVhZCwgZXhjZXB0CiAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICogZm9yIHRoZSBuZXh0IG1hdGNoLCBwbHVzIE1JTl9NQVRDSCBieXRlcyB0byBpbnNlcnQgdGhlCiAgICAgKiBzdHJpbmcgZm9sbG93aW5nIHRoZSBuZXh0IG1hdGNoLgogICAgICovCiAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEKSB7CiAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgeyBicmVhazsgfSAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgfQoKICAgIC8qIEluc2VydCB0aGUgc3RyaW5nIHdpbmRvd1tzdHJzdGFydCAuLiBzdHJzdGFydCsyXSBpbiB0aGUKICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICovCiAgICBoYXNoX2hlYWQgPSAwLypOSUwqLzsKICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgLyoqKiBJTlNFUlRfU1RSSU5HKHMsIHMuc3Ryc3RhcnQsIGhhc2hfaGVhZCk7ICoqKi8KICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKTsKICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgIC8qKiovCiAgICB9CgogICAgLyogRmluZCB0aGUgbG9uZ2VzdCBtYXRjaCwgZGlzY2FyZGluZyB0aG9zZSA8PSBwcmV2X2xlbmd0aC4KICAgICAqLwogICAgcy5wcmV2X2xlbmd0aCA9IHMubWF0Y2hfbGVuZ3RoOwogICAgcy5wcmV2X21hdGNoID0gcy5tYXRjaF9zdGFydDsKICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKCiAgICBpZiAoaGFzaF9oZWFkICE9PSAwLypOSUwqLyAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJgogICAgICAgIHMuc3Ryc3RhcnQgLSBoYXNoX2hlYWQgPD0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkvKk1BWF9ESVNUKHMpKi8pIHsKICAgICAgLyogVG8gc2ltcGxpZnkgdGhlIGNvZGUsIHdlIHByZXZlbnQgbWF0Y2hlcyB3aXRoIHRoZSBzdHJpbmcKICAgICAgICogb2Ygd2luZG93IGluZGV4IDAgKGluIHBhcnRpY3VsYXIgd2UgaGF2ZSB0byBhdm9pZCBhIG1hdGNoCiAgICAgICAqIG9mIHRoZSBzdHJpbmcgd2l0aCBpdHNlbGYgYXQgdGhlIHN0YXJ0IG9mIHRoZSBpbnB1dCBmaWxlKS4KICAgICAgICovCiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAvKiBsb25nZXN0X21hdGNoKCkgc2V0cyBtYXRjaF9zdGFydCAqLwoKICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoIDw9IDUgJiYKICAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfRklMVEVSRUQgfHwgKHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2LypUT09fRkFSKi8pKSkgewoKICAgICAgICAvKiBJZiBwcmV2X21hdGNoIGlzIGFsc28gTUlOX01BVENILCBtYXRjaF9zdGFydCBpcyBnYXJiYWdlCiAgICAgICAgICogYnV0IHdlIHdpbGwgaWdub3JlIHRoZSBjdXJyZW50IG1hdGNoIGFueXdheS4KICAgICAgICAgKi8KICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgIH0KICAgIH0KICAgIC8qIElmIHRoZXJlIHdhcyBhIG1hdGNoIGF0IHRoZSBwcmV2aW91cyBzdGVwIGFuZCB0aGUgY3VycmVudAogICAgICogbWF0Y2ggaXMgbm90IGJldHRlciwgb3V0cHV0IHRoZSBwcmV2aW91cyBtYXRjaDoKICAgICAqLwogICAgaWYgKHMucHJldl9sZW5ndGggPj0gTUlOX01BVENIICYmIHMubWF0Y2hfbGVuZ3RoIDw9IHMucHJldl9sZW5ndGgpIHsKICAgICAgbWF4X2luc2VydCA9IHMuc3Ryc3RhcnQgKyBzLmxvb2thaGVhZCAtIE1JTl9NQVRDSDsKICAgICAgLyogRG8gbm90IGluc2VydCBzdHJpbmdzIGluIGhhc2ggdGFibGUgYmV5b25kIHRoaXMuICovCgogICAgICAvL2NoZWNrX21hdGNoKHMsIHMuc3Ryc3RhcnQtMSwgcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoKTsKCiAgICAgIC8qKipfdHJfdGFsbHlfZGlzdChzLCBzLnN0cnN0YXJ0IC0gMSAtIHMucHJldl9tYXRjaCwKICAgICAgICAgICAgICAgICAgICAgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsqKiovCiAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCBzLnN0cnN0YXJ0IC0gMSAtIHMucHJldl9tYXRjaCwgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCk7CiAgICAgIC8qIEluc2VydCBpbiBoYXNoIHRhYmxlIGFsbCBzdHJpbmdzIHVwIHRvIHRoZSBlbmQgb2YgdGhlIG1hdGNoLgogICAgICAgKiBzdHJzdGFydC0xIGFuZCBzdHJzdGFydCBhcmUgYWxyZWFkeSBpbnNlcnRlZC4gSWYgdGhlcmUgaXMgbm90CiAgICAgICAqIGVub3VnaCBsb29rYWhlYWQsIHRoZSBsYXN0IHR3byBzdHJpbmdzIGFyZSBub3QgaW5zZXJ0ZWQgaW4KICAgICAgICogdGhlIGhhc2ggdGFibGUuCiAgICAgICAqLwogICAgICBzLmxvb2thaGVhZCAtPSBzLnByZXZfbGVuZ3RoIC0gMTsKICAgICAgcy5wcmV2X2xlbmd0aCAtPSAyOwogICAgICBkbyB7CiAgICAgICAgaWYgKCsrcy5zdHJzdGFydCA8PSBtYXhfaW5zZXJ0KSB7CiAgICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKTsKICAgICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAgIC8qKiovCiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLXMucHJldl9sZW5ndGggIT09IDApOwogICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgcy5zdHJzdGFydCsrOwoKICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQoKICAgIH0gZWxzZSBpZiAocy5tYXRjaF9hdmFpbGFibGUpIHsKICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIG1hdGNoIGF0IHRoZSBwcmV2aW91cyBwb3NpdGlvbiwgb3V0cHV0IGEKICAgICAgICogc2luZ2xlIGxpdGVyYWwuIElmIHRoZXJlIHdhcyBhIG1hdGNoIGJ1dCB0aGUgY3VycmVudCBtYXRjaAogICAgICAgKiBpcyBsb25nZXIsIHRydW5jYXRlIHRoZSBwcmV2aW91cyBtYXRjaCB0byBhIHNpbmdsZSBsaXRlcmFsLgogICAgICAgKi8KICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0LTFdKSk7CiAgICAgIC8qKiogX3RyX3RhbGx5X2xpdChzLCBzLndpbmRvd1tzLnN0cnN0YXJ0LTFdLCBiZmx1c2gpOyAqKiovCiAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwoKICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0tfT05MWShzLCAwKSAqKiovCiAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIHMubG9va2FoZWFkLS07CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLyogVGhlcmUgaXMgbm8gcHJldmlvdXMgbWF0Y2ggdG8gY29tcGFyZSB3aXRoLCB3YWl0IGZvcgogICAgICAgKiB0aGUgbmV4dCBzdGVwIHRvIGRlY2lkZS4KICAgICAgICovCiAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMTsKICAgICAgcy5zdHJzdGFydCsrOwogICAgICBzLmxvb2thaGVhZC0tOwogICAgfQogIH0KICAvL0Fzc2VydCAoZmx1c2ggIT0gWl9OT19GTFVTSCwgIm5vIGZsdXNoPyIpOwogIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0LTFdKSk7CiAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydC0xXSwgYmZsdXNoKTsgKioqLwogICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CgogICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogIH0KICBzLmluc2VydCA9IHMuc3Ryc3RhcnQgPCBNSU5fTUFUQ0ggLSAxID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDE7CiAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDEpOyAqKiovCiAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgfQogICAgLyoqKi8KICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICB9CiAgaWYgKHMubGFzdF9saXQpIHsKICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgIH0KICAgIC8qKiovCiAgfQoKICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogRm9yIFpfUkxFLCBzaW1wbHkgbG9vayBmb3IgcnVucyBvZiBieXRlcywgZ2VuZXJhdGUgbWF0Y2hlcyBvbmx5IG9mIGRpc3RhbmNlCiAqIG9uZS4gIERvIG5vdCBtYWludGFpbiBhIGhhc2ggdGFibGUuICAoSXQgd2lsbCBiZSByZWdlbmVyYXRlZCBpZiB0aGlzIHJ1biBvZgogKiBkZWZsYXRlIHN3aXRjaGVzIGF3YXkgZnJvbSBaX1JMRS4pCiAqLwpjb25zdCBkZWZsYXRlX3JsZSA9IChzLCBmbHVzaCkgPT4gewoKICBsZXQgYmZsdXNoOyAgICAgICAgICAgIC8qIHNldCBpZiBjdXJyZW50IGJsb2NrIG11c3QgYmUgZmx1c2hlZCAqLwogIGxldCBwcmV2OyAgICAgICAgICAgICAgLyogYnl0ZSBhdCBkaXN0YW5jZSBvbmUgdG8gbWF0Y2ggKi8KICBsZXQgc2Nhbiwgc3RyZW5kOyAgICAgIC8qIHNjYW4gZ29lcyB1cCB0byBzdHJlbmQgZm9yIGxlbmd0aCBvZiBydW4gKi8KCiAgY29uc3QgX3dpbiA9IHMud2luZG93OwoKICBmb3IgKDs7KSB7CiAgICAvKiBNYWtlIHN1cmUgdGhhdCB3ZSBhbHdheXMgaGF2ZSBlbm91Z2ggbG9va2FoZWFkLCBleGNlcHQKICAgICAqIGF0IHRoZSBlbmQgb2YgdGhlIGlucHV0IGZpbGUuIFdlIG5lZWQgTUFYX01BVENIIGJ5dGVzCiAgICAgKiBmb3IgdGhlIGxvbmdlc3QgcnVuLCBwbHVzIG9uZSBmb3IgdGhlIHVucm9sbGVkIGxvb3AuCiAgICAgKi8KICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0gpIHsKICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0ggJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMikgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7IGJyZWFrOyB9IC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICB9CgogICAgLyogU2VlIGhvdyBtYW55IHRpbWVzIHRoZSBwcmV2aW91cyBieXRlIHJlcGVhdHMgKi8KICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCA+IDApIHsKICAgICAgc2NhbiA9IHMuc3Ryc3RhcnQgLSAxOwogICAgICBwcmV2ID0gX3dpbltzY2FuXTsKICAgICAgaWYgKHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dKSB7CiAgICAgICAgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgICAgICBkbyB7CiAgICAgICAgICAvKmpzaGludCBub2VtcHR5OmZhbHNlKi8KICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJgogICAgICAgICAgICAgICAgIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYKICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgc2NhbiA8IHN0cmVuZCk7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNQVhfTUFUQ0ggLSAoc3RyZW5kIC0gc2Nhbik7CiAgICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5sb29rYWhlYWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vQXNzZXJ0KHNjYW4gPD0gcy0+d2luZG93Kyh1SW50KShzLT53aW5kb3dfc2l6ZS0xKSwgIndpbGQgc2NhbiIpOwogICAgfQoKICAgIC8qIEVtaXQgbWF0Y2ggaWYgaGF2ZSBydW4gb2YgTUlOX01BVENIIG9yIGxvbmdlciwgZWxzZSBlbWl0IGxpdGVyYWwgKi8KICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgLy9jaGVja19tYXRjaChzLCBzLnN0cnN0YXJ0LCBzLnN0cnN0YXJ0IC0gMSwgcy5tYXRjaF9sZW5ndGgpOwoKICAgICAgLyoqKiBfdHJfdGFsbHlfZGlzdChzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsgKioqLwogICAgICBiZmx1c2ggPSBfdHJfdGFsbHkocywgMSwgcy5tYXRjaF9sZW5ndGggLSBNSU5fTUFUQ0gpOwoKICAgICAgcy5sb29rYWhlYWQgLT0gcy5tYXRjaF9sZW5ndGg7CiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIC8qIE5vIG1hdGNoLCBvdXRwdXQgYSBsaXRlcmFsIGJ5dGUgKi8KICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0XSkpOwogICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydF0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgIHMubG9va2FoZWFkLS07CiAgICAgIHMuc3Ryc3RhcnQrKzsKICAgIH0KICAgIGlmIChiZmx1c2gpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgfQogIHMuaW5zZXJ0ID0gMDsKICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICB9CiAgICAvKioqLwogICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogIH0KICBpZiAocy5sYXN0X2xpdCkgewogICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgfQogICAgLyoqKi8KICB9CiAgcmV0dXJuIEJTX0JMT0NLX0RPTkU7Cn07CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogRm9yIFpfSFVGRk1BTl9PTkxZLCBkbyBub3QgbG9vayBmb3IgbWF0Y2hlcy4gIERvIG5vdCBtYWludGFpbiBhIGhhc2ggdGFibGUuCiAqIChJdCB3aWxsIGJlIHJlZ2VuZXJhdGVkIGlmIHRoaXMgcnVuIG9mIGRlZmxhdGUgc3dpdGNoZXMgYXdheSBmcm9tIEh1ZmZtYW4uKQogKi8KY29uc3QgZGVmbGF0ZV9odWZmID0gKHMsIGZsdXNoKSA9PiB7CgogIGxldCBiZmx1c2g7ICAgICAgICAgICAgIC8qIHNldCBpZiBjdXJyZW50IGJsb2NrIG11c3QgYmUgZmx1c2hlZCAqLwoKICBmb3IgKDs7KSB7CiAgICAvKiBNYWtlIHN1cmUgdGhhdCB3ZSBoYXZlIGEgbGl0ZXJhbCB0byB3cml0ZS4gKi8KICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgaWYgKGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOyAgICAgIC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgIH0KICAgIH0KCiAgICAvKiBPdXRwdXQgYSBsaXRlcmFsIGJ5dGUgKi8KICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgIC8vVHJhY2V2digoc3RkZXJyLCIlYyIsIHMtPndpbmRvd1tzLT5zdHJzdGFydF0pKTsKICAgIC8qKiogX3RyX3RhbGx5X2xpdChzLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSwgYmZsdXNoKTsgKioqLwogICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKICAgIHMubG9va2FoZWFkLS07CiAgICBzLnN0cnN0YXJ0Kys7CiAgICBpZiAoYmZsdXNoKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQogICAgICAvKioqLwogICAgfQogIH0KICBzLmluc2VydCA9IDA7CiAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDEpOyAqKiovCiAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgfQogICAgLyoqKi8KICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICB9CiAgaWYgKHMubGFzdF9saXQpIHsKICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgIH0KICAgIC8qKiovCiAgfQogIHJldHVybiBCU19CTE9DS19ET05FOwp9OwoKLyogVmFsdWVzIGZvciBtYXhfbGF6eV9tYXRjaCwgZ29vZF9tYXRjaCBhbmQgbWF4X2NoYWluX2xlbmd0aCwgZGVwZW5kaW5nIG9uCiAqIHRoZSBkZXNpcmVkIHBhY2sgbGV2ZWwgKDAuLjkpLiBUaGUgdmFsdWVzIGdpdmVuIGJlbG93IGhhdmUgYmVlbiB0dW5lZCB0bwogKiBleGNsdWRlIHdvcnN0IGNhc2UgcGVyZm9ybWFuY2UgZm9yIHBhdGhvbG9naWNhbCBmaWxlcy4gQmV0dGVyIHZhbHVlcyBtYXkgYmUKICogZm91bmQgZm9yIHNwZWNpZmljIGZpbGVzLgogKi8KZnVuY3Rpb24gQ29uZmlnKGdvb2RfbGVuZ3RoLCBtYXhfbGF6eSwgbmljZV9sZW5ndGgsIG1heF9jaGFpbiwgZnVuYykgewoKICB0aGlzLmdvb2RfbGVuZ3RoID0gZ29vZF9sZW5ndGg7CiAgdGhpcy5tYXhfbGF6eSA9IG1heF9sYXp5OwogIHRoaXMubmljZV9sZW5ndGggPSBuaWNlX2xlbmd0aDsKICB0aGlzLm1heF9jaGFpbiA9IG1heF9jaGFpbjsKICB0aGlzLmZ1bmMgPSBmdW5jOwp9Cgpjb25zdCBjb25maWd1cmF0aW9uX3RhYmxlID0gWwogIC8qICAgICAgZ29vZCBsYXp5IG5pY2UgY2hhaW4gKi8KICBuZXcgQ29uZmlnKDAsIDAsIDAsIDAsIGRlZmxhdGVfc3RvcmVkKSwgICAgICAgICAgLyogMCBzdG9yZSBvbmx5ICovCiAgbmV3IENvbmZpZyg0LCA0LCA4LCA0LCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAgIC8qIDEgbWF4IHNwZWVkLCBubyBsYXp5IG1hdGNoZXMgKi8KICBuZXcgQ29uZmlnKDQsIDUsIDE2LCA4LCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAgLyogMiAqLwogIG5ldyBDb25maWcoNCwgNiwgMzIsIDMyLCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAvKiAzICovCgogIG5ldyBDb25maWcoNCwgNCwgMTYsIDE2LCBkZWZsYXRlX3Nsb3cpLCAgICAgICAgICAvKiA0IGxhenkgbWF0Y2hlcyAqLwogIG5ldyBDb25maWcoOCwgMTYsIDMyLCAzMiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAvKiA1ICovCiAgbmV3IENvbmZpZyg4LCAxNiwgMTI4LCAxMjgsIGRlZmxhdGVfc2xvdyksICAgICAgIC8qIDYgKi8KICBuZXcgQ29uZmlnKDgsIDMyLCAxMjgsIDI1NiwgZGVmbGF0ZV9zbG93KSwgICAgICAgLyogNyAqLwogIG5ldyBDb25maWcoMzIsIDEyOCwgMjU4LCAxMDI0LCBkZWZsYXRlX3Nsb3cpLCAgICAvKiA4ICovCiAgbmV3IENvbmZpZygzMiwgMjU4LCAyNTgsIDQwOTYsIGRlZmxhdGVfc2xvdykgICAgIC8qIDkgbWF4IGNvbXByZXNzaW9uICovCl07CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEluaXRpYWxpemUgdGhlICJsb25nZXN0IG1hdGNoIiByb3V0aW5lcyBmb3IgYSBuZXcgemxpYiBzdHJlYW0KICovCmNvbnN0IGxtX2luaXQgPSAocykgPT4gewoKICBzLndpbmRvd19zaXplID0gMiAqIHMud19zaXplOwoKICAvKioqIENMRUFSX0hBU0gocyk7ICoqKi8KICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CgogIC8qIFNldCB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIHBhcmFtZXRlcnM6CiAgICovCiAgcy5tYXhfbGF6eV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2xhenk7CiAgcy5nb29kX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5nb29kX2xlbmd0aDsKICBzLm5pY2VfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLm5pY2VfbGVuZ3RoOwogIHMubWF4X2NoYWluX2xlbmd0aCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2NoYWluOwoKICBzLnN0cnN0YXJ0ID0gMDsKICBzLmJsb2NrX3N0YXJ0ID0gMDsKICBzLmxvb2thaGVhZCA9IDA7CiAgcy5pbnNlcnQgPSAwOwogIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogIHMuaW5zX2ggPSAwOwp9OwoKCmZ1bmN0aW9uIERlZmxhdGVTdGF0ZSgpIHsKICB0aGlzLnN0cm0gPSBudWxsOyAgICAgICAgICAgIC8qIHBvaW50ZXIgYmFjayB0byB0aGlzIHpsaWIgc3RyZWFtICovCiAgdGhpcy5zdGF0dXMgPSAwOyAgICAgICAgICAgIC8qIGFzIHRoZSBuYW1lIGltcGxpZXMgKi8KICB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbDsgICAgICAvKiBvdXRwdXQgc3RpbGwgcGVuZGluZyAqLwogIHRoaXMucGVuZGluZ19idWZfc2l6ZSA9IDA7ICAvKiBzaXplIG9mIHBlbmRpbmdfYnVmICovCiAgdGhpcy5wZW5kaW5nX291dCA9IDA7ICAgICAgIC8qIG5leHQgcGVuZGluZyBieXRlIHRvIG91dHB1dCB0byB0aGUgc3RyZWFtICovCiAgdGhpcy5wZW5kaW5nID0gMDsgICAgICAgICAgIC8qIG5iIG9mIGJ5dGVzIGluIHRoZSBwZW5kaW5nIGJ1ZmZlciAqLwogIHRoaXMud3JhcCA9IDA7ICAgICAgICAgICAgICAvKiBiaXQgMCB0cnVlIGZvciB6bGliLCBiaXQgMSB0cnVlIGZvciBnemlwICovCiAgdGhpcy5nemhlYWQgPSBudWxsOyAgICAgICAgIC8qIGd6aXAgaGVhZGVyIGluZm9ybWF0aW9uIHRvIHdyaXRlICovCiAgdGhpcy5nemluZGV4ID0gMDsgICAgICAgICAgIC8qIHdoZXJlIGluIGV4dHJhLCBuYW1lLCBvciBjb21tZW50ICovCiAgdGhpcy5tZXRob2QgPSBaX0RFRkxBVEVEJDI7IC8qIGNhbiBvbmx5IGJlIERFRkxBVEVEICovCiAgdGhpcy5sYXN0X2ZsdXNoID0gLTE7ICAgLyogdmFsdWUgb2YgZmx1c2ggcGFyYW0gZm9yIHByZXZpb3VzIGRlZmxhdGUgY2FsbCAqLwoKICB0aGlzLndfc2l6ZSA9IDA7ICAvKiBMWjc3IHdpbmRvdyBzaXplICgzMksgYnkgZGVmYXVsdCkgKi8KICB0aGlzLndfYml0cyA9IDA7ICAvKiBsb2cyKHdfc2l6ZSkgICg4Li4xNikgKi8KICB0aGlzLndfbWFzayA9IDA7ICAvKiB3X3NpemUgLSAxICovCgogIHRoaXMud2luZG93ID0gbnVsbDsKICAvKiBTbGlkaW5nIHdpbmRvdy4gSW5wdXQgYnl0ZXMgYXJlIHJlYWQgaW50byB0aGUgc2Vjb25kIGhhbGYgb2YgdGhlIHdpbmRvdywKICAgKiBhbmQgbW92ZSB0byB0aGUgZmlyc3QgaGFsZiBsYXRlciB0byBrZWVwIGEgZGljdGlvbmFyeSBvZiBhdCBsZWFzdCB3U2l6ZQogICAqIGJ5dGVzLiBXaXRoIHRoaXMgb3JnYW5pemF0aW9uLCBtYXRjaGVzIGFyZSBsaW1pdGVkIHRvIGEgZGlzdGFuY2Ugb2YKICAgKiB3U2l6ZS1NQVhfTUFUQ0ggYnl0ZXMsIGJ1dCB0aGlzIGVuc3VyZXMgdGhhdCBJTyBpcyBhbHdheXMKICAgKiBwZXJmb3JtZWQgd2l0aCBhIGxlbmd0aCBtdWx0aXBsZSBvZiB0aGUgYmxvY2sgc2l6ZS4KICAgKi8KCiAgdGhpcy53aW5kb3dfc2l6ZSA9IDA7CiAgLyogQWN0dWFsIHNpemUgb2Ygd2luZG93OiAyKndTaXplLCBleGNlcHQgd2hlbiB0aGUgdXNlciBpbnB1dCBidWZmZXIKICAgKiBpcyBkaXJlY3RseSB1c2VkIGFzIHNsaWRpbmcgd2luZG93LgogICAqLwoKICB0aGlzLnByZXYgPSBudWxsOwogIC8qIExpbmsgdG8gb2xkZXIgc3RyaW5nIHdpdGggc2FtZSBoYXNoIGluZGV4LiBUbyBsaW1pdCB0aGUgc2l6ZSBvZiB0aGlzCiAgICogYXJyYXkgdG8gNjRLLCB0aGlzIGxpbmsgaXMgbWFpbnRhaW5lZCBvbmx5IGZvciB0aGUgbGFzdCAzMksgc3RyaW5ncy4KICAgKiBBbiBpbmRleCBpbiB0aGlzIGFycmF5IGlzIHRodXMgYSB3aW5kb3cgaW5kZXggbW9kdWxvIDMySy4KICAgKi8KCiAgdGhpcy5oZWFkID0gbnVsbDsgICAvKiBIZWFkcyBvZiB0aGUgaGFzaCBjaGFpbnMgb3IgTklMLiAqLwoKICB0aGlzLmluc19oID0gMDsgICAgICAgLyogaGFzaCBpbmRleCBvZiBzdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgKi8KICB0aGlzLmhhc2hfc2l6ZSA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIGluIGhhc2ggdGFibGUgKi8KICB0aGlzLmhhc2hfYml0cyA9IDA7ICAgLyogbG9nMihoYXNoX3NpemUpICovCiAgdGhpcy5oYXNoX21hc2sgPSAwOyAgIC8qIGhhc2hfc2l6ZS0xICovCgogIHRoaXMuaGFzaF9zaGlmdCA9IDA7CiAgLyogTnVtYmVyIG9mIGJpdHMgYnkgd2hpY2ggaW5zX2ggbXVzdCBiZSBzaGlmdGVkIGF0IGVhY2ggaW5wdXQKICAgKiBzdGVwLiBJdCBtdXN0IGJlIHN1Y2ggdGhhdCBhZnRlciBNSU5fTUFUQ0ggc3RlcHMsIHRoZSBvbGRlc3QKICAgKiBieXRlIG5vIGxvbmdlciB0YWtlcyBwYXJ0IGluIHRoZSBoYXNoIGtleSwgdGhhdCBpczoKICAgKiAgIGhhc2hfc2hpZnQgKiBNSU5fTUFUQ0ggPj0gaGFzaF9iaXRzCiAgICovCgogIHRoaXMuYmxvY2tfc3RhcnQgPSAwOwogIC8qIFdpbmRvdyBwb3NpdGlvbiBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjdXJyZW50IG91dHB1dCBibG9jay4gR2V0cwogICAqIG5lZ2F0aXZlIHdoZW4gdGhlIHdpbmRvdyBpcyBtb3ZlZCBiYWNrd2FyZHMuCiAgICovCgogIHRoaXMubWF0Y2hfbGVuZ3RoID0gMDsgICAgICAvKiBsZW5ndGggb2YgYmVzdCBtYXRjaCAqLwogIHRoaXMucHJldl9tYXRjaCA9IDA7ICAgICAgICAvKiBwcmV2aW91cyBtYXRjaCAqLwogIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMDsgICAvKiBzZXQgaWYgcHJldmlvdXMgbWF0Y2ggZXhpc3RzICovCiAgdGhpcy5zdHJzdGFydCA9IDA7ICAgICAgICAgIC8qIHN0YXJ0IG9mIHN0cmluZyB0byBpbnNlcnQgKi8KICB0aGlzLm1hdGNoX3N0YXJ0ID0gMDsgICAgICAgLyogc3RhcnQgb2YgbWF0Y2hpbmcgc3RyaW5nICovCiAgdGhpcy5sb29rYWhlYWQgPSAwOyAgICAgICAgIC8qIG51bWJlciBvZiB2YWxpZCBieXRlcyBhaGVhZCBpbiB3aW5kb3cgKi8KCiAgdGhpcy5wcmV2X2xlbmd0aCA9IDA7CiAgLyogTGVuZ3RoIG9mIHRoZSBiZXN0IG1hdGNoIGF0IHByZXZpb3VzIHN0ZXAuIE1hdGNoZXMgbm90IGdyZWF0ZXIgdGhhbiB0aGlzCiAgICogYXJlIGRpc2NhcmRlZC4gVGhpcyBpcyB1c2VkIGluIHRoZSBsYXp5IG1hdGNoIGV2YWx1YXRpb24uCiAgICovCgogIHRoaXMubWF4X2NoYWluX2xlbmd0aCA9IDA7CiAgLyogVG8gc3BlZWQgdXAgZGVmbGF0aW9uLCBoYXNoIGNoYWlucyBhcmUgbmV2ZXIgc2VhcmNoZWQgYmV5b25kIHRoaXMKICAgKiBsZW5ndGguICBBIGhpZ2hlciBsaW1pdCBpbXByb3ZlcyBjb21wcmVzc2lvbiByYXRpbyBidXQgZGVncmFkZXMgdGhlCiAgICogc3BlZWQuCiAgICovCgogIHRoaXMubWF4X2xhenlfbWF0Y2ggPSAwOwogIC8qIEF0dGVtcHQgdG8gZmluZCBhIGJldHRlciBtYXRjaCBvbmx5IHdoZW4gdGhlIGN1cnJlbnQgbWF0Y2ggaXMgc3RyaWN0bHkKICAgKiBzbWFsbGVyIHRoYW4gdGhpcyB2YWx1ZS4gVGhpcyBtZWNoYW5pc20gaXMgdXNlZCBvbmx5IGZvciBjb21wcmVzc2lvbgogICAqIGxldmVscyA+PSA0LgogICAqLwogIC8vIFRoYXQncyBhbGlhcyB0byBtYXhfbGF6eV9tYXRjaCwgZG9uJ3QgdXNlIGRpcmVjdGx5CiAgLy90aGlzLm1heF9pbnNlcnRfbGVuZ3RoID0gMDsKICAvKiBJbnNlcnQgbmV3IHN0cmluZ3MgaW4gdGhlIGhhc2ggdGFibGUgb25seSBpZiB0aGUgbWF0Y2ggbGVuZ3RoIGlzIG5vdAogICAqIGdyZWF0ZXIgdGhhbiB0aGlzIGxlbmd0aC4gVGhpcyBzYXZlcyB0aW1lIGJ1dCBkZWdyYWRlcyBjb21wcmVzc2lvbi4KICAgKiBtYXhfaW5zZXJ0X2xlbmd0aCBpcyB1c2VkIG9ubHkgZm9yIGNvbXByZXNzaW9uIGxldmVscyA8PSAzLgogICAqLwoKICB0aGlzLmxldmVsID0gMDsgICAgIC8qIGNvbXByZXNzaW9uIGxldmVsICgxLi45KSAqLwogIHRoaXMuc3RyYXRlZ3kgPSAwOyAgLyogZmF2b3Igb3IgZm9yY2UgSHVmZm1hbiBjb2RpbmcqLwoKICB0aGlzLmdvb2RfbWF0Y2ggPSAwOwogIC8qIFVzZSBhIGZhc3RlciBzZWFyY2ggd2hlbiB0aGUgcHJldmlvdXMgbWF0Y2ggaXMgbG9uZ2VyIHRoYW4gdGhpcyAqLwoKICB0aGlzLm5pY2VfbWF0Y2ggPSAwOyAvKiBTdG9wIHNlYXJjaGluZyB3aGVuIGN1cnJlbnQgbWF0Y2ggZXhjZWVkcyB0aGlzICovCgogICAgICAgICAgICAgIC8qIHVzZWQgYnkgdHJlZXMuYzogKi8KCiAgLyogRGlkbid0IHVzZSBjdF9kYXRhIHR5cGVkZWYgYmVsb3cgdG8gc3VwcHJlc3MgY29tcGlsZXIgd2FybmluZyAqLwoKICAvLyBzdHJ1Y3QgY3RfZGF0YV9zIGR5bl9sdHJlZVtIRUFQX1NJWkVdOyAgIC8qIGxpdGVyYWwgYW5kIGxlbmd0aCB0cmVlICovCiAgLy8gc3RydWN0IGN0X2RhdGFfcyBkeW5fZHRyZWVbMipEX0NPREVTKzFdOyAvKiBkaXN0YW5jZSB0cmVlICovCiAgLy8gc3RydWN0IGN0X2RhdGFfcyBibF90cmVlWzIqQkxfQ09ERVMrMV07ICAvKiBIdWZmbWFuIHRyZWUgZm9yIGJpdCBsZW5ndGhzICovCgogIC8vIFVzZSBmbGF0IGFycmF5IG9mIERPVUJMRSBzaXplLCB3aXRoIGludGVybGVhdmVkIGZhdGEsCiAgLy8gYmVjYXVzZSBKUyBkb2VzIG5vdCBzdXBwb3J0IGVmZmVjdGl2ZQogIHRoaXMuZHluX2x0cmVlICA9IG5ldyBVaW50MTZBcnJheShIRUFQX1NJWkUgKiAyKTsKICB0aGlzLmR5bl9kdHJlZSAgPSBuZXcgVWludDE2QXJyYXkoKDIgKiBEX0NPREVTICsgMSkgKiAyKTsKICB0aGlzLmJsX3RyZWUgICAgPSBuZXcgVWludDE2QXJyYXkoKDIgKiBCTF9DT0RFUyArIDEpICogMik7CiAgemVybyh0aGlzLmR5bl9sdHJlZSk7CiAgemVybyh0aGlzLmR5bl9kdHJlZSk7CiAgemVybyh0aGlzLmJsX3RyZWUpOwoKICB0aGlzLmxfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgbGl0ZXJhbCB0cmVlICovCiAgdGhpcy5kX2Rlc2MgICA9IG51bGw7ICAgICAgICAgLyogZGVzYy4gZm9yIGRpc3RhbmNlIHRyZWUgKi8KICB0aGlzLmJsX2Rlc2MgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgYml0IGxlbmd0aCB0cmVlICovCgogIC8vdXNoIGJsX2NvdW50W01BWF9CSVRTKzFdOwogIHRoaXMuYmxfY291bnQgPSBuZXcgVWludDE2QXJyYXkoTUFYX0JJVFMgKyAxKTsKICAvKiBudW1iZXIgb2YgY29kZXMgYXQgZWFjaCBiaXQgbGVuZ3RoIGZvciBhbiBvcHRpbWFsIHRyZWUgKi8KCiAgLy9pbnQgaGVhcFsyKkxfQ09ERVMrMV07ICAgICAgLyogaGVhcCB1c2VkIHRvIGJ1aWxkIHRoZSBIdWZmbWFuIHRyZWVzICovCiAgdGhpcy5oZWFwID0gbmV3IFVpbnQxNkFycmF5KDIgKiBMX0NPREVTICsgMSk7ICAvKiBoZWFwIHVzZWQgdG8gYnVpbGQgdGhlIEh1ZmZtYW4gdHJlZXMgKi8KICB6ZXJvKHRoaXMuaGVhcCk7CgogIHRoaXMuaGVhcF9sZW4gPSAwOyAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgaGVhcCAqLwogIHRoaXMuaGVhcF9tYXggPSAwOyAgICAgICAgICAgICAgIC8qIGVsZW1lbnQgb2YgbGFyZ2VzdCBmcmVxdWVuY3kgKi8KICAvKiBUaGUgc29ucyBvZiBoZWFwW25dIGFyZSBoZWFwWzIqbl0gYW5kIGhlYXBbMipuKzFdLiBoZWFwWzBdIGlzIG5vdCB1c2VkLgogICAqIFRoZSBzYW1lIGhlYXAgYXJyYXkgaXMgdXNlZCB0byBidWlsZCBhbGwgdHJlZXMuCiAgICovCgogIHRoaXMuZGVwdGggPSBuZXcgVWludDE2QXJyYXkoMiAqIExfQ09ERVMgKyAxKTsgLy91Y2ggZGVwdGhbMipMX0NPREVTKzFdOwogIHplcm8odGhpcy5kZXB0aCk7CiAgLyogRGVwdGggb2YgZWFjaCBzdWJ0cmVlIHVzZWQgYXMgdGllIGJyZWFrZXIgZm9yIHRyZWVzIG9mIGVxdWFsIGZyZXF1ZW5jeQogICAqLwoKICB0aGlzLmxfYnVmID0gMDsgICAgICAgICAgLyogYnVmZmVyIGluZGV4IGZvciBsaXRlcmFscyBvciBsZW5ndGhzICovCgogIHRoaXMubGl0X2J1ZnNpemUgPSAwOwogIC8qIFNpemUgb2YgbWF0Y2ggYnVmZmVyIGZvciBsaXRlcmFscy9sZW5ndGhzLiAgVGhlcmUgYXJlIDQgcmVhc29ucyBmb3IKICAgKiBsaW1pdGluZyBsaXRfYnVmc2l6ZSB0byA2NEs6CiAgICogICAtIGZyZXF1ZW5jaWVzIGNhbiBiZSBrZXB0IGluIDE2IGJpdCBjb3VudGVycwogICAqICAgLSBpZiBjb21wcmVzc2lvbiBpcyBub3Qgc3VjY2Vzc2Z1bCBmb3IgdGhlIGZpcnN0IGJsb2NrLCBhbGwgaW5wdXQKICAgKiAgICAgZGF0YSBpcyBzdGlsbCBpbiB0aGUgd2luZG93IHNvIHdlIGNhbiBzdGlsbCBlbWl0IGEgc3RvcmVkIGJsb2NrIGV2ZW4KICAgKiAgICAgd2hlbiBpbnB1dCBjb21lcyBmcm9tIHN0YW5kYXJkIGlucHV0LiAgKFRoaXMgY2FuIGFsc28gYmUgZG9uZSBmb3IKICAgKiAgICAgYWxsIGJsb2NrcyBpZiBsaXRfYnVmc2l6ZSBpcyBub3QgZ3JlYXRlciB0aGFuIDMySy4pCiAgICogICAtIGlmIGNvbXByZXNzaW9uIGlzIG5vdCBzdWNjZXNzZnVsIGZvciBhIGZpbGUgc21hbGxlciB0aGFuIDY0Sywgd2UgY2FuCiAgICogICAgIGV2ZW4gZW1pdCBhIHN0b3JlZCBmaWxlIGluc3RlYWQgb2YgYSBzdG9yZWQgYmxvY2sgKHNhdmluZyA1IGJ5dGVzKS4KICAgKiAgICAgVGhpcyBpcyBhcHBsaWNhYmxlIG9ubHkgZm9yIHppcCAobm90IGd6aXAgb3IgemxpYikuCiAgICogICAtIGNyZWF0aW5nIG5ldyBIdWZmbWFuIHRyZWVzIGxlc3MgZnJlcXVlbnRseSBtYXkgbm90IHByb3ZpZGUgZmFzdAogICAqICAgICBhZGFwdGF0aW9uIHRvIGNoYW5nZXMgaW4gdGhlIGlucHV0IGRhdGEgc3RhdGlzdGljcy4gKFRha2UgZm9yCiAgICogICAgIGV4YW1wbGUgYSBiaW5hcnkgZmlsZSB3aXRoIHBvb3JseSBjb21wcmVzc2libGUgY29kZSBmb2xsb3dlZCBieQogICAqICAgICBhIGhpZ2hseSBjb21wcmVzc2libGUgc3RyaW5nIHRhYmxlLikgU21hbGxlciBidWZmZXIgc2l6ZXMgZ2l2ZQogICAqICAgICBmYXN0IGFkYXB0YXRpb24gYnV0IGhhdmUgb2YgY291cnNlIHRoZSBvdmVyaGVhZCBvZiB0cmFuc21pdHRpbmcKICAgKiAgICAgdHJlZXMgbW9yZSBmcmVxdWVudGx5LgogICAqICAgLSBJIGNhbid0IGNvdW50IGFib3ZlIDQKICAgKi8KCiAgdGhpcy5sYXN0X2xpdCA9IDA7ICAgICAgLyogcnVubmluZyBpbmRleCBpbiBsX2J1ZiAqLwoKICB0aGlzLmRfYnVmID0gMDsKICAvKiBCdWZmZXIgaW5kZXggZm9yIGRpc3RhbmNlcy4gVG8gc2ltcGxpZnkgdGhlIGNvZGUsIGRfYnVmIGFuZCBsX2J1ZiBoYXZlCiAgICogdGhlIHNhbWUgbnVtYmVyIG9mIGVsZW1lbnRzLiBUbyB1c2UgZGlmZmVyZW50IGxlbmd0aHMsIGFuIGV4dHJhIGZsYWcKICAgKiBhcnJheSB3b3VsZCBiZSBuZWNlc3NhcnkuCiAgICovCgogIHRoaXMub3B0X2xlbiA9IDA7ICAgICAgIC8qIGJpdCBsZW5ndGggb2YgY3VycmVudCBibG9jayB3aXRoIG9wdGltYWwgdHJlZXMgKi8KICB0aGlzLnN0YXRpY19sZW4gPSAwOyAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBzdGF0aWMgdHJlZXMgKi8KICB0aGlzLm1hdGNoZXMgPSAwOyAgICAgICAvKiBudW1iZXIgb2Ygc3RyaW5nIG1hdGNoZXMgaW4gY3VycmVudCBibG9jayAqLwogIHRoaXMuaW5zZXJ0ID0gMDsgICAgICAgIC8qIGJ5dGVzIGF0IGVuZCBvZiB3aW5kb3cgbGVmdCB0byBpbnNlcnQgKi8KCgogIHRoaXMuYmlfYnVmID0gMDsKICAvKiBPdXRwdXQgYnVmZmVyLiBiaXRzIGFyZSBpbnNlcnRlZCBzdGFydGluZyBhdCB0aGUgYm90dG9tIChsZWFzdAogICAqIHNpZ25pZmljYW50IGJpdHMpLgogICAqLwogIHRoaXMuYmlfdmFsaWQgPSAwOwogIC8qIE51bWJlciBvZiB2YWxpZCBiaXRzIGluIGJpX2J1Zi4gIEFsbCBiaXRzIGFib3ZlIHRoZSBsYXN0IHZhbGlkIGJpdAogICAqIGFyZSBhbHdheXMgemVyby4KICAgKi8KCiAgLy8gVXNlZCBmb3Igd2luZG93IG1lbW9yeSBpbml0LiBXZSBzYWZlbHkgaWdub3JlIGl0IGZvciBKUy4gVGhhdCBtYWtlcwogIC8vIHNlbnNlIG9ubHkgZm9yIHBvaW50ZXJzIGFuZCBtZW1vcnkgY2hlY2sgdG9vbHMuCiAgLy90aGlzLmhpZ2hfd2F0ZXIgPSAwOwogIC8qIEhpZ2ggd2F0ZXIgbWFyayBvZmZzZXQgaW4gd2luZG93IGZvciBpbml0aWFsaXplZCBieXRlcyAtLSBieXRlcyBhYm92ZQogICAqIHRoaXMgYXJlIHNldCB0byB6ZXJvIGluIG9yZGVyIHRvIGF2b2lkIG1lbW9yeSBjaGVjayB3YXJuaW5ncyB3aGVuCiAgICogbG9uZ2VzdCBtYXRjaCByb3V0aW5lcyBhY2Nlc3MgYnl0ZXMgcGFzdCB0aGUgaW5wdXQuICBUaGlzIGlzIHRoZW4KICAgKiB1cGRhdGVkIHRvIHRoZSBuZXcgaGlnaCB3YXRlciBtYXJrLgogICAqLwp9CgoKY29uc3QgZGVmbGF0ZVJlc2V0S2VlcCA9IChzdHJtKSA9PiB7CgogIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKTsKICB9CgogIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IDA7CiAgc3RybS5kYXRhX3R5cGUgPSBaX1VOS05PV047CgogIGNvbnN0IHMgPSBzdHJtLnN0YXRlOwogIHMucGVuZGluZyA9IDA7CiAgcy5wZW5kaW5nX291dCA9IDA7CgogIGlmIChzLndyYXAgPCAwKSB7CiAgICBzLndyYXAgPSAtcy53cmFwOwogICAgLyogd2FzIG1hZGUgbmVnYXRpdmUgYnkgZGVmbGF0ZSguLi4sIFpfRklOSVNIKTsgKi8KICB9CiAgcy5zdGF0dXMgPSAocy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEUpOwogIHN0cm0uYWRsZXIgPSAocy53cmFwID09PSAyKSA/CiAgICAwICAvLyBjcmMzMigwLCBaX05VTEwsIDApCiAgOgogICAgMTsgLy8gYWRsZXIzMigwLCBaX05VTEwsIDApCiAgcy5sYXN0X2ZsdXNoID0gWl9OT19GTFVTSCQyOwogIF90cl9pbml0KHMpOwogIHJldHVybiBaX09LJDM7Cn07CgoKY29uc3QgZGVmbGF0ZVJlc2V0ID0gKHN0cm0pID0+IHsKCiAgY29uc3QgcmV0ID0gZGVmbGF0ZVJlc2V0S2VlcChzdHJtKTsKICBpZiAocmV0ID09PSBaX09LJDMpIHsKICAgIGxtX2luaXQoc3RybS5zdGF0ZSk7CiAgfQogIHJldHVybiByZXQ7Cn07CgoKY29uc3QgZGVmbGF0ZVNldEhlYWRlciA9IChzdHJtLCBoZWFkKSA9PiB7CgogIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsgfQogIGlmIChzdHJtLnN0YXRlLndyYXAgIT09IDIpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICBzdHJtLnN0YXRlLmd6aGVhZCA9IGhlYWQ7CiAgcmV0dXJuIFpfT0skMzsKfTsKCgpjb25zdCBkZWZsYXRlSW5pdDIgPSAoc3RybSwgbGV2ZWwsIG1ldGhvZCwgd2luZG93Qml0cywgbWVtTGV2ZWwsIHN0cmF0ZWd5KSA9PiB7CgogIGlmICghc3RybSkgeyAvLyA9PT0gWl9OVUxMCiAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICB9CiAgbGV0IHdyYXAgPSAxOwoKICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTiQxKSB7CiAgICBsZXZlbCA9IDY7CiAgfQoKICBpZiAod2luZG93Qml0cyA8IDApIHsgLyogc3VwcHJlc3MgemxpYiB3cmFwcGVyICovCiAgICB3cmFwID0gMDsKICAgIHdpbmRvd0JpdHMgPSAtd2luZG93Qml0czsKICB9CgogIGVsc2UgaWYgKHdpbmRvd0JpdHMgPiAxNSkgewogICAgd3JhcCA9IDI7ICAgICAgICAgICAvKiB3cml0ZSBnemlwIHdyYXBwZXIgaW5zdGVhZCAqLwogICAgd2luZG93Qml0cyAtPSAxNjsKICB9CgoKICBpZiAobWVtTGV2ZWwgPCAxIHx8IG1lbUxldmVsID4gTUFYX01FTV9MRVZFTCB8fCBtZXRob2QgIT09IFpfREVGTEFURUQkMiB8fAogICAgd2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1IHx8IGxldmVsIDwgMCB8fCBsZXZlbCA+IDkgfHwKICAgIHN0cmF0ZWd5IDwgMCB8fCBzdHJhdGVneSA+IFpfRklYRUQpIHsKICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IkMik7CiAgfQoKCiAgaWYgKHdpbmRvd0JpdHMgPT09IDgpIHsKICAgIHdpbmRvd0JpdHMgPSA5OwogIH0KICAvKiB1bnRpbCAyNTYtYnl0ZSB3aW5kb3cgYnVnIGZpeGVkICovCgogIGNvbnN0IHMgPSBuZXcgRGVmbGF0ZVN0YXRlKCk7CgogIHN0cm0uc3RhdGUgPSBzOwogIHMuc3RybSA9IHN0cm07CgogIHMud3JhcCA9IHdyYXA7CiAgcy5nemhlYWQgPSBudWxsOwogIHMud19iaXRzID0gd2luZG93Qml0czsKICBzLndfc2l6ZSA9IDEgPDwgcy53X2JpdHM7CiAgcy53X21hc2sgPSBzLndfc2l6ZSAtIDE7CgogIHMuaGFzaF9iaXRzID0gbWVtTGV2ZWwgKyA3OwogIHMuaGFzaF9zaXplID0gMSA8PCBzLmhhc2hfYml0czsKICBzLmhhc2hfbWFzayA9IHMuaGFzaF9zaXplIC0gMTsKICBzLmhhc2hfc2hpZnQgPSB+figocy5oYXNoX2JpdHMgKyBNSU5fTUFUQ0ggLSAxKSAvIE1JTl9NQVRDSCk7CgogIHMud2luZG93ID0gbmV3IFVpbnQ4QXJyYXkocy53X3NpemUgKiAyKTsKICBzLmhlYWQgPSBuZXcgVWludDE2QXJyYXkocy5oYXNoX3NpemUpOwogIHMucHJldiA9IG5ldyBVaW50MTZBcnJheShzLndfc2l6ZSk7CgogIC8vIERvbid0IG5lZWQgbWVtIGluaXQgbWFnaWMgZm9yIEpTLgogIC8vcy5oaWdoX3dhdGVyID0gMDsgIC8qIG5vdGhpbmcgd3JpdHRlbiB0byBzLT53aW5kb3cgeWV0ICovCgogIHMubGl0X2J1ZnNpemUgPSAxIDw8IChtZW1MZXZlbCArIDYpOyAvKiAxNksgZWxlbWVudHMgYnkgZGVmYXVsdCAqLwoKICBzLnBlbmRpbmdfYnVmX3NpemUgPSBzLmxpdF9idWZzaXplICogNDsKCiAgLy9vdmVybGF5ID0gKHVzaGYgKikgWkFMTE9DKHN0cm0sIHMtPmxpdF9idWZzaXplLCBzaXplb2YodXNoKSsyKTsKICAvL3MtPnBlbmRpbmdfYnVmID0gKHVjaGYgKikgb3ZlcmxheTsKICBzLnBlbmRpbmdfYnVmID0gbmV3IFVpbnQ4QXJyYXkocy5wZW5kaW5nX2J1Zl9zaXplKTsKCiAgLy8gSXQgaXMgb2Zmc2V0IGZyb20gYHMucGVuZGluZ19idWZgIChzaXplIGlzIGBzLmxpdF9idWZzaXplICogMmApCiAgLy9zLT5kX2J1ZiA9IG92ZXJsYXkgKyBzLT5saXRfYnVmc2l6ZS9zaXplb2YodXNoKTsKICBzLmRfYnVmID0gMSAqIHMubGl0X2J1ZnNpemU7CgogIC8vcy0+bF9idWYgPSBzLT5wZW5kaW5nX2J1ZiArICgxK3NpemVvZih1c2gpKSpzLT5saXRfYnVmc2l6ZTsKICBzLmxfYnVmID0gKDEgKyAyKSAqIHMubGl0X2J1ZnNpemU7CgogIHMubGV2ZWwgPSBsZXZlbDsKICBzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgcy5tZXRob2QgPSBtZXRob2Q7CgogIHJldHVybiBkZWZsYXRlUmVzZXQoc3RybSk7Cn07Cgpjb25zdCBkZWZsYXRlSW5pdCA9IChzdHJtLCBsZXZlbCkgPT4gewoKICByZXR1cm4gZGVmbGF0ZUluaXQyKHN0cm0sIGxldmVsLCBaX0RFRkxBVEVEJDIsIE1BWF9XQklUUyQxLCBERUZfTUVNX0xFVkVMLCBaX0RFRkFVTFRfU1RSQVRFR1kkMSk7Cn07CgoKY29uc3QgZGVmbGF0ZSQyID0gKHN0cm0sIGZsdXNoKSA9PiB7CgogIGxldCBiZWcsIHZhbDsgLy8gZm9yIGd6aXAgaGVhZGVyIHdyaXRlIG9ubHkKCiAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlIHx8CiAgICBmbHVzaCA+IFpfQkxPQ0skMSB8fCBmbHVzaCA8IDApIHsKICAgIHJldHVybiBzdHJtID8gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpIDogWl9TVFJFQU1fRVJST1IkMjsKICB9CgogIGNvbnN0IHMgPSBzdHJtLnN0YXRlOwoKICBpZiAoIXN0cm0ub3V0cHV0IHx8CiAgICAgICghc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSB8fAogICAgICAocy5zdGF0dXMgPT09IEZJTklTSF9TVEFURSAmJiBmbHVzaCAhPT0gWl9GSU5JU0gkMykpIHsKICAgIHJldHVybiBlcnIoc3RybSwgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IFpfQlVGX0VSUk9SJDEgOiBaX1NUUkVBTV9FUlJPUiQyKTsKICB9CgogIHMuc3RybSA9IHN0cm07IC8qIGp1c3QgaW4gY2FzZSAqLwogIGNvbnN0IG9sZF9mbHVzaCA9IHMubGFzdF9mbHVzaDsKICBzLmxhc3RfZmx1c2ggPSBmbHVzaDsKCiAgLyogV3JpdGUgdGhlIGhlYWRlciAqLwogIGlmIChzLnN0YXR1cyA9PT0gSU5JVF9TVEFURSkgewoKICAgIGlmIChzLndyYXAgPT09IDIpIHsgLy8gR1pJUCBoZWFkZXIKICAgICAgc3RybS5hZGxlciA9IDA7ICAvL2NyYzMyKDBMLCBaX05VTEwsIDApOwogICAgICBwdXRfYnl0ZShzLCAzMSk7CiAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgIHB1dF9ieXRlKHMsIDgpOwogICAgICBpZiAoIXMuZ3poZWFkKSB7IC8vIHMtPmd6aGVhZCA9PSBaX05VTEwKICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICBwdXRfYnl0ZShzLCBzLmxldmVsID09PSA5ID8gMiA6CiAgICAgICAgICAgICAgICAgICAgKHMuc3RyYXRlZ3kgPj0gWl9IVUZGTUFOX09OTFkgfHwgcy5sZXZlbCA8IDIgPwogICAgICAgICAgICAgICAgICAgICA0IDogMCkpOwogICAgICAgIHB1dF9ieXRlKHMsIE9TX0NPREUpOwogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgKHMuZ3poZWFkLmhjcmMgPyAyIDogMCkgKwogICAgICAgICAgICAgICAgICAgICghcy5nemhlYWQuZXh0cmEgPyAwIDogNCkgKwogICAgICAgICAgICAgICAgICAgICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArCiAgICAgICAgICAgICAgICAgICAgKCFzLmd6aGVhZC5jb21tZW50ID8gMCA6IDE2KQogICAgICAgICk7CiAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDB4ZmYpOwogICAgICAgIHB1dF9ieXRlKHMsIChzLmd6aGVhZC50aW1lID4+IDgpICYgMHhmZik7CiAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gMTYpICYgMHhmZik7CiAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gMjQpICYgMHhmZik7CiAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOgogICAgICAgICAgICAgICAgICAgIChzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyID8KICAgICAgICAgICAgICAgICAgICAgNCA6IDApKTsKICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5vcyAmIDB4ZmYpOwogICAgICAgIGlmIChzLmd6aGVhZC5leHRyYSAmJiBzLmd6aGVhZC5leHRyYS5sZW5ndGgpIHsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLmV4dHJhLmxlbmd0aCA+PiA4KSAmIDB4ZmYpOwogICAgICAgIH0KICAgICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nLCAwKTsKICAgICAgICB9CiAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICBzLnN0YXR1cyA9IEVYVFJBX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBlbHNlIC8vIERFRkxBVEUgaGVhZGVyCiAgICB7CiAgICAgIGxldCBoZWFkZXIgPSAoWl9ERUZMQVRFRCQyICsgKChzLndfYml0cyAtIDgpIDw8IDQpKSA8PCA4OwogICAgICBsZXQgbGV2ZWxfZmxhZ3MgPSAtMTsKCiAgICAgIGlmIChzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyKSB7CiAgICAgICAgbGV2ZWxfZmxhZ3MgPSAwOwogICAgICB9IGVsc2UgaWYgKHMubGV2ZWwgPCA2KSB7CiAgICAgICAgbGV2ZWxfZmxhZ3MgPSAxOwogICAgICB9IGVsc2UgaWYgKHMubGV2ZWwgPT09IDYpIHsKICAgICAgICBsZXZlbF9mbGFncyA9IDI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV2ZWxfZmxhZ3MgPSAzOwogICAgICB9CiAgICAgIGhlYWRlciB8PSAobGV2ZWxfZmxhZ3MgPDwgNik7CiAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7IGhlYWRlciB8PSBQUkVTRVRfRElDVDsgfQogICAgICBoZWFkZXIgKz0gMzEgLSAoaGVhZGVyICUgMzEpOwoKICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwoKICAgICAgLyogU2F2ZSB0aGUgYWRsZXIzMiBvZiB0aGUgcHJlc2V0IGRpY3Rpb25hcnk6ICovCiAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7CiAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICAgIHB1dFNob3J0TVNCKHMsIHN0cm0uYWRsZXIgJiAweGZmZmYpOwogICAgICB9CiAgICAgIHN0cm0uYWRsZXIgPSAxOyAvLyBhZGxlcjMyKDBMLCBaX05VTEwsIDApOwogICAgfQogIH0KCi8vI2lmZGVmIEdaSVAKICBpZiAocy5zdGF0dXMgPT09IEVYVFJBX1NUQVRFKSB7CiAgICBpZiAocy5nemhlYWQuZXh0cmEvKiAhPSBaX05VTEwqLykgewogICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCgogICAgICB3aGlsZSAocy5nemluZGV4IDwgKHMuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDB4ZmZmZikpIHsKICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICB9CiAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5leHRyYVtzLmd6aW5kZXhdICYgMHhmZik7CiAgICAgICAgcy5nemluZGV4Kys7CiAgICAgIH0KICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICB9CiAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgfQogIH0KICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgIGlmIChzLmd6aGVhZC5uYW1lLyogIT0gWl9OVUxMKi8pIHsKICAgICAgYmVnID0gcy5wZW5kaW5nOyAgLyogc3RhcnQgb2YgYnl0ZXMgdG8gdXBkYXRlIGNyYyAqLwogICAgICAvL2ludCB2YWw7CgogICAgICBkbyB7CiAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgICAgfQogICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICB2YWwgPSAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gSlMgc3BlY2lmaWM6IGxpdHRsZSBtYWdpYyB0byBhZGQgemVybyB0ZXJtaW5hdG9yIHRvIGVuZCBvZiBzdHJpbmcKICAgICAgICBpZiAocy5nemluZGV4IDwgcy5nemhlYWQubmFtZS5sZW5ndGgpIHsKICAgICAgICAgIHZhbCA9IHMuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChzLmd6aW5kZXgrKykgJiAweGZmOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWwgPSAwOwogICAgICAgIH0KICAgICAgICBwdXRfYnl0ZShzLCB2YWwpOwogICAgICB9IHdoaWxlICh2YWwgIT09IDApOwoKICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICB9CiAgICAgIGlmICh2YWwgPT09IDApIHsKICAgICAgICBzLmd6aW5kZXggPSAwOwogICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgIH0KICB9CiAgaWYgKHMuc3RhdHVzID09PSBDT01NRU5UX1NUQVRFKSB7CiAgICBpZiAocy5nemhlYWQuY29tbWVudC8qICE9IFpfTlVMTCovKSB7CiAgICAgIGJlZyA9IHMucGVuZGluZzsgIC8qIHN0YXJ0IG9mIGJ5dGVzIHRvIHVwZGF0ZSBjcmMgKi8KICAgICAgLy9pbnQgdmFsOwoKICAgICAgZG8gewogICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgdmFsID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEpTIHNwZWNpZmljOiBsaXR0bGUgbWFnaWMgdG8gYWRkIHplcm8gdGVybWluYXRvciB0byBlbmQgb2Ygc3RyaW5nCiAgICAgICAgaWYgKHMuZ3ppbmRleCA8IHMuZ3poZWFkLmNvbW1lbnQubGVuZ3RoKSB7CiAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMHhmZjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFsID0gMDsKICAgICAgICB9CiAgICAgICAgcHV0X2J5dGUocywgdmFsKTsKICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKCiAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgfQogICAgICBpZiAodmFsID09PSAwKSB7CiAgICAgICAgcy5zdGF0dXMgPSBIQ1JDX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgcy5zdGF0dXMgPSBIQ1JDX1NUQVRFOwogICAgfQogIH0KICBpZiAocy5zdGF0dXMgPT09IEhDUkNfU1RBVEUpIHsKICAgIGlmIChzLmd6aGVhZC5oY3JjKSB7CiAgICAgIGlmIChzLnBlbmRpbmcgKyAyID4gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgfQogICAgICBpZiAocy5wZW5kaW5nICsgMiA8PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyICYgMHhmZik7CiAgICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgICBzdHJtLmFkbGVyID0gMDsgLy9jcmMzMigwTCwgWl9OVUxMLCAwKTsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICB9CiAgfQovLyNlbmRpZgoKICAvKiBGbHVzaCBhcyBtdWNoIHBlbmRpbmcgb3V0cHV0IGFzIHBvc3NpYmxlICovCiAgaWYgKHMucGVuZGluZyAhPT0gMCkgewogICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAvKiBTaW5jZSBhdmFpbF9vdXQgaXMgMCwgZGVmbGF0ZSB3aWxsIGJlIGNhbGxlZCBhZ2FpbiB3aXRoCiAgICAgICAqIG1vcmUgb3V0cHV0IHNwYWNlLCBidXQgcG9zc2libHkgd2l0aCBib3RoIHBlbmRpbmcgYW5kCiAgICAgICAqIGF2YWlsX2luIGVxdWFsIHRvIHplcm8uIFRoZXJlIHdvbid0IGJlIGFueXRoaW5nIHRvIGRvLAogICAgICAgKiBidXQgdGhpcyBpcyBub3QgYW4gZXJyb3Igc2l0dWF0aW9uIHNvIG1ha2Ugc3VyZSB3ZQogICAgICAgKiByZXR1cm4gT0sgaW5zdGVhZCBvZiBCVUZfRVJST1IgYXQgbmV4dCBjYWxsIG9mIGRlZmxhdGU6CiAgICAgICAqLwogICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgcmV0dXJuIFpfT0skMzsKICAgIH0KCiAgICAvKiBNYWtlIHN1cmUgdGhlcmUgaXMgc29tZXRoaW5nIHRvIGRvIGFuZCBhdm9pZCBkdXBsaWNhdGUgY29uc2VjdXRpdmUKICAgICAqIGZsdXNoZXMuIEZvciByZXBlYXRlZCBhbmQgdXNlbGVzcyBjYWxscyB3aXRoIFpfRklOSVNILCB3ZSBrZWVwCiAgICAgKiByZXR1cm5pbmcgWl9TVFJFQU1fRU5EIGluc3RlYWQgb2YgWl9CVUZfRVJST1IuCiAgICAgKi8KICB9IGVsc2UgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgcmFuayhmbHVzaCkgPD0gcmFuayhvbGRfZmx1c2gpICYmCiAgICBmbHVzaCAhPT0gWl9GSU5JU0gkMykgewogICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUiQxKTsKICB9CgogIC8qIFVzZXIgbXVzdCBub3QgcHJvdmlkZSBtb3JlIGlucHV0IGFmdGVyIHRoZSBmaXJzdCBGSU5JU0g6ICovCiAgaWYgKHMuc3RhdHVzID09PSBGSU5JU0hfU1RBVEUgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkgewogICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUiQxKTsKICB9CgogIC8qIFN0YXJ0IGEgbmV3IGJsb2NrIG9yIGNvbnRpbnVlIHRoZSBjdXJyZW50IG9uZS4KICAgKi8KICBpZiAoc3RybS5hdmFpbF9pbiAhPT0gMCB8fCBzLmxvb2thaGVhZCAhPT0gMCB8fAogICAgKGZsdXNoICE9PSBaX05PX0ZMVVNIJDIgJiYgcy5zdGF0dXMgIT09IEZJTklTSF9TVEFURSkpIHsKICAgIGxldCBic3RhdGUgPSAocy5zdHJhdGVneSA9PT0gWl9IVUZGTUFOX09OTFkpID8gZGVmbGF0ZV9odWZmKHMsIGZsdXNoKSA6CiAgICAgIChzLnN0cmF0ZWd5ID09PSBaX1JMRSA/IGRlZmxhdGVfcmxlKHMsIGZsdXNoKSA6CiAgICAgICAgY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5mdW5jKHMsIGZsdXNoKSk7CgogICAgaWYgKGJzdGF0ZSA9PT0gQlNfRklOSVNIX1NUQVJURUQgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfRE9ORSkgewogICAgICBzLnN0YXR1cyA9IEZJTklTSF9TVEFURTsKICAgIH0KICAgIGlmIChic3RhdGUgPT09IEJTX05FRURfTU9SRSB8fCBic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEKSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHMubGFzdF9mbHVzaCA9IC0xOwogICAgICAgIC8qIGF2b2lkIEJVRl9FUlJPUiBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICB9CiAgICAgIHJldHVybiBaX09LJDM7CiAgICAgIC8qIElmIGZsdXNoICE9IFpfTk9fRkxVU0ggJiYgYXZhaWxfb3V0ID09IDAsIHRoZSBuZXh0IGNhbGwKICAgICAgICogb2YgZGVmbGF0ZSBzaG91bGQgdXNlIHRoZSBzYW1lIGZsdXNoIHBhcmFtZXRlciB0byBtYWtlIHN1cmUKICAgICAgICogdGhhdCB0aGUgZmx1c2ggaXMgY29tcGxldGUuIFNvIHdlIGRvbid0IGhhdmUgdG8gb3V0cHV0IGFuCiAgICAgICAqIGVtcHR5IGJsb2NrIGhlcmUsIHRoaXMgd2lsbCBiZSBkb25lIGF0IG5leHQgY2FsbC4gVGhpcyBhbHNvCiAgICAgICAqIGVuc3VyZXMgdGhhdCBmb3IgYSB2ZXJ5IHNtYWxsIG91dHB1dCBidWZmZXIsIHdlIGVtaXQgYXQgbW9zdAogICAgICAgKiBvbmUgZW1wdHkgYmxvY2suCiAgICAgICAqLwogICAgfQogICAgaWYgKGJzdGF0ZSA9PT0gQlNfQkxPQ0tfRE9ORSkgewogICAgICBpZiAoZmx1c2ggPT09IFpfUEFSVElBTF9GTFVTSCkgewogICAgICAgIF90cl9hbGlnbihzKTsKICAgICAgfQogICAgICBlbHNlIGlmIChmbHVzaCAhPT0gWl9CTE9DSyQxKSB7IC8qIEZVTExfRkxVU0ggb3IgU1lOQ19GTFVTSCAqLwoKICAgICAgICBfdHJfc3RvcmVkX2Jsb2NrKHMsIDAsIDAsIGZhbHNlKTsKICAgICAgICAvKiBGb3IgYSBmdWxsIGZsdXNoLCB0aGlzIGVtcHR5IGJsb2NrIHdpbGwgYmUgcmVjb2duaXplZAogICAgICAgICAqIGFzIGEgc3BlY2lhbCBtYXJrZXIgYnkgaW5mbGF0ZV9zeW5jKCkuCiAgICAgICAgICovCiAgICAgICAgaWYgKGZsdXNoID09PSBaX0ZVTExfRkxVU0gkMSkgewogICAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovICAgICAgICAgICAgIC8qIGZvcmdldCBoaXN0b3J5ICovCiAgICAgICAgICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CgogICAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgICAgICBzLmJsb2NrX3N0YXJ0ID0gMDsKICAgICAgICAgICAgcy5pbnNlcnQgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsgLyogYXZvaWQgQlVGX0VSUk9SIGF0IG5leHQgY2FsbCwgc2VlIGFib3ZlICovCiAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgfQogICAgfQogIH0KICAvL0Fzc2VydChzdHJtLT5hdmFpbF9vdXQgPiAwLCAiYnVnMiIpOwogIC8vaWYgKHN0cm0uYXZhaWxfb3V0IDw9IDApIHsgdGhyb3cgbmV3IEVycm9yKCJidWcyIik7fQoKICBpZiAoZmx1c2ggIT09IFpfRklOSVNIJDMpIHsgcmV0dXJuIFpfT0skMzsgfQogIGlmIChzLndyYXAgPD0gMCkgeyByZXR1cm4gWl9TVFJFQU1fRU5EJDM7IH0KCiAgLyogV3JpdGUgdGhlIHRyYWlsZXIgKi8KICBpZiAocy53cmFwID09PSAyKSB7CiAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyICYgMHhmZik7CiAgICBwdXRfYnl0ZShzLCAoc3RybS5hZGxlciA+PiA4KSAmIDB4ZmYpOwogICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gMTYpICYgMHhmZik7CiAgICBwdXRfYnl0ZShzLCAoc3RybS5hZGxlciA+PiAyNCkgJiAweGZmKTsKICAgIHB1dF9ieXRlKHMsIHN0cm0udG90YWxfaW4gJiAweGZmKTsKICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDgpICYgMHhmZik7CiAgICBwdXRfYnl0ZShzLCAoc3RybS50b3RhbF9pbiA+PiAxNikgJiAweGZmKTsKICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDI0KSAmIDB4ZmYpOwogIH0KICBlbHNlCiAgewogICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciAmIDB4ZmZmZik7CiAgfQoKICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogIC8qIElmIGF2YWlsX291dCBpcyB6ZXJvLCB0aGUgYXBwbGljYXRpb24gd2lsbCBjYWxsIGRlZmxhdGUgYWdhaW4KICAgKiB0byBmbHVzaCB0aGUgcmVzdC4KICAgKi8KICBpZiAocy53cmFwID4gMCkgeyBzLndyYXAgPSAtcy53cmFwOyB9CiAgLyogd3JpdGUgdGhlIHRyYWlsZXIgb25seSBvbmNlISAqLwogIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LJDMgOiBaX1NUUkVBTV9FTkQkMzsKfTsKCgpjb25zdCBkZWZsYXRlRW5kID0gKHN0cm0pID0+IHsKCiAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQyOwogIH0KCiAgY29uc3Qgc3RhdHVzID0gc3RybS5zdGF0ZS5zdGF0dXM7CiAgaWYgKHN0YXR1cyAhPT0gSU5JVF9TVEFURSAmJgogICAgc3RhdHVzICE9PSBFWFRSQV9TVEFURSAmJgogICAgc3RhdHVzICE9PSBOQU1FX1NUQVRFICYmCiAgICBzdGF0dXMgIT09IENPTU1FTlRfU1RBVEUgJiYKICAgIHN0YXR1cyAhPT0gSENSQ19TVEFURSAmJgogICAgc3RhdHVzICE9PSBCVVNZX1NUQVRFICYmCiAgICBzdGF0dXMgIT09IEZJTklTSF9TVEFURQogICkgewogICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKTsKICB9CgogIHN0cm0uc3RhdGUgPSBudWxsOwoKICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUiQyKSA6IFpfT0skMzsKfTsKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEluaXRpYWxpemVzIHRoZSBjb21wcmVzc2lvbiBkaWN0aW9uYXJ5IGZyb20gdGhlIGdpdmVuIGJ5dGUKICogc2VxdWVuY2Ugd2l0aG91dCBwcm9kdWNpbmcgYW55IGNvbXByZXNzZWQgb3V0cHV0LgogKi8KY29uc3QgZGVmbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewoKICBsZXQgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwoKICBpZiAoIXN0cm0vKj09IFpfTlVMTCovIHx8ICFzdHJtLnN0YXRlLyo9PSBaX05VTEwqLykgewogICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgfQoKICBjb25zdCBzID0gc3RybS5zdGF0ZTsKICBjb25zdCB3cmFwID0gcy53cmFwOwoKICBpZiAod3JhcCA9PT0gMiB8fCAod3JhcCA9PT0gMSAmJiBzLnN0YXR1cyAhPT0gSU5JVF9TVEFURSkgfHwgcy5sb29rYWhlYWQpIHsKICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQyOwogIH0KCiAgLyogd2hlbiB1c2luZyB6bGliIHdyYXBwZXJzLCBjb21wdXRlIEFkbGVyLTMyIGZvciBwcm92aWRlZCBkaWN0aW9uYXJ5ICovCiAgaWYgKHdyYXAgPT09IDEpIHsKICAgIC8qIGFkbGVyMzIoc3RybS0+YWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgc3RybS5hZGxlciA9IGFkbGVyMzJfMShzdHJtLmFkbGVyLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoLCAwKTsKICB9CgogIHMud3JhcCA9IDA7ICAgLyogYXZvaWQgY29tcHV0aW5nIEFkbGVyLTMyIGluIHJlYWRfYnVmICovCgogIC8qIGlmIGRpY3Rpb25hcnkgd291bGQgZmlsbCB3aW5kb3csIGp1c3QgcmVwbGFjZSB0aGUgaGlzdG9yeSAqLwogIGlmIChkaWN0TGVuZ3RoID49IHMud19zaXplKSB7CiAgICBpZiAod3JhcCA9PT0gMCkgeyAgICAgICAgICAgIC8qIGFscmVhZHkgZW1wdHkgb3RoZXJ3aXNlICovCiAgICAgIC8qKiogQ0xFQVJfSEFTSChzKTsgKioqLwogICAgICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CiAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICBzLmJsb2NrX3N0YXJ0ID0gMDsKICAgICAgcy5pbnNlcnQgPSAwOwogICAgfQogICAgLyogdXNlIHRoZSB0YWlsICovCiAgICAvLyBkaWN0aW9uYXJ5ID0gZGljdGlvbmFyeS5zbGljZShkaWN0TGVuZ3RoIC0gcy53X3NpemUpOwogICAgbGV0IHRtcERpY3QgPSBuZXcgVWludDhBcnJheShzLndfc2l6ZSk7CiAgICB0bXBEaWN0LnNldChkaWN0aW9uYXJ5LnN1YmFycmF5KGRpY3RMZW5ndGggLSBzLndfc2l6ZSwgZGljdExlbmd0aCksIDApOwogICAgZGljdGlvbmFyeSA9IHRtcERpY3Q7CiAgICBkaWN0TGVuZ3RoID0gcy53X3NpemU7CiAgfQogIC8qIGluc2VydCBkaWN0aW9uYXJ5IGludG8gd2luZG93IGFuZCBoYXNoICovCiAgY29uc3QgYXZhaWwgPSBzdHJtLmF2YWlsX2luOwogIGNvbnN0IG5leHQgPSBzdHJtLm5leHRfaW47CiAgY29uc3QgaW5wdXQgPSBzdHJtLmlucHV0OwogIHN0cm0uYXZhaWxfaW4gPSBkaWN0TGVuZ3RoOwogIHN0cm0ubmV4dF9pbiA9IDA7CiAgc3RybS5pbnB1dCA9IGRpY3Rpb25hcnk7CiAgZmlsbF93aW5kb3cocyk7CiAgd2hpbGUgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgbGV0IHN0ciA9IHMuc3Ryc3RhcnQ7CiAgICBsZXQgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgZG8gewogICAgICAvKiBVUERBVEVfSEFTSChzLCBzLT5pbnNfaCwgcy0+d2luZG93W3N0ciArIE1JTl9NQVRDSC0xXSk7ICovCiAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKTsKCiAgICAgIHMucHJldltzdHIgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CgogICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzdHI7CiAgICAgIHN0cisrOwogICAgfSB3aGlsZSAoLS1uKTsKICAgIHMuc3Ryc3RhcnQgPSBzdHI7CiAgICBzLmxvb2thaGVhZCA9IE1JTl9NQVRDSCAtIDE7CiAgICBmaWxsX3dpbmRvdyhzKTsKICB9CiAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICBzLmJsb2NrX3N0YXJ0ID0gcy5zdHJzdGFydDsKICBzLmluc2VydCA9IHMubG9va2FoZWFkOwogIHMubG9va2FoZWFkID0gMDsKICBzLm1hdGNoX2xlbmd0aCA9IHMucHJldl9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogIHMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICBzdHJtLm5leHRfaW4gPSBuZXh0OwogIHN0cm0uaW5wdXQgPSBpbnB1dDsKICBzdHJtLmF2YWlsX2luID0gYXZhaWw7CiAgcy53cmFwID0gd3JhcDsKICByZXR1cm4gWl9PSyQzOwp9OwoKCnZhciBkZWZsYXRlSW5pdF8xID0gZGVmbGF0ZUluaXQ7CnZhciBkZWZsYXRlSW5pdDJfMSA9IGRlZmxhdGVJbml0MjsKdmFyIGRlZmxhdGVSZXNldF8xID0gZGVmbGF0ZVJlc2V0Owp2YXIgZGVmbGF0ZVJlc2V0S2VlcF8xID0gZGVmbGF0ZVJlc2V0S2VlcDsKdmFyIGRlZmxhdGVTZXRIZWFkZXJfMSA9IGRlZmxhdGVTZXRIZWFkZXI7CnZhciBkZWZsYXRlXzIkMSA9IGRlZmxhdGUkMjsKdmFyIGRlZmxhdGVFbmRfMSA9IGRlZmxhdGVFbmQ7CnZhciBkZWZsYXRlU2V0RGljdGlvbmFyeV8xID0gZGVmbGF0ZVNldERpY3Rpb25hcnk7CnZhciBkZWZsYXRlSW5mbyA9ICdwYWtvIGRlZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpJzsKCi8qIE5vdCBpbXBsZW1lbnRlZAptb2R1bGUuZXhwb3J0cy5kZWZsYXRlQm91bmQgPSBkZWZsYXRlQm91bmQ7Cm1vZHVsZS5leHBvcnRzLmRlZmxhdGVDb3B5ID0gZGVmbGF0ZUNvcHk7Cm1vZHVsZS5leHBvcnRzLmRlZmxhdGVQYXJhbXMgPSBkZWZsYXRlUGFyYW1zOwptb2R1bGUuZXhwb3J0cy5kZWZsYXRlUGVuZGluZyA9IGRlZmxhdGVQZW5kaW5nOwptb2R1bGUuZXhwb3J0cy5kZWZsYXRlUHJpbWUgPSBkZWZsYXRlUHJpbWU7Cm1vZHVsZS5leHBvcnRzLmRlZmxhdGVUdW5lID0gZGVmbGF0ZVR1bmU7CiovCgp2YXIgZGVmbGF0ZV8xJDIgPSB7CglkZWZsYXRlSW5pdDogZGVmbGF0ZUluaXRfMSwKCWRlZmxhdGVJbml0MjogZGVmbGF0ZUluaXQyXzEsCglkZWZsYXRlUmVzZXQ6IGRlZmxhdGVSZXNldF8xLAoJZGVmbGF0ZVJlc2V0S2VlcDogZGVmbGF0ZVJlc2V0S2VlcF8xLAoJZGVmbGF0ZVNldEhlYWRlcjogZGVmbGF0ZVNldEhlYWRlcl8xLAoJZGVmbGF0ZTogZGVmbGF0ZV8yJDEsCglkZWZsYXRlRW5kOiBkZWZsYXRlRW5kXzEsCglkZWZsYXRlU2V0RGljdGlvbmFyeTogZGVmbGF0ZVNldERpY3Rpb25hcnlfMSwKCWRlZmxhdGVJbmZvOiBkZWZsYXRlSW5mbwp9OwoKY29uc3QgX2hhcyA9IChvYmosIGtleSkgPT4gewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwp9OwoKdmFyIGFzc2lnbiA9IGZ1bmN0aW9uIChvYmogLypmcm9tMSwgZnJvbTIsIGZyb20zLCAuLi4qLykgewogIGNvbnN0IHNvdXJjZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogIHdoaWxlIChzb3VyY2VzLmxlbmd0aCkgewogICAgY29uc3Qgc291cmNlID0gc291cmNlcy5zaGlmdCgpOwogICAgaWYgKCFzb3VyY2UpIHsgY29udGludWU7IH0KCiAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gJ29iamVjdCcpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzb3VyY2UgKyAnbXVzdCBiZSBub24tb2JqZWN0Jyk7CiAgICB9CgogICAgZm9yIChjb25zdCBwIGluIHNvdXJjZSkgewogICAgICBpZiAoX2hhcyhzb3VyY2UsIHApKSB7CiAgICAgICAgb2JqW3BdID0gc291cmNlW3BdOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gb2JqOwp9OwoKCi8vIEpvaW4gYXJyYXkgb2YgY2h1bmtzIHRvIHNpbmdsZSBhcnJheS4KdmFyIGZsYXR0ZW5DaHVua3MgPSAoY2h1bmtzKSA9PiB7CiAgLy8gY2FsY3VsYXRlIGRhdGEgbGVuZ3RoCiAgbGV0IGxlbiA9IDA7CgogIGZvciAobGV0IGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgbGVuICs9IGNodW5rc1tpXS5sZW5ndGg7CiAgfQoKICAvLyBqb2luIGNodW5rcwogIGNvbnN0IHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGxlbik7CgogIGZvciAobGV0IGkgPSAwLCBwb3MgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgbGV0IGNodW5rID0gY2h1bmtzW2ldOwogICAgcmVzdWx0LnNldChjaHVuaywgcG9zKTsKICAgIHBvcyArPSBjaHVuay5sZW5ndGg7CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9OwoKdmFyIGNvbW1vbiA9IHsKCWFzc2lnbjogYXNzaWduLAoJZmxhdHRlbkNodW5rczogZmxhdHRlbkNodW5rcwp9OwoKLy8gU3RyaW5nIGVuY29kZS9kZWNvZGUgaGVscGVycwoKCi8vIFF1aWNrIGNoZWNrIGlmIHdlIGNhbiB1c2UgZmFzdCBhcnJheSB0byBiaW4gc3RyaW5nIGNvbnZlcnNpb24KLy8KLy8gLSBhcHBseShBcnJheSkgY2FuIGZhaWwgb24gQW5kcm9pZCAyLjIKLy8gLSBhcHBseShVaW50OEFycmF5KSBjYW4gZmFpbCBvbiBpT1MgNS4xIFNhZmFyaQovLwpsZXQgU1RSX0FQUExZX1VJQV9PSyA9IHRydWU7Cgp0cnkgeyBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KDEpKTsgfSBjYXRjaCAoX18pIHsgU1RSX0FQUExZX1VJQV9PSyA9IGZhbHNlOyB9CgoKLy8gVGFibGUgd2l0aCB1dGY4IGxlbmd0aHMgKGNhbGN1bGF0ZWQgYnkgZmlyc3QgYnl0ZSBvZiBzZXF1ZW5jZSkKLy8gTm90ZSwgdGhhdCA1ICYgNi1ieXRlIHZhbHVlcyBhbmQgc29tZSA0LWJ5dGUgdmFsdWVzIGNhbiBub3QgYmUgcmVwcmVzZW50ZWQgaW4gSlMsCi8vIGJlY2F1c2UgbWF4IHBvc3NpYmxlIGNvZGVwb2ludCBpcyAweDEwZmZmZgpjb25zdCBfdXRmOGxlbiA9IG5ldyBVaW50OEFycmF5KDI1Nik7CmZvciAobGV0IHEgPSAwOyBxIDwgMjU2OyBxKyspIHsKICBfdXRmOGxlbltxXSA9IChxID49IDI1MiA/IDYgOiBxID49IDI0OCA/IDUgOiBxID49IDI0MCA/IDQgOiBxID49IDIyNCA/IDMgOiBxID49IDE5MiA/IDIgOiAxKTsKfQpfdXRmOGxlblsyNTRdID0gX3V0ZjhsZW5bMjU0XSA9IDE7IC8vIEludmFsaWQgc2VxdWVuY2Ugc3RhcnQKCgovLyBjb252ZXJ0IHN0cmluZyB0byBhcnJheSAodHlwZWQsIHdoZW4gcG9zc2libGUpCnZhciBzdHJpbmcyYnVmID0gKHN0cikgPT4gewogIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICdmdW5jdGlvbicgJiYgVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSkgewogICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzdHIpOwogIH0KCiAgbGV0IGJ1ZiwgYywgYzIsIG1fcG9zLCBpLCBzdHJfbGVuID0gc3RyLmxlbmd0aCwgYnVmX2xlbiA9IDA7CgogIC8vIGNvdW50IGJpbmFyeSBzaXplCiAgZm9yIChtX3BvcyA9IDA7IG1fcG9zIDwgc3RyX2xlbjsgbV9wb3MrKykgewogICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgIGlmICgoYyAmIDB4ZmMwMCkgPT09IDB4ZDgwMCAmJiAobV9wb3MgKyAxIDwgc3RyX2xlbikpIHsKICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICBpZiAoKGMyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7CiAgICAgICAgYyA9IDB4MTAwMDAgKyAoKGMgLSAweGQ4MDApIDw8IDEwKSArIChjMiAtIDB4ZGMwMCk7CiAgICAgICAgbV9wb3MrKzsKICAgICAgfQogICAgfQogICAgYnVmX2xlbiArPSBjIDwgMHg4MCA/IDEgOiBjIDwgMHg4MDAgPyAyIDogYyA8IDB4MTAwMDAgPyAzIDogNDsKICB9CgogIC8vIGFsbG9jYXRlIGJ1ZmZlcgogIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGJ1Zl9sZW4pOwoKICAvLyBjb252ZXJ0CiAgZm9yIChpID0gMCwgbV9wb3MgPSAwOyBpIDwgYnVmX2xlbjsgbV9wb3MrKykgewogICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgIGlmICgoYyAmIDB4ZmMwMCkgPT09IDB4ZDgwMCAmJiAobV9wb3MgKyAxIDwgc3RyX2xlbikpIHsKICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICBpZiAoKGMyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7CiAgICAgICAgYyA9IDB4MTAwMDAgKyAoKGMgLSAweGQ4MDApIDw8IDEwKSArIChjMiAtIDB4ZGMwMCk7CiAgICAgICAgbV9wb3MrKzsKICAgICAgfQogICAgfQogICAgaWYgKGMgPCAweDgwKSB7CiAgICAgIC8qIG9uZSBieXRlICovCiAgICAgIGJ1ZltpKytdID0gYzsKICAgIH0gZWxzZSBpZiAoYyA8IDB4ODAwKSB7CiAgICAgIC8qIHR3byBieXRlcyAqLwogICAgICBidWZbaSsrXSA9IDB4QzAgfCAoYyA+Pj4gNik7CiAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjICYgMHgzZik7CiAgICB9IGVsc2UgaWYgKGMgPCAweDEwMDAwKSB7CiAgICAgIC8qIHRocmVlIGJ5dGVzICovCiAgICAgIGJ1ZltpKytdID0gMHhFMCB8IChjID4+PiAxMik7CiAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjID4+PiA2ICYgMHgzZik7CiAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjICYgMHgzZik7CiAgICB9IGVsc2UgewogICAgICAvKiBmb3VyIGJ5dGVzICovCiAgICAgIGJ1ZltpKytdID0gMHhmMCB8IChjID4+PiAxOCk7CiAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjID4+PiAxMiAmIDB4M2YpOwogICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gNiAmIDB4M2YpOwogICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyAmIDB4M2YpOwogICAgfQogIH0KCiAgcmV0dXJuIGJ1ZjsKfTsKCi8vIEhlbHBlcgpjb25zdCBidWYyYmluc3RyaW5nID0gKGJ1ZiwgbGVuKSA9PiB7CiAgLy8gT24gQ2hyb21lLCB0aGUgYXJndW1lbnRzIGluIGEgZnVuY3Rpb24gY2FsbCB0aGF0IGFyZSBhbGxvd2VkIGlzIGA2NTUzNGAuCiAgLy8gSWYgdGhlIGxlbmd0aCBvZiB0aGUgYnVmZmVyIGlzIHNtYWxsZXIgdGhhbiB0aGF0LCB3ZSBjYW4gdXNlIHRoaXMgb3B0aW1pemF0aW9uLAogIC8vIG90aGVyd2lzZSB3ZSB3aWxsIHRha2UgYSBzbG93ZXIgcGF0aC4KICBpZiAobGVuIDwgNjU1MzQpIHsKICAgIGlmIChidWYuc3ViYXJyYXkgJiYgU1RSX0FQUExZX1VJQV9PSykgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBidWYubGVuZ3RoID09PSBsZW4gPyBidWYgOiBidWYuc3ViYXJyYXkoMCwgbGVuKSk7CiAgICB9CiAgfQoKICBsZXQgcmVzdWx0ID0gJyc7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKTsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfTsKCgovLyBjb252ZXJ0IGFycmF5IHRvIHN0cmluZwp2YXIgYnVmMnN0cmluZyA9IChidWYsIG1heCkgPT4gewogIGNvbnN0IGxlbiA9IG1heCB8fCBidWYubGVuZ3RoOwoKICBpZiAodHlwZW9mIFRleHREZWNvZGVyID09PSAnZnVuY3Rpb24nICYmIFRleHREZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUpIHsKICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoYnVmLnN1YmFycmF5KDAsIG1heCkpOwogIH0KCiAgbGV0IGksIG91dDsKCiAgLy8gUmVzZXJ2ZSBtYXggcG9zc2libGUgbGVuZ3RoICgyIHdvcmRzIHBlciBjaGFyKQogIC8vIE5COiBieSB1bmtub3duIHJlYXNvbnMsIEFycmF5IGlzIHNpZ25pZmljYW50bHkgZmFzdGVyIGZvcgogIC8vICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5IHRoYW4gVWludDE2QXJyYXkuCiAgY29uc3QgdXRmMTZidWYgPSBuZXcgQXJyYXkobGVuICogMik7CgogIGZvciAob3V0ID0gMCwgaSA9IDA7IGkgPCBsZW47KSB7CiAgICBsZXQgYyA9IGJ1ZltpKytdOwogICAgLy8gcXVpY2sgcHJvY2VzcyBhc2NpaQogICAgaWYgKGMgPCAweDgwKSB7IHV0ZjE2YnVmW291dCsrXSA9IGM7IGNvbnRpbnVlOyB9CgogICAgbGV0IGNfbGVuID0gX3V0ZjhsZW5bY107CiAgICAvLyBza2lwIDUgJiA2IGJ5dGUgY29kZXMKICAgIGlmIChjX2xlbiA+IDQpIHsgdXRmMTZidWZbb3V0KytdID0gMHhmZmZkOyBpICs9IGNfbGVuIC0gMTsgY29udGludWU7IH0KCiAgICAvLyBhcHBseSBtYXNrIG9uIGZpcnN0IGJ5dGUKICAgIGMgJj0gY19sZW4gPT09IDIgPyAweDFmIDogY19sZW4gPT09IDMgPyAweDBmIDogMHgwNzsKICAgIC8vIGpvaW4gdGhlIHJlc3QKICAgIHdoaWxlIChjX2xlbiA+IDEgJiYgaSA8IGxlbikgewogICAgICBjID0gKGMgPDwgNikgfCAoYnVmW2krK10gJiAweDNmKTsKICAgICAgY19sZW4tLTsKICAgIH0KCiAgICAvLyB0ZXJtaW5hdGVkIGJ5IGVuZCBvZiBzdHJpbmc/CiAgICBpZiAoY19sZW4gPiAxKSB7IHV0ZjE2YnVmW291dCsrXSA9IDB4ZmZmZDsgY29udGludWU7IH0KCiAgICBpZiAoYyA8IDB4MTAwMDApIHsKICAgICAgdXRmMTZidWZbb3V0KytdID0gYzsKICAgIH0gZWxzZSB7CiAgICAgIGMgLT0gMHgxMDAwMDsKICAgICAgdXRmMTZidWZbb3V0KytdID0gMHhkODAwIHwgKChjID4+IDEwKSAmIDB4M2ZmKTsKICAgICAgdXRmMTZidWZbb3V0KytdID0gMHhkYzAwIHwgKGMgJiAweDNmZik7CiAgICB9CiAgfQoKICByZXR1cm4gYnVmMmJpbnN0cmluZyh1dGYxNmJ1Ziwgb3V0KTsKfTsKCgovLyBDYWxjdWxhdGUgbWF4IHBvc3NpYmxlIHBvc2l0aW9uIGluIHV0ZjggYnVmZmVyLAovLyB0aGF0IHdpbGwgbm90IGJyZWFrIHNlcXVlbmNlLiBJZiB0aGF0J3Mgbm90IHBvc3NpYmxlCi8vIC0gKHZlcnkgc21hbGwgbGltaXRzKSByZXR1cm4gbWF4IHNpemUgYXMgaXMuCi8vCi8vIGJ1ZltdIC0gdXRmOCBieXRlcyBhcnJheQovLyBtYXggICAtIGxlbmd0aCBsaW1pdCAobWFuZGF0b3J5KTsKdmFyIHV0Zjhib3JkZXIgPSAoYnVmLCBtYXgpID0+IHsKCiAgbWF4ID0gbWF4IHx8IGJ1Zi5sZW5ndGg7CiAgaWYgKG1heCA+IGJ1Zi5sZW5ndGgpIHsgbWF4ID0gYnVmLmxlbmd0aDsgfQoKICAvLyBnbyBiYWNrIGZyb20gbGFzdCBwb3NpdGlvbiwgdW50aWwgc3RhcnQgb2Ygc2VxdWVuY2UgZm91bmQKICBsZXQgcG9zID0gbWF4IC0gMTsKICB3aGlsZSAocG9zID49IDAgJiYgKGJ1Zltwb3NdICYgMHhDMCkgPT09IDB4ODApIHsgcG9zLS07IH0KCiAgLy8gVmVyeSBzbWFsbCBhbmQgYnJva2VuIHNlcXVlbmNlLAogIC8vIHJldHVybiBtYXgsIGJlY2F1c2Ugd2Ugc2hvdWxkIHJldHVybiBzb21ldGhpbmcgYW55d2F5LgogIGlmIChwb3MgPCAwKSB7IHJldHVybiBtYXg7IH0KCiAgLy8gSWYgd2UgY2FtZSB0byBzdGFydCBvZiBidWZmZXIgLSB0aGF0IG1lYW5zIGJ1ZmZlciBpcyB0b28gc21hbGwsCiAgLy8gcmV0dXJuIG1heCB0b28uCiAgaWYgKHBvcyA9PT0gMCkgeyByZXR1cm4gbWF4OyB9CgogIHJldHVybiAocG9zICsgX3V0ZjhsZW5bYnVmW3Bvc11dID4gbWF4KSA/IHBvcyA6IG1heDsKfTsKCnZhciBzdHJpbmdzID0gewoJc3RyaW5nMmJ1Zjogc3RyaW5nMmJ1ZiwKCWJ1ZjJzdHJpbmc6IGJ1ZjJzdHJpbmcsCgl1dGY4Ym9yZGVyOiB1dGY4Ym9yZGVyCn07CgovLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KLy8KLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCi8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCi8vCi8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAovLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0Ci8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKLy8KLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQovLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQovLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCi8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCi8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgovLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKZnVuY3Rpb24gWlN0cmVhbSgpIHsKICAvKiBuZXh0IGlucHV0IGJ5dGUgKi8KICB0aGlzLmlucHV0ID0gbnVsbDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwogIHRoaXMubmV4dF9pbiA9IDA7CiAgLyogbnVtYmVyIG9mIGJ5dGVzIGF2YWlsYWJsZSBhdCBpbnB1dCAqLwogIHRoaXMuYXZhaWxfaW4gPSAwOwogIC8qIHRvdGFsIG51bWJlciBvZiBpbnB1dCBieXRlcyByZWFkIHNvIGZhciAqLwogIHRoaXMudG90YWxfaW4gPSAwOwogIC8qIG5leHQgb3V0cHV0IGJ5dGUgc2hvdWxkIGJlIHB1dCB0aGVyZSAqLwogIHRoaXMub3V0cHV0ID0gbnVsbDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwogIHRoaXMubmV4dF9vdXQgPSAwOwogIC8qIHJlbWFpbmluZyBmcmVlIHNwYWNlIGF0IG91dHB1dCAqLwogIHRoaXMuYXZhaWxfb3V0ID0gMDsKICAvKiB0b3RhbCBudW1iZXIgb2YgYnl0ZXMgb3V0cHV0IHNvIGZhciAqLwogIHRoaXMudG90YWxfb3V0ID0gMDsKICAvKiBsYXN0IGVycm9yIG1lc3NhZ2UsIE5VTEwgaWYgbm8gZXJyb3IgKi8KICB0aGlzLm1zZyA9ICcnLypaX05VTEwqLzsKICAvKiBub3QgdmlzaWJsZSBieSBhcHBsaWNhdGlvbnMgKi8KICB0aGlzLnN0YXRlID0gbnVsbDsKICAvKiBiZXN0IGd1ZXNzIGFib3V0IHRoZSBkYXRhIHR5cGU6IGJpbmFyeSBvciB0ZXh0ICovCiAgdGhpcy5kYXRhX3R5cGUgPSAyLypaX1VOS05PV04qLzsKICAvKiBhZGxlcjMyIHZhbHVlIG9mIHRoZSB1bmNvbXByZXNzZWQgZGF0YSAqLwogIHRoaXMuYWRsZXIgPSAwOwp9Cgp2YXIgenN0cmVhbSA9IFpTdHJlYW07Cgpjb25zdCB0b1N0cmluZyQxID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCi8qIFB1YmxpYyBjb25zdGFudHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgpjb25zdCB7CiAgWl9OT19GTFVTSDogWl9OT19GTFVTSCQxLCBaX1NZTkNfRkxVU0gsIFpfRlVMTF9GTFVTSCwgWl9GSU5JU0g6IFpfRklOSVNIJDIsCiAgWl9PSzogWl9PSyQyLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQyLAogIFpfREVGQVVMVF9DT01QUkVTU0lPTiwKICBaX0RFRkFVTFRfU1RSQVRFR1ksCiAgWl9ERUZMQVRFRDogWl9ERUZMQVRFRCQxCn0gPSBjb25zdGFudHMkMjsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKLyoqCiAqIGNsYXNzIERlZmxhdGUKICoKICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogKiBzdHJlYW1pbmcgYmVoYXZpb3VyIC0gdXNlIG1vcmUgc2ltcGxlIGZ1bmN0aW9uczogW1tkZWZsYXRlXV0sCiAqIFtbZGVmbGF0ZVJhd11dIGFuZCBbW2d6aXBdXS4KICoqLwoKLyogaW50ZXJuYWwKICogRGVmbGF0ZS5jaHVua3MgLT4gQXJyYXkKICoKICogQ2h1bmtzIG9mIG91dHB1dCBkYXRhLCBpZiBbW0RlZmxhdGUjb25EYXRhXV0gbm90IG92ZXJyaWRkZW4uCiAqKi8KCi8qKgogKiBEZWZsYXRlLnJlc3VsdCAtPiBVaW50OEFycmF5CiAqCiAqIENvbXByZXNzZWQgcmVzdWx0LCBnZW5lcmF0ZWQgYnkgZGVmYXVsdCBbW0RlZmxhdGUjb25EYXRhXV0KICogYW5kIFtbRGVmbGF0ZSNvbkVuZF1dIGhhbmRsZXJzLiBGaWxsZWQgYWZ0ZXIgeW91IHB1c2ggbGFzdCBjaHVuawogKiAoY2FsbCBbW0RlZmxhdGUjcHVzaF1dIHdpdGggYFpfRklOSVNIYCAvIGB0cnVlYCBwYXJhbSkuCiAqKi8KCi8qKgogKiBEZWZsYXRlLmVyciAtPiBOdW1iZXIKICoKICogRXJyb3IgY29kZSBhZnRlciBkZWZsYXRlIGZpbmlzaGVkLiAwIChaX09LKSBvbiBzdWNjZXNzLgogKiBZb3Ugd2lsbCBub3QgbmVlZCBpdCBpbiByZWFsIGxpZmUsIGJlY2F1c2UgZGVmbGF0ZSBlcnJvcnMKICogYXJlIHBvc3NpYmxlIG9ubHkgb24gd3Jvbmcgb3B0aW9ucyBvciBiYWQgYG9uRGF0YWAgLyBgb25FbmRgCiAqIGN1c3RvbSBoYW5kbGVycy4KICoqLwoKLyoqCiAqIERlZmxhdGUubXNnIC0+IFN0cmluZwogKgogKiBFcnJvciBtZXNzYWdlLCBpZiBbW0RlZmxhdGUuZXJyXV0gIT0gMAogKiovCgoKLyoqCiAqIG5ldyBEZWZsYXRlKG9wdGlvbnMpCiAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBkZWZsYXRlIG9wdGlvbnMuCiAqCiAqIENyZWF0ZXMgbmV3IGRlZmxhdG9yIGluc3RhbmNlIHdpdGggc3BlY2lmaWVkIHBhcmFtcy4gVGhyb3dzIGV4Y2VwdGlvbgogKiBvbiBiYWQgcGFyYW1zLiBTdXBwb3J0ZWQgb3B0aW9uczoKICoKICogLSBgbGV2ZWxgCiAqIC0gYHdpbmRvd0JpdHNgCiAqIC0gYG1lbUxldmVsYAogKiAtIGBzdHJhdGVneWAKICogLSBgZGljdGlvbmFyeWAKICoKICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZS4KICoKICogQWRkaXRpb25hbCBvcHRpb25zLCBmb3IgaW50ZXJuYWwgbmVlZHM6CiAqCiAqIC0gYGNodW5rU2l6ZWAgLSBzaXplIG9mIGdlbmVyYXRlZCBkYXRhIGNodW5rcyAoMTZLIGJ5IGRlZmF1bHQpCiAqIC0gYHJhd2AgKEJvb2xlYW4pIC0gZG8gcmF3IGRlZmxhdGUKICogLSBgZ3ppcGAgKEJvb2xlYW4pIC0gY3JlYXRlIGd6aXAgd3JhcHBlcgogKiAtIGBoZWFkZXJgIChPYmplY3QpIC0gY3VzdG9tIGhlYWRlciBmb3IgZ3ppcAogKiAgIC0gYHRleHRgIChCb29sZWFuKSAtIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQKICogICAtIGB0aW1lYCAoTnVtYmVyKSAtIG1vZGlmaWNhdGlvbiB0aW1lLCB1bml4IHRpbWVzdGFtcAogKiAgIC0gYG9zYCAoTnVtYmVyKSAtIG9wZXJhdGlvbiBzeXN0ZW0gY29kZQogKiAgIC0gYGV4dHJhYCAoQXJyYXkpIC0gYXJyYXkgb2YgYnl0ZXMgd2l0aCBleHRyYSBkYXRhIChtYXggNjU1MzYpCiAqICAgLSBgbmFtZWAgKFN0cmluZykgLSBmaWxlIG5hbWUgKGJpbmFyeSBzdHJpbmcpCiAqICAgLSBgY29tbWVudGAgKFN0cmluZykgLSBjb21tZW50IChiaW5hcnkgc3RyaW5nKQogKiAgIC0gYGhjcmNgIChCb29sZWFuKSAtIHRydWUgaWYgaGVhZGVyIGNyYyBzaG91bGQgYmUgYWRkZWQKICoKICogIyMjIyMgRXhhbXBsZToKICoKICogYGBgamF2YXNjcmlwdAogKiBjb25zdCBwYWtvID0gcmVxdWlyZSgncGFrbycpCiAqICAgLCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogKiAgICwgY2h1bmsyID0gbmV3IFVpbnQ4QXJyYXkoWzEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5XSk7CiAqCiAqIGNvbnN0IGRlZmxhdGUgPSBuZXcgcGFrby5EZWZsYXRlKHsgbGV2ZWw6IDN9KTsKICoKICogZGVmbGF0ZS5wdXNoKGNodW5rMSwgZmFsc2UpOwogKiBkZWZsYXRlLnB1c2goY2h1bmsyLCB0cnVlKTsgIC8vIHRydWUgLT4gbGFzdCBjaHVuawogKgogKiBpZiAoZGVmbGF0ZS5lcnIpIHsgdGhyb3cgbmV3IEVycm9yKGRlZmxhdGUuZXJyKTsgfQogKgogKiBjb25zb2xlLmxvZyhkZWZsYXRlLnJlc3VsdCk7CiAqIGBgYAogKiovCmZ1bmN0aW9uIERlZmxhdGUkMShvcHRpb25zKSB7CiAgdGhpcy5vcHRpb25zID0gY29tbW9uLmFzc2lnbih7CiAgICBsZXZlbDogWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgbWV0aG9kOiBaX0RFRkxBVEVEJDEsCiAgICBjaHVua1NpemU6IDE2Mzg0LAogICAgd2luZG93Qml0czogMTUsCiAgICBtZW1MZXZlbDogOCwKICAgIHN0cmF0ZWd5OiBaX0RFRkFVTFRfU1RSQVRFR1kKICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgbGV0IG9wdCA9IHRoaXMub3B0aW9uczsKCiAgaWYgKG9wdC5yYXcgJiYgKG9wdC53aW5kb3dCaXRzID4gMCkpIHsKICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogIH0KCiAgZWxzZSBpZiAob3B0Lmd6aXAgJiYgKG9wdC53aW5kb3dCaXRzID4gMCkgJiYgKG9wdC53aW5kb3dCaXRzIDwgMTYpKSB7CiAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICB9CgogIHRoaXMuZXJyICAgID0gMDsgICAgICAvLyBlcnJvciBjb2RlLCBpZiBoYXBwZW5zICgwID0gWl9PSykKICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogIHRoaXMuZW5kZWQgID0gZmFsc2U7ICAvLyB1c2VkIHRvIGF2b2lkIG11bHRpcGxlIG9uRW5kKCkgY2FsbHMKICB0aGlzLmNodW5rcyA9IFtdOyAgICAgLy8gY2h1bmtzIG9mIGNvbXByZXNzZWQgZGF0YQoKICB0aGlzLnN0cm0gPSBuZXcgenN0cmVhbSgpOwogIHRoaXMuc3RybS5hdmFpbF9vdXQgPSAwOwoKICBsZXQgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZUluaXQyKAogICAgdGhpcy5zdHJtLAogICAgb3B0LmxldmVsLAogICAgb3B0Lm1ldGhvZCwKICAgIG9wdC53aW5kb3dCaXRzLAogICAgb3B0Lm1lbUxldmVsLAogICAgb3B0LnN0cmF0ZWd5CiAgKTsKCiAgaWYgKHN0YXR1cyAhPT0gWl9PSyQyKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZXNbc3RhdHVzXSk7CiAgfQoKICBpZiAob3B0LmhlYWRlcikgewogICAgZGVmbGF0ZV8xJDIuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sIG9wdC5oZWFkZXIpOwogIH0KCiAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICBsZXQgZGljdDsKICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgIGlmICh0eXBlb2Ygb3B0LmRpY3Rpb25hcnkgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIElmIHdlIG5lZWQgdG8gY29tcHJlc3MgdGV4dCwgY2hhbmdlIGVuY29kaW5nIHRvIHV0ZjguCiAgICAgIGRpY3QgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgfSBlbHNlIGlmICh0b1N0cmluZyQxLmNhbGwob3B0LmRpY3Rpb25hcnkpID09PSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nKSB7CiAgICAgIGRpY3QgPSBuZXcgVWludDhBcnJheShvcHQuZGljdGlvbmFyeSk7CiAgICB9IGVsc2UgewogICAgICBkaWN0ID0gb3B0LmRpY3Rpb25hcnk7CiAgICB9CgogICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBkaWN0KTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LJDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgfQoKICAgIHRoaXMuX2RpY3Rfc2V0ID0gdHJ1ZTsKICB9Cn0KCi8qKgogKiBEZWZsYXRlI3B1c2goZGF0YVssIGZsdXNoX21vZGVdKSAtPiBCb29sZWFuCiAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcnxTdHJpbmcpOiBpbnB1dCBkYXRhLiBTdHJpbmdzIHdpbGwgYmUKICogICBjb252ZXJ0ZWQgdG8gdXRmOCBieXRlIHNlcXVlbmNlLgogKiAtIGZsdXNoX21vZGUgKE51bWJlcnxCb29sZWFuKTogMC4uNiBmb3IgY29ycmVzcG9uZGluZyBaX05PX0ZMVVNILi5aX1RSRUUgbW9kZXMuCiAqICAgU2VlIGNvbnN0YW50cy4gU2tpcHBlZCBvciBgZmFsc2VgIG1lYW5zIFpfTk9fRkxVU0gsIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICoKICogU2VuZHMgaW5wdXQgZGF0YSB0byBkZWZsYXRlIHBpcGUsIGdlbmVyYXRpbmcgW1tEZWZsYXRlI29uRGF0YV1dIGNhbGxzIHdpdGgKICogbmV3IGNvbXByZXNzZWQgY2h1bmtzLiBSZXR1cm5zIGB0cnVlYCBvbiBzdWNjZXNzLiBUaGUgbGFzdCBkYXRhIGJsb2NrIG11c3QKICogaGF2ZSBgZmx1c2hfbW9kZWAgWl9GSU5JU0ggKG9yIGB0cnVlYCkuIFRoYXQgd2lsbCBmbHVzaCBpbnRlcm5hbCBwZW5kaW5nCiAqIGJ1ZmZlcnMgYW5kIGNhbGwgW1tEZWZsYXRlI29uRW5kXV0uCiAqCiAqIE9uIGZhaWwgY2FsbCBbW0RlZmxhdGUjb25FbmRdXSB3aXRoIGVycm9yIGNvZGUgYW5kIHJldHVybiBmYWxzZS4KICoKICogIyMjIyMgRXhhbXBsZQogKgogKiBgYGBqYXZhc2NyaXB0CiAqIHB1c2goY2h1bmssIGZhbHNlKTsgLy8gcHVzaCBvbmUgb2YgZGF0YSBjaHVua3MKICogLi4uCiAqIHB1c2goY2h1bmssIHRydWUpOyAgLy8gcHVzaCBsYXN0IGNodW5rCiAqIGBgYAogKiovCkRlZmxhdGUkMS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChkYXRhLCBmbHVzaF9tb2RlKSB7CiAgY29uc3Qgc3RybSA9IHRoaXMuc3RybTsKICBjb25zdCBjaHVua1NpemUgPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplOwogIGxldCBzdGF0dXMsIF9mbHVzaF9tb2RlOwoKICBpZiAodGhpcy5lbmRlZCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgaWYgKGZsdXNoX21vZGUgPT09IH5+Zmx1c2hfbW9kZSkgX2ZsdXNoX21vZGUgPSBmbHVzaF9tb2RlOwogIGVsc2UgX2ZsdXNoX21vZGUgPSBmbHVzaF9tb2RlID09PSB0cnVlID8gWl9GSU5JU0gkMiA6IFpfTk9fRkxVU0gkMTsKCiAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHsKICAgIC8vIElmIHdlIG5lZWQgdG8gY29tcHJlc3MgdGV4dCwgY2hhbmdlIGVuY29kaW5nIHRvIHV0ZjguCiAgICBzdHJtLmlucHV0ID0gc3RyaW5ncy5zdHJpbmcyYnVmKGRhdGEpOwogIH0gZWxzZSBpZiAodG9TdHJpbmckMS5jYWxsKGRhdGEpID09PSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nKSB7CiAgICBzdHJtLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgfSBlbHNlIHsKICAgIHN0cm0uaW5wdXQgPSBkYXRhOwogIH0KCiAgc3RybS5uZXh0X2luID0gMDsKICBzdHJtLmF2YWlsX2luID0gc3RybS5pbnB1dC5sZW5ndGg7CgogIGZvciAoOzspIHsKICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICBzdHJtLm91dHB1dCA9IG5ldyBVaW50OEFycmF5KGNodW5rU2l6ZSk7CiAgICAgIHN0cm0ubmV4dF9vdXQgPSAwOwogICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgIH0KCiAgICAvLyBNYWtlIHN1cmUgYXZhaWxfb3V0ID4gNiB0byBhdm9pZCByZXBlYXRpbmcgbWFya2VycwogICAgaWYgKChfZmx1c2hfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIIHx8IF9mbHVzaF9tb2RlID09PSBaX0ZVTExfRkxVU0gpICYmIHN0cm0uYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgdGhpcy5vbkRhdGEoc3RybS5vdXRwdXQuc3ViYXJyYXkoMCwgc3RybS5uZXh0X291dCkpOwogICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHN0YXR1cyA9IGRlZmxhdGVfMSQyLmRlZmxhdGUoc3RybSwgX2ZsdXNoX21vZGUpOwoKICAgIC8vIEVuZGVkID0+IGZsdXNoIGFuZCBmaW5pc2gKICAgIGlmIChzdGF0dXMgPT09IFpfU1RSRUFNX0VORCQyKSB7CiAgICAgIGlmIChzdHJtLm5leHRfb3V0ID4gMCkgewogICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgfQogICAgICBzdGF0dXMgPSBkZWZsYXRlXzEkMi5kZWZsYXRlRW5kKHRoaXMuc3RybSk7CiAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgdGhpcy5lbmRlZCA9IHRydWU7CiAgICAgIHJldHVybiBzdGF0dXMgPT09IFpfT0skMjsKICAgIH0KCiAgICAvLyBGbHVzaCBpZiBvdXQgYnVmZmVyIGZ1bGwKICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dCk7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIC8vIEZsdXNoIGlmIHJlcXVlc3RlZCBhbmQgaGFzIGRhdGEKICAgIGlmIChfZmx1c2hfbW9kZSA+IDAgJiYgc3RybS5uZXh0X291dCA+IDApIHsKICAgICAgdGhpcy5vbkRhdGEoc3RybS5vdXRwdXQuc3ViYXJyYXkoMCwgc3RybS5uZXh0X291dCkpOwogICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChzdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICB9CgogIHJldHVybiB0cnVlOwp9OwoKCi8qKgogKiBEZWZsYXRlI29uRGF0YShjaHVuaykgLT4gVm9pZAogKiAtIGNodW5rIChVaW50OEFycmF5KTogb3V0cHV0IGRhdGEuCiAqCiAqIEJ5IGRlZmF1bHQsIHN0b3JlcyBkYXRhIGJsb2NrcyBpbiBgY2h1bmtzW11gIHByb3BlcnR5IGFuZCBnbHVlCiAqIHRob3NlIGluIGBvbkVuZGAuIE92ZXJyaWRlIHRoaXMgaGFuZGxlciwgaWYgeW91IG5lZWQgYW5vdGhlciBiZWhhdmlvdXIuCiAqKi8KRGVmbGF0ZSQxLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbiAoY2h1bmspIHsKICB0aGlzLmNodW5rcy5wdXNoKGNodW5rKTsKfTsKCgovKioKICogRGVmbGF0ZSNvbkVuZChzdGF0dXMpIC0+IFZvaWQKICogLSBzdGF0dXMgKE51bWJlcik6IGRlZmxhdGUgc3RhdHVzLiAwIChaX09LKSBvbiBzdWNjZXNzLAogKiAgIG90aGVyIGlmIG5vdC4KICoKICogQ2FsbGVkIG9uY2UgYWZ0ZXIgeW91IHRlbGwgZGVmbGF0ZSB0aGF0IHRoZSBpbnB1dCBzdHJlYW0gaXMKICogY29tcGxldGUgKFpfRklOSVNIKS4gQnkgZGVmYXVsdCAtIGpvaW4gY29sbGVjdGVkIGNodW5rcywKICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICoqLwpEZWZsYXRlJDEucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24gKHN0YXR1cykgewogIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgaWYgKHN0YXR1cyA9PT0gWl9PSyQyKSB7CiAgICB0aGlzLnJlc3VsdCA9IGNvbW1vbi5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICB9CiAgdGhpcy5jaHVua3MgPSBbXTsKICB0aGlzLmVyciA9IHN0YXR1czsKICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7Cn07CgovLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KLy8KLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCi8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCi8vCi8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAovLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0Ci8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKLy8KLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQovLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQovLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCi8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCi8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgovLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKLy8gU2VlIHN0YXRlIGRlZnMgZnJvbSBpbmZsYXRlLmpzCmNvbnN0IEJBRCQxID0gMzA7ICAgICAgIC8qIGdvdCBhIGRhdGEgZXJyb3IgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KY29uc3QgVFlQRSQxID0gMTI7ICAgICAgLyogaTogd2FpdGluZyBmb3IgdHlwZSBiaXRzLCBpbmNsdWRpbmcgbGFzdC1mbGFnIGJpdCAqLwoKLyoKICAgRGVjb2RlIGxpdGVyYWwsIGxlbmd0aCwgYW5kIGRpc3RhbmNlIGNvZGVzIGFuZCB3cml0ZSBvdXQgdGhlIHJlc3VsdGluZwogICBsaXRlcmFsIGFuZCBtYXRjaCBieXRlcyB1bnRpbCBlaXRoZXIgbm90IGVub3VnaCBpbnB1dCBvciBvdXRwdXQgaXMKICAgYXZhaWxhYmxlLCBhbiBlbmQtb2YtYmxvY2sgaXMgZW5jb3VudGVyZWQsIG9yIGEgZGF0YSBlcnJvciBpcyBlbmNvdW50ZXJlZC4KICAgV2hlbiBsYXJnZSBlbm91Z2ggaW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIGFyZSBzdXBwbGllZCB0byBpbmZsYXRlKCksIGZvcgogICBleGFtcGxlLCBhIDE2SyBpbnB1dCBidWZmZXIgYW5kIGEgNjRLIG91dHB1dCBidWZmZXIsIG1vcmUgdGhhbiA5NSUgb2YgdGhlCiAgIGluZmxhdGUgZXhlY3V0aW9uIHRpbWUgaXMgc3BlbnQgaW4gdGhpcyByb3V0aW5lLgoKICAgRW50cnkgYXNzdW1wdGlvbnM6CgogICAgICAgIHN0YXRlLm1vZGUgPT09IExFTgogICAgICAgIHN0cm0uYXZhaWxfaW4gPj0gNgogICAgICAgIHN0cm0uYXZhaWxfb3V0ID49IDI1OAogICAgICAgIHN0YXJ0ID49IHN0cm0uYXZhaWxfb3V0CiAgICAgICAgc3RhdGUuYml0cyA8IDgKCiAgIE9uIHJldHVybiwgc3RhdGUubW9kZSBpcyBvbmUgb2Y6CgogICAgICAgIExFTiAtLSByYW4gb3V0IG9mIGVub3VnaCBvdXRwdXQgc3BhY2Ugb3IgZW5vdWdoIGF2YWlsYWJsZSBpbnB1dAogICAgICAgIFRZUEUgLS0gcmVhY2hlZCBlbmQgb2YgYmxvY2sgY29kZSwgaW5mbGF0ZSgpIHRvIGludGVycHJldCBuZXh0IGJsb2NrCiAgICAgICAgQkFEIC0tIGVycm9yIGluIGJsb2NrIGRhdGEKCiAgIE5vdGVzOgoKICAgIC0gVGhlIG1heGltdW0gaW5wdXQgYml0cyB1c2VkIGJ5IGEgbGVuZ3RoL2Rpc3RhbmNlIHBhaXIgaXMgMTUgYml0cyBmb3IgdGhlCiAgICAgIGxlbmd0aCBjb2RlLCA1IGJpdHMgZm9yIHRoZSBsZW5ndGggZXh0cmEsIDE1IGJpdHMgZm9yIHRoZSBkaXN0YW5jZSBjb2RlLAogICAgICBhbmQgMTMgYml0cyBmb3IgdGhlIGRpc3RhbmNlIGV4dHJhLiAgVGhpcyB0b3RhbHMgNDggYml0cywgb3Igc2l4IGJ5dGVzLgogICAgICBUaGVyZWZvcmUgaWYgc3RybS5hdmFpbF9pbiA+PSA2LCB0aGVuIHRoZXJlIGlzIGVub3VnaCBpbnB1dCB0byBhdm9pZAogICAgICBjaGVja2luZyBmb3IgYXZhaWxhYmxlIGlucHV0IHdoaWxlIGRlY29kaW5nLgoKICAgIC0gVGhlIG1heGltdW0gYnl0ZXMgdGhhdCBhIHNpbmdsZSBsZW5ndGgvZGlzdGFuY2UgcGFpciBjYW4gb3V0cHV0IGlzIDI1OAogICAgICBieXRlcywgd2hpY2ggaXMgdGhlIG1heGltdW0gbGVuZ3RoIHRoYXQgY2FuIGJlIGNvZGVkLiAgaW5mbGF0ZV9mYXN0KCkKICAgICAgcmVxdWlyZXMgc3RybS5hdmFpbF9vdXQgPj0gMjU4IGZvciBlYWNoIGxvb3AgdG8gYXZvaWQgY2hlY2tpbmcgZm9yCiAgICAgIG91dHB1dCBzcGFjZS4KICovCnZhciBpbmZmYXN0ID0gZnVuY3Rpb24gaW5mbGF0ZV9mYXN0KHN0cm0sIHN0YXJ0KSB7CiAgbGV0IF9pbjsgICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uaW5wdXQgKi8KICBsZXQgbGFzdDsgICAgICAgICAgICAgICAgICAgLyogaGF2ZSBlbm91Z2ggaW5wdXQgd2hpbGUgaW4gPCBsYXN0ICovCiAgbGV0IF9vdXQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ub3V0cHV0ICovCiAgbGV0IGJlZzsgICAgICAgICAgICAgICAgICAgIC8qIGluZmxhdGUoKSdzIGluaXRpYWwgc3RybS5vdXRwdXQgKi8KICBsZXQgZW5kOyAgICAgICAgICAgICAgICAgICAgLyogd2hpbGUgb3V0IDwgZW5kLCBlbm91Z2ggc3BhY2UgYXZhaWxhYmxlICovCi8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgbGV0IGRtYXg7ICAgICAgICAgICAgICAgICAgIC8qIG1heGltdW0gZGlzdGFuY2UgZnJvbSB6bGliIGhlYWRlciAqLwovLyNlbmRpZgogIGxldCB3c2l6ZTsgICAgICAgICAgICAgICAgICAvKiB3aW5kb3cgc2l6ZSBvciB6ZXJvIGlmIG5vdCB1c2luZyB3aW5kb3cgKi8KICBsZXQgd2hhdmU7ICAgICAgICAgICAgICAgICAgLyogdmFsaWQgYnl0ZXMgaW4gdGhlIHdpbmRvdyAqLwogIGxldCB3bmV4dDsgICAgICAgICAgICAgICAgICAvKiB3aW5kb3cgd3JpdGUgaW5kZXggKi8KICAvLyBVc2UgYHNfd2luZG93YCBpbnN0ZWFkIGB3aW5kb3dgLCBhdm9pZCBjb25mbGljdCB3aXRoIGluc3RydW1lbnRhdGlvbiB0b29scwogIGxldCBzX3dpbmRvdzsgICAgICAgICAgICAgICAvKiBhbGxvY2F0ZWQgc2xpZGluZyB3aW5kb3csIGlmIHdzaXplICE9IDAgKi8KICBsZXQgaG9sZDsgICAgICAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS5ob2xkICovCiAgbGV0IGJpdHM7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uYml0cyAqLwogIGxldCBsY29kZTsgICAgICAgICAgICAgICAgICAvKiBsb2NhbCBzdHJtLmxlbmNvZGUgKi8KICBsZXQgZGNvZGU7ICAgICAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS5kaXN0Y29kZSAqLwogIGxldCBsbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBsZW5ndGggY29kZXMgKi8KICBsZXQgZG1hc2s7ICAgICAgICAgICAgICAgICAgLyogbWFzayBmb3IgZmlyc3QgbGV2ZWwgb2YgZGlzdGFuY2UgY29kZXMgKi8KICBsZXQgaGVyZTsgICAgICAgICAgICAgICAgICAgLyogcmV0cmlldmVkIHRhYmxlIGVudHJ5ICovCiAgbGV0IG9wOyAgICAgICAgICAgICAgICAgICAgIC8qIGNvZGUgYml0cywgb3BlcmF0aW9uLCBleHRyYSBiaXRzLCBvciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgd2luZG93IHBvc2l0aW9uLCB3aW5kb3cgYnl0ZXMgdG8gY29weSAqLwogIGxldCBsZW47ICAgICAgICAgICAgICAgICAgICAvKiBtYXRjaCBsZW5ndGgsIHVudXNlZCBieXRlcyAqLwogIGxldCBkaXN0OyAgICAgICAgICAgICAgICAgICAvKiBtYXRjaCBkaXN0YW5jZSAqLwogIGxldCBmcm9tOyAgICAgICAgICAgICAgICAgICAvKiB3aGVyZSB0byBjb3B5IG1hdGNoIGZyb20gKi8KICBsZXQgZnJvbV9zb3VyY2U7CgoKICBsZXQgaW5wdXQsIG91dHB1dDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwoKICAvKiBjb3B5IHN0YXRlIHRvIGxvY2FsIHZhcmlhYmxlcyAqLwogIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAvL2hlcmUgPSBzdGF0ZS5oZXJlOwogIF9pbiA9IHN0cm0ubmV4dF9pbjsKICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgbGFzdCA9IF9pbiArIChzdHJtLmF2YWlsX2luIC0gNSk7CiAgX291dCA9IHN0cm0ubmV4dF9vdXQ7CiAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgYmVnID0gX291dCAtIChzdGFydCAtIHN0cm0uYXZhaWxfb3V0KTsKICBlbmQgPSBfb3V0ICsgKHN0cm0uYXZhaWxfb3V0IC0gMjU3KTsKLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICBkbWF4ID0gc3RhdGUuZG1heDsKLy8jZW5kaWYKICB3c2l6ZSA9IHN0YXRlLndzaXplOwogIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgd25leHQgPSBzdGF0ZS53bmV4dDsKICBzX3dpbmRvdyA9IHN0YXRlLndpbmRvdzsKICBob2xkID0gc3RhdGUuaG9sZDsKICBiaXRzID0gc3RhdGUuYml0czsKICBsY29kZSA9IHN0YXRlLmxlbmNvZGU7CiAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICBsbWFzayA9ICgxIDw8IHN0YXRlLmxlbmJpdHMpIC0gMTsKICBkbWFzayA9ICgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDE7CgoKICAvKiBkZWNvZGUgbGl0ZXJhbHMgYW5kIGxlbmd0aC9kaXN0YW5jZXMgdW50aWwgZW5kLW9mLWJsb2NrIG9yIG5vdCBlbm91Z2gKICAgICBpbnB1dCBkYXRhIG9yIG91dHB1dCBzcGFjZSAqLwoKICB0b3A6CiAgZG8gewogICAgaWYgKGJpdHMgPCAxNSkgewogICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICBiaXRzICs9IDg7CiAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgIGJpdHMgKz0gODsKICAgIH0KCiAgICBoZXJlID0gbGNvZGVbaG9sZCAmIGxtYXNrXTsKCiAgICBkb2xlbjoKICAgIGZvciAoOzspIHsgLy8gR290byBlbXVsYXRpb24KICAgICAgb3AgPSBoZXJlID4+PiAyNC8qaGVyZS5iaXRzKi87CiAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgYml0cyAtPSBvcDsKICAgICAgb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZi8qaGVyZS5vcCovOwogICAgICBpZiAob3AgPT09IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGxpdGVyYWwgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgIC8vICAgICAgICAiaW5mbGF0ZTogICAgICAgICBsaXRlcmFsICclYydcbiIgOgogICAgICAgIC8vICAgICAgICAiaW5mbGF0ZTogICAgICAgICBsaXRlcmFsIDB4JTAyeFxuIiwgaGVyZS52YWwpKTsKICAgICAgICBvdXRwdXRbX291dCsrXSA9IGhlcmUgJiAweGZmZmYvKmhlcmUudmFsKi87CiAgICAgIH0KICAgICAgZWxzZSBpZiAob3AgJiAxNikgeyAgICAgICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBiYXNlICovCiAgICAgICAgbGVuID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgZXh0cmEgYml0cyAqLwogICAgICAgIGlmIChvcCkgewogICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBsZW4gKz0gaG9sZCAmICgoMSA8PCBvcCkgLSAxKTsKICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgfQogICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgICBsZW5ndGggJXVcbiIsIGxlbikpOwogICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgYml0cyArPSA4OwogICAgICAgIH0KICAgICAgICBoZXJlID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKCiAgICAgICAgZG9kaXN0OgogICAgICAgIGZvciAoOzspIHsgLy8gZ290byBlbXVsYXRpb24KICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQvKmhlcmUuYml0cyovOwogICAgICAgICAgaG9sZCA+Pj49IG9wOwogICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgIG9wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmYvKmhlcmUub3AqLzsKCiAgICAgICAgICBpZiAob3AgJiAxNikgeyAgICAgICAgICAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYXNlICovCiAgICAgICAgICAgIGRpc3QgPSBoZXJlICYgMHhmZmZmLypoZXJlLnZhbCovOwogICAgICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkaXN0ICs9IGhvbGQgJiAoKDEgPDwgb3ApIC0gMSk7Ci8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICAgICAgICAgIGlmIChkaXN0ID4gZG1heCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICB9Ci8vI2VuZGlmCiAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGRpc3RhbmNlICV1XG4iLCBkaXN0KSk7CiAgICAgICAgICAgIG9wID0gX291dCAtIGJlZzsgICAgICAgICAgICAgICAgLyogbWF4IGRpc3RhbmNlIGluIG91dHB1dCAqLwogICAgICAgICAgICBpZiAoZGlzdCA+IG9wKSB7ICAgICAgICAgICAgICAgIC8qIHNlZSBpZiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgb3AgPSBkaXN0IC0gb3A7ICAgICAgICAgICAgICAgLyogZGlzdGFuY2UgYmFjayBpbiB3aW5kb3cgKi8KICAgICAgICAgICAgICBpZiAob3AgPiB3aGF2ZSkgewogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2snOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgIH0KCi8vICghKSBUaGlzIGJsb2NrIGlzIGRpc2FibGVkIGluIHpsaWIgZGVmYXVsdHMsCi8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKLy8jaWZkZWYgSU5GTEFURV9BTExPV19JTlZBTElEX0RJU1RBTkNFX1RPT0ZBUl9BUlJSCi8vICAgICAgICAgICAgICAgIGlmIChsZW4gPD0gb3AgLSB3aGF2ZSkgewovLyAgICAgICAgICAgICAgICAgIGRvIHsKLy8gICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gMDsKLy8gICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLWxlbik7Ci8vICAgICAgICAgICAgICAgICAgY29udGludWUgdG9wOwovLyAgICAgICAgICAgICAgICB9Ci8vICAgICAgICAgICAgICAgIGxlbiAtPSBvcCAtIHdoYXZlOwovLyAgICAgICAgICAgICAgICBkbyB7Ci8vICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSAwOwovLyAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wID4gd2hhdmUpOwovLyAgICAgICAgICAgICAgICBpZiAob3AgPT09IDApIHsKLy8gICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7Ci8vICAgICAgICAgICAgICAgICAgZG8gewovLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKLy8gICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLWxlbik7Ci8vICAgICAgICAgICAgICAgICAgY29udGludWUgdG9wOwovLyAgICAgICAgICAgICAgICB9Ci8vI2VuZGlmCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZyb20gPSAwOyAvLyB3aW5kb3cgaW5kZXgKICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHNfd2luZG93OwogICAgICAgICAgICAgIGlmICh3bmV4dCA9PT0gMCkgeyAgICAgICAgICAgLyogdmVyeSBjb21tb24gY2FzZSAqLwogICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSAtIG9wOwogICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7ICAgICAgICAgLyogc29tZSBmcm9tIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmICh3bmV4dCA8IG9wKSB7ICAgICAgLyogd3JhcCBhcm91bmQgd2luZG93ICovCiAgICAgICAgICAgICAgICBmcm9tICs9IHdzaXplICsgd25leHQgLSBvcDsKICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7ICAgICAgICAgLyogc29tZSBmcm9tIGVuZCBvZiB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tKytdOwogICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgZnJvbSA9IDA7CiAgICAgICAgICAgICAgICAgIGlmICh3bmV4dCA8IGxlbikgeyAgLyogc29tZSBmcm9tIHN0YXJ0IG9mIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgIG9wID0gd25leHQ7CiAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAgICAgLyogcmVzdCBmcm9tIG91dHB1dCAqLwogICAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAvKiBjb250aWd1b3VzIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgZnJvbSArPSB3bmV4dCAtIG9wOwogICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7ICAgICAgICAgLyogc29tZSBmcm9tIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aGlsZSAobGVuID4gMikgewogICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZnJvbSA9IF9vdXQgLSBkaXN0OyAgICAgICAgICAvKiBjb3B5IGRpcmVjdCBmcm9tIG91dHB1dCAqLwogICAgICAgICAgICAgIGRvIHsgICAgICAgICAgICAgICAgICAgICAgICAvKiBtaW5pbXVtIGxlbmd0aCBpcyB0aHJlZSAqLwogICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgfSB3aGlsZSAobGVuID4gMik7CiAgICAgICAgICAgICAgaWYgKGxlbikgewogICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsgICAgICAgICAgLyogMm5kIGxldmVsIGRpc3RhbmNlIGNvZGUgKi8KICAgICAgICAgICAgaGVyZSA9IGRjb2RlWyhoZXJlICYgMHhmZmZmKS8qaGVyZS52YWwqLyArIChob2xkICYgKCgxIDw8IG9wKSAtIDEpKV07CiAgICAgICAgICAgIGNvbnRpbnVlIGRvZGlzdDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsgLy8gbmVlZCB0byBlbXVsYXRlIGdvdG8gdmlhICJjb250aW51ZSIKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAoKG9wICYgNjQpID09PSAwKSB7ICAgICAgICAgICAgICAvKiAybmQgbGV2ZWwgbGVuZ3RoIGNvZGUgKi8KICAgICAgICBoZXJlID0gbGNvZGVbKGhlcmUgJiAweGZmZmYpLypoZXJlLnZhbCovICsgKGhvbGQgJiAoKDEgPDwgb3ApIC0gMSkpXTsKICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgfQogICAgICBlbHNlIGlmIChvcCAmIDMyKSB7ICAgICAgICAgICAgICAgICAgICAgLyogZW5kLW9mLWJsb2NrICovCiAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFJDE7CiAgICAgICAgYnJlYWsgdG9wOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgbGl0ZXJhbC9sZW5ndGggY29kZSc7CiAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgIGJyZWFrIHRvcDsKICAgICAgfQoKICAgICAgYnJlYWs7IC8vIG5lZWQgdG8gZW11bGF0ZSBnb3RvIHZpYSAiY29udGludWUiCiAgICB9CiAgfSB3aGlsZSAoX2luIDwgbGFzdCAmJiBfb3V0IDwgZW5kKTsKCiAgLyogcmV0dXJuIHVudXNlZCBieXRlcyAob24gZW50cnksIGJpdHMgPCA4LCBzbyBpbiB3b24ndCBnbyB0b28gZmFyIGJhY2spICovCiAgbGVuID0gYml0cyA+PiAzOwogIF9pbiAtPSBsZW47CiAgYml0cyAtPSBsZW4gPDwgMzsKICBob2xkICY9ICgxIDw8IGJpdHMpIC0gMTsKCiAgLyogdXBkYXRlIHN0YXRlIGFuZCByZXR1cm4gKi8KICBzdHJtLm5leHRfaW4gPSBfaW47CiAgc3RybS5uZXh0X291dCA9IF9vdXQ7CiAgc3RybS5hdmFpbF9pbiA9IChfaW4gPCBsYXN0ID8gNSArIChsYXN0IC0gX2luKSA6IDUgLSAoX2luIC0gbGFzdCkpOwogIHN0cm0uYXZhaWxfb3V0ID0gKF9vdXQgPCBlbmQgPyAyNTcgKyAoZW5kIC0gX291dCkgOiAyNTcgLSAoX291dCAtIGVuZCkpOwogIHN0YXRlLmhvbGQgPSBob2xkOwogIHN0YXRlLmJpdHMgPSBiaXRzOwogIHJldHVybjsKfTsKCi8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgovLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgovLwovLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAovLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KLy8KLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCi8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgovLwovLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAovLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCi8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCi8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCi8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgpjb25zdCBNQVhCSVRTID0gMTU7CmNvbnN0IEVOT1VHSF9MRU5TJDEgPSA4NTI7CmNvbnN0IEVOT1VHSF9ESVNUUyQxID0gNTkyOwovL2NvbnN0IEVOT1VHSCA9IChFTk9VR0hfTEVOUytFTk9VR0hfRElTVFMpOwoKY29uc3QgQ09ERVMkMSA9IDA7CmNvbnN0IExFTlMkMSA9IDE7CmNvbnN0IERJU1RTJDEgPSAyOwoKY29uc3QgbGJhc2UgPSBuZXcgVWludDE2QXJyYXkoWyAvKiBMZW5ndGggY29kZXMgMjU3Li4yODUgYmFzZSAqLwogIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTMsIDE1LCAxNywgMTksIDIzLCAyNywgMzEsCiAgMzUsIDQzLCA1MSwgNTksIDY3LCA4MywgOTksIDExNSwgMTMxLCAxNjMsIDE5NSwgMjI3LCAyNTgsIDAsIDAKXSk7Cgpjb25zdCBsZXh0ID0gbmV3IFVpbnQ4QXJyYXkoWyAvKiBMZW5ndGggY29kZXMgMjU3Li4yODUgZXh0cmEgKi8KICAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE3LCAxNywgMTcsIDE3LCAxOCwgMTgsIDE4LCAxOCwKICAxOSwgMTksIDE5LCAxOSwgMjAsIDIwLCAyMCwgMjAsIDIxLCAyMSwgMjEsIDIxLCAxNiwgNzIsIDc4Cl0pOwoKY29uc3QgZGJhc2UgPSBuZXcgVWludDE2QXJyYXkoWyAvKiBEaXN0YW5jZSBjb2RlcyAwLi4yOSBiYXNlICovCiAgMSwgMiwgMywgNCwgNSwgNywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLAogIDI1NywgMzg1LCA1MTMsIDc2OSwgMTAyNSwgMTUzNywgMjA0OSwgMzA3MywgNDA5NywgNjE0NSwKICA4MTkzLCAxMjI4OSwgMTYzODUsIDI0NTc3LCAwLCAwCl0pOwoKY29uc3QgZGV4dCA9IG5ldyBVaW50OEFycmF5KFsgLyogRGlzdGFuY2UgY29kZXMgMC4uMjkgZXh0cmEgKi8KICAxNiwgMTYsIDE2LCAxNiwgMTcsIDE3LCAxOCwgMTgsIDE5LCAxOSwgMjAsIDIwLCAyMSwgMjEsIDIyLCAyMiwKICAyMywgMjMsIDI0LCAyNCwgMjUsIDI1LCAyNiwgMjYsIDI3LCAyNywKICAyOCwgMjgsIDI5LCAyOSwgNjQsIDY0Cl0pOwoKY29uc3QgaW5mbGF0ZV90YWJsZSA9ICh0eXBlLCBsZW5zLCBsZW5zX2luZGV4LCBjb2RlcywgdGFibGUsIHRhYmxlX2luZGV4LCB3b3JrLCBvcHRzKSA9Pgp7CiAgY29uc3QgYml0cyA9IG9wdHMuYml0czsKICAgICAgLy9oZXJlID0gb3B0cy5oZXJlOyAvKiB0YWJsZSBlbnRyeSBmb3IgZHVwbGljYXRpb24gKi8KCiAgbGV0IGxlbiA9IDA7ICAgICAgICAgICAgICAgLyogYSBjb2RlJ3MgbGVuZ3RoIGluIGJpdHMgKi8KICBsZXQgc3ltID0gMDsgICAgICAgICAgICAgICAvKiBpbmRleCBvZiBjb2RlIHN5bWJvbHMgKi8KICBsZXQgbWluID0gMCwgbWF4ID0gMDsgICAgICAgICAgLyogbWluaW11bSBhbmQgbWF4aW11bSBjb2RlIGxlbmd0aHMgKi8KICBsZXQgcm9vdCA9IDA7ICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgaW5kZXggYml0cyBmb3Igcm9vdCB0YWJsZSAqLwogIGxldCBjdXJyID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciBjdXJyZW50IHRhYmxlICovCiAgbGV0IGRyb3AgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBiaXRzIHRvIGRyb3AgZm9yIHN1Yi10YWJsZSAqLwogIGxldCBsZWZ0ID0gMDsgICAgICAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIHByZWZpeCBjb2RlcyBhdmFpbGFibGUgKi8KICBsZXQgdXNlZCA9IDA7ICAgICAgICAgICAgICAvKiBjb2RlIGVudHJpZXMgaW4gdGFibGUgdXNlZCAqLwogIGxldCBodWZmID0gMDsgICAgICAgICAgICAgIC8qIEh1ZmZtYW4gY29kZSAqLwogIGxldCBpbmNyOyAgICAgICAgICAgICAgLyogZm9yIGluY3JlbWVudGluZyBjb2RlLCBpbmRleCAqLwogIGxldCBmaWxsOyAgICAgICAgICAgICAgLyogaW5kZXggZm9yIHJlcGxpY2F0aW5nIGVudHJpZXMgKi8KICBsZXQgbG93OyAgICAgICAgICAgICAgIC8qIGxvdyBiaXRzIGZvciBjdXJyZW50IHJvb3QgZW50cnkgKi8KICBsZXQgbWFzazsgICAgICAgICAgICAgIC8qIG1hc2sgZm9yIGxvdyByb290IGJpdHMgKi8KICBsZXQgbmV4dDsgICAgICAgICAgICAgLyogbmV4dCBhdmFpbGFibGUgc3BhY2UgaW4gdGFibGUgKi8KICBsZXQgYmFzZSA9IG51bGw7ICAgICAvKiBiYXNlIHZhbHVlIHRhYmxlIHRvIHVzZSAqLwogIGxldCBiYXNlX2luZGV4ID0gMDsKLy8gIGxldCBzaG9leHRyYTsgICAgLyogZXh0cmEgYml0cyB0YWJsZSB0byB1c2UgKi8KICBsZXQgZW5kOyAgICAgICAgICAgICAgICAgICAgLyogdXNlIGJhc2UgYW5kIGV4dHJhIGZvciBzeW1ib2wgPiBlbmQgKi8KICBjb25zdCBjb3VudCA9IG5ldyBVaW50MTZBcnJheShNQVhCSVRTICsgMSk7IC8vW01BWEJJVFMrMV07ICAgIC8qIG51bWJlciBvZiBjb2RlcyBvZiBlYWNoIGxlbmd0aCAqLwogIGNvbnN0IG9mZnMgPSBuZXcgVWludDE2QXJyYXkoTUFYQklUUyArIDEpOyAvL1tNQVhCSVRTKzFdOyAgICAgLyogb2Zmc2V0cyBpbiB0YWJsZSBmb3IgZWFjaCBsZW5ndGggKi8KICBsZXQgZXh0cmEgPSBudWxsOwogIGxldCBleHRyYV9pbmRleCA9IDA7CgogIGxldCBoZXJlX2JpdHMsIGhlcmVfb3AsIGhlcmVfdmFsOwoKICAvKgogICBQcm9jZXNzIGEgc2V0IG9mIGNvZGUgbGVuZ3RocyB0byBjcmVhdGUgYSBjYW5vbmljYWwgSHVmZm1hbiBjb2RlLiAgVGhlCiAgIGNvZGUgbGVuZ3RocyBhcmUgbGVuc1swLi5jb2Rlcy0xXS4gIEVhY2ggbGVuZ3RoIGNvcnJlc3BvbmRzIHRvIHRoZQogICBzeW1ib2xzIDAuLmNvZGVzLTEuICBUaGUgSHVmZm1hbiBjb2RlIGlzIGdlbmVyYXRlZCBieSBmaXJzdCBzb3J0aW5nIHRoZQogICBzeW1ib2xzIGJ5IGxlbmd0aCBmcm9tIHNob3J0IHRvIGxvbmcsIGFuZCByZXRhaW5pbmcgdGhlIHN5bWJvbCBvcmRlcgogICBmb3IgY29kZXMgd2l0aCBlcXVhbCBsZW5ndGhzLiAgVGhlbiB0aGUgY29kZSBzdGFydHMgd2l0aCBhbGwgemVybyBiaXRzCiAgIGZvciB0aGUgZmlyc3QgY29kZSBvZiB0aGUgc2hvcnRlc3QgbGVuZ3RoLCBhbmQgdGhlIGNvZGVzIGFyZSBpbnRlZ2VyCiAgIGluY3JlbWVudHMgZm9yIHRoZSBzYW1lIGxlbmd0aCwgYW5kIHplcm9zIGFyZSBhcHBlbmRlZCBhcyB0aGUgbGVuZ3RoCiAgIGluY3JlYXNlcy4gIEZvciB0aGUgZGVmbGF0ZSBmb3JtYXQsIHRoZXNlIGJpdHMgYXJlIHN0b3JlZCBiYWNrd2FyZHMKICAgZnJvbSB0aGVpciBtb3JlIG5hdHVyYWwgaW50ZWdlciBpbmNyZW1lbnQgb3JkZXJpbmcsIGFuZCBzbyB3aGVuIHRoZQogICBkZWNvZGluZyB0YWJsZXMgYXJlIGJ1aWx0IGluIHRoZSBsYXJnZSBsb29wIGJlbG93LCB0aGUgaW50ZWdlciBjb2RlcwogICBhcmUgaW5jcmVtZW50ZWQgYmFja3dhcmRzLgoKICAgVGhpcyByb3V0aW5lIGFzc3VtZXMsIGJ1dCBkb2VzIG5vdCBjaGVjaywgdGhhdCBhbGwgb2YgdGhlIGVudHJpZXMgaW4KICAgbGVuc1tdIGFyZSBpbiB0aGUgcmFuZ2UgMC4uTUFYQklUUy4gIFRoZSBjYWxsZXIgbXVzdCBhc3N1cmUgdGhpcy4KICAgMS4uTUFYQklUUyBpcyBpbnRlcnByZXRlZCBhcyB0aGF0IGNvZGUgbGVuZ3RoLiAgemVybyBtZWFucyB0aGF0IHRoYXQKICAgc3ltYm9sIGRvZXMgbm90IG9jY3VyIGluIHRoaXMgY29kZS4KCiAgIFRoZSBjb2RlcyBhcmUgc29ydGVkIGJ5IGNvbXB1dGluZyBhIGNvdW50IG9mIGNvZGVzIGZvciBlYWNoIGxlbmd0aCwKICAgY3JlYXRpbmcgZnJvbSB0aGF0IGEgdGFibGUgb2Ygc3RhcnRpbmcgaW5kaWNlcyBmb3IgZWFjaCBsZW5ndGggaW4gdGhlCiAgIHNvcnRlZCB0YWJsZSwgYW5kIHRoZW4gZW50ZXJpbmcgdGhlIHN5bWJvbHMgaW4gb3JkZXIgaW4gdGhlIHNvcnRlZAogICB0YWJsZS4gIFRoZSBzb3J0ZWQgdGFibGUgaXMgd29ya1tdLCB3aXRoIHRoYXQgc3BhY2UgYmVpbmcgcHJvdmlkZWQgYnkKICAgdGhlIGNhbGxlci4KCiAgIFRoZSBsZW5ndGggY291bnRzIGFyZSB1c2VkIGZvciBvdGhlciBwdXJwb3NlcyBhcyB3ZWxsLCBpLmUuIGZpbmRpbmcKICAgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gbGVuZ3RoIGNvZGVzLCBkZXRlcm1pbmluZyBpZiB0aGVyZSBhcmUgYW55CiAgIGNvZGVzIGF0IGFsbCwgY2hlY2tpbmcgZm9yIGEgdmFsaWQgc2V0IG9mIGxlbmd0aHMsIGFuZCBsb29raW5nIGFoZWFkCiAgIGF0IGxlbmd0aCBjb3VudHMgdG8gZGV0ZXJtaW5lIHN1Yi10YWJsZSBzaXplcyB3aGVuIGJ1aWxkaW5nIHRoZQogICBkZWNvZGluZyB0YWJsZXMuCiAgICovCgogIC8qIGFjY3VtdWxhdGUgbGVuZ3RocyBmb3IgY29kZXMgKGFzc3VtZXMgbGVuc1tdIGFsbCBpbiAwLi5NQVhCSVRTKSAqLwogIGZvciAobGVuID0gMDsgbGVuIDw9IE1BWEJJVFM7IGxlbisrKSB7CiAgICBjb3VudFtsZW5dID0gMDsKICB9CiAgZm9yIChzeW0gPSAwOyBzeW0gPCBjb2Rlczsgc3ltKyspIHsKICAgIGNvdW50W2xlbnNbbGVuc19pbmRleCArIHN5bV1dKys7CiAgfQoKICAvKiBib3VuZCBjb2RlIGxlbmd0aHMsIGZvcmNlIHJvb3QgdG8gYmUgd2l0aGluIGNvZGUgbGVuZ3RocyAqLwogIHJvb3QgPSBiaXRzOwogIGZvciAobWF4ID0gTUFYQklUUzsgbWF4ID49IDE7IG1heC0tKSB7CiAgICBpZiAoY291bnRbbWF4XSAhPT0gMCkgeyBicmVhazsgfQogIH0KICBpZiAocm9vdCA+IG1heCkgewogICAgcm9vdCA9IG1heDsKICB9CiAgaWYgKG1heCA9PT0gMCkgeyAgICAgICAgICAgICAgICAgICAgIC8qIG5vIHN5bWJvbHMgdG8gY29kZSBhdCBhbGwgKi8KICAgIC8vdGFibGUub3Bbb3B0cy50YWJsZV9pbmRleF0gPSA2NDsgIC8vaGVyZS5vcCA9ICh2YXIgY2hhcik2NDsgICAgLyogaW52YWxpZCBjb2RlIG1hcmtlciAqLwogICAgLy90YWJsZS5iaXRzW29wdHMudGFibGVfaW5kZXhdID0gMTsgICAvL2hlcmUuYml0cyA9ICh2YXIgY2hhcikxOwogICAgLy90YWJsZS52YWxbb3B0cy50YWJsZV9pbmRleCsrXSA9IDA7ICAgLy9oZXJlLnZhbCA9ICh2YXIgc2hvcnQpMDsKICAgIHRhYmxlW3RhYmxlX2luZGV4KytdID0gKDEgPDwgMjQpIHwgKDY0IDw8IDE2KSB8IDA7CgoKICAgIC8vdGFibGUub3Bbb3B0cy50YWJsZV9pbmRleF0gPSA2NDsKICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7CiAgICAvL3RhYmxlLnZhbFtvcHRzLnRhYmxlX2luZGV4KytdID0gMDsKICAgIHRhYmxlW3RhYmxlX2luZGV4KytdID0gKDEgPDwgMjQpIHwgKDY0IDw8IDE2KSB8IDA7CgogICAgb3B0cy5iaXRzID0gMTsKICAgIHJldHVybiAwOyAgICAgLyogbm8gc3ltYm9scywgYnV0IHdhaXQgZm9yIGRlY29kaW5nIHRvIHJlcG9ydCBlcnJvciAqLwogIH0KICBmb3IgKG1pbiA9IDE7IG1pbiA8IG1heDsgbWluKyspIHsKICAgIGlmIChjb3VudFttaW5dICE9PSAwKSB7IGJyZWFrOyB9CiAgfQogIGlmIChyb290IDwgbWluKSB7CiAgICByb290ID0gbWluOwogIH0KCiAgLyogY2hlY2sgZm9yIGFuIG92ZXItc3Vic2NyaWJlZCBvciBpbmNvbXBsZXRlIHNldCBvZiBsZW5ndGhzICovCiAgbGVmdCA9IDE7CiAgZm9yIChsZW4gPSAxOyBsZW4gPD0gTUFYQklUUzsgbGVuKyspIHsKICAgIGxlZnQgPDw9IDE7CiAgICBsZWZ0IC09IGNvdW50W2xlbl07CiAgICBpZiAobGVmdCA8IDApIHsKICAgICAgcmV0dXJuIC0xOwogICAgfSAgICAgICAgLyogb3Zlci1zdWJzY3JpYmVkICovCiAgfQogIGlmIChsZWZ0ID4gMCAmJiAodHlwZSA9PT0gQ09ERVMkMSB8fCBtYXggIT09IDEpKSB7CiAgICByZXR1cm4gLTE7ICAgICAgICAgICAgICAgICAgICAgIC8qIGluY29tcGxldGUgc2V0ICovCiAgfQoKICAvKiBnZW5lcmF0ZSBvZmZzZXRzIGludG8gc3ltYm9sIHRhYmxlIGZvciBlYWNoIGxlbmd0aCBmb3Igc29ydGluZyAqLwogIG9mZnNbMV0gPSAwOwogIGZvciAobGVuID0gMTsgbGVuIDwgTUFYQklUUzsgbGVuKyspIHsKICAgIG9mZnNbbGVuICsgMV0gPSBvZmZzW2xlbl0gKyBjb3VudFtsZW5dOwogIH0KCiAgLyogc29ydCBzeW1ib2xzIGJ5IGxlbmd0aCwgYnkgc3ltYm9sIG9yZGVyIHdpdGhpbiBlYWNoIGxlbmd0aCAqLwogIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICBpZiAobGVuc1tsZW5zX2luZGV4ICsgc3ltXSAhPT0gMCkgewogICAgICB3b3JrW29mZnNbbGVuc1tsZW5zX2luZGV4ICsgc3ltXV0rK10gPSBzeW07CiAgICB9CiAgfQoKICAvKgogICBDcmVhdGUgYW5kIGZpbGwgaW4gZGVjb2RpbmcgdGFibGVzLiAgSW4gdGhpcyBsb29wLCB0aGUgdGFibGUgYmVpbmcKICAgZmlsbGVkIGlzIGF0IG5leHQgYW5kIGhhcyBjdXJyIGluZGV4IGJpdHMuICBUaGUgY29kZSBiZWluZyB1c2VkIGlzIGh1ZmYKICAgd2l0aCBsZW5ndGggbGVuLiAgVGhhdCBjb2RlIGlzIGNvbnZlcnRlZCB0byBhbiBpbmRleCBieSBkcm9wcGluZyBkcm9wCiAgIGJpdHMgb2ZmIG9mIHRoZSBib3R0b20uICBGb3IgY29kZXMgd2hlcmUgbGVuIGlzIGxlc3MgdGhhbiBkcm9wICsgY3VyciwKICAgdGhvc2UgdG9wIGRyb3AgKyBjdXJyIC0gbGVuIGJpdHMgYXJlIGluY3JlbWVudGVkIHRocm91Z2ggYWxsIHZhbHVlcyB0bwogICBmaWxsIHRoZSB0YWJsZSB3aXRoIHJlcGxpY2F0ZWQgZW50cmllcy4KCiAgIHJvb3QgaXMgdGhlIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciB0aGUgcm9vdCB0YWJsZS4gIFdoZW4gbGVuIGV4Y2VlZHMKICAgcm9vdCwgc3ViLXRhYmxlcyBhcmUgY3JlYXRlZCBwb2ludGVkIHRvIGJ5IHRoZSByb290IGVudHJ5IHdpdGggYW4gaW5kZXgKICAgb2YgdGhlIGxvdyByb290IGJpdHMgb2YgaHVmZi4gIFRoaXMgaXMgc2F2ZWQgaW4gbG93IHRvIGNoZWNrIGZvciB3aGVuIGEKICAgbmV3IHN1Yi10YWJsZSBzaG91bGQgYmUgc3RhcnRlZC4gIGRyb3AgaXMgemVybyB3aGVuIHRoZSByb290IHRhYmxlIGlzCiAgIGJlaW5nIGZpbGxlZCwgYW5kIGRyb3AgaXMgcm9vdCB3aGVuIHN1Yi10YWJsZXMgYXJlIGJlaW5nIGZpbGxlZC4KCiAgIFdoZW4gYSBuZXcgc3ViLXRhYmxlIGlzIG5lZWRlZCwgaXQgaXMgbmVjZXNzYXJ5IHRvIGxvb2sgYWhlYWQgaW4gdGhlCiAgIGNvZGUgbGVuZ3RocyB0byBkZXRlcm1pbmUgd2hhdCBzaXplIHN1Yi10YWJsZSBpcyBuZWVkZWQuICBUaGUgbGVuZ3RoCiAgIGNvdW50cyBhcmUgdXNlZCBmb3IgdGhpcywgYW5kIHNvIGNvdW50W10gaXMgZGVjcmVtZW50ZWQgYXMgY29kZXMgYXJlCiAgIGVudGVyZWQgaW4gdGhlIHRhYmxlcy4KCiAgIHVzZWQga2VlcHMgdHJhY2sgb2YgaG93IG1hbnkgdGFibGUgZW50cmllcyBoYXZlIGJlZW4gYWxsb2NhdGVkIGZyb20gdGhlCiAgIHByb3ZpZGVkICp0YWJsZSBzcGFjZS4gIEl0IGlzIGNoZWNrZWQgZm9yIExFTlMgYW5kIERJU1QgdGFibGVzIGFnYWluc3QKICAgdGhlIGNvbnN0YW50cyBFTk9VR0hfTEVOUyBhbmQgRU5PVUdIX0RJU1RTIHRvIGd1YXJkIGFnYWluc3QgY2hhbmdlcyBpbgogICB0aGUgaW5pdGlhbCByb290IHRhYmxlIHNpemUgY29uc3RhbnRzLiAgU2VlIHRoZSBjb21tZW50cyBpbiBpbmZ0cmVlcy5oCiAgIGZvciBtb3JlIGluZm9ybWF0aW9uLgoKICAgc3ltIGluY3JlbWVudHMgdGhyb3VnaCBhbGwgc3ltYm9scywgYW5kIHRoZSBsb29wIHRlcm1pbmF0ZXMgd2hlbgogICBhbGwgY29kZXMgb2YgbGVuZ3RoIG1heCwgaS5lLiBhbGwgY29kZXMsIGhhdmUgYmVlbiBwcm9jZXNzZWQuICBUaGlzCiAgIHJvdXRpbmUgcGVybWl0cyBpbmNvbXBsZXRlIGNvZGVzLCBzbyBhbm90aGVyIGxvb3AgYWZ0ZXIgdGhpcyBvbmUgZmlsbHMKICAgaW4gdGhlIHJlc3Qgb2YgdGhlIGRlY29kaW5nIHRhYmxlcyB3aXRoIGludmFsaWQgY29kZSBtYXJrZXJzLgogICAqLwoKICAvKiBzZXQgdXAgZm9yIGNvZGUgdHlwZSAqLwogIC8vIHBvb3IgbWFuIG9wdGltaXphdGlvbiAtIHVzZSBpZi1lbHNlIGluc3RlYWQgb2Ygc3dpdGNoLAogIC8vIHRvIGF2b2lkIGRlb3B0cyBpbiBvbGQgdjgKICBpZiAodHlwZSA9PT0gQ09ERVMkMSkgewogICAgYmFzZSA9IGV4dHJhID0gd29yazsgICAgLyogZHVtbXkgdmFsdWUtLW5vdCB1c2VkICovCiAgICBlbmQgPSAxOTsKCiAgfSBlbHNlIGlmICh0eXBlID09PSBMRU5TJDEpIHsKICAgIGJhc2UgPSBsYmFzZTsKICAgIGJhc2VfaW5kZXggLT0gMjU3OwogICAgZXh0cmEgPSBsZXh0OwogICAgZXh0cmFfaW5kZXggLT0gMjU3OwogICAgZW5kID0gMjU2OwoKICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgLyogRElTVFMgKi8KICAgIGJhc2UgPSBkYmFzZTsKICAgIGV4dHJhID0gZGV4dDsKICAgIGVuZCA9IC0xOwogIH0KCiAgLyogaW5pdGlhbGl6ZSBvcHRzIGZvciBsb29wICovCiAgaHVmZiA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIHN0YXJ0aW5nIGNvZGUgKi8KICBzeW0gPSAwOyAgICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSBzeW1ib2wgKi8KICBsZW4gPSBtaW47ICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSBsZW5ndGggKi8KICBuZXh0ID0gdGFibGVfaW5kZXg7ICAgICAgICAgICAgICAvKiBjdXJyZW50IHRhYmxlIHRvIGZpbGwgaW4gKi8KICBjdXJyID0gcm9vdDsgICAgICAgICAgICAgICAgLyogY3VycmVudCB0YWJsZSBpbmRleCBiaXRzICovCiAgZHJvcCA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgYml0cyB0byBkcm9wIGZyb20gY29kZSBmb3IgaW5kZXggKi8KICBsb3cgPSAtMTsgICAgICAgICAgICAgICAgICAgLyogdHJpZ2dlciBuZXcgc3ViLXRhYmxlIHdoZW4gbGVuID4gcm9vdCAqLwogIHVzZWQgPSAxIDw8IHJvb3Q7ICAgICAgICAgIC8qIHVzZSByb290IHRhYmxlIGVudHJpZXMgKi8KICBtYXNrID0gdXNlZCAtIDE7ICAgICAgICAgICAgLyogbWFzayBmb3IgY29tcGFyaW5nIGxvdyAqLwoKICAvKiBjaGVjayBhdmFpbGFibGUgdGFibGUgc3BhY2UgKi8KICBpZiAoKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSkgfHwKICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgIHJldHVybiAxOwogIH0KCiAgLyogcHJvY2VzcyBhbGwgY29kZXMgYW5kIG1ha2UgdGFibGUgZW50cmllcyAqLwogIGZvciAoOzspIHsKICAgIC8qIGNyZWF0ZSB0YWJsZSBlbnRyeSAqLwogICAgaGVyZV9iaXRzID0gbGVuIC0gZHJvcDsKICAgIGlmICh3b3JrW3N5bV0gPCBlbmQpIHsKICAgICAgaGVyZV9vcCA9IDA7CiAgICAgIGhlcmVfdmFsID0gd29ya1tzeW1dOwogICAgfQogICAgZWxzZSBpZiAod29ya1tzeW1dID4gZW5kKSB7CiAgICAgIGhlcmVfb3AgPSBleHRyYVtleHRyYV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgIGhlcmVfdmFsID0gYmFzZVtiYXNlX2luZGV4ICsgd29ya1tzeW1dXTsKICAgIH0KICAgIGVsc2UgewogICAgICBoZXJlX29wID0gMzIgKyA2NDsgICAgICAgICAvKiBlbmQgb2YgYmxvY2sgKi8KICAgICAgaGVyZV92YWwgPSAwOwogICAgfQoKICAgIC8qIHJlcGxpY2F0ZSBmb3IgdGhvc2UgaW5kaWNlcyB3aXRoIGxvdyBsZW4gYml0cyBlcXVhbCB0byBodWZmICovCiAgICBpbmNyID0gMSA8PCAobGVuIC0gZHJvcCk7CiAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgbWluID0gZmlsbDsgICAgICAgICAgICAgICAgIC8qIHNhdmUgb2Zmc2V0IHRvIG5leHQgdGFibGUgKi8KICAgIGRvIHsKICAgICAgZmlsbCAtPSBpbmNyOwogICAgICB0YWJsZVtuZXh0ICsgKGh1ZmYgPj4gZHJvcCkgKyBmaWxsXSA9IChoZXJlX2JpdHMgPDwgMjQpIHwgKGhlcmVfb3AgPDwgMTYpIHwgaGVyZV92YWwgfDA7CiAgICB9IHdoaWxlIChmaWxsICE9PSAwKTsKCiAgICAvKiBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwogICAgaW5jciA9IDEgPDwgKGxlbiAtIDEpOwogICAgd2hpbGUgKGh1ZmYgJiBpbmNyKSB7CiAgICAgIGluY3IgPj49IDE7CiAgICB9CiAgICBpZiAoaW5jciAhPT0gMCkgewogICAgICBodWZmICY9IGluY3IgLSAxOwogICAgICBodWZmICs9IGluY3I7CiAgICB9IGVsc2UgewogICAgICBodWZmID0gMDsKICAgIH0KCiAgICAvKiBnbyB0byBuZXh0IHN5bWJvbCwgdXBkYXRlIGNvdW50LCBsZW4gKi8KICAgIHN5bSsrOwogICAgaWYgKC0tY291bnRbbGVuXSA9PT0gMCkgewogICAgICBpZiAobGVuID09PSBtYXgpIHsgYnJlYWs7IH0KICAgICAgbGVuID0gbGVuc1tsZW5zX2luZGV4ICsgd29ya1tzeW1dXTsKICAgIH0KCiAgICAvKiBjcmVhdGUgbmV3IHN1Yi10YWJsZSBpZiBuZWVkZWQgKi8KICAgIGlmIChsZW4gPiByb290ICYmIChodWZmICYgbWFzaykgIT09IGxvdykgewogICAgICAvKiBpZiBmaXJzdCB0aW1lLCB0cmFuc2l0aW9uIHRvIHN1Yi10YWJsZXMgKi8KICAgICAgaWYgKGRyb3AgPT09IDApIHsKICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgfQoKICAgICAgLyogaW5jcmVtZW50IHBhc3QgbGFzdCB0YWJsZSAqLwogICAgICBuZXh0ICs9IG1pbjsgICAgICAgICAgICAvKiBoZXJlIG1pbiBpcyAxIDw8IGN1cnIgKi8KCiAgICAgIC8qIGRldGVybWluZSBsZW5ndGggb2YgbmV4dCB0YWJsZSAqLwogICAgICBjdXJyID0gbGVuIC0gZHJvcDsKICAgICAgbGVmdCA9IDEgPDwgY3VycjsKICAgICAgd2hpbGUgKGN1cnIgKyBkcm9wIDwgbWF4KSB7CiAgICAgICAgbGVmdCAtPSBjb3VudFtjdXJyICsgZHJvcF07CiAgICAgICAgaWYgKGxlZnQgPD0gMCkgeyBicmVhazsgfQogICAgICAgIGN1cnIrKzsKICAgICAgICBsZWZ0IDw8PSAxOwogICAgICB9CgogICAgICAvKiBjaGVjayBmb3IgZW5vdWdoIHNwYWNlICovCiAgICAgIHVzZWQgKz0gMSA8PCBjdXJyOwogICAgICBpZiAoKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSkgfHwKICAgICAgICAodHlwZSA9PT0gRElTVFMkMSAmJiB1c2VkID4gRU5PVUdIX0RJU1RTJDEpKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KCiAgICAgIC8qIHBvaW50IGVudHJ5IGluIHJvb3QgdGFibGUgdG8gc3ViLXRhYmxlICovCiAgICAgIGxvdyA9IGh1ZmYgJiBtYXNrOwogICAgICAvKnRhYmxlLm9wW2xvd10gPSBjdXJyOwogICAgICB0YWJsZS5iaXRzW2xvd10gPSByb290OwogICAgICB0YWJsZS52YWxbbG93XSA9IG5leHQgLSBvcHRzLnRhYmxlX2luZGV4OyovCiAgICAgIHRhYmxlW2xvd10gPSAocm9vdCA8PCAyNCkgfCAoY3VyciA8PCAxNikgfCAobmV4dCAtIHRhYmxlX2luZGV4KSB8MDsKICAgIH0KICB9CgogIC8qIGZpbGwgaW4gcmVtYWluaW5nIHRhYmxlIGVudHJ5IGlmIGNvZGUgaXMgaW5jb21wbGV0ZSAoZ3VhcmFudGVlZCB0byBoYXZlCiAgIGF0IG1vc3Qgb25lIHJlbWFpbmluZyBlbnRyeSwgc2luY2UgaWYgdGhlIGNvZGUgaXMgaW5jb21wbGV0ZSwgdGhlCiAgIG1heGltdW0gY29kZSBsZW5ndGggdGhhdCB3YXMgYWxsb3dlZCB0byBnZXQgdGhpcyBmYXIgaXMgb25lIGJpdCkgKi8KICBpZiAoaHVmZiAhPT0gMCkgewogICAgLy90YWJsZS5vcFtuZXh0ICsgaHVmZl0gPSA2NDsgICAgICAgICAgICAvKiBpbnZhbGlkIGNvZGUgbWFya2VyICovCiAgICAvL3RhYmxlLmJpdHNbbmV4dCArIGh1ZmZdID0gbGVuIC0gZHJvcDsKICAgIC8vdGFibGUudmFsW25leHQgKyBodWZmXSA9IDA7CiAgICB0YWJsZVtuZXh0ICsgaHVmZl0gPSAoKGxlbiAtIGRyb3ApIDw8IDI0KSB8ICg2NCA8PCAxNikgfDA7CiAgfQoKICAvKiBzZXQgcmV0dXJuIHBhcmFtZXRlcnMgKi8KICAvL29wdHMudGFibGVfaW5kZXggKz0gdXNlZDsKICBvcHRzLmJpdHMgPSByb290OwogIHJldHVybiAwOwp9OwoKCnZhciBpbmZ0cmVlcyA9IGluZmxhdGVfdGFibGU7CgovLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KLy8KLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCi8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCi8vCi8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAovLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0Ci8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKLy8KLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQovLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQovLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCi8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCi8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgovLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKCgoKCgpjb25zdCBDT0RFUyA9IDA7CmNvbnN0IExFTlMgPSAxOwpjb25zdCBESVNUUyA9IDI7CgovKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKY29uc3QgewogIFpfRklOSVNIOiBaX0ZJTklTSCQxLCBaX0JMT0NLLCBaX1RSRUVTLAogIFpfT0s6IFpfT0skMSwgWl9TVFJFQU1fRU5EOiBaX1NUUkVBTV9FTkQkMSwgWl9ORUVEX0RJQ1Q6IFpfTkVFRF9ESUNUJDEsIFpfU1RSRUFNX0VSUk9SOiBaX1NUUkVBTV9FUlJPUiQxLCBaX0RBVEFfRVJST1I6IFpfREFUQV9FUlJPUiQxLCBaX01FTV9FUlJPUjogWl9NRU1fRVJST1IkMSwgWl9CVUZfRVJST1IsCiAgWl9ERUZMQVRFRAp9ID0gY29uc3RhbnRzJDI7CgoKLyogU1RBVEVTID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCgpjb25zdCAgICBIRUFEID0gMTsgICAgICAgLyogaTogd2FpdGluZyBmb3IgbWFnaWMgaGVhZGVyICovCmNvbnN0ICAgIEZMQUdTID0gMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBtZXRob2QgYW5kIGZsYWdzIChnemlwKSAqLwpjb25zdCAgICBUSU1FID0gMzsgICAgICAgLyogaTogd2FpdGluZyBmb3IgbW9kaWZpY2F0aW9uIHRpbWUgKGd6aXApICovCmNvbnN0ICAgIE9TID0gNDsgICAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBmbGFncyBhbmQgb3BlcmF0aW5nIHN5c3RlbSAoZ3ppcCkgKi8KY29uc3QgICAgRVhMRU4gPSA1OyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGV4dHJhIGxlbmd0aCAoZ3ppcCkgKi8KY29uc3QgICAgRVhUUkEgPSA2OyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGV4dHJhIGJ5dGVzIChnemlwKSAqLwpjb25zdCAgICBOQU1FID0gNzsgICAgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGZpbGUgbmFtZSAoZ3ppcCkgKi8KY29uc3QgICAgQ09NTUVOVCA9IDg7ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGVuZCBvZiBjb21tZW50IChnemlwKSAqLwpjb25zdCAgICBIQ1JDID0gOTsgICAgICAgLyogaTogd2FpdGluZyBmb3IgaGVhZGVyIGNyYyAoZ3ppcCkgKi8KY29uc3QgICAgRElDVElEID0gMTA7ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpY3Rpb25hcnkgY2hlY2sgdmFsdWUgKi8KY29uc3QgICAgRElDVCA9IDExOyAgICAgIC8qIHdhaXRpbmcgZm9yIGluZmxhdGVTZXREaWN0aW9uYXJ5KCkgY2FsbCAqLwpjb25zdCAgICAgICAgVFlQRSA9IDEyOyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIHR5cGUgYml0cywgaW5jbHVkaW5nIGxhc3QtZmxhZyBiaXQgKi8KY29uc3QgICAgICAgIFRZUEVETyA9IDEzOyAgICAvKiBpOiBzYW1lLCBidXQgc2tpcCBjaGVjayB0byBleGl0IGluZmxhdGUgb24gbmV3IGJsb2NrICovCmNvbnN0ICAgICAgICBTVE9SRUQgPSAxNDsgICAgLyogaTogd2FpdGluZyBmb3Igc3RvcmVkIHNpemUgKGxlbmd0aCBhbmQgY29tcGxlbWVudCkgKi8KY29uc3QgICAgICAgIENPUFlfID0gMTU7ICAgICAvKiBpL286IHNhbWUgYXMgQ09QWSBiZWxvdywgYnV0IG9ubHkgZmlyc3QgdGltZSBpbiAqLwpjb25zdCAgICAgICAgQ09QWSA9IDE2OyAgICAgIC8qIGkvbzogd2FpdGluZyBmb3IgaW5wdXQgb3Igb3V0cHV0IHRvIGNvcHkgc3RvcmVkIGJsb2NrICovCmNvbnN0ICAgICAgICBUQUJMRSA9IDE3OyAgICAgLyogaTogd2FpdGluZyBmb3IgZHluYW1pYyBibG9jayB0YWJsZSBsZW5ndGhzICovCmNvbnN0ICAgICAgICBMRU5MRU5TID0gMTg7ICAgLyogaTogd2FpdGluZyBmb3IgY29kZSBsZW5ndGggY29kZSBsZW5ndGhzICovCmNvbnN0ICAgICAgICBDT0RFTEVOUyA9IDE5OyAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoL2xpdCBhbmQgZGlzdGFuY2UgY29kZSBsZW5ndGhzICovCmNvbnN0ICAgICAgICAgICAgTEVOXyA9IDIwOyAgICAgIC8qIGk6IHNhbWUgYXMgTEVOIGJlbG93LCBidXQgb25seSBmaXJzdCB0aW1lIGluICovCmNvbnN0ICAgICAgICAgICAgTEVOID0gMjE7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGxlbmd0aC9saXQvZW9iIGNvZGUgKi8KY29uc3QgICAgICAgICAgICBMRU5FWFQgPSAyMjsgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoIGV4dHJhIGJpdHMgKi8KY29uc3QgICAgICAgICAgICBESVNUID0gMjM7ICAgICAgLyogaTogd2FpdGluZyBmb3IgZGlzdGFuY2UgY29kZSAqLwpjb25zdCAgICAgICAgICAgIERJU1RFWFQgPSAyNDsgICAvKiBpOiB3YWl0aW5nIGZvciBkaXN0YW5jZSBleHRyYSBiaXRzICovCmNvbnN0ICAgICAgICAgICAgTUFUQ0ggPSAyNTsgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byBjb3B5IHN0cmluZyAqLwpjb25zdCAgICAgICAgICAgIExJVCA9IDI2OyAgICAgICAvKiBvOiB3YWl0aW5nIGZvciBvdXRwdXQgc3BhY2UgdG8gd3JpdGUgbGl0ZXJhbCAqLwpjb25zdCAgICBDSEVDSyA9IDI3OyAgICAgLyogaTogd2FpdGluZyBmb3IgMzItYml0IGNoZWNrIHZhbHVlICovCmNvbnN0ICAgIExFTkdUSCA9IDI4OyAgICAvKiBpOiB3YWl0aW5nIGZvciAzMi1iaXQgbGVuZ3RoIChnemlwKSAqLwpjb25zdCAgICBET05FID0gMjk7ICAgICAgLyogZmluaXNoZWQgY2hlY2ssIGRvbmUgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KY29uc3QgICAgQkFEID0gMzA7ICAgICAgIC8qIGdvdCBhIGRhdGEgZXJyb3IgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KY29uc3QgICAgTUVNID0gMzE7ICAgICAgIC8qIGdvdCBhbiBpbmZsYXRlKCkgbWVtb3J5IGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCmNvbnN0ICAgIFNZTkMgPSAzMjsgICAgICAvKiBsb29raW5nIGZvciBzeW5jaHJvbml6YXRpb24gYnl0ZXMgdG8gcmVzdGFydCBpbmZsYXRlKCkgKi8KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKCmNvbnN0IEVOT1VHSF9MRU5TID0gODUyOwpjb25zdCBFTk9VR0hfRElTVFMgPSA1OTI7Ci8vY29uc3QgRU5PVUdIID0gIChFTk9VR0hfTEVOUytFTk9VR0hfRElTVFMpOwoKY29uc3QgTUFYX1dCSVRTID0gMTU7Ci8qIDMySyBMWjc3IHdpbmRvdyAqLwpjb25zdCBERUZfV0JJVFMgPSBNQVhfV0JJVFM7CgoKY29uc3QgenN3YXAzMiA9IChxKSA9PiB7CgogIHJldHVybiAgKCgocSA+Pj4gMjQpICYgMHhmZikgKwogICAgICAgICAgKChxID4+PiA4KSAmIDB4ZmYwMCkgKwogICAgICAgICAgKChxICYgMHhmZjAwKSA8PCA4KSArCiAgICAgICAgICAoKHEgJiAweGZmKSA8PCAyNCkpOwp9OwoKCmZ1bmN0aW9uIEluZmxhdGVTdGF0ZSgpIHsKICB0aGlzLm1vZGUgPSAwOyAgICAgICAgICAgICAvKiBjdXJyZW50IGluZmxhdGUgbW9kZSAqLwogIHRoaXMubGFzdCA9IGZhbHNlOyAgICAgICAgICAvKiB0cnVlIGlmIHByb2Nlc3NpbmcgbGFzdCBibG9jayAqLwogIHRoaXMud3JhcCA9IDA7ICAgICAgICAgICAgICAvKiBiaXQgMCB0cnVlIGZvciB6bGliLCBiaXQgMSB0cnVlIGZvciBnemlwICovCiAgdGhpcy5oYXZlZGljdCA9IGZhbHNlOyAgICAgIC8qIHRydWUgaWYgZGljdGlvbmFyeSBwcm92aWRlZCAqLwogIHRoaXMuZmxhZ3MgPSAwOyAgICAgICAgICAgICAvKiBnemlwIGhlYWRlciBtZXRob2QgYW5kIGZsYWdzICgwIGlmIHpsaWIpICovCiAgdGhpcy5kbWF4ID0gMDsgICAgICAgICAgICAgIC8qIHpsaWIgaGVhZGVyIG1heCBkaXN0YW5jZSAoSU5GTEFURV9TVFJJQ1QpICovCiAgdGhpcy5jaGVjayA9IDA7ICAgICAgICAgICAgIC8qIHByb3RlY3RlZCBjb3B5IG9mIGNoZWNrIHZhbHVlICovCiAgdGhpcy50b3RhbCA9IDA7ICAgICAgICAgICAgIC8qIHByb3RlY3RlZCBjb3B5IG9mIG91dHB1dCBjb3VudCAqLwogIC8vIFRPRE86IG1heSBiZSB7fQogIHRoaXMuaGVhZCA9IG51bGw7ICAgICAgICAgICAvKiB3aGVyZSB0byBzYXZlIGd6aXAgaGVhZGVyIGluZm9ybWF0aW9uICovCgogIC8qIHNsaWRpbmcgd2luZG93ICovCiAgdGhpcy53Yml0cyA9IDA7ICAgICAgICAgICAgIC8qIGxvZyBiYXNlIDIgb2YgcmVxdWVzdGVkIHdpbmRvdyBzaXplICovCiAgdGhpcy53c2l6ZSA9IDA7ICAgICAgICAgICAgIC8qIHdpbmRvdyBzaXplIG9yIHplcm8gaWYgbm90IHVzaW5nIHdpbmRvdyAqLwogIHRoaXMud2hhdmUgPSAwOyAgICAgICAgICAgICAvKiB2YWxpZCBieXRlcyBpbiB0aGUgd2luZG93ICovCiAgdGhpcy53bmV4dCA9IDA7ICAgICAgICAgICAgIC8qIHdpbmRvdyB3cml0ZSBpbmRleCAqLwogIHRoaXMud2luZG93ID0gbnVsbDsgICAgICAgICAvKiBhbGxvY2F0ZWQgc2xpZGluZyB3aW5kb3csIGlmIG5lZWRlZCAqLwoKICAvKiBiaXQgYWNjdW11bGF0b3IgKi8KICB0aGlzLmhvbGQgPSAwOyAgICAgICAgICAgICAgLyogaW5wdXQgYml0IGFjY3VtdWxhdG9yICovCiAgdGhpcy5iaXRzID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBiaXRzIGluICJpbiIgKi8KCiAgLyogZm9yIHN0cmluZyBhbmQgc3RvcmVkIGJsb2NrIGNvcHlpbmcgKi8KICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAgICAgLyogbGl0ZXJhbCBvciBsZW5ndGggb2YgZGF0YSB0byBjb3B5ICovCiAgdGhpcy5vZmZzZXQgPSAwOyAgICAgICAgICAgIC8qIGRpc3RhbmNlIGJhY2sgdG8gY29weSBzdHJpbmcgZnJvbSAqLwoKICAvKiBmb3IgdGFibGUgYW5kIGNvZGUgZGVjb2RpbmcgKi8KICB0aGlzLmV4dHJhID0gMDsgICAgICAgICAgICAgLyogZXh0cmEgYml0cyBuZWVkZWQgKi8KCiAgLyogZml4ZWQgYW5kIGR5bmFtaWMgY29kZSB0YWJsZXMgKi8KICB0aGlzLmxlbmNvZGUgPSBudWxsOyAgICAgICAgICAvKiBzdGFydGluZyB0YWJsZSBmb3IgbGVuZ3RoL2xpdGVyYWwgY29kZXMgKi8KICB0aGlzLmRpc3Rjb2RlID0gbnVsbDsgICAgICAgICAvKiBzdGFydGluZyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKi8KICB0aGlzLmxlbmJpdHMgPSAwOyAgICAgICAgICAgLyogaW5kZXggYml0cyBmb3IgbGVuY29kZSAqLwogIHRoaXMuZGlzdGJpdHMgPSAwOyAgICAgICAgICAvKiBpbmRleCBiaXRzIGZvciBkaXN0Y29kZSAqLwoKICAvKiBkeW5hbWljIHRhYmxlIGJ1aWxkaW5nICovCiAgdGhpcy5uY29kZSA9IDA7ICAgICAgICAgICAgIC8qIG51bWJlciBvZiBjb2RlIGxlbmd0aCBjb2RlIGxlbmd0aHMgKi8KICB0aGlzLm5sZW4gPSAwOyAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2RlIGxlbmd0aHMgKi8KICB0aGlzLm5kaXN0ID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGUgbGVuZ3RocyAqLwogIHRoaXMuaGF2ZSA9IDA7ICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgY29kZSBsZW5ndGhzIGluIGxlbnNbXSAqLwogIHRoaXMubmV4dCA9IG51bGw7ICAgICAgICAgICAgICAvKiBuZXh0IGF2YWlsYWJsZSBzcGFjZSBpbiBjb2Rlc1tdICovCgogIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApOyAvKiB0ZW1wb3Jhcnkgc3RvcmFnZSBmb3IgY29kZSBsZW5ndGhzICovCiAgdGhpcy53b3JrID0gbmV3IFVpbnQxNkFycmF5KDI4OCk7IC8qIHdvcmsgYXJlYSBmb3IgY29kZSB0YWJsZSBidWlsZGluZyAqLwoKICAvKgogICBiZWNhdXNlIHdlIGRvbid0IGhhdmUgcG9pbnRlcnMgaW4ganMsIHdlIHVzZSBsZW5jb2RlIGFuZCBkaXN0Y29kZSBkaXJlY3RseQogICBhcyBidWZmZXJzIHNvIHdlIGRvbid0IG5lZWQgY29kZXMKICAqLwogIC8vdGhpcy5jb2RlcyA9IG5ldyBJbnQzMkFycmF5KEVOT1VHSCk7ICAgICAgIC8qIHNwYWNlIGZvciBjb2RlIHRhYmxlcyAqLwogIHRoaXMubGVuZHluID0gbnVsbDsgICAgICAgICAgICAgIC8qIGR5bmFtaWMgdGFibGUgZm9yIGxlbmd0aC9saXRlcmFsIGNvZGVzIChKUyBzcGVjaWZpYykgKi8KICB0aGlzLmRpc3RkeW4gPSBudWxsOyAgICAgICAgICAgICAvKiBkeW5hbWljIHRhYmxlIGZvciBkaXN0YW5jZSBjb2RlcyAoSlMgc3BlY2lmaWMpICovCiAgdGhpcy5zYW5lID0gMDsgICAgICAgICAgICAgICAgICAgLyogaWYgZmFsc2UsIGFsbG93IGludmFsaWQgZGlzdGFuY2UgdG9vIGZhciAqLwogIHRoaXMuYmFjayA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIGJpdHMgYmFjayBvZiBsYXN0IHVucHJvY2Vzc2VkIGxlbmd0aC9saXQgKi8KICB0aGlzLndhcyA9IDA7ICAgICAgICAgICAgICAgICAgICAvKiBpbml0aWFsIGxlbmd0aCBvZiBtYXRjaCAqLwp9CgoKY29uc3QgaW5mbGF0ZVJlc2V0S2VlcCA9IChzdHJtKSA9PiB7CgogIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICBzdHJtLnRvdGFsX2luID0gc3RybS50b3RhbF9vdXQgPSBzdGF0ZS50b3RhbCA9IDA7CiAgc3RybS5tc2cgPSAnJzsgLypaX05VTEwqLwogIGlmIChzdGF0ZS53cmFwKSB7ICAgICAgIC8qIHRvIHN1cHBvcnQgaWxsLWNvbmNlaXZlZCBKYXZhIHRlc3Qgc3VpdGUgKi8KICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS53cmFwICYgMTsKICB9CiAgc3RhdGUubW9kZSA9IEhFQUQ7CiAgc3RhdGUubGFzdCA9IDA7CiAgc3RhdGUuaGF2ZWRpY3QgPSAwOwogIHN0YXRlLmRtYXggPSAzMjc2ODsKICBzdGF0ZS5oZWFkID0gbnVsbC8qWl9OVUxMKi87CiAgc3RhdGUuaG9sZCA9IDA7CiAgc3RhdGUuYml0cyA9IDA7CiAgLy9zdGF0ZS5sZW5jb2RlID0gc3RhdGUuZGlzdGNvZGUgPSBzdGF0ZS5uZXh0ID0gc3RhdGUuY29kZXM7CiAgc3RhdGUubGVuY29kZSA9IHN0YXRlLmxlbmR5biA9IG5ldyBJbnQzMkFycmF5KEVOT1VHSF9MRU5TKTsKICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfRElTVFMpOwoKICBzdGF0ZS5zYW5lID0gMTsKICBzdGF0ZS5iYWNrID0gLTE7CiAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6IHJlc2V0XG4iKSk7CiAgcmV0dXJuIFpfT0skMTsKfTsKCgpjb25zdCBpbmZsYXRlUmVzZXQgPSAoc3RybSkgPT4gewoKICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgc3RhdGUud3NpemUgPSAwOwogIHN0YXRlLndoYXZlID0gMDsKICBzdGF0ZS53bmV4dCA9IDA7CiAgcmV0dXJuIGluZmxhdGVSZXNldEtlZXAoc3RybSk7Cgp9OwoKCmNvbnN0IGluZmxhdGVSZXNldDIgPSAoc3RybSwgd2luZG93Qml0cykgPT4gewogIGxldCB3cmFwOwoKICAvKiBnZXQgdGhlIHN0YXRlICovCiAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CiAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAvKiBleHRyYWN0IHdyYXAgcmVxdWVzdCBmcm9tIHdpbmRvd0JpdHMgcGFyYW1ldGVyICovCiAgaWYgKHdpbmRvd0JpdHMgPCAwKSB7CiAgICB3cmFwID0gMDsKICAgIHdpbmRvd0JpdHMgPSAtd2luZG93Qml0czsKICB9CiAgZWxzZSB7CiAgICB3cmFwID0gKHdpbmRvd0JpdHMgPj4gNCkgKyAxOwogICAgaWYgKHdpbmRvd0JpdHMgPCA0OCkgewogICAgICB3aW5kb3dCaXRzICY9IDE1OwogICAgfQogIH0KCiAgLyogc2V0IG51bWJlciBvZiB3aW5kb3cgYml0cywgZnJlZSB3aW5kb3cgaWYgZGlmZmVyZW50ICovCiAgaWYgKHdpbmRvd0JpdHMgJiYgKHdpbmRvd0JpdHMgPCA4IHx8IHdpbmRvd0JpdHMgPiAxNSkpIHsKICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogIH0KICBpZiAoc3RhdGUud2luZG93ICE9PSBudWxsICYmIHN0YXRlLndiaXRzICE9PSB3aW5kb3dCaXRzKSB7CiAgICBzdGF0ZS53aW5kb3cgPSBudWxsOwogIH0KCiAgLyogdXBkYXRlIHN0YXRlIGFuZCByZXNldCB0aGUgcmVzdCBvZiBpdCAqLwogIHN0YXRlLndyYXAgPSB3cmFwOwogIHN0YXRlLndiaXRzID0gd2luZG93Qml0czsKICByZXR1cm4gaW5mbGF0ZVJlc2V0KHN0cm0pOwp9OwoKCmNvbnN0IGluZmxhdGVJbml0MiA9IChzdHJtLCB3aW5kb3dCaXRzKSA9PiB7CgogIGlmICghc3RybSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogIC8vc3RybS5tc2cgPSBaX05VTEw7ICAgICAgICAgICAgICAgICAvKiBpbiBjYXNlIHdlIHJldHVybiBhbiBlcnJvciAqLwoKICBjb25zdCBzdGF0ZSA9IG5ldyBJbmZsYXRlU3RhdGUoKTsKCiAgLy9pZiAoc3RhdGUgPT09IFpfTlVMTCkgcmV0dXJuIFpfTUVNX0VSUk9SOwogIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiBhbGxvY2F0ZWRcbiIpKTsKICBzdHJtLnN0YXRlID0gc3RhdGU7CiAgc3RhdGUud2luZG93ID0gbnVsbC8qWl9OVUxMKi87CiAgY29uc3QgcmV0ID0gaW5mbGF0ZVJlc2V0MihzdHJtLCB3aW5kb3dCaXRzKTsKICBpZiAocmV0ICE9PSBaX09LJDEpIHsKICAgIHN0cm0uc3RhdGUgPSBudWxsLypaX05VTEwqLzsKICB9CiAgcmV0dXJuIHJldDsKfTsKCgpjb25zdCBpbmZsYXRlSW5pdCA9IChzdHJtKSA9PiB7CgogIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKfTsKCgovKgogUmV0dXJuIHN0YXRlIHdpdGggbGVuZ3RoIGFuZCBkaXN0YW5jZSBkZWNvZGluZyB0YWJsZXMgYW5kIGluZGV4IHNpemVzIHNldCB0bwogZml4ZWQgY29kZSBkZWNvZGluZy4gIE5vcm1hbGx5IHRoaXMgcmV0dXJucyBmaXhlZCB0YWJsZXMgZnJvbSBpbmZmaXhlZC5oLgogSWYgQlVJTERGSVhFRCBpcyBkZWZpbmVkLCB0aGVuIGluc3RlYWQgdGhpcyByb3V0aW5lIGJ1aWxkcyB0aGUgdGFibGVzIHRoZQogZmlyc3QgdGltZSBpdCdzIGNhbGxlZCwgYW5kIHJldHVybnMgdGhvc2UgdGFibGVzIHRoZSBmaXJzdCB0aW1lIGFuZAogdGhlcmVhZnRlci4gIFRoaXMgcmVkdWNlcyB0aGUgc2l6ZSBvZiB0aGUgY29kZSBieSBhYm91dCAySyBieXRlcywgaW4KIGV4Y2hhbmdlIGZvciBhIGxpdHRsZSBleGVjdXRpb24gdGltZS4gIEhvd2V2ZXIsIEJVSUxERklYRUQgc2hvdWxkIG5vdCBiZQogdXNlZCBmb3IgdGhyZWFkZWQgYXBwbGljYXRpb25zLCBzaW5jZSB0aGUgcmV3cml0aW5nIG9mIHRoZSB0YWJsZXMgYW5kIHZpcmdpbgogbWF5IG5vdCBiZSB0aHJlYWQtc2FmZS4KICovCmxldCB2aXJnaW4gPSB0cnVlOwoKbGV0IGxlbmZpeCwgZGlzdGZpeDsgLy8gV2UgaGF2ZSBubyBwb2ludGVycyBpbiBKUywgc28ga2VlcCB0YWJsZXMgc2VwYXJhdGUKCgpjb25zdCBmaXhlZHRhYmxlcyA9IChzdGF0ZSkgPT4gewoKICAvKiBidWlsZCBmaXhlZCBodWZmbWFuIHRhYmxlcyBpZiBmaXJzdCBjYWxsIChtYXkgbm90IGJlIHRocmVhZCBzYWZlKSAqLwogIGlmICh2aXJnaW4pIHsKICAgIGxlbmZpeCA9IG5ldyBJbnQzMkFycmF5KDUxMik7CiAgICBkaXN0Zml4ID0gbmV3IEludDMyQXJyYXkoMzIpOwoKICAgIC8qIGxpdGVyYWwvbGVuZ3RoIHRhYmxlICovCiAgICBsZXQgc3ltID0gMDsKICAgIHdoaWxlIChzeW0gPCAxNDQpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CiAgICB3aGlsZSAoc3ltIDwgMjU2KSB7IHN0YXRlLmxlbnNbc3ltKytdID0gOTsgfQogICAgd2hpbGUgKHN5bSA8IDI4MCkgeyBzdGF0ZS5sZW5zW3N5bSsrXSA9IDc7IH0KICAgIHdoaWxlIChzeW0gPCAyODgpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CgogICAgaW5mdHJlZXMoTEVOUywgIHN0YXRlLmxlbnMsIDAsIDI4OCwgbGVuZml4LCAgIDAsIHN0YXRlLndvcmssIHsgYml0czogOSB9KTsKCiAgICAvKiBkaXN0YW5jZSB0YWJsZSAqLwogICAgc3ltID0gMDsKICAgIHdoaWxlIChzeW0gPCAzMikgeyBzdGF0ZS5sZW5zW3N5bSsrXSA9IDU7IH0KCiAgICBpbmZ0cmVlcyhESVNUUywgc3RhdGUubGVucywgMCwgMzIsICAgZGlzdGZpeCwgMCwgc3RhdGUud29yaywgeyBiaXRzOiA1IH0pOwoKICAgIC8qIGRvIHRoaXMganVzdCBvbmNlICovCiAgICB2aXJnaW4gPSBmYWxzZTsKICB9CgogIHN0YXRlLmxlbmNvZGUgPSBsZW5maXg7CiAgc3RhdGUubGVuYml0cyA9IDk7CiAgc3RhdGUuZGlzdGNvZGUgPSBkaXN0Zml4OwogIHN0YXRlLmRpc3RiaXRzID0gNTsKfTsKCgovKgogVXBkYXRlIHRoZSB3aW5kb3cgd2l0aCB0aGUgbGFzdCB3c2l6ZSAobm9ybWFsbHkgMzJLKSBieXRlcyB3cml0dGVuIGJlZm9yZQogcmV0dXJuaW5nLiAgSWYgd2luZG93IGRvZXMgbm90IGV4aXN0IHlldCwgY3JlYXRlIGl0LiAgVGhpcyBpcyBvbmx5IGNhbGxlZAogd2hlbiBhIHdpbmRvdyBpcyBhbHJlYWR5IGluIHVzZSwgb3Igd2hlbiBvdXRwdXQgaGFzIGJlZW4gd3JpdHRlbiBkdXJpbmcgdGhpcwogaW5mbGF0ZSBjYWxsLCBidXQgdGhlIGVuZCBvZiB0aGUgZGVmbGF0ZSBzdHJlYW0gaGFzIG5vdCBiZWVuIHJlYWNoZWQgeWV0LgogSXQgaXMgYWxzbyBjYWxsZWQgdG8gY3JlYXRlIGEgd2luZG93IGZvciBkaWN0aW9uYXJ5IGRhdGEgd2hlbiBhIGRpY3Rpb25hcnkKIGlzIGxvYWRlZC4KCiBQcm92aWRpbmcgb3V0cHV0IGJ1ZmZlcnMgbGFyZ2VyIHRoYW4gMzJLIHRvIGluZmxhdGUoKSBzaG91bGQgcHJvdmlkZSBhIHNwZWVkCiBhZHZhbnRhZ2UsIHNpbmNlIG9ubHkgdGhlIGxhc3QgMzJLIG9mIG91dHB1dCBpcyBjb3BpZWQgdG8gdGhlIHNsaWRpbmcgd2luZG93CiB1cG9uIHJldHVybiBmcm9tIGluZmxhdGUoKSwgYW5kIHNpbmNlIGFsbCBkaXN0YW5jZXMgYWZ0ZXIgdGhlIGZpcnN0IDMySyBvZgogb3V0cHV0IHdpbGwgZmFsbCBpbiB0aGUgb3V0cHV0IGRhdGEsIG1ha2luZyBtYXRjaCBjb3BpZXMgc2ltcGxlciBhbmQgZmFzdGVyLgogVGhlIGFkdmFudGFnZSBtYXkgYmUgZGVwZW5kZW50IG9uIHRoZSBzaXplIG9mIHRoZSBwcm9jZXNzb3IncyBkYXRhIGNhY2hlcy4KICovCmNvbnN0IHVwZGF0ZXdpbmRvdyA9IChzdHJtLCBzcmMsIGVuZCwgY29weSkgPT4gewoKICBsZXQgZGlzdDsKICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CgogIC8qIGlmIGl0IGhhc24ndCBiZWVuIGRvbmUgYWxyZWFkeSwgYWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB3aW5kb3cgKi8KICBpZiAoc3RhdGUud2luZG93ID09PSBudWxsKSB7CiAgICBzdGF0ZS53c2l6ZSA9IDEgPDwgc3RhdGUud2JpdHM7CiAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICBzdGF0ZS53aGF2ZSA9IDA7CgogICAgc3RhdGUud2luZG93ID0gbmV3IFVpbnQ4QXJyYXkoc3RhdGUud3NpemUpOwogIH0KCiAgLyogY29weSBzdGF0ZS0+d3NpemUgb3IgbGVzcyBvdXRwdXQgYnl0ZXMgaW50byB0aGUgY2lyY3VsYXIgd2luZG93ICovCiAgaWYgKGNvcHkgPj0gc3RhdGUud3NpemUpIHsKICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIHN0YXRlLndzaXplLCBlbmQpLCAwKTsKICAgIHN0YXRlLnduZXh0ID0gMDsKICAgIHN0YXRlLndoYXZlID0gc3RhdGUud3NpemU7CiAgfQogIGVsc2UgewogICAgZGlzdCA9IHN0YXRlLndzaXplIC0gc3RhdGUud25leHQ7CiAgICBpZiAoZGlzdCA+IGNvcHkpIHsKICAgICAgZGlzdCA9IGNvcHk7CiAgICB9CiAgICAvL3ptZW1jcHkoc3RhdGUtPndpbmRvdyArIHN0YXRlLT53bmV4dCwgZW5kIC0gY29weSwgZGlzdCk7CiAgICBzdGF0ZS53aW5kb3cuc2V0KHNyYy5zdWJhcnJheShlbmQgLSBjb3B5LCBlbmQgLSBjb3B5ICsgZGlzdCksIHN0YXRlLnduZXh0KTsKICAgIGNvcHkgLT0gZGlzdDsKICAgIGlmIChjb3B5KSB7CiAgICAgIC8vem1lbWNweShzdGF0ZS0+d2luZG93LCBlbmQgLSBjb3B5LCBjb3B5KTsKICAgICAgc3RhdGUud2luZG93LnNldChzcmMuc3ViYXJyYXkoZW5kIC0gY29weSwgZW5kKSwgMCk7CiAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgc3RhdGUud2hhdmUgPSBzdGF0ZS53c2l6ZTsKICAgIH0KICAgIGVsc2UgewogICAgICBzdGF0ZS53bmV4dCArPSBkaXN0OwogICAgICBpZiAoc3RhdGUud25leHQgPT09IHN0YXRlLndzaXplKSB7IHN0YXRlLnduZXh0ID0gMDsgfQogICAgICBpZiAoc3RhdGUud2hhdmUgPCBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53aGF2ZSArPSBkaXN0OyB9CiAgICB9CiAgfQogIHJldHVybiAwOwp9OwoKCmNvbnN0IGluZmxhdGUkMiA9IChzdHJtLCBmbHVzaCkgPT4gewoKICBsZXQgc3RhdGU7CiAgbGV0IGlucHV0LCBvdXRwdXQ7ICAgICAgICAgIC8vIGlucHV0L291dHB1dCBidWZmZXJzCiAgbGV0IG5leHQ7ICAgICAgICAgICAgICAgICAgIC8qIG5leHQgaW5wdXQgSU5ERVggKi8KICBsZXQgcHV0OyAgICAgICAgICAgICAgICAgICAgLyogbmV4dCBvdXRwdXQgSU5ERVggKi8KICBsZXQgaGF2ZSwgbGVmdDsgICAgICAgICAgICAgLyogYXZhaWxhYmxlIGlucHV0IGFuZCBvdXRwdXQgKi8KICBsZXQgaG9sZDsgICAgICAgICAgICAgICAgICAgLyogYml0IGJ1ZmZlciAqLwogIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgICAvKiBiaXRzIGluIGJpdCBidWZmZXIgKi8KICBsZXQgX2luLCBfb3V0OyAgICAgICAgICAgICAgLyogc2F2ZSBzdGFydGluZyBhdmFpbGFibGUgaW5wdXQgYW5kIG91dHB1dCAqLwogIGxldCBjb3B5OyAgICAgICAgICAgICAgICAgICAvKiBudW1iZXIgb2Ygc3RvcmVkIG9yIG1hdGNoIGJ5dGVzIHRvIGNvcHkgKi8KICBsZXQgZnJvbTsgICAgICAgICAgICAgICAgICAgLyogd2hlcmUgdG8gY29weSBtYXRjaCBieXRlcyBmcm9tICovCiAgbGV0IGZyb21fc291cmNlOwogIGxldCBoZXJlID0gMDsgICAgICAgICAgICAgICAvKiBjdXJyZW50IGRlY29kaW5nIHRhYmxlIGVudHJ5ICovCiAgbGV0IGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7IC8vIHBha2VkICJoZXJlIiBkZW5vcm1hbGl6ZWQgKEpTIHNwZWNpZmljKQogIC8vbGV0IGxhc3Q7ICAgICAgICAgICAgICAgICAgIC8qIHBhcmVudCB0YWJsZSBlbnRyeSAqLwogIGxldCBsYXN0X2JpdHMsIGxhc3Rfb3AsIGxhc3RfdmFsOyAvLyBwYWtlZCAibGFzdCIgZGVub3JtYWxpemVkIChKUyBzcGVjaWZpYykKICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIHRvIGNvcHkgZm9yIHJlcGVhdHMsIGJpdHMgdG8gZHJvcCAqLwogIGxldCByZXQ7ICAgICAgICAgICAgICAgICAgICAvKiByZXR1cm4gY29kZSAqLwogIGNvbnN0IGhidWYgPSBuZXcgVWludDhBcnJheSg0KTsgICAgLyogYnVmZmVyIGZvciBnemlwIGhlYWRlciBjcmMgY2FsY3VsYXRpb24gKi8KICBsZXQgb3B0czsKCiAgbGV0IG47IC8vIHRlbXBvcmFyeSB2YXJpYWJsZSBmb3IgTkVFRF9CSVRTCgogIGNvbnN0IG9yZGVyID0gLyogcGVybXV0YXRpb24gb2YgY29kZSBsZW5ndGhzICovCiAgICBuZXcgVWludDhBcnJheShbIDE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTUgXSk7CgoKICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUgfHwgIXN0cm0ub3V0cHV0IHx8CiAgICAgICghc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSkgewogICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgfQoKICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsgc3RhdGUubW9kZSA9IFRZUEVETzsgfSAgICAvKiBza2lwIGNoZWNrICovCgoKICAvLy0tLSBMT0FEKCkgLS0tCiAgcHV0ID0gc3RybS5uZXh0X291dDsKICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICBsZWZ0ID0gc3RybS5hdmFpbF9vdXQ7CiAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgaGF2ZSA9IHN0cm0uYXZhaWxfaW47CiAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgYml0cyA9IHN0YXRlLmJpdHM7CiAgLy8tLS0KCiAgX2luID0gaGF2ZTsKICBfb3V0ID0gbGVmdDsKICByZXQgPSBaX09LJDE7CgogIGluZl9sZWF2ZTogLy8gZ290byBlbXVsYXRpb24KICBmb3IgKDs7KSB7CiAgICBzd2l0Y2ggKHN0YXRlLm1vZGUpIHsKICAgICAgY2FzZSBIRUFEOgogICAgICAgIGlmIChzdGF0ZS53cmFwID09PSAwKSB7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRURPOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8vPT09IE5FRURCSVRTKDE2KTsKICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgYml0cyArPSA4OwogICAgICAgIH0KICAgICAgICAvLz09PS8vCiAgICAgICAgaWYgKChzdGF0ZS53cmFwICYgMikgJiYgaG9sZCA9PT0gMHg4YjFmKSB7ICAvKiBnemlwIGhlYWRlciAqLwogICAgICAgICAgc3RhdGUuY2hlY2sgPSAwLypjcmMzMigwTCwgWl9OVUxMLCAwKSovOwogICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAvLz09PS8vCgogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRkxBR1M7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RhdGUuZmxhZ3MgPSAwOyAgICAgICAgICAgLyogZXhwZWN0IHpsaWIgaGVhZGVyICovCiAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgIHN0YXRlLmhlYWQuZG9uZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIShzdGF0ZS53cmFwICYgMSkgfHwgICAvKiBjaGVjayBpZiB6bGliIGhlYWRlciBhbGxvd2VkICovCiAgICAgICAgICAoKChob2xkICYgMHhmZikvKkJJVFMoOCkqLyA8PCA4KSArIChob2xkID4+IDgpKSAlIDMxKSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICdpbmNvcnJlY3QgaGVhZGVyIGNoZWNrJzsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKChob2xkICYgMHgwZikvKkJJVFMoNCkqLyAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgc3RybS5tc2cgPSAndW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvLy0tLSBEUk9QQklUUyg0KSAtLS0vLwogICAgICAgIGhvbGQgPj4+PSA0OwogICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAvLy0tLS8vCiAgICAgICAgbGVuID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgODsKICAgICAgICBpZiAoc3RhdGUud2JpdHMgPT09IDApIHsKICAgICAgICAgIHN0YXRlLndiaXRzID0gbGVuOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gPiBzdGF0ZS53Yml0cykgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCB3aW5kb3cgc2l6ZSc7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvLyAhISEgcGFrbyBwYXRjaC4gRm9yY2UgdXNlIGBvcHRpb25zLndpbmRvd0JpdHNgIGlmIHBhc3NlZC4KICAgICAgICAvLyBSZXF1aXJlZCB0byBhbHdheXMgdXNlIG1heCB3aW5kb3cgc2l6ZSBieSBkZWZhdWx0LgogICAgICAgIHN0YXRlLmRtYXggPSAxIDw8IHN0YXRlLndiaXRzOwogICAgICAgIC8vc3RhdGUuZG1heCA9IDEgPDwgbGVuOwoKICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICB6bGliIGhlYWRlciBva1xuIikpOwogICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDEvKmFkbGVyMzIoMEwsIFpfTlVMTCwgMCkqLzsKICAgICAgICBzdGF0ZS5tb2RlID0gaG9sZCAmIDB4MjAwID8gRElDVElEIDogVFlQRTsKICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgIGhvbGQgPSAwOwogICAgICAgIGJpdHMgPSAwOwogICAgICAgIC8vPT09Ly8KICAgICAgICBicmVhazsKICAgICAgY2FzZSBGTEFHUzoKICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBoYXZlLS07CiAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICB9CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLmZsYWdzID0gaG9sZDsKICAgICAgICBpZiAoKHN0YXRlLmZsYWdzICYgMHhmZikgIT09IFpfREVGTEFURUQpIHsKICAgICAgICAgIHN0cm0ubXNnID0gJ3Vua25vd24gY29tcHJlc3Npb24gbWV0aG9kJzsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHhlMDAwKSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGhlYWRlciBmbGFncyBzZXQnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgc3RhdGUuaGVhZC50ZXh0ID0gKChob2xkID4+IDgpICYgMSk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgfQogICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgYml0cyA9IDA7CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLm1vZGUgPSBUSU1FOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBUSU1FOgogICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsgKi8KICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgYml0cyArPSA4OwogICAgICAgIH0KICAgICAgICAvLz09PS8vCiAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgIHN0YXRlLmhlYWQudGltZSA9IGhvbGQ7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgLy89PT0gQ1JDNChzdGF0ZS5jaGVjaywgaG9sZCkKICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMHhmZjsKICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgaGJ1ZlsyXSA9IChob2xkID4+PiAxNikgJiAweGZmOwogICAgICAgICAgaGJ1ZlszXSA9IChob2xkID4+PiAyNCkgJiAweGZmOwogICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCA0LCAwKTsKICAgICAgICAgIC8vPT09CiAgICAgICAgfQogICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgYml0cyA9IDA7CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLm1vZGUgPSBPUzsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgT1M6CiAgICAgICAgLy89PT0gTkVFREJJVFMoMTYpOyAqLwogICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIC8vPT09Ly8KICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgc3RhdGUuaGVhZC54ZmxhZ3MgPSAoaG9sZCAmIDB4ZmYpOwogICAgICAgICAgc3RhdGUuaGVhZC5vcyA9IChob2xkID4+IDgpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgIC8vPT09IENSQzIoc3RhdGUuY2hlY2ssIGhvbGQpOwogICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgaGJ1ZlsxXSA9IChob2xkID4+PiA4KSAmIDB4ZmY7CiAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgLy89PT0vLwogICAgICAgIH0KICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgIGhvbGQgPSAwOwogICAgICAgIGJpdHMgPSAwOwogICAgICAgIC8vPT09Ly8KICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIEVYTEVOOgogICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTYpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZDsKICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmFfbGVuID0gaG9sZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkMyKHN0YXRlLmNoZWNrLCBob2xkKTsKICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBudWxsLypaX05VTEwqLzsKICAgICAgICB9CiAgICAgICAgc3RhdGUubW9kZSA9IEVYVFJBOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBFWFRSQToKICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDA0MDApIHsKICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICBpZiAoY29weSA+IGhhdmUpIHsgY29weSA9IGhhdmU7IH0KICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgbGVuID0gc3RhdGUuaGVhZC5leHRyYV9sZW4gLSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5oZWFkLmV4dHJhKSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgdW50eXBlZCBhcnJheSBmb3IgbW9yZSBjb252ZW5pZW50IHByb2Nlc3NpbmcgbGF0ZXIKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheShzdGF0ZS5oZWFkLmV4dHJhX2xlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEuc2V0KAogICAgICAgICAgICAgICAgaW5wdXQuc3ViYXJyYXkoCiAgICAgICAgICAgICAgICAgIG5leHQsCiAgICAgICAgICAgICAgICAgIC8vIGV4dHJhIGZpZWxkIGlzIGxpbWl0ZWQgdG8gNjU1MzYgYnl0ZXMKICAgICAgICAgICAgICAgICAgLy8gLSBubyBuZWVkIGZvciBhZGRpdGlvbmFsIHNpemUgY2hlY2sKICAgICAgICAgICAgICAgICAgbmV4dCArIGNvcHkKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAvKmxlbiArIGNvcHkgPiBzdGF0ZS5oZWFkLmV4dHJhX21heCAtIGxlbiA/IHN0YXRlLmhlYWQuZXh0cmFfbWF4IDogY29weSwqLwogICAgICAgICAgICAgICAgbGVuCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAvL3ptZW1jcHkoc3RhdGUuaGVhZC5leHRyYSArIGxlbiwgbmV4dCwKICAgICAgICAgICAgICAvLyAgICAgICAgbGVuICsgY29weSA+IHN0YXRlLmhlYWQuZXh0cmFfbWF4ID8KICAgICAgICAgICAgICAvLyAgICAgICAgc3RhdGUuaGVhZC5leHRyYV9tYXggLSBsZW4gOiBjb3B5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGlucHV0LCBjb3B5LCBuZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgIH0KICAgICAgICBzdGF0ZS5sZW5ndGggPSAwOwogICAgICAgIHN0YXRlLm1vZGUgPSBOQU1FOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBOQU1FOgogICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDgwMCkgewogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgLy8gVE9ETzogMiBvciAxIGJ5dGVzPwogICAgICAgICAgICBsZW4gPSBpbnB1dFtuZXh0ICsgY29weSsrXTsKICAgICAgICAgICAgLyogdXNlIGNvbnN0YW50IGxpbWl0IGJlY2F1c2UgaW4ganMgd2Ugc2hvdWxkIG5vdCBwcmVhbGxvY2F0ZSBtZW1vcnkgKi8KICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAoc3RhdGUubGVuZ3RoIDwgNjU1MzYgLypzdGF0ZS5oZWFkLm5hbWVfbWF4Ki8pKSB7CiAgICAgICAgICAgICAgc3RhdGUuaGVhZC5uYW1lICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobGVuKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSB3aGlsZSAobGVuICYmIGNvcHkgPCBoYXZlKTsKCiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICBpZiAobGVuKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICBzdGF0ZS5oZWFkLm5hbWUgPSBudWxsOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5sZW5ndGggPSAwOwogICAgICAgIHN0YXRlLm1vZGUgPSBDT01NRU5UOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MTAwMCkgewogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgbGVuID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkICYmIGxlbiAmJgogICAgICAgICAgICAgICAgKHN0YXRlLmxlbmd0aCA8IDY1NTM2IC8qc3RhdGUuaGVhZC5jb21tX21heCovKSkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gd2hpbGUgKGxlbiAmJiBjb3B5IDwgaGF2ZSk7CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICBpZiAobGVuKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICBzdGF0ZS5oZWFkLmNvbW1lbnQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5tb2RlID0gSENSQzsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgSENSQzoKICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDE2KTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIGlmIChob2xkICE9PSAoc3RhdGUuY2hlY2sgJiAweGZmZmYpKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2hlYWRlciBjcmMgbWlzbWF0Y2gnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgc3RhdGUuaGVhZC5oY3JjID0gKChzdGF0ZS5mbGFncyA+PiA5KSAmIDEpOwogICAgICAgICAgc3RhdGUuaGVhZC5kb25lID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMDsKICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBESUNUSUQ6CiAgICAgICAgLy89PT0gTkVFREJJVFMoMzIpOyAqLwogICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIC8vPT09Ly8KICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgYml0cyA9IDA7CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLm1vZGUgPSBESUNUOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBESUNUOgogICAgICAgIGlmIChzdGF0ZS5oYXZlZGljdCA9PT0gMCkgewogICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgICAgICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAvLy0tLQogICAgICAgICAgcmV0dXJuIFpfTkVFRF9ESUNUJDE7CiAgICAgICAgfQogICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDEvKmFkbGVyMzIoMEwsIFpfTlVMTCwgMCkqLzsKICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgVFlQRToKICAgICAgICBpZiAoZmx1c2ggPT09IFpfQkxPQ0sgfHwgZmx1c2ggPT09IFpfVFJFRVMpIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIFRZUEVETzoKICAgICAgICBpZiAoc3RhdGUubGFzdCkgewogICAgICAgICAgLy8tLS0gQllURUJJVFMoKSAtLS0vLwogICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgYml0cyAtPSBiaXRzICYgNzsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm1vZGUgPSBDSEVDSzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvLz09PSBORUVEQklUUygzKTsgKi8KICAgICAgICB3aGlsZSAoYml0cyA8IDMpIHsKICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIC8vPT09Ly8KICAgICAgICBzdGF0ZS5sYXN0ID0gKGhvbGQgJiAweDAxKS8qQklUUygxKSovOwogICAgICAgIC8vLS0tIERST1BCSVRTKDEpIC0tLS8vCiAgICAgICAgaG9sZCA+Pj49IDE7CiAgICAgICAgYml0cyAtPSAxOwogICAgICAgIC8vLS0tLy8KCiAgICAgICAgc3dpdGNoICgoaG9sZCAmIDB4MDMpLypCSVRTKDIpKi8pIHsKICAgICAgICAgIGNhc2UgMDogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHN0b3JlZCBibG9jayAqLwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgIHN0b3JlZCBibG9jayVzXG4iLAogICAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGFzdCA/ICIgKGxhc3QpIiA6ICIiKSk7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZml4ZWQgYmxvY2sgKi8KICAgICAgICAgICAgZml4ZWR0YWJsZXMoc3RhdGUpOwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgIGZpeGVkIGNvZGVzIGJsb2NrJXNcbiIsCiAgICAgICAgICAgIC8vICAgICAgICBzdGF0ZS5sYXN0ID8gIiAobGFzdCkiIDogIiIpKTsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87ICAgICAgICAgICAgIC8qIGRlY29kZSBjb2RlcyAqLwogICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUygyKSAtLS0vLwogICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZHluYW1pYyBibG9jayAqLwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgIGR5bmFtaWMgY29kZXMgYmxvY2slc1xuIiwKICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmxhc3QgPyAiIChsYXN0KSIgOiAiIikpOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gVEFCTEU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGJsb2NrIHR5cGUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgIH0KICAgICAgICAvLy0tLSBEUk9QQklUUygyKSAtLS0vLwogICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAvLy0tLS8vCiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU1RPUkVEOgogICAgICAgIC8vLS0tIEJZVEVCSVRTKCkgLS0tLy8gLyogZ28gdG8gYnl0ZSBib3VuZGFyeSAqLwogICAgICAgIGhvbGQgPj4+PSBiaXRzICYgNzsKICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgIC8vLS0tLy8KICAgICAgICAvLz09PSBORUVEQklUUygzMik7ICovCiAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBoYXZlLS07CiAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICB9CiAgICAgICAgLy89PT0vLwogICAgICAgIGlmICgoaG9sZCAmIDB4ZmZmZikgIT09ICgoaG9sZCA+Pj4gMTYpIF4gMHhmZmZmKSkgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBzdG9yZWQgYmxvY2sgbGVuZ3Rocyc7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0YXRlLmxlbmd0aCA9IGhvbGQgJiAweGZmZmY7CiAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHN0b3JlZCBsZW5ndGggJXVcbiIsCiAgICAgICAgLy8gICAgICAgIHN0YXRlLmxlbmd0aCkpOwogICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgYml0cyA9IDA7CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZXzsKICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIENPUFlfOgogICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBDT1BZOgogICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgeyBjb3B5ID0gaGF2ZTsgfQogICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9CiAgICAgICAgICBpZiAoY29weSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIC8vLS0tIHptZW1jcHkocHV0LCBuZXh0LCBjb3B5KTsgLS0tCiAgICAgICAgICBvdXRwdXQuc2V0KGlucHV0LnN1YmFycmF5KG5leHQsIG5leHQgKyBjb3B5KSwgcHV0KTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHN0b3JlZCBlbmRcbiIpKTsKICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBUQUJMRToKICAgICAgICAvLz09PSBORUVEQklUUygxNCk7ICovCiAgICAgICAgd2hpbGUgKGJpdHMgPCAxNCkgewogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBoYXZlLS07CiAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICB9CiAgICAgICAgLy89PT0vLwogICAgICAgIHN0YXRlLm5sZW4gPSAoaG9sZCAmIDB4MWYpLypCSVRTKDUpKi8gKyAyNTc7CiAgICAgICAgLy8tLS0gRFJPUEJJVFMoNSkgLS0tLy8KICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICBiaXRzIC09IDU7CiAgICAgICAgLy8tLS0vLwogICAgICAgIHN0YXRlLm5kaXN0ID0gKGhvbGQgJiAweDFmKS8qQklUUyg1KSovICsgMTsKICAgICAgICAvLy0tLSBEUk9QQklUUyg1KSAtLS0vLwogICAgICAgIGhvbGQgPj4+PSA1OwogICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAvLy0tLS8vCiAgICAgICAgc3RhdGUubmNvZGUgPSAoaG9sZCAmIDB4MGYpLypCSVRTKDQpKi8gKyA0OwogICAgICAgIC8vLS0tIERST1BCSVRTKDQpIC0tLS8vCiAgICAgICAgaG9sZCA+Pj49IDQ7CiAgICAgICAgYml0cyAtPSA0OwogICAgICAgIC8vLS0tLy8KLy8jaWZuZGVmIFBLWklQX0JVR19XT1JLQVJPVU5ECiAgICAgICAgaWYgKHN0YXRlLm5sZW4gPiAyODYgfHwgc3RhdGUubmRpc3QgPiAzMCkgewogICAgICAgICAgc3RybS5tc2cgPSAndG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KLy8jZW5kaWYKICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgdGFibGUgc2l6ZXMgb2tcbiIpKTsKICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICBzdGF0ZS5tb2RlID0gTEVOTEVOUzsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5jb2RlKSB7CiAgICAgICAgICAvLz09PSBORUVEQklUUygzKTsKICAgICAgICAgIHdoaWxlIChiaXRzIDwgMykgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IChob2xkICYgMHgwNyk7Ly9CSVRTKDMpOwogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgYml0cyAtPSAzOwogICAgICAgICAgLy8tLS0vLwogICAgICAgIH0KICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IDE5KSB7CiAgICAgICAgICBzdGF0ZS5sZW5zW29yZGVyW3N0YXRlLmhhdmUrK11dID0gMDsKICAgICAgICB9CiAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAvL3N0YXRlLm5leHQgPSBzdGF0ZS5jb2RlczsKICAgICAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwogICAgICAgIC8vIFN3aXRjaCB0byB1c2UgZHluYW1pYyB0YWJsZQogICAgICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW47CiAgICAgICAgc3RhdGUubGVuYml0cyA9IDc7CgogICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICByZXQgPSBpbmZ0cmVlcyhDT0RFUywgc3RhdGUubGVucywgMCwgMTksIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CgogICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgY29kZSBsZW5ndGhzIHNldCc7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICBjb2RlIGxlbmd0aHMgb2tcbiIpKTsKICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICBzdGF0ZS5tb2RlID0gQ09ERUxFTlM7CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIENPREVMRU5TOgogICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgc3RhdGUubmxlbiArIHN0YXRlLm5kaXN0KSB7CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2hvbGQgJiAoKDEgPDwgc3RhdGUubGVuYml0cykgLSAxKV07LypCSVRTKHN0YXRlLmxlbmJpdHMpKi8KICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgMHhmZmZmOwoKICAgICAgICAgICAgaWYgKChoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaGVyZV92YWwgPCAxNikgewogICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGhlcmVfdmFsOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyAyKTsKICAgICAgICAgICAgICBuID0gaGVyZV9iaXRzICsgMjsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgYml0IGxlbmd0aCByZXBlYXQnOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsZW4gPSBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUgLSAxXTsKICAgICAgICAgICAgICBjb3B5ID0gMyArIChob2xkICYgMHgwMyk7Ly9CSVRTKDIpOwogICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDIpIC0tLS8vCiAgICAgICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChoZXJlX3ZhbCA9PT0gMTcpIHsKICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyAzKTsKICAgICAgICAgICAgICBuID0gaGVyZV9iaXRzICsgMzsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgbGVuID0gMDsKICAgICAgICAgICAgICBjb3B5ID0gMyArIChob2xkICYgMHgwNyk7Ly9CSVRTKDMpOwogICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgICAgaG9sZCA+Pj49IDM7CiAgICAgICAgICAgICAgYml0cyAtPSAzOwogICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyA3KTsKICAgICAgICAgICAgICBuID0gaGVyZV9iaXRzICsgNzsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgbGVuID0gMDsKICAgICAgICAgICAgICBjb3B5ID0gMTEgKyAoaG9sZCAmIDB4N2YpOy8vQklUUyg3KTsKICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyg3KSAtLS0vLwogICAgICAgICAgICAgIGhvbGQgPj4+PSA3OwogICAgICAgICAgICAgIGJpdHMgLT0gNzsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmhhdmUgKyBjb3B5ID4gc3RhdGUubmxlbiArIHN0YXRlLm5kaXN0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCc7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoY29weS0tKSB7CiAgICAgICAgICAgICAgc3RhdGUubGVuc1tzdGF0ZS5oYXZlKytdID0gbGVuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKiBoYW5kbGUgZXJyb3IgYnJlYWtzIGluIHdoaWxlICovCiAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IEJBRCkgeyBicmVhazsgfQoKICAgICAgICAvKiBjaGVjayBmb3IgZW5kLW9mLWJsb2NrIGNvZGUgKGJldHRlciBoYXZlIG9uZSkgKi8KICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGNvZGUgLS0gbWlzc2luZyBlbmQtb2YtYmxvY2snOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLyogYnVpbGQgY29kZSB0YWJsZXMgLS0gbm90ZTogZG8gbm90IGNoYW5nZSB0aGUgbGVuYml0cyBvciBkaXN0Yml0cwogICAgICAgICAgIHZhbHVlcyBoZXJlICg5IGFuZCA2KSB3aXRob3V0IHJlYWRpbmcgdGhlIGNvbW1lbnRzIGluIGluZnRyZWVzLmgKICAgICAgICAgICBjb25jZXJuaW5nIHRoZSBFTk9VR0ggY29uc3RhbnRzLCB3aGljaCBkZXBlbmQgb24gdGhvc2UgdmFsdWVzICovCiAgICAgICAgc3RhdGUubGVuYml0cyA9IDk7CgogICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICByZXQgPSBpbmZ0cmVlcyhMRU5TLCBzdGF0ZS5sZW5zLCAwLCBzdGF0ZS5ubGVuLCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAvLyBXZSBoYXZlIHNlcGFyYXRlIHRhYmxlcyAmIG5vIHBvaW50ZXJzLiAyIGNvbW1lbnRlZCBsaW5lcyBiZWxvdyBub3QgbmVlZGVkLgogICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgLy8gc3RhdGUubGVuY29kZSA9IHN0YXRlLm5leHQ7CgogICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCc7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBzdGF0ZS5kaXN0Yml0cyA9IDY7CiAgICAgICAgLy9zdGF0ZS5kaXN0Y29kZS5jb3B5KHN0YXRlLmNvZGVzKTsKICAgICAgICAvLyBTd2l0Y2ggdG8gdXNlIGR5bmFtaWMgdGFibGUKICAgICAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW47CiAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUuZGlzdGJpdHMgfTsKICAgICAgICByZXQgPSBpbmZ0cmVlcyhESVNUUywgc3RhdGUubGVucywgc3RhdGUubmxlbiwgc3RhdGUubmRpc3QsIHN0YXRlLmRpc3Rjb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAvLyBXZSBoYXZlIHNlcGFyYXRlIHRhYmxlcyAmIG5vIHBvaW50ZXJzLiAyIGNvbW1lbnRlZCBsaW5lcyBiZWxvdyBub3QgbmVlZGVkLgogICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgIHN0YXRlLmRpc3RiaXRzID0gb3B0cy5iaXRzOwogICAgICAgIC8vIHN0YXRlLmRpc3Rjb2RlID0gc3RhdGUubmV4dDsKCiAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBkaXN0YW5jZXMgc2V0JzsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgJ2luZmxhdGU6ICAgICAgIGNvZGVzIG9rXG4nKSk7CiAgICAgICAgc3RhdGUubW9kZSA9IExFTl87CiAgICAgICAgaWYgKGZsdXNoID09PSBaX1RSRUVTKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBMRU5fOgogICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIExFTjoKICAgICAgICBpZiAoaGF2ZSA+PSA2ICYmIGxlZnQgPj0gMjU4KSB7CiAgICAgICAgICAvLy0tLSBSRVNUT1JFKCkgLS0tCiAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogICAgICAgICAgc3RybS5uZXh0X2luID0gbmV4dDsKICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICAgICAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgICAgICAgIC8vLS0tCiAgICAgICAgICBpbmZmYXN0KHN0cm0sIF9vdXQpOwogICAgICAgICAgLy8tLS0gTE9BRCgpIC0tLQogICAgICAgICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgICAgICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgICAgICAgbGVmdCA9IHN0cm0uYXZhaWxfb3V0OwogICAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgIGlucHV0ID0gc3RybS5pbnB1dDsKICAgICAgICAgIGhhdmUgPSBzdHJtLmF2YWlsX2luOwogICAgICAgICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICAgICAgICBiaXRzID0gc3RhdGUuYml0czsKICAgICAgICAgIC8vLS0tCgogICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgc3RhdGUuYmFjayA9IC0xOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0YXRlLmJhY2sgPSAwOwogICAgICAgIGZvciAoOzspIHsKICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2hvbGQgJiAoKDEgPDwgc3RhdGUubGVuYml0cykgLSAxKV07ICAvKkJJVFMoc3RhdGUubGVuYml0cykqLwogICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICBoZXJlX29wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgaWYgKGhlcmVfYml0cyA8PSBiaXRzKSB7IGJyZWFrOyB9CiAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgLy8tLS0vLwogICAgICAgIH0KICAgICAgICBpZiAoaGVyZV9vcCAmJiAoaGVyZV9vcCAmIDB4ZjApID09PSAwKSB7CiAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgIGxhc3RfdmFsID0gaGVyZV92YWw7CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAoKGhvbGQgJiAoKDEgPDwgKGxhc3RfYml0cyArIGxhc3Rfb3ApKSAtIDEpKS8qQklUUyhsYXN0LmJpdHMgKyBsYXN0Lm9wKSovID4+IGxhc3RfYml0cyldOwogICAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgICBpZiAoKGxhc3RfYml0cyArIGhlcmVfYml0cykgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGxhc3QuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBsYXN0X2JpdHM7CiAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gbGFzdF9iaXRzOwogICAgICAgIH0KICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAvLy0tLS8vCiAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgc3RhdGUubGVuZ3RoID0gaGVyZV92YWw7CiAgICAgICAgaWYgKGhlcmVfb3AgPT09IDApIHsKICAgICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCBoZXJlLnZhbCA+PSAweDIwICYmIGhlcmUudmFsIDwgMHg3ZiA/CiAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAnJWMnXG4iIDoKICAgICAgICAgIC8vICAgICAgICAiaW5mbGF0ZTogICAgICAgICBsaXRlcmFsIDB4JTAyeFxuIiwgaGVyZS52YWwpKTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMSVQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGhlcmVfb3AgJiAzMikgewogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgc3RhdGUuYmFjayA9IC0xOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGhlcmVfb3AgJiA2NCkgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlJzsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RhdGUuZXh0cmEgPSBoZXJlX29wICYgMTU7CiAgICAgICAgc3RhdGUubW9kZSA9IExFTkVYVDsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgTEVORVhUOgogICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgLy89PT0gTkVFREJJVFMoc3RhdGUuZXh0cmEpOwogICAgICAgICAgbiA9IHN0YXRlLmV4dHJhOwogICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5sZW5ndGggKz0gaG9sZCAmICgoMSA8PCBzdGF0ZS5leHRyYSkgLSAxKS8qQklUUyhzdGF0ZS5leHRyYSkqLzsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKHN0YXRlLmV4dHJhKSAtLS0vLwogICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gc3RhdGUuZXh0cmE7CiAgICAgICAgfQogICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgICBsZW5ndGggJXVcbiIsIHN0YXRlLmxlbmd0aCkpOwogICAgICAgIHN0YXRlLndhcyA9IHN0YXRlLmxlbmd0aDsKICAgICAgICBzdGF0ZS5tb2RlID0gRElTVDsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgRElTVDoKICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICBoZXJlID0gc3RhdGUuZGlzdGNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5kaXN0Yml0cykgLSAxKV07LypCSVRTKHN0YXRlLmRpc3RiaXRzKSovCiAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICBpZiAoKGhlcmVfYml0cykgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBoYXZlLS07CiAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICB9CiAgICAgICAgaWYgKChoZXJlX29wICYgMHhmMCkgPT09IDApIHsKICAgICAgICAgIGxhc3RfYml0cyA9IGhlcmVfYml0czsKICAgICAgICAgIGxhc3Rfb3AgPSBoZXJlX29wOwogICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmRpc3Rjb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAoKGhvbGQgJiAoKDEgPDwgKGxhc3RfYml0cyArIGxhc3Rfb3ApKSAtIDEpKS8qQklUUyhsYXN0LmJpdHMgKyBsYXN0Lm9wKSovID4+IGxhc3RfYml0cyldOwogICAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgICBpZiAoKGxhc3RfYml0cyArIGhlcmVfYml0cykgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGxhc3QuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBsYXN0X2JpdHM7CiAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gbGFzdF9iaXRzOwogICAgICAgIH0KICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAvLy0tLS8vCiAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgaWYgKGhlcmVfb3AgJiA2NCkgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBkaXN0YW5jZSBjb2RlJzsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RhdGUub2Zmc2V0ID0gaGVyZV92YWw7CiAgICAgICAgc3RhdGUuZXh0cmEgPSAoaGVyZV9vcCkgJiAxNTsKICAgICAgICBzdGF0ZS5tb2RlID0gRElTVEVYVDsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICBpZiAoc3RhdGUuZXh0cmEpIHsKICAgICAgICAgIC8vPT09IE5FRURCSVRTKHN0YXRlLmV4dHJhKTsKICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUub2Zmc2V0ICs9IGhvbGQgJiAoKDEgPDwgc3RhdGUuZXh0cmEpIC0gMSkvKkJJVFMoc3RhdGUuZXh0cmEpKi87CiAgICAgICAgICAvLy0tLSBEUk9QQklUUyhzdGF0ZS5leHRyYSkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBzdGF0ZS5leHRyYTsKICAgICAgICAgIGJpdHMgLT0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgIH0KLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICBpZiAoc3RhdGUub2Zmc2V0ID4gc3RhdGUuZG1heCkgewogICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2snOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KLy8jZW5kaWYKICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgZGlzdGFuY2UgJXVcbiIsIHN0YXRlLm9mZnNldCkpOwogICAgICAgIHN0YXRlLm1vZGUgPSBNQVRDSDsKICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgIGNhc2UgTUFUQ0g6CiAgICAgICAgaWYgKGxlZnQgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgY29weSA9IF9vdXQgLSBsZWZ0OwogICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBjb3B5KSB7ICAgICAgICAgLyogY29weSBmcm9tIHdpbmRvdyAqLwogICAgICAgICAgY29weSA9IHN0YXRlLm9mZnNldCAtIGNvcHk7CiAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLndoYXZlKSB7CiAgICAgICAgICAgIGlmIChzdGF0ZS5zYW5lKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2snOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KLy8gKCEpIFRoaXMgYmxvY2sgaXMgZGlzYWJsZWQgaW4gemxpYiBkZWZhdWx0cywKLy8gZG9uJ3QgZW5hYmxlIGl0IGZvciBiaW5hcnkgY29tcGF0aWJpbGl0eQovLyNpZmRlZiBJTkZMQVRFX0FMTE9XX0lOVkFMSURfRElTVEFOQ0VfVE9PRkFSX0FSUlIKLy8gICAgICAgICAgVHJhY2UoKHN0ZGVyciwgImluZmxhdGUuYyB0b28gZmFyXG4iKSk7Ci8vICAgICAgICAgIGNvcHkgLT0gc3RhdGUud2hhdmU7Ci8vICAgICAgICAgIGlmIChjb3B5ID4gc3RhdGUubGVuZ3RoKSB7IGNvcHkgPSBzdGF0ZS5sZW5ndGg7IH0KLy8gICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9Ci8vICAgICAgICAgIGxlZnQgLT0gY29weTsKLy8gICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7Ci8vICAgICAgICAgIGRvIHsKLy8gICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gMDsKLy8gICAgICAgICAgfSB3aGlsZSAoLS1jb3B5KTsKLy8gICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgeyBzdGF0ZS5tb2RlID0gTEVOOyB9Ci8vICAgICAgICAgIGJyZWFrOwovLyNlbmRpZgogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS53bmV4dCkgewogICAgICAgICAgICBjb3B5IC09IHN0YXRlLnduZXh0OwogICAgICAgICAgICBmcm9tID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZyb20gPSBzdGF0ZS53bmV4dCAtIGNvcHk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgeyBjb3B5ID0gc3RhdGUubGVuZ3RoOyB9CiAgICAgICAgICBmcm9tX3NvdXJjZSA9IHN0YXRlLndpbmRvdzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogY29weSBmcm9tIG91dHB1dCAqLwogICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICBmcm9tID0gcHV0IC0gc3RhdGUub2Zmc2V0OwogICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9CiAgICAgICAgbGVmdCAtPSBjb3B5OwogICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgIGRvIHsKICAgICAgICAgIG91dHB1dFtwdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgeyBzdGF0ZS5tb2RlID0gTEVOOyB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgTElUOgogICAgICAgIGlmIChsZWZ0ID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgIG91dHB1dFtwdXQrK10gPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgbGVmdC0tOwogICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgaWYgKHN0YXRlLndyYXApIHsKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsKICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgLy8gVXNlICd8JyBpbnN0ZWFkIG9mICcrJyB0byBtYWtlIHN1cmUgdGhhdCByZXN1bHQgaXMgc2lnbmVkCiAgICAgICAgICAgIGhvbGQgfD0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBfb3V0IC09IGxlZnQ7CiAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgc3RhdGUudG90YWwgKz0gX291dDsKICAgICAgICAgIGlmIChfb3V0KSB7CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9CiAgICAgICAgICAgICAgICAvKlVQREFURShzdGF0ZS5jaGVjaywgcHV0IC0gX291dCwgX291dCk7Ki8KICAgICAgICAgICAgICAgIChzdGF0ZS5mbGFncyA/IGNyYzMyXzEoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgcHV0IC0gX291dCkgOiBhZGxlcjMyXzEoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgcHV0IC0gX291dCkpOwoKICAgICAgICAgIH0KICAgICAgICAgIF9vdXQgPSBsZWZ0OwogICAgICAgICAgLy8gTkI6IGNyYzMyIHN0b3JlZCBhcyBzaWduZWQgMzItYml0IGludCwgenN3YXAzMiByZXR1cm5zIHNpZ25lZCB0b28KICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgPyBob2xkIDogenN3YXAzMihob2xkKSkgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2luY29ycmVjdCBkYXRhIGNoZWNrJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIGNoZWNrIG1hdGNoZXMgdHJhaWxlclxuIikpOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5tb2RlID0gTEVOR1RIOwogICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgY2FzZSBMRU5HVEg6CiAgICAgICAgaWYgKHN0YXRlLndyYXAgJiYgc3RhdGUuZmxhZ3MpIHsKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsKICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIGlmIChob2xkICE9PSAoc3RhdGUudG90YWwgJiAweGZmZmZmZmZmKSkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIGxlbmd0aCBtYXRjaGVzIHRyYWlsZXJcbiIpKTsKICAgICAgICB9CiAgICAgICAgc3RhdGUubW9kZSA9IERPTkU7CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBjYXNlIERPTkU6CiAgICAgICAgcmV0ID0gWl9TVFJFQU1fRU5EJDE7CiAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICBjYXNlIEJBRDoKICAgICAgICByZXQgPSBaX0RBVEFfRVJST1IkMTsKICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgIGNhc2UgTUVNOgogICAgICAgIHJldHVybiBaX01FTV9FUlJPUiQxOwogICAgICBjYXNlIFNZTkM6CiAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQogIH0KCiAgLy8gaW5mX2xlYXZlIDwtIGhlcmUgaXMgcmVhbCBwbGFjZSBmb3IgImdvdG8gaW5mX2xlYXZlIiwgZW11bGF0ZWQgdmlhICJicmVhayBpbmZfbGVhdmUiCgogIC8qCiAgICAgUmV0dXJuIGZyb20gaW5mbGF0ZSgpLCB1cGRhdGluZyB0aGUgdG90YWwgY291bnRzIGFuZCB0aGUgY2hlY2sgdmFsdWUuCiAgICAgSWYgdGhlcmUgd2FzIG5vIHByb2dyZXNzIGR1cmluZyB0aGUgaW5mbGF0ZSgpIGNhbGwsIHJldHVybiBhIGJ1ZmZlcgogICAgIGVycm9yLiAgQ2FsbCB1cGRhdGV3aW5kb3coKSB0byBjcmVhdGUgYW5kL29yIHVwZGF0ZSB0aGUgd2luZG93IHN0YXRlLgogICAgIE5vdGU6IGEgbWVtb3J5IGVycm9yIGZyb20gaW5mbGF0ZSgpIGlzIG5vbi1yZWNvdmVyYWJsZS4KICAgKi8KCiAgLy8tLS0gUkVTVE9SRSgpIC0tLQogIHN0cm0ubmV4dF9vdXQgPSBwdXQ7CiAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgc3RybS5hdmFpbF9pbiA9IGhhdmU7CiAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgc3RhdGUuYml0cyA9IGJpdHM7CiAgLy8tLS0KCiAgaWYgKHN0YXRlLndzaXplIHx8IChfb3V0ICE9PSBzdHJtLmF2YWlsX291dCAmJiBzdGF0ZS5tb2RlIDwgQkFEICYmCiAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA8IENIRUNLIHx8IGZsdXNoICE9PSBaX0ZJTklTSCQxKSkpIHsKICAgIGlmICh1cGRhdGV3aW5kb3coc3RybSwgc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQsIF9vdXQgLSBzdHJtLmF2YWlsX291dCkpIDsKICB9CiAgX2luIC09IHN0cm0uYXZhaWxfaW47CiAgX291dCAtPSBzdHJtLmF2YWlsX291dDsKICBzdHJtLnRvdGFsX2luICs9IF9pbjsKICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogIHN0YXRlLnRvdGFsICs9IF9vdXQ7CiAgaWYgKHN0YXRlLndyYXAgJiYgX291dCkgewogICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gLypVUERBVEUoc3RhdGUuY2hlY2ssIHN0cm0ubmV4dF9vdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAoc3RhdGUuZmxhZ3MgPyBjcmMzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHN0cm0ubmV4dF9vdXQgLSBfb3V0KSA6IGFkbGVyMzJfMShzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBzdHJtLm5leHRfb3V0IC0gX291dCkpOwogIH0KICBzdHJtLmRhdGFfdHlwZSA9IHN0YXRlLmJpdHMgKyAoc3RhdGUubGFzdCA/IDY0IDogMCkgKwogICAgICAgICAgICAgICAgICAgIChzdGF0ZS5tb2RlID09PSBUWVBFID8gMTI4IDogMCkgKwogICAgICAgICAgICAgICAgICAgIChzdGF0ZS5tb2RlID09PSBMRU5fIHx8IHN0YXRlLm1vZGUgPT09IENPUFlfID8gMjU2IDogMCk7CiAgaWYgKCgoX2luID09PSAwICYmIF9vdXQgPT09IDApIHx8IGZsdXNoID09PSBaX0ZJTklTSCQxKSAmJiByZXQgPT09IFpfT0skMSkgewogICAgcmV0ID0gWl9CVUZfRVJST1I7CiAgfQogIHJldHVybiByZXQ7Cn07CgoKY29uc3QgaW5mbGF0ZUVuZCA9IChzdHJtKSA9PiB7CgogIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSAvKnx8IHN0cm0tPnpmcmVlID09IChmcmVlX2Z1bmMpMCovKSB7CiAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICB9CgogIGxldCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgaWYgKHN0YXRlLndpbmRvdykgewogICAgc3RhdGUud2luZG93ID0gbnVsbDsKICB9CiAgc3RybS5zdGF0ZSA9IG51bGw7CiAgcmV0dXJuIFpfT0skMTsKfTsKCgpjb25zdCBpbmZsYXRlR2V0SGVhZGVyID0gKHN0cm0sIGhlYWQpID0+IHsKCiAgLyogY2hlY2sgc3RhdGUgKi8KICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgaWYgKChzdGF0ZS53cmFwICYgMikgPT09IDApIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KCiAgLyogc2F2ZSBoZWFkZXIgc3RydWN0dXJlICovCiAgc3RhdGUuaGVhZCA9IGhlYWQ7CiAgaGVhZC5kb25lID0gZmFsc2U7CiAgcmV0dXJuIFpfT0skMTsKfTsKCgpjb25zdCBpbmZsYXRlU2V0RGljdGlvbmFyeSA9IChzdHJtLCBkaWN0aW9uYXJ5KSA9PiB7CiAgY29uc3QgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwoKICBsZXQgc3RhdGU7CiAgbGV0IGRpY3RpZDsKICBsZXQgcmV0OwoKICAvKiBjaGVjayBzdGF0ZSAqLwogIGlmICghc3RybSAvKiA9PSBaX05VTEwgKi8gfHwgIXN0cm0uc3RhdGUgLyogPT0gWl9OVUxMICovKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CiAgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICBpZiAoc3RhdGUud3JhcCAhPT0gMCAmJiBzdGF0ZS5tb2RlICE9PSBESUNUKSB7CiAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICB9CgogIC8qIGNoZWNrIGZvciBjb3JyZWN0IGRpY3Rpb25hcnkgaWRlbnRpZmllciAqLwogIGlmIChzdGF0ZS5tb2RlID09PSBESUNUKSB7CiAgICBkaWN0aWQgPSAxOyAvKiBhZGxlcjMyKDAsIG51bGwsIDApKi8KICAgIC8qIGRpY3RpZCA9IGFkbGVyMzIoZGljdGlkLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoKTsgKi8KICAgIGRpY3RpZCA9IGFkbGVyMzJfMShkaWN0aWQsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIDApOwogICAgaWYgKGRpY3RpZCAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgcmV0dXJuIFpfREFUQV9FUlJPUiQxOwogICAgfQogIH0KICAvKiBjb3B5IGRpY3Rpb25hcnkgdG8gd2luZG93IHVzaW5nIHVwZGF0ZXdpbmRvdygpLCB3aGljaCB3aWxsIGFtZW5kIHRoZQogICBleGlzdGluZyBkaWN0aW9uYXJ5IGlmIGFwcHJvcHJpYXRlICovCiAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogIGlmIChyZXQpIHsKICAgIHN0YXRlLm1vZGUgPSBNRU07CiAgICByZXR1cm4gWl9NRU1fRVJST1IkMTsKICB9CiAgc3RhdGUuaGF2ZWRpY3QgPSAxOwogIC8vIFRyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBkaWN0aW9uYXJ5IHNldFxuIikpOwogIHJldHVybiBaX09LJDE7Cn07CgoKdmFyIGluZmxhdGVSZXNldF8xID0gaW5mbGF0ZVJlc2V0Owp2YXIgaW5mbGF0ZVJlc2V0Ml8xID0gaW5mbGF0ZVJlc2V0MjsKdmFyIGluZmxhdGVSZXNldEtlZXBfMSA9IGluZmxhdGVSZXNldEtlZXA7CnZhciBpbmZsYXRlSW5pdF8xID0gaW5mbGF0ZUluaXQ7CnZhciBpbmZsYXRlSW5pdDJfMSA9IGluZmxhdGVJbml0MjsKdmFyIGluZmxhdGVfMiQxID0gaW5mbGF0ZSQyOwp2YXIgaW5mbGF0ZUVuZF8xID0gaW5mbGF0ZUVuZDsKdmFyIGluZmxhdGVHZXRIZWFkZXJfMSA9IGluZmxhdGVHZXRIZWFkZXI7CnZhciBpbmZsYXRlU2V0RGljdGlvbmFyeV8xID0gaW5mbGF0ZVNldERpY3Rpb25hcnk7CnZhciBpbmZsYXRlSW5mbyA9ICdwYWtvIGluZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpJzsKCi8qIE5vdCBpbXBsZW1lbnRlZAptb2R1bGUuZXhwb3J0cy5pbmZsYXRlQ29weSA9IGluZmxhdGVDb3B5Owptb2R1bGUuZXhwb3J0cy5pbmZsYXRlR2V0RGljdGlvbmFyeSA9IGluZmxhdGVHZXREaWN0aW9uYXJ5Owptb2R1bGUuZXhwb3J0cy5pbmZsYXRlTWFyayA9IGluZmxhdGVNYXJrOwptb2R1bGUuZXhwb3J0cy5pbmZsYXRlUHJpbWUgPSBpbmZsYXRlUHJpbWU7Cm1vZHVsZS5leHBvcnRzLmluZmxhdGVTeW5jID0gaW5mbGF0ZVN5bmM7Cm1vZHVsZS5leHBvcnRzLmluZmxhdGVTeW5jUG9pbnQgPSBpbmZsYXRlU3luY1BvaW50Owptb2R1bGUuZXhwb3J0cy5pbmZsYXRlVW5kZXJtaW5lID0gaW5mbGF0ZVVuZGVybWluZTsKKi8KCnZhciBpbmZsYXRlXzEkMiA9IHsKCWluZmxhdGVSZXNldDogaW5mbGF0ZVJlc2V0XzEsCglpbmZsYXRlUmVzZXQyOiBpbmZsYXRlUmVzZXQyXzEsCglpbmZsYXRlUmVzZXRLZWVwOiBpbmZsYXRlUmVzZXRLZWVwXzEsCglpbmZsYXRlSW5pdDogaW5mbGF0ZUluaXRfMSwKCWluZmxhdGVJbml0MjogaW5mbGF0ZUluaXQyXzEsCglpbmZsYXRlOiBpbmZsYXRlXzIkMSwKCWluZmxhdGVFbmQ6IGluZmxhdGVFbmRfMSwKCWluZmxhdGVHZXRIZWFkZXI6IGluZmxhdGVHZXRIZWFkZXJfMSwKCWluZmxhdGVTZXREaWN0aW9uYXJ5OiBpbmZsYXRlU2V0RGljdGlvbmFyeV8xLAoJaW5mbGF0ZUluZm86IGluZmxhdGVJbmZvCn07CgovLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KLy8KLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCi8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCi8vCi8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAovLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0Ci8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKLy8KLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQovLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQovLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCi8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCi8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgovLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKZnVuY3Rpb24gR1poZWFkZXIoKSB7CiAgLyogdHJ1ZSBpZiBjb21wcmVzc2VkIGRhdGEgYmVsaWV2ZWQgdG8gYmUgdGV4dCAqLwogIHRoaXMudGV4dCAgICAgICA9IDA7CiAgLyogbW9kaWZpY2F0aW9uIHRpbWUgKi8KICB0aGlzLnRpbWUgICAgICAgPSAwOwogIC8qIGV4dHJhIGZsYWdzIChub3QgdXNlZCB3aGVuIHdyaXRpbmcgYSBnemlwIGZpbGUpICovCiAgdGhpcy54ZmxhZ3MgICAgID0gMDsKICAvKiBvcGVyYXRpbmcgc3lzdGVtICovCiAgdGhpcy5vcyAgICAgICAgID0gMDsKICAvKiBwb2ludGVyIHRvIGV4dHJhIGZpZWxkIG9yIFpfTlVMTCBpZiBub25lICovCiAgdGhpcy5leHRyYSAgICAgID0gbnVsbDsKICAvKiBleHRyYSBmaWVsZCBsZW5ndGggKHZhbGlkIGlmIGV4dHJhICE9IFpfTlVMTCkgKi8KICB0aGlzLmV4dHJhX2xlbiAgPSAwOyAvLyBBY3R1YWxseSwgd2UgZG9uJ3QgbmVlZCBpdCBpbiBKUywKICAgICAgICAgICAgICAgICAgICAgICAvLyBidXQgbGVhdmUgZm9yIGZldyBjb2RlIG1vZGlmaWNhdGlvbnMKCiAgLy8KICAvLyBTZXR1cCBsaW1pdHMgaXMgbm90IG5lY2Vzc2FyeSBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5CiAgLy8gZm9yIGluZmxhdGUgdXNlIGNvbnN0YW50IGxpbWl0IGluIDY1NTM2IGJ5dGVzCiAgLy8KCiAgLyogc3BhY2UgYXQgZXh0cmEgKG9ubHkgd2hlbiByZWFkaW5nIGhlYWRlcikgKi8KICAvLyB0aGlzLmV4dHJhX21heCAgPSAwOwogIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGZpbGUgbmFtZSBvciBaX05VTEwgKi8KICB0aGlzLm5hbWUgICAgICAgPSAnJzsKICAvKiBzcGFjZSBhdCBuYW1lIChvbmx5IHdoZW4gcmVhZGluZyBoZWFkZXIpICovCiAgLy8gdGhpcy5uYW1lX21heCAgID0gMDsKICAvKiBwb2ludGVyIHRvIHplcm8tdGVybWluYXRlZCBjb21tZW50IG9yIFpfTlVMTCAqLwogIHRoaXMuY29tbWVudCAgICA9ICcnOwogIC8qIHNwYWNlIGF0IGNvbW1lbnQgKG9ubHkgd2hlbiByZWFkaW5nIGhlYWRlcikgKi8KICAvLyB0aGlzLmNvbW1fbWF4ICAgPSAwOwogIC8qIHRydWUgaWYgdGhlcmUgd2FzIG9yIHdpbGwgYmUgYSBoZWFkZXIgY3JjICovCiAgdGhpcy5oY3JjICAgICAgID0gMDsKICAvKiB0cnVlIHdoZW4gZG9uZSByZWFkaW5nIGd6aXAgaGVhZGVyIChub3QgdXNlZCB3aGVuIHdyaXRpbmcgYSBnemlwIGZpbGUpICovCiAgdGhpcy5kb25lICAgICAgID0gZmFsc2U7Cn0KCnZhciBnemhlYWRlciA9IEdaaGVhZGVyOwoKY29uc3QgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCmNvbnN0IHsKICBaX05PX0ZMVVNILCBaX0ZJTklTSCwKICBaX09LLCBaX1NUUkVBTV9FTkQsIFpfTkVFRF9ESUNULCBaX1NUUkVBTV9FUlJPUiwgWl9EQVRBX0VSUk9SLCBaX01FTV9FUlJPUgp9ID0gY29uc3RhbnRzJDI7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCi8qKgogKiBjbGFzcyBJbmZsYXRlCiAqCiAqIEdlbmVyaWMgSlMtc3R5bGUgd3JhcHBlciBmb3IgemxpYiBjYWxscy4gSWYgeW91IGRvbid0IG5lZWQKICogc3RyZWFtaW5nIGJlaGF2aW91ciAtIHVzZSBtb3JlIHNpbXBsZSBmdW5jdGlvbnM6IFtbaW5mbGF0ZV1dCiAqIGFuZCBbW2luZmxhdGVSYXddXS4KICoqLwoKLyogaW50ZXJuYWwKICogaW5mbGF0ZS5jaHVua3MgLT4gQXJyYXkKICoKICogQ2h1bmtzIG9mIG91dHB1dCBkYXRhLCBpZiBbW0luZmxhdGUjb25EYXRhXV0gbm90IG92ZXJyaWRkZW4uCiAqKi8KCi8qKgogKiBJbmZsYXRlLnJlc3VsdCAtPiBVaW50OEFycmF5fFN0cmluZwogKgogKiBVbmNvbXByZXNzZWQgcmVzdWx0LCBnZW5lcmF0ZWQgYnkgZGVmYXVsdCBbW0luZmxhdGUjb25EYXRhXV0KICogYW5kIFtbSW5mbGF0ZSNvbkVuZF1dIGhhbmRsZXJzLiBGaWxsZWQgYWZ0ZXIgeW91IHB1c2ggbGFzdCBjaHVuawogKiAoY2FsbCBbW0luZmxhdGUjcHVzaF1dIHdpdGggYFpfRklOSVNIYCAvIGB0cnVlYCBwYXJhbSkuCiAqKi8KCi8qKgogKiBJbmZsYXRlLmVyciAtPiBOdW1iZXIKICoKICogRXJyb3IgY29kZSBhZnRlciBpbmZsYXRlIGZpbmlzaGVkLiAwIChaX09LKSBvbiBzdWNjZXNzLgogKiBTaG91bGQgYmUgY2hlY2tlZCBpZiBicm9rZW4gZGF0YSBwb3NzaWJsZS4KICoqLwoKLyoqCiAqIEluZmxhdGUubXNnIC0+IFN0cmluZwogKgogKiBFcnJvciBtZXNzYWdlLCBpZiBbW0luZmxhdGUuZXJyXV0gIT0gMAogKiovCgoKLyoqCiAqIG5ldyBJbmZsYXRlKG9wdGlvbnMpCiAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBpbmZsYXRlIG9wdGlvbnMuCiAqCiAqIENyZWF0ZXMgbmV3IGluZmxhdG9yIGluc3RhbmNlIHdpdGggc3BlY2lmaWVkIHBhcmFtcy4gVGhyb3dzIGV4Y2VwdGlvbgogKiBvbiBiYWQgcGFyYW1zLiBTdXBwb3J0ZWQgb3B0aW9uczoKICoKICogLSBgd2luZG93Qml0c2AKICogLSBgZGljdGlvbmFyeWAKICoKICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZS4KICoKICogQWRkaXRpb25hbCBvcHRpb25zLCBmb3IgaW50ZXJuYWwgbmVlZHM6CiAqCiAqIC0gYGNodW5rU2l6ZWAgLSBzaXplIG9mIGdlbmVyYXRlZCBkYXRhIGNodW5rcyAoMTZLIGJ5IGRlZmF1bHQpCiAqIC0gYHJhd2AgKEJvb2xlYW4pIC0gZG8gcmF3IGluZmxhdGUKICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAqICAgZnJvbSB1dGY4IHRvIHV0ZjE2IChqYXZhc2NyaXB0KSBzdHJpbmcuIFdoZW4gc3RyaW5nIG91dHB1dCByZXF1ZXN0ZWQsCiAqICAgY2h1bmsgbGVuZ3RoIGNhbiBkaWZmZXIgZnJvbSBgY2h1bmtTaXplYCwgZGVwZW5kaW5nIG9uIGNvbnRlbnQuCiAqCiAqIEJ5IGRlZmF1bHQsIHdoZW4gbm8gb3B0aW9ucyBzZXQsIGF1dG9kZXRlY3QgZGVmbGF0ZS9nemlwIGRhdGEgZm9ybWF0IHZpYQogKiB3cmFwcGVyIGhlYWRlci4KICoKICogIyMjIyMgRXhhbXBsZToKICoKICogYGBgamF2YXNjcmlwdAogKiBjb25zdCBwYWtvID0gcmVxdWlyZSgncGFrbycpCiAqIGNvbnN0IGNodW5rMSA9IG5ldyBVaW50OEFycmF5KFsxLDIsMyw0LDUsNiw3LDgsOV0pCiAqIGNvbnN0IGNodW5rMiA9IG5ldyBVaW50OEFycmF5KFsxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOV0pOwogKgogKiBjb25zdCBpbmZsYXRlID0gbmV3IHBha28uSW5mbGF0ZSh7IGxldmVsOiAzfSk7CiAqCiAqIGluZmxhdGUucHVzaChjaHVuazEsIGZhbHNlKTsKICogaW5mbGF0ZS5wdXNoKGNodW5rMiwgdHJ1ZSk7ICAvLyB0cnVlIC0+IGxhc3QgY2h1bmsKICoKICogaWYgKGluZmxhdGUuZXJyKSB7IHRocm93IG5ldyBFcnJvcihpbmZsYXRlLmVycik7IH0KICoKICogY29uc29sZS5sb2coaW5mbGF0ZS5yZXN1bHQpOwogKiBgYGAKICoqLwpmdW5jdGlvbiBJbmZsYXRlJDEob3B0aW9ucykgewogIHRoaXMub3B0aW9ucyA9IGNvbW1vbi5hc3NpZ24oewogICAgY2h1bmtTaXplOiAxMDI0ICogNjQsCiAgICB3aW5kb3dCaXRzOiAxNSwKICAgIHRvOiAnJwogIH0sIG9wdGlvbnMgfHwge30pOwoKICBjb25zdCBvcHQgPSB0aGlzLm9wdGlvbnM7CgogIC8vIEZvcmNlIHdpbmRvdyBzaXplIGZvciBgcmF3YCBkYXRhLCBpZiBub3Qgc2V0IGRpcmVjdGx5LAogIC8vIGJlY2F1c2Ugd2UgaGF2ZSBubyBoZWFkZXIgZm9yIGF1dG9kZXRlY3QuCiAgaWYgKG9wdC5yYXcgJiYgKG9wdC53aW5kb3dCaXRzID49IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgb3B0LndpbmRvd0JpdHMgPSAtb3B0LndpbmRvd0JpdHM7CiAgICBpZiAob3B0LndpbmRvd0JpdHMgPT09IDApIHsgb3B0LndpbmRvd0JpdHMgPSAtMTU7IH0KICB9CgogIC8vIElmIGB3aW5kb3dCaXRzYCBub3QgZGVmaW5lZCAoYW5kIG1vZGUgbm90IHJhdykgLSBzZXQgYXV0b2RldGVjdCBmbGFnIGZvciBnemlwL2RlZmxhdGUKICBpZiAoKG9wdC53aW5kb3dCaXRzID49IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSAmJgogICAgICAhKG9wdGlvbnMgJiYgb3B0aW9ucy53aW5kb3dCaXRzKSkgewogICAgb3B0LndpbmRvd0JpdHMgKz0gMzI7CiAgfQoKICAvLyBHemlwIGhlYWRlciBoYXMgbm8gaW5mbyBhYm91dCB3aW5kb3dzIHNpemUsIHdlIGNhbiBkbyBhdXRvZGV0ZWN0IG9ubHkKICAvLyBmb3IgZGVmbGF0ZS4gU28sIGlmIHdpbmRvdyBzaXplIG5vdCBzZXQsIGZvcmNlIGl0IHRvIG1heCB3aGVuIGd6aXAgcG9zc2libGUKICBpZiAoKG9wdC53aW5kb3dCaXRzID4gMTUpICYmIChvcHQud2luZG93Qml0cyA8IDQ4KSkgewogICAgLy8gYml0IDMgKDE2KSAtPiBnemlwcGVkIGRhdGEKICAgIC8vIGJpdCA0ICgzMikgLT4gYXV0b2RldGVjdCBnemlwL2RlZmxhdGUKICAgIGlmICgob3B0LndpbmRvd0JpdHMgJiAxNSkgPT09IDApIHsKICAgICAgb3B0LndpbmRvd0JpdHMgfD0gMTU7CiAgICB9CiAgfQoKICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgdGhpcy5tc2cgICAgPSAnJzsgICAgIC8vIGVycm9yIG1lc3NhZ2UKICB0aGlzLmVuZGVkICA9IGZhbHNlOyAgLy8gdXNlZCB0byBhdm9pZCBtdWx0aXBsZSBvbkVuZCgpIGNhbGxzCiAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgdGhpcy5zdHJtICAgPSBuZXcgenN0cmVhbSgpOwogIHRoaXMuc3RybS5hdmFpbF9vdXQgPSAwOwoKICBsZXQgc3RhdHVzICA9IGluZmxhdGVfMSQyLmluZmxhdGVJbml0MigKICAgIHRoaXMuc3RybSwKICAgIG9wdC53aW5kb3dCaXRzCiAgKTsKCiAgaWYgKHN0YXR1cyAhPT0gWl9PSykgewogICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogIH0KCiAgdGhpcy5oZWFkZXIgPSBuZXcgZ3poZWFkZXIoKTsKCiAgaW5mbGF0ZV8xJDIuaW5mbGF0ZUdldEhlYWRlcih0aGlzLnN0cm0sIHRoaXMuaGVhZGVyKTsKCiAgLy8gU2V0dXAgZGljdGlvbmFyeQogIGlmIChvcHQuZGljdGlvbmFyeSkgewogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgb3B0LmRpY3Rpb25hcnkgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKG9wdC5kaWN0aW9uYXJ5KSA9PT0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJykgewogICAgICBvcHQuZGljdGlvbmFyeSA9IG5ldyBVaW50OEFycmF5KG9wdC5kaWN0aW9uYXJ5KTsKICAgIH0KICAgIGlmIChvcHQucmF3KSB7IC8vSW4gcmF3IG1vZGUgd2UgbmVlZCB0byBzZXQgdGhlIGRpY3Rpb25hcnkgZWFybHkKICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgIGlmIChzdGF0dXMgIT09IFpfT0spIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZXNbc3RhdHVzXSk7CiAgICAgIH0KICAgIH0KICB9Cn0KCi8qKgogKiBJbmZsYXRlI3B1c2goZGF0YVssIGZsdXNoX21vZGVdKSAtPiBCb29sZWFuCiAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcik6IGlucHV0IGRhdGEKICogLSBmbHVzaF9tb2RlIChOdW1iZXJ8Qm9vbGVhbik6IDAuLjYgZm9yIGNvcnJlc3BvbmRpbmcgWl9OT19GTFVTSC4uWl9UUkVFCiAqICAgZmx1c2ggbW9kZXMuIFNlZSBjb25zdGFudHMuIFNraXBwZWQgb3IgYGZhbHNlYCBtZWFucyBaX05PX0ZMVVNILAogKiAgIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICoKICogU2VuZHMgaW5wdXQgZGF0YSB0byBpbmZsYXRlIHBpcGUsIGdlbmVyYXRpbmcgW1tJbmZsYXRlI29uRGF0YV1dIGNhbGxzIHdpdGgKICogbmV3IG91dHB1dCBjaHVua3MuIFJldHVybnMgYHRydWVgIG9uIHN1Y2Nlc3MuIElmIGVuZCBvZiBzdHJlYW0gZGV0ZWN0ZWQsCiAqIFtbSW5mbGF0ZSNvbkVuZF1dIHdpbGwgYmUgY2FsbGVkLgogKgogKiBgZmx1c2hfbW9kZWAgaXMgbm90IG5lZWRlZCBmb3Igbm9ybWFsIG9wZXJhdGlvbiwgYmVjYXVzZSBlbmQgb2Ygc3RyZWFtCiAqIGRldGVjdGVkIGF1dG9tYXRpY2FsbHkuIFlvdSBtYXkgdHJ5IHRvIHVzZSBpdCBmb3IgYWR2YW5jZWQgdGhpbmdzLCBidXQKICogdGhpcyBmdW5jdGlvbmFsaXR5IHdhcyBub3QgdGVzdGVkLgogKgogKiBPbiBmYWlsIGNhbGwgW1tJbmZsYXRlI29uRW5kXV0gd2l0aCBlcnJvciBjb2RlIGFuZCByZXR1cm4gZmFsc2UuCiAqCiAqICMjIyMjIEV4YW1wbGUKICoKICogYGBgamF2YXNjcmlwdAogKiBwdXNoKGNodW5rLCBmYWxzZSk7IC8vIHB1c2ggb25lIG9mIGRhdGEgY2h1bmtzCiAqIC4uLgogKiBwdXNoKGNodW5rLCB0cnVlKTsgIC8vIHB1c2ggbGFzdCBjaHVuawogKiBgYGAKICoqLwpJbmZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoZGF0YSwgZmx1c2hfbW9kZSkgewogIGNvbnN0IHN0cm0gPSB0aGlzLnN0cm07CiAgY29uc3QgY2h1bmtTaXplID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZTsKICBjb25zdCBkaWN0aW9uYXJ5ID0gdGhpcy5vcHRpb25zLmRpY3Rpb25hcnk7CiAgbGV0IHN0YXR1cywgX2ZsdXNoX21vZGUsIGxhc3RfYXZhaWxfb3V0OwoKICBpZiAodGhpcy5lbmRlZCkgcmV0dXJuIGZhbHNlOwoKICBpZiAoZmx1c2hfbW9kZSA9PT0gfn5mbHVzaF9tb2RlKSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGU7CiAgZWxzZSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGUgPT09IHRydWUgPyBaX0ZJTklTSCA6IFpfTk9fRkxVU0g7CgogIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICBpZiAodG9TdHJpbmcuY2FsbChkYXRhKSA9PT0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJykgewogICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogIH0gZWxzZSB7CiAgICBzdHJtLmlucHV0ID0gZGF0YTsKICB9CgogIHN0cm0ubmV4dF9pbiA9IDA7CiAgc3RybS5hdmFpbF9pbiA9IHN0cm0uaW5wdXQubGVuZ3RoOwoKICBmb3IgKDs7KSB7CiAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgc3RybS5vdXRwdXQgPSBuZXcgVWludDhBcnJheShjaHVua1NpemUpOwogICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgc3RybS5hdmFpbF9vdXQgPSBjaHVua1NpemU7CiAgICB9CgogICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZShzdHJtLCBfZmx1c2hfbW9kZSk7CgogICAgaWYgKHN0YXR1cyA9PT0gWl9ORUVEX0RJQ1QgJiYgZGljdGlvbmFyeSkgewogICAgICBzdGF0dXMgPSBpbmZsYXRlXzEkMi5pbmZsYXRlU2V0RGljdGlvbmFyeShzdHJtLCBkaWN0aW9uYXJ5KTsKCiAgICAgIGlmIChzdGF0dXMgPT09IFpfT0spIHsKICAgICAgICBzdGF0dXMgPSBpbmZsYXRlXzEkMi5pbmZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFpfREFUQV9FUlJPUikgewogICAgICAgIC8vIFJlcGxhY2UgY29kZSB3aXRoIG1vcmUgdmVyYm9zZQogICAgICAgIHN0YXR1cyA9IFpfTkVFRF9ESUNUOwogICAgICB9CiAgICB9CgogICAgLy8gU2tpcCBzbnljIG1hcmtlcnMgaWYgbW9yZSBkYXRhIGZvbGxvd3MgYW5kIG5vdCByYXcgbW9kZQogICAgd2hpbGUgKHN0cm0uYXZhaWxfaW4gPiAwICYmCiAgICAgICAgICAgc3RhdHVzID09PSBaX1NUUkVBTV9FTkQgJiYKICAgICAgICAgICBzdHJtLnN0YXRlLndyYXAgPiAwICYmCiAgICAgICAgICAgZGF0YVtzdHJtLm5leHRfaW5dICE9PSAwKQogICAgewogICAgICBpbmZsYXRlXzEkMi5pbmZsYXRlUmVzZXQoc3RybSk7CiAgICAgIHN0YXR1cyA9IGluZmxhdGVfMSQyLmluZmxhdGUoc3RybSwgX2ZsdXNoX21vZGUpOwogICAgfQoKICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgIGNhc2UgWl9TVFJFQU1fRVJST1I6CiAgICAgIGNhc2UgWl9EQVRBX0VSUk9SOgogICAgICBjYXNlIFpfTkVFRF9ESUNUOgogICAgICBjYXNlIFpfTUVNX0VSUk9SOgogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gUmVtZW1iZXIgcmVhbCBgYXZhaWxfb3V0YCB2YWx1ZSwgYmVjYXVzZSB3ZSBtYXkgcGF0Y2ggb3V0IGJ1ZmZlciBjb250ZW50CiAgICAvLyB0byBhbGlnbiB1dGY4IHN0cmluZ3MgYm91bmRhcmllcy4KICAgIGxhc3RfYXZhaWxfb3V0ID0gc3RybS5hdmFpbF9vdXQ7CgogICAgaWYgKHN0cm0ubmV4dF9vdXQpIHsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwIHx8IHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EKSB7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CgogICAgICAgICAgbGV0IG5leHRfb3V0X3V0ZjggPSBzdHJpbmdzLnV0Zjhib3JkZXIoc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQpOwoKICAgICAgICAgIGxldCB0YWlsID0gc3RybS5uZXh0X291dCAtIG5leHRfb3V0X3V0Zjg7CiAgICAgICAgICBsZXQgdXRmOHN0ciA9IHN0cmluZ3MuYnVmMnN0cmluZyhzdHJtLm91dHB1dCwgbmV4dF9vdXRfdXRmOCk7CgogICAgICAgICAgLy8gbW92ZSB0YWlsICYgcmVhbGlnbiBjb3VudGVycwogICAgICAgICAgc3RybS5uZXh0X291dCA9IHRhaWw7CiAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZSAtIHRhaWw7CiAgICAgICAgICBpZiAodGFpbCkgc3RybS5vdXRwdXQuc2V0KHN0cm0ub3V0cHV0LnN1YmFycmF5KG5leHRfb3V0X3V0ZjgsIG5leHRfb3V0X3V0ZjggKyB0YWlsKSwgMCk7CgogICAgICAgICAgdGhpcy5vbkRhdGEodXRmOHN0cik7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dC5sZW5ndGggPT09IHN0cm0ubmV4dF9vdXQgPyBzdHJtLm91dHB1dCA6IHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBNdXN0IHJlcGVhdCBpdGVyYXRpb24gaWYgb3V0IGJ1ZmZlciBpcyBmdWxsCiAgICBpZiAoc3RhdHVzID09PSBaX09LICYmIGxhc3RfYXZhaWxfb3V0ID09PSAwKSBjb250aW51ZTsKCiAgICAvLyBGaW5hbGl6ZSBpZiBlbmQgb2Ygc3RyZWFtIHJlYWNoZWQuCiAgICBpZiAoc3RhdHVzID09PSBaX1NUUkVBTV9FTkQpIHsKICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBpZiAoc3RybS5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgfQoKICByZXR1cm4gdHJ1ZTsKfTsKCgovKioKICogSW5mbGF0ZSNvbkRhdGEoY2h1bmspIC0+IFZvaWQKICogLSBjaHVuayAoVWludDhBcnJheXxTdHJpbmcpOiBvdXRwdXQgZGF0YS4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICogICBlYWNoIGNodW5rIHdpbGwgYmUgc3RyaW5nLgogKgogKiBCeSBkZWZhdWx0LCBzdG9yZXMgZGF0YSBibG9ja3MgaW4gYGNodW5rc1tdYCBwcm9wZXJ0eSBhbmQgZ2x1ZQogKiB0aG9zZSBpbiBgb25FbmRgLiBPdmVycmlkZSB0aGlzIGhhbmRsZXIsIGlmIHlvdSBuZWVkIGFub3RoZXIgYmVoYXZpb3VyLgogKiovCkluZmxhdGUkMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgdGhpcy5jaHVua3MucHVzaChjaHVuayk7Cn07CgoKLyoqCiAqIEluZmxhdGUjb25FbmQoc3RhdHVzKSAtPiBWb2lkCiAqIC0gc3RhdHVzIChOdW1iZXIpOiBpbmZsYXRlIHN0YXR1cy4gMCAoWl9PSykgb24gc3VjY2VzcywKICogICBvdGhlciBpZiBub3QuCiAqCiAqIENhbGxlZCBlaXRoZXIgYWZ0ZXIgeW91IHRlbGwgaW5mbGF0ZSB0aGF0IHRoZSBpbnB1dCBzdHJlYW0gaXMKICogY29tcGxldGUgKFpfRklOSVNIKS4gQnkgZGVmYXVsdCAtIGpvaW4gY29sbGVjdGVkIGNodW5rcywKICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICoqLwpJbmZsYXRlJDEucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24gKHN0YXR1cykgewogIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgaWYgKHN0YXR1cyA9PT0gWl9PSykgewogICAgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gJ3N0cmluZycpIHsKICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCcnKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucmVzdWx0ID0gY29tbW9uLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpOwogICAgfQogIH0KICB0aGlzLmNodW5rcyA9IFtdOwogIHRoaXMuZXJyID0gc3RhdHVzOwogIHRoaXMubXNnID0gdGhpcy5zdHJtLm1zZzsKfTsKCgovKioKICogaW5mbGF0ZShkYXRhWywgb3B0aW9uc10pIC0+IFVpbnQ4QXJyYXl8U3RyaW5nCiAqIC0gZGF0YSAoVWludDhBcnJheSk6IGlucHV0IGRhdGEgdG8gZGVjb21wcmVzcy4KICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICoKICogRGVjb21wcmVzcyBgZGF0YWAgd2l0aCBpbmZsYXRlL3VuZ3ppcCBhbmQgYG9wdGlvbnNgLiBBdXRvZGV0ZWN0CiAqIGZvcm1hdCB2aWEgd3JhcHBlciBoZWFkZXIgYnkgZGVmYXVsdC4gVGhhdCdzIHdoeSB3ZSBkb24ndCBwcm92aWRlCiAqIHNlcGFyYXRlIGB1bmd6aXBgIG1ldGhvZC4KICoKICogU3VwcG9ydGVkIG9wdGlvbnMgYXJlOgogKgogKiAtIHdpbmRvd0JpdHMKICoKICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICoKICogU3VnYXIgKG9wdGlvbnMpOgogKgogKiAtIGByYXdgIChCb29sZWFuKSAtIHNheSB0aGF0IHdlIHdvcmsgd2l0aCByYXcgc3RyZWFtLCBpZiB5b3UgZG9uJ3Qgd2lzaCB0byBzcGVjaWZ5CiAqICAgbmVnYXRpdmUgd2luZG93Qml0cyBpbXBsaWNpdGx5LgogKiAtIGB0b2AgKFN0cmluZykgLSBpZiBlcXVhbCB0byAnc3RyaW5nJywgdGhlbiByZXN1bHQgd2lsbCBiZSBjb252ZXJ0ZWQKICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICogICBjaHVuayBsZW5ndGggY2FuIGRpZmZlciBmcm9tIGBjaHVua1NpemVgLCBkZXBlbmRpbmcgb24gY29udGVudC4KICoKICoKICogIyMjIyMgRXhhbXBsZToKICoKICogYGBgamF2YXNjcmlwdAogKiBjb25zdCBwYWtvID0gcmVxdWlyZSgncGFrbycpOwogKiBjb25zdCBpbnB1dCA9IHBha28uZGVmbGF0ZShuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKSk7CiAqIGxldCBvdXRwdXQ7CiAqCiAqIHRyeSB7CiAqICAgb3V0cHV0ID0gcGFrby5pbmZsYXRlKGlucHV0KTsKICogfSBjYXRjaCAoZXJyKSB7CiAqICAgY29uc29sZS5sb2coZXJyKTsKICogfQogKiBgYGAKICoqLwpmdW5jdGlvbiBpbmZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICBjb25zdCBpbmZsYXRvciA9IG5ldyBJbmZsYXRlJDEob3B0aW9ucyk7CgogIGluZmxhdG9yLnB1c2goaW5wdXQpOwoKICAvLyBUaGF0IHdpbGwgbmV2ZXIgaGFwcGVucywgaWYgeW91IGRvbid0IGNoZWF0IHdpdGggb3B0aW9ucyA6KQogIGlmIChpbmZsYXRvci5lcnIpIHRocm93IGluZmxhdG9yLm1zZyB8fCBtZXNzYWdlc1tpbmZsYXRvci5lcnJdOwoKICByZXR1cm4gaW5mbGF0b3IucmVzdWx0Owp9CgoKLyoqCiAqIGluZmxhdGVSYXcoZGF0YVssIG9wdGlvbnNdKSAtPiBVaW50OEFycmF5fFN0cmluZwogKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBpbmZsYXRlIG9wdGlvbnMuCiAqCiAqIFRoZSBzYW1lIGFzIFtbaW5mbGF0ZV1dLCBidXQgY3JlYXRlcyByYXcgZGF0YSwgd2l0aG91dCB3cmFwcGVyCiAqIChoZWFkZXIgYW5kIGFkbGVyMzIgY3JjKS4KICoqLwpmdW5jdGlvbiBpbmZsYXRlUmF3JDEoaW5wdXQsIG9wdGlvbnMpIHsKICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBvcHRpb25zLnJhdyA9IHRydWU7CiAgcmV0dXJuIGluZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7Cn0KCgovKioKICogdW5nemlwKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICogLSBkYXRhIChVaW50OEFycmF5KTogaW5wdXQgZGF0YSB0byBkZWNvbXByZXNzLgogKiAtIG9wdGlvbnMgKE9iamVjdCk6IHpsaWIgaW5mbGF0ZSBvcHRpb25zLgogKgogKiBKdXN0IHNob3J0Y3V0IHRvIFtbaW5mbGF0ZV1dLCBiZWNhdXNlIGl0IGF1dG9kZXRlY3RzIGZvcm1hdAogKiBieSBoZWFkZXIuY29udGVudC4gRG9uZSBmb3IgY29udmVuaWVuY2UuCiAqKi8KCgp2YXIgSW5mbGF0ZV8xJDEgPSBJbmZsYXRlJDE7CnZhciBpbmZsYXRlXzIgPSBpbmZsYXRlJDE7CnZhciBpbmZsYXRlUmF3XzEkMSA9IGluZmxhdGVSYXckMTsKdmFyIHVuZ3ppcCQxID0gaW5mbGF0ZSQxOwp2YXIgY29uc3RhbnRzID0gY29uc3RhbnRzJDI7Cgp2YXIgaW5mbGF0ZV8xJDEgPSB7CglJbmZsYXRlOiBJbmZsYXRlXzEkMSwKCWluZmxhdGU6IGluZmxhdGVfMiwKCWluZmxhdGVSYXc6IGluZmxhdGVSYXdfMSQxLAoJdW5nemlwOiB1bmd6aXAkMSwKCWNvbnN0YW50czogY29uc3RhbnRzCn07Cgpjb25zdCB7IEluZmxhdGUsIGluZmxhdGUsIGluZmxhdGVSYXcsIHVuZ3ppcCB9ID0gaW5mbGF0ZV8xJDE7CnZhciBpbmZsYXRlXzEgPSBpbmZsYXRlOwoKY2xhc3MgRGVmbGF0ZURlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgZGVjb2RlQmxvY2soYnVmZmVyKSB7CiAgICByZXR1cm4gaW5mbGF0ZV8xKG5ldyBVaW50OEFycmF5KGJ1ZmZlcikpLmJ1ZmZlcjsKICB9Cn0KCnZhciBkZWZsYXRlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogIF9fcHJvdG9fXzogbnVsbCwKICAnZGVmYXVsdCc6IERlZmxhdGVEZWNvZGVyCn0pOwoKY2xhc3MgUGFja2JpdHNEZWNvZGVyIGV4dGVuZHMgQmFzZURlY29kZXIgewogIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgIGNvbnN0IG91dCA9IFtdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLmJ5dGVMZW5ndGg7ICsraSkgewogICAgICBsZXQgaGVhZGVyID0gZGF0YVZpZXcuZ2V0SW50OChpKTsKICAgICAgaWYgKGhlYWRlciA8IDApIHsKICAgICAgICBjb25zdCBuZXh0ID0gZGF0YVZpZXcuZ2V0VWludDgoaSArIDEpOwogICAgICAgIGhlYWRlciA9IC1oZWFkZXI7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaGVhZGVyOyArK2opIHsKICAgICAgICAgIG91dC5wdXNoKG5leHQpOwogICAgICAgIH0KICAgICAgICBpICs9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaGVhZGVyOyArK2opIHsKICAgICAgICAgIG91dC5wdXNoKGRhdGFWaWV3LmdldFVpbnQ4KGkgKyBqICsgMSkpOwogICAgICAgIH0KICAgICAgICBpICs9IGhlYWRlciArIDE7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgVWludDhBcnJheShvdXQpLmJ1ZmZlcjsKICB9Cn0KCnZhciBwYWNrYml0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICBfX3Byb3RvX186IG51bGwsCiAgJ2RlZmF1bHQnOiBQYWNrYml0c0RlY29kZXIKfSk7Cgp2YXIgTGVyY0RlY29kZSA9IHtleHBvcnRzOiB7fX07CgooZnVuY3Rpb24gKG1vZHVsZSkgewovKiBqc2hpbnQgZm9yaW46IGZhbHNlLCBiaXR3aXNlOiBmYWxzZSAqLwovKgpDb3B5cmlnaHQgMjAxNS0yMDIxIEVzcmkKCkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwp5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoKaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgpVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgpTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKQSBjb3B5IG9mIHRoZSBsaWNlbnNlIGFuZCBhZGRpdGlvbmFsIG5vdGljZXMgYXJlIGxvY2F0ZWQgd2l0aCB0aGUKc291cmNlIGRpc3RyaWJ1dGlvbiBhdDoKCmh0dHA6Ly9naXRodWIuY29tL0VzcmkvbGVyYy8KCkNvbnRyaWJ1dG9yczogIEpvaGFubmVzIFNjaG1pZCwgKExFUkMgdjEpCiAgICAgICAgICAgICAgIENoYXlhbmlrYSBLaGF0dWEsIChMRVJDIHYxKQogICAgICAgICAgICAgICBXZW54dWUgSnUgKExFUkMgdjEsIHYyLngpCiovCgovKiBDb3B5cmlnaHQgMjAxNS0yMDIxIEVzcmkuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAgQHByZXNlcnZlICovCgovKioKICogYSBtb2R1bGUgZm9yIGRlY29kaW5nIExFUkMgYmxvYnMKICogQG1vZHVsZSBMZXJjCiAqLwooZnVuY3Rpb24oKSB7CiAgLy90aGlzIGRlY29kZXIgc3VwcG9ydHMgYWxsIGxlcmMgdmVyc2lvbnMsIGVhY2ggdmVyc2lvbiBoYXMgaXRzIG93biBjbGFzcyAoTGVyY0RlY29kZSBhbmQgTGVyYzJEZWNvZGUpLiAKICAvL3RoZSBleHBvcnRlZCBtb2R1bGUgaGFuZGxlcyBmb3JtYXQgdmFyaWF0aW9uIGF1dG9hbXRpY2FsbHkuCgogIC8vdGhlIG9yaWdpbmFsIExlcmNEZWNvZGUgZm9yIFZlcnNpb24gMQogIHZhciBMZXJjRGVjb2RlID0gKGZ1bmN0aW9uKCkgewoKICAgIC8vIE5vdGU6IGN1cnJlbnRseSwgdGhpcyBtb2R1bGUgb25seSBoYXMgYW4gaW1wbGVtZW50YXRpb24gZm9yIGRlY29kaW5nIExFUkMgZGF0YSwgbm90IGVuY29kaW5nLiBUaGUgbmFtZSBvZgogICAgLy8gdGhlIGNsYXNzIHdhcyBjaG9zZW4gdG8gYmUgZnV0dXJlIHByb29mLgoKICAgIHZhciBDbnRaSW1hZ2UgPSB7fTsKCiAgICBDbnRaSW1hZ2UuZGVmYXVsdE5vRGF0YVZhbHVlID0gLTMuNDAyNzk5OTM4NzkwMTQ4NGUrMzg7IC8vIHNtYWxsZXN0IEZsb2F0MzIgdmFsdWUKCiAgICAvKioKICAgICAqIERlY29kZSBhIExFUkMgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgc29tZSByZXF1aXJlZCBhbmQgb3B0aW9uYWwKICAgICAqIGluZm9ybWF0aW9uIGFib3V0IGl0LCBzdWNoIGFzIHRoZSBpbWFnZSdzIHdpZHRoIGFuZCBoZWlnaHQuCiAgICAgKgogICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gaW5wdXQgVGhlIExFUkMgaW5wdXQgYnl0ZSBzdHJlYW0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gRGVjb2Rpbmcgb3B0aW9ucywgY29udGFpbmluZyBhbnkgb2YgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogICAgICogQGNvbmZpZyB7bnVtYmVyfSBbaW5wdXRPZmZzZXQgPSAwXQogICAgICogICAgICAgIFNraXAgdGhlIGZpcnN0IGlucHV0T2Zmc2V0IGJ5dGVzIG9mIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMRVJDIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbi4KICAgICAqIEBjb25maWcge1VpbnQ4QXJyYXl9IFtlbmNvZGVkTWFzayA9IG51bGxdCiAgICAgKiAgICAgICAgSWYgc3BlY2lmaWVkLCB0aGUgZGVjb2RlciB3aWxsIG5vdCByZWFkIG1hc2sgaW5mb3JtYXRpb24gZnJvbSB0aGUgaW5wdXQgYW5kIHVzZSB0aGUgc3BlY2lmaWVkIGVuY29kZWQKICAgICAqICAgICAgICBtYXNrIGRhdGEgaW5zdGVhZC4gTWFzayBoZWFkZXIvZGF0YSBtdXN0IG5vdCBiZSBwcmVzZW50IGluIHRoZSBMRVJDIGJ5dGUgc3RyZWFtIGluIHRoaXMgY2FzZS4KICAgICAqIEBjb25maWcge251bWJlcn0gW25vRGF0YVZhbHVlID0gTGVyY0NvZGUuZGVmYXVsdE5vRGF0YVZhbHVlXQogICAgICogICAgICAgIFBpeGVsIHZhbHVlIHRvIHVzZSBmb3IgbWFza2VkIHBpeGVscy4KICAgICAqIEBjb25maWcge0FycmF5QnVmZmVyVmlld3xBcnJheX0gW3BpeGVsVHlwZSA9IEZsb2F0MzJBcnJheV0KICAgICAqICAgICAgICBUaGUgZGVzaXJlZCB0eXBlIG9mIHRoZSBwaXhlbERhdGEgYXJyYXkgaW4gdGhlIHJldHVybiB2YWx1ZS4gTm90ZSB0aGF0IGl0IGlzIHRoZSBjYWxsZXIncyByZXNwb25zaWJpbGl0eSB0bwogICAgICogICAgICAgIHByb3ZpZGUgYW4gYXBwcm9wcmlhdGUgbm9EYXRhVmFsdWUgaWYgdGhlIGRlZmF1bHQgcGl4ZWxUeXBlIGlzIG92ZXJyaWRkZW4uCiAgICAgKiBAY29uZmlnIHtib29sZWFufSBbcmV0dXJuTWFzayA9IGZhbHNlXQogICAgICogICAgICAgIElmIHRydWUsIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIGEgbWFza0RhdGEgcHJvcGVydHkgb2YgdHlwZSBVaW50OEFycmF5IHdoaWNoIGhhcyBvbmUgZWxlbWVudCBwZXIKICAgICAqICAgICAgICBwaXhlbCwgdGhlIHZhbHVlIG9mIHdoaWNoIGlzIDEgb3IgMCBkZXBlbmRpbmcgb24gd2hldGhlciB0aGF0IHBpeGVsJ3MgZGF0YSBpcyBwcmVzZW50IG9yIG1hc2tlZC4gSWYgdGhlCiAgICAgKiAgICAgICAgaW5wdXQgTEVSQyBkYXRhIGRvZXMgbm90IGNvbnRhaW4gYSBtYXNrLCBtYXNrRGF0YSB3aWxsIG5vdCBiZSByZXR1cm5lZC4KICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtyZXR1cm5FbmNvZGVkTWFzayA9IGZhbHNlXQogICAgICogICAgICAgIElmIHRydWUsIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIGEgZW5jb2RlZE1hc2tEYXRhIHByb3BlcnR5LCB3aGljaCBjYW4gYmUgcGFzc2VkIGludG8gZW5jb2RlKCkgYXMKICAgICAqICAgICAgICBlbmNvZGVkTWFzay4KICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtyZXR1cm5GaWxlSW5mbyA9IGZhbHNlXQogICAgICogICAgICAgIElmIHRydWUsIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBoYXZlIGEgZmlsZUluZm8gcHJvcGVydHkgdGhhdCBjb250YWlucyBtZXRhZGF0YSBvYnRhaW5lZCBmcm9tIHRoZQogICAgICogICAgICAgIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MuCiAgICAgKiBAY29uZmlnIHtib29sZWFufSBbY29tcHV0ZVVzZWRCaXREZXB0aHMgPSBmYWxzZV0KICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgZmlsZUluZm8gcHJvcGVydHkgaW4gdGhlIHJldHVybiB2YWx1ZSB3aWxsIGNvbnRhaW4gdGhlIHNldCBvZiBhbGwgYmxvY2sgYml0IGRlcHRocwogICAgICogICAgICAgIGVuY291bnRlcmVkIGR1cmluZyBkZWNvZGluZy4gV2lsbCBvbmx5IGhhdmUgYW4gZWZmZWN0IGlmIHJldHVybkZpbGVJbmZvIG9wdGlvbiBpcyB0cnVlLgogICAgICogQHJldHVybnMge3t3aWR0aCwgaGVpZ2h0LCBwaXhlbERhdGEsIG1pblZhbHVlLCBtYXhWYWx1ZSwgbm9EYXRhVmFsdWUsIG1hc2tEYXRhLCBlbmNvZGVkTWFza0RhdGEsIGZpbGVJbmZvfX0KICAgICAqLwogICAgQ250WkltYWdlLmRlY29kZSA9IGZ1bmN0aW9uKGlucHV0LCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgdmFyIHNraXBNYXNrID0gb3B0aW9ucy5lbmNvZGVkTWFza0RhdGEgfHwgKG9wdGlvbnMuZW5jb2RlZE1hc2tEYXRhID09PSBudWxsKTsKICAgICAgdmFyIHBhcnNlZERhdGEgPSBwYXJzZShpbnB1dCwgb3B0aW9ucy5pbnB1dE9mZnNldCB8fCAwLCBza2lwTWFzayk7CgogICAgICB2YXIgbm9EYXRhVmFsdWUgPSAob3B0aW9ucy5ub0RhdGFWYWx1ZSAhPT0gbnVsbCkgPyBvcHRpb25zLm5vRGF0YVZhbHVlIDogQ250WkltYWdlLmRlZmF1bHROb0RhdGFWYWx1ZTsKCiAgICAgIHZhciB1bmNvbXByZXNzZWREYXRhID0gdW5jb21wcmVzc1BpeGVsVmFsdWVzKHBhcnNlZERhdGEsIG9wdGlvbnMucGl4ZWxUeXBlIHx8IEZsb2F0MzJBcnJheSwKICAgICAgICBvcHRpb25zLmVuY29kZWRNYXNrRGF0YSwgbm9EYXRhVmFsdWUsIG9wdGlvbnMucmV0dXJuTWFzayk7CgogICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgIHdpZHRoOiBwYXJzZWREYXRhLndpZHRoLAogICAgICAgIGhlaWdodDogcGFyc2VkRGF0YS5oZWlnaHQsCiAgICAgICAgcGl4ZWxEYXRhOiB1bmNvbXByZXNzZWREYXRhLnJlc3VsdFBpeGVscywKICAgICAgICBtaW5WYWx1ZTogdW5jb21wcmVzc2VkRGF0YS5taW5WYWx1ZSwKICAgICAgICBtYXhWYWx1ZTogcGFyc2VkRGF0YS5waXhlbHMubWF4VmFsdWUsCiAgICAgICAgbm9EYXRhVmFsdWU6IG5vRGF0YVZhbHVlCiAgICAgIH07CgogICAgICBpZiAodW5jb21wcmVzc2VkRGF0YS5yZXN1bHRNYXNrKSB7CiAgICAgICAgcmVzdWx0Lm1hc2tEYXRhID0gdW5jb21wcmVzc2VkRGF0YS5yZXN1bHRNYXNrOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5yZXR1cm5FbmNvZGVkTWFzayAmJiBwYXJzZWREYXRhLm1hc2spIHsKICAgICAgICByZXN1bHQuZW5jb2RlZE1hc2tEYXRhID0gcGFyc2VkRGF0YS5tYXNrLmJpdHNldCA/IHBhcnNlZERhdGEubWFzay5iaXRzZXQgOiBudWxsOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5yZXR1cm5GaWxlSW5mbykgewogICAgICAgIHJlc3VsdC5maWxlSW5mbyA9IGZvcm1hdEZpbGVJbmZvKHBhcnNlZERhdGEpOwogICAgICAgIGlmIChvcHRpb25zLmNvbXB1dGVVc2VkQml0RGVwdGhzKSB7CiAgICAgICAgICByZXN1bHQuZmlsZUluZm8uYml0RGVwdGhzID0gY29tcHV0ZVVzZWRCaXREZXB0aHMocGFyc2VkRGF0YSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKCiAgICB2YXIgdW5jb21wcmVzc1BpeGVsVmFsdWVzID0gZnVuY3Rpb24oZGF0YSwgVHlwZWRBcnJheUNsYXNzLCBtYXNrQml0c2V0LCBub0RhdGFWYWx1ZSwgc3RvcmVEZWNvZGVkTWFzaykgewogICAgICB2YXIgYmxvY2tJZHggPSAwOwogICAgICB2YXIgbnVtWCA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1g7CiAgICAgIHZhciBudW1ZID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWTsKICAgICAgdmFyIGJsb2NrV2lkdGggPSBNYXRoLmZsb29yKGRhdGEud2lkdGggLyBudW1YKTsKICAgICAgdmFyIGJsb2NrSGVpZ2h0ID0gTWF0aC5mbG9vcihkYXRhLmhlaWdodCAvIG51bVkpOwogICAgICB2YXIgc2NhbGUgPSAyICogZGF0YS5tYXhaRXJyb3I7CiAgICAgIHZhciBtaW5WYWx1ZSA9IE51bWJlci5NQVhfVkFMVUUsIGN1cnJlbnRWYWx1ZTsKICAgICAgbWFza0JpdHNldCA9IG1hc2tCaXRzZXQgfHwgKChkYXRhLm1hc2spID8gZGF0YS5tYXNrLmJpdHNldCA6IG51bGwpOwoKICAgICAgdmFyIHJlc3VsdFBpeGVscywgcmVzdWx0TWFzazsKICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IFR5cGVkQXJyYXlDbGFzcyhkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICBpZiAoc3RvcmVEZWNvZGVkTWFzayAmJiBtYXNrQml0c2V0KSB7CiAgICAgICAgcmVzdWx0TWFzayA9IG5ldyBVaW50OEFycmF5KGRhdGEud2lkdGggKiBkYXRhLmhlaWdodCk7CiAgICAgIH0KICAgICAgdmFyIGJsb2NrRGF0YUJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoYmxvY2tXaWR0aCAqIGJsb2NrSGVpZ2h0KTsKCiAgICAgIHZhciB4eCwgeXk7CiAgICAgIGZvciAodmFyIHkgPSAwOyB5IDw9IG51bVk7IHkrKykgewogICAgICAgIHZhciB0aGlzQmxvY2tIZWlnaHQgPSAoeSAhPT0gbnVtWSkgPyBibG9ja0hlaWdodCA6IChkYXRhLmhlaWdodCAlIG51bVkpOwogICAgICAgIGlmICh0aGlzQmxvY2tIZWlnaHQgPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8PSBudW1YOyB4KyspIHsKICAgICAgICAgIHZhciB0aGlzQmxvY2tXaWR0aCA9ICh4ICE9PSBudW1YKSA/IGJsb2NrV2lkdGggOiAoZGF0YS53aWR0aCAlIG51bVgpOwogICAgICAgICAgaWYgKHRoaXNCbG9ja1dpZHRoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvdXRQdHIgPSB5ICogZGF0YS53aWR0aCAqIGJsb2NrSGVpZ2h0ICsgeCAqIGJsb2NrV2lkdGg7CiAgICAgICAgICB2YXIgb3V0U3RyaWRlID0gZGF0YS53aWR0aCAtIHRoaXNCbG9ja1dpZHRoOwoKICAgICAgICAgIHZhciBibG9jayA9IGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0lkeF07CgogICAgICAgICAgdmFyIGJsb2NrRGF0YSwgYmxvY2tQdHIsIGNvbnN0VmFsdWU7CiAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPCAyKSB7CiAgICAgICAgICAgIC8vIGJsb2NrIGlzIGVpdGhlciB1bmNvbXByZXNzZWQgb3IgYml0LXN0dWZmZWQgKGVuY29kaW5ncyAwIGFuZCAxKQogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDApIHsKICAgICAgICAgICAgICAvLyBibG9jayBpcyB1bmNvbXByZXNzZWQKICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9jay5yYXdEYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGJpdC1zdHVmZmVkCiAgICAgICAgICAgICAgdW5zdHVmZihibG9jay5zdHVmZmVkRGF0YSwgYmxvY2suYml0c1BlclBpeGVsLCBibG9jay5udW1WYWxpZFBpeGVscywgYmxvY2sub2Zmc2V0LCBzY2FsZSwgYmxvY2tEYXRhQnVmZmVyLCBkYXRhLnBpeGVscy5tYXhWYWx1ZSk7CiAgICAgICAgICAgICAgYmxvY2tEYXRhID0gYmxvY2tEYXRhQnVmZmVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJsb2NrUHRyID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGJsb2NrLmVuY29kaW5nID09PSAyKSB7CiAgICAgICAgICAgIC8vIGJsb2NrIGlzIGFsbCAwCiAgICAgICAgICAgIGNvbnN0VmFsdWUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIGJsb2NrIGhhcyBjb25zdGFudCB2YWx1ZSAoZW5jb2RpbmcgPT09IDMpCiAgICAgICAgICAgIGNvbnN0VmFsdWUgPSBibG9jay5vZmZzZXQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1hc2tCeXRlOwogICAgICAgICAgaWYgKG1hc2tCaXRzZXQpIHsKICAgICAgICAgICAgZm9yICh5eSA9IDA7IHl5IDwgdGhpc0Jsb2NrSGVpZ2h0OyB5eSsrKSB7CiAgICAgICAgICAgICAgaWYgKG91dFB0ciAmIDcpIHsKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICBtYXNrQnl0ZSA9IG1hc2tCaXRzZXRbb3V0UHRyID4+IDNdOwogICAgICAgICAgICAgICAgbWFza0J5dGUgPDw9IG91dFB0ciAmIDc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAoeHggPSAwOyB4eCA8IHRoaXNCbG9ja1dpZHRoOyB4eCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIShvdXRQdHIgJiA3KSkgewogICAgICAgICAgICAgICAgICAvLyByZWFkIG5leHQgYnl0ZSBmcm9tIG1hc2sKICAgICAgICAgICAgICAgICAgbWFza0J5dGUgPSBtYXNrQml0c2V0W291dFB0ciA+PiAzXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtYXNrQnl0ZSAmIDEyOCkgewogICAgICAgICAgICAgICAgICAvLyBwaXhlbCBkYXRhIHByZXNlbnQKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdE1hc2spIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRNYXNrW291dFB0cl0gPSAxOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IChibG9jay5lbmNvZGluZyA8IDIpID8gYmxvY2tEYXRhW2Jsb2NrUHRyKytdIDogY29uc3RWYWx1ZTsKICAgICAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZSA+IGN1cnJlbnRWYWx1ZSA/IGN1cnJlbnRWYWx1ZSA6IG1pblZhbHVlOwogICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gY3VycmVudFZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gcGl4ZWwgZGF0YSBub3QgcHJlc2VudAogICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdE1hc2tbb3V0UHRyXSA9IDA7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWFza0J5dGUgPDw9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG1hc2sgbm90IHByZXNlbnQsIHNpbXBseSBjb3B5IGJsb2NrIG92ZXIKICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nIDwgMikgewogICAgICAgICAgICAgIC8vIGR1cGxpY2F0aW5nIHRoaXMgY29kZSBibG9jayBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucwogICAgICAgICAgICAgIC8vIGJsb2NrRGF0YSBjYXNlOgogICAgICAgICAgICAgIGZvciAoeXkgPSAwOyB5eSA8IHRoaXNCbG9ja0hlaWdodDsgeXkrKykgewogICAgICAgICAgICAgICAgZm9yICh4eCA9IDA7IHh4IDwgdGhpc0Jsb2NrV2lkdGg7IHh4KyspIHsKICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gYmxvY2tEYXRhW2Jsb2NrUHRyKytdOwogICAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG1pblZhbHVlID4gY3VycmVudFZhbHVlID8gY3VycmVudFZhbHVlIDogbWluVmFsdWU7CiAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvLyBjb25zdFZhbHVlIGNhc2U6CiAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZSA+IGNvbnN0VmFsdWUgPyBjb25zdFZhbHVlIDogbWluVmFsdWU7CiAgICAgICAgICAgICAgZm9yICh5eSA9IDA7IHl5IDwgdGhpc0Jsb2NrSGVpZ2h0OyB5eSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKHh4ID0gMDsgeHggPCB0aGlzQmxvY2tXaWR0aDsgeHgrKykgewogICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gY29uc3RWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGJsb2NrLmVuY29kaW5nID09PSAxKSAmJiAoYmxvY2tQdHIgIT09IGJsb2NrLm51bVZhbGlkUGl4ZWxzKSkgewogICAgICAgICAgICB0aHJvdyAiQmxvY2sgYW5kIE1hc2sgZG8gbm90IG1hdGNoIjsKICAgICAgICAgIH0KICAgICAgICAgIGJsb2NrSWR4Kys7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIHJlc3VsdFBpeGVsczogcmVzdWx0UGl4ZWxzLAogICAgICAgIHJlc3VsdE1hc2s6IHJlc3VsdE1hc2ssCiAgICAgICAgbWluVmFsdWU6IG1pblZhbHVlCiAgICAgIH07CiAgICB9OwoKICAgIHZhciBmb3JtYXRGaWxlSW5mbyA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAiZmlsZUlkZW50aWZpZXJTdHJpbmciOiBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLAogICAgICAgICJmaWxlVmVyc2lvbiI6IGRhdGEuZmlsZVZlcnNpb24sCiAgICAgICAgImltYWdlVHlwZSI6IGRhdGEuaW1hZ2VUeXBlLAogICAgICAgICJoZWlnaHQiOiBkYXRhLmhlaWdodCwKICAgICAgICAid2lkdGgiOiBkYXRhLndpZHRoLAogICAgICAgICJtYXhaRXJyb3IiOiBkYXRhLm1heFpFcnJvciwKICAgICAgICAiZW9mT2Zmc2V0IjogZGF0YS5lb2ZPZmZzZXQsCiAgICAgICAgIm1hc2siOiBkYXRhLm1hc2sgPyB7CiAgICAgICAgICAibnVtQmxvY2tzWCI6IGRhdGEubWFzay5udW1CbG9ja3NYLAogICAgICAgICAgIm51bUJsb2Nrc1kiOiBkYXRhLm1hc2subnVtQmxvY2tzWSwKICAgICAgICAgICJudW1CeXRlcyI6IGRhdGEubWFzay5udW1CeXRlcywKICAgICAgICAgICJtYXhWYWx1ZSI6IGRhdGEubWFzay5tYXhWYWx1ZQogICAgICAgIH0gOiBudWxsLAogICAgICAgICJwaXhlbHMiOiB7CiAgICAgICAgICAibnVtQmxvY2tzWCI6IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1gsCiAgICAgICAgICAibnVtQmxvY2tzWSI6IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ksCiAgICAgICAgICAibnVtQnl0ZXMiOiBkYXRhLnBpeGVscy5udW1CeXRlcywKICAgICAgICAgICJtYXhWYWx1ZSI6IGRhdGEucGl4ZWxzLm1heFZhbHVlLAogICAgICAgICAgIm5vRGF0YVZhbHVlIjogZGF0YS5ub0RhdGFWYWx1ZQogICAgICAgIH0KICAgICAgfTsKICAgIH07CgogICAgdmFyIGNvbXB1dGVVc2VkQml0RGVwdGhzID0gZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgbnVtQmxvY2tzID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWCAqIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgIHZhciBiaXREZXB0aHMgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1CbG9ja3M7IGkrKykgewogICAgICAgIHZhciBibG9jayA9IGRhdGEucGl4ZWxzLmJsb2Nrc1tpXTsKICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDApIHsKICAgICAgICAgIGJpdERlcHRocy5mbG9hdDMyID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICBiaXREZXB0aHNbYmxvY2suYml0c1BlclBpeGVsXSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJpdERlcHRoc1swXSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gT2JqZWN0LmtleXMoYml0RGVwdGhzKTsKICAgIH07CgogICAgdmFyIHBhcnNlID0gZnVuY3Rpb24oaW5wdXQsIGZwLCBza2lwTWFzaykgewogICAgICB2YXIgZGF0YSA9IHt9OwoKICAgICAgLy8gRmlsZSBoZWFkZXIKICAgICAgdmFyIGZpbGVJZFZpZXcgPSBuZXcgVWludDhBcnJheShpbnB1dCwgZnAsIDEwKTsKICAgICAgZGF0YS5maWxlSWRlbnRpZmllclN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZmlsZUlkVmlldyk7CiAgICAgIGlmIChkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSAhPT0gIkNudFpJbWFnZSIpIHsKICAgICAgICB0aHJvdyAiVW5leHBlY3RlZCBmaWxlIGlkZW50aWZpZXIgc3RyaW5nOiAiICsgZGF0YS5maWxlSWRlbnRpZmllclN0cmluZzsKICAgICAgfQogICAgICBmcCArPSAxMDsKICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGZwLCAyNCk7CiAgICAgIGRhdGEuZmlsZVZlcnNpb24gPSB2aWV3LmdldEludDMyKDAsIHRydWUpOwogICAgICBkYXRhLmltYWdlVHlwZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgIGRhdGEuaGVpZ2h0ID0gdmlldy5nZXRVaW50MzIoOCwgdHJ1ZSk7CiAgICAgIGRhdGEud2lkdGggPSB2aWV3LmdldFVpbnQzMigxMiwgdHJ1ZSk7CiAgICAgIGRhdGEubWF4WkVycm9yID0gdmlldy5nZXRGbG9hdDY0KDE2LCB0cnVlKTsKICAgICAgZnAgKz0gMjQ7CgogICAgICAvLyBNYXNrIEhlYWRlcgogICAgICBpZiAoIXNraXBNYXNrKSB7CiAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDE2KTsKICAgICAgICBkYXRhLm1hc2sgPSB7fTsKICAgICAgICBkYXRhLm1hc2subnVtQmxvY2tzWSA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgIGRhdGEubWFzay5udW1CbG9ja3NYID0gdmlldy5nZXRVaW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5tYXNrLm51bUJ5dGVzID0gdmlldy5nZXRVaW50MzIoOCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5tYXNrLm1heFZhbHVlID0gdmlldy5nZXRGbG9hdDMyKDEyLCB0cnVlKTsKICAgICAgICBmcCArPSAxNjsKCiAgICAgICAgLy8gTWFzayBEYXRhCiAgICAgICAgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDApIHsKICAgICAgICAgIHZhciBiaXRzZXQgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoZGF0YS53aWR0aCAqIGRhdGEuaGVpZ2h0IC8gOCkpOwogICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIGRhdGEubWFzay5udW1CeXRlcyk7CiAgICAgICAgICB2YXIgY250ID0gdmlldy5nZXRJbnQxNigwLCB0cnVlKTsKICAgICAgICAgIHZhciBpcCA9IDIsIG9wID0gMDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKGNudCA+IDApIHsKICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmlldy5nZXRVaW50OChpcCsrKTsgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciB2YWwgPSB2aWV3LmdldFVpbnQ4KGlwKyspOwogICAgICAgICAgICAgIGNudCA9IC1jbnQ7CiAgICAgICAgICAgICAgd2hpbGUgKGNudC0tKSB7IGJpdHNldFtvcCsrXSA9IHZhbDsgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNudCA9IHZpZXcuZ2V0SW50MTYoaXAsIHRydWUpOwogICAgICAgICAgICBpcCArPSAyOwogICAgICAgICAgfSB3aGlsZSAoaXAgPCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgaWYgKChjbnQgIT09IC0zMjc2OCkgfHwgKG9wIDwgYml0c2V0Lmxlbmd0aCkpIHsKICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZW5kIG9mIG1hc2sgUkxFIGVuY29kaW5nIjsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEubWFzay5iaXRzZXQgPSBiaXRzZXQ7CiAgICAgICAgICBmcCArPSBkYXRhLm1hc2subnVtQnl0ZXM7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKChkYXRhLm1hc2subnVtQnl0ZXMgfCBkYXRhLm1hc2subnVtQmxvY2tzWSB8IGRhdGEubWFzay5tYXhWYWx1ZSkgPT09IDApIHsgIC8vIFNwZWNpYWwgY2FzZSwgYWxsIG5vZGF0YQogICAgICAgICAgZGF0YS5tYXNrLmJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChkYXRhLndpZHRoICogZGF0YS5oZWlnaHQgLyA4KSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBQaXhlbCBIZWFkZXIKICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDE2KTsKICAgICAgZGF0YS5waXhlbHMgPSB7fTsKICAgICAgZGF0YS5waXhlbHMubnVtQmxvY2tzWSA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gdmlldy5nZXRVaW50MzIoNCwgdHJ1ZSk7CiAgICAgIGRhdGEucGl4ZWxzLm51bUJ5dGVzID0gdmlldy5nZXRVaW50MzIoOCwgdHJ1ZSk7CiAgICAgIGRhdGEucGl4ZWxzLm1heFZhbHVlID0gdmlldy5nZXRGbG9hdDMyKDEyLCB0cnVlKTsKICAgICAgZnAgKz0gMTY7CgogICAgICB2YXIgbnVtQmxvY2tzWCA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1g7CiAgICAgIHZhciBudW1CbG9ja3NZID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWTsKICAgICAgLy8gdGhlIG51bWJlciBvZiBibG9ja3Mgc3BlY2lmaWVkIGluIHRoZSBoZWFkZXIgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGJsb2NrcyBhdCB0aGUgZW5kIG9mCiAgICAgIC8vIGVhY2ggcm93L2NvbHVtbiB3aXRoIGEgc3BlY2lhbCB3aWR0aC9oZWlnaHQgdGhhdCBtYWtlIHRoZSBpbWFnZSBjb21wbGV0ZSBpbiBjYXNlIHRoZSB3aWR0aCBpcyBub3QKICAgICAgLy8gZXZlbmx5IGRpdmlzaWJsZSBieSB0aGUgbnVtYmVyIG9mIGJsb2Nrcy4KICAgICAgdmFyIGFjdHVhbE51bUJsb2Nrc1ggPSBudW1CbG9ja3NYICsgKChkYXRhLndpZHRoICUgbnVtQmxvY2tzWCkgPiAwID8gMSA6IDApOwogICAgICB2YXIgYWN0dWFsTnVtQmxvY2tzWSA9IG51bUJsb2Nrc1kgKyAoKGRhdGEuaGVpZ2h0ICUgbnVtQmxvY2tzWSkgPiAwID8gMSA6IDApOwogICAgICBkYXRhLnBpeGVscy5ibG9ja3MgPSBuZXcgQXJyYXkoYWN0dWFsTnVtQmxvY2tzWCAqIGFjdHVhbE51bUJsb2Nrc1kpOwogICAgICB2YXIgYmxvY2tJID0gMDsKICAgICAgZm9yICh2YXIgYmxvY2tZID0gMDsgYmxvY2tZIDwgYWN0dWFsTnVtQmxvY2tzWTsgYmxvY2tZKyspIHsKICAgICAgICBmb3IgKHZhciBibG9ja1ggPSAwOyBibG9ja1ggPCBhY3R1YWxOdW1CbG9ja3NYOyBibG9ja1grKykgewoKICAgICAgICAgIC8vIEJsb2NrCiAgICAgICAgICB2YXIgc2l6ZSA9IDA7CiAgICAgICAgICB2YXIgYnl0ZXNMZWZ0ID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGZwOwogICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgIHZhciBibG9jayA9IHt9OwogICAgICAgICAgZGF0YS5waXhlbHMuYmxvY2tzW2Jsb2NrSSsrXSA9IGJsb2NrOwogICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOyBzaXplKys7CiAgICAgICAgICBibG9jay5lbmNvZGluZyA9IGhlYWRlckJ5dGUgJiA2MzsKICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA+IDMpIHsKICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9jay5lbmNvZGluZyArICIpIjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMikgewogICAgICAgICAgICBmcCsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgoaGVhZGVyQnl0ZSAhPT0gMCkgJiYgKGhlYWRlckJ5dGUgIT09IDIpKSB7CiAgICAgICAgICAgIGhlYWRlckJ5dGUgPj49IDY7CiAgICAgICAgICAgIGJsb2NrLm9mZnNldFR5cGUgPSBoZWFkZXJCeXRlOwogICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgIGJsb2NrLm9mZnNldCA9IHZpZXcuZ2V0SW50OCgxKTsgc2l6ZSsrOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDEpIHsKICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEludDE2KDEsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyQnl0ZSA9PT0gMCkgewogICAgICAgICAgICAgIGJsb2NrLm9mZnNldCA9IHZpZXcuZ2V0RmxvYXQzMigxLCB0cnVlKTsgc2l6ZSArPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93ICJJbnZhbGlkIGJsb2NrIG9mZnNldCB0eXBlIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA9IHZpZXcuZ2V0VWludDgoc2l6ZSk7IHNpemUrKzsKICAgICAgICAgICAgICBibG9jay5iaXRzUGVyUGl4ZWwgPSBoZWFkZXJCeXRlICYgNjM7CiAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVsc1R5cGUgPSBoZWFkZXJCeXRlOwogICAgICAgICAgICAgIGlmIChoZWFkZXJCeXRlID09PSAyKSB7CiAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDgoc2l6ZSk7IHNpemUrKzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIGJsb2NrLm51bVZhbGlkUGl4ZWxzID0gdmlldy5nZXRVaW50MTYoc2l6ZSwgdHJ1ZSk7IHNpemUgKz0gMjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJsb2NrLm51bVZhbGlkUGl4ZWxzID0gdmlldy5nZXRVaW50MzIoc2l6ZSwgdHJ1ZSk7IHNpemUgKz0gNDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgdmFsaWQgcGl4ZWwgY291bnQgdHlwZSI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmcCArPSBzaXplOwoKICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYXJyYXlCdWYsIHN0b3JlODsKICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gKGRhdGEucGl4ZWxzLm51bUJ5dGVzIC0gMSkgLyA0OwogICAgICAgICAgICBpZiAobnVtUGl4ZWxzICE9PSBNYXRoLmZsb29yKG51bVBpeGVscykpIHsKICAgICAgICAgICAgICB0aHJvdyAidW5jb21wcmVzc2VkIGJsb2NrIGhhcyBpbnZhbGlkIGxlbmd0aCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIobnVtUGl4ZWxzICogNCk7CiAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgZnAsIG51bVBpeGVscyAqIDQpKTsKICAgICAgICAgICAgdmFyIHJhd0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgYmxvY2sucmF3RGF0YSA9IHJhd0RhdGE7CiAgICAgICAgICAgIGZwICs9IG51bVBpeGVscyAqIDQ7CiAgICAgICAgICB9IGVsc2UgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICAgIHZhciBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoYmxvY2subnVtVmFsaWRQaXhlbHMgKiBibG9jay5iaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgZnAsIGRhdGFCeXRlcykpOwogICAgICAgICAgICBibG9jay5zdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIGZwICs9IGRhdGFCeXRlczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBmcDsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9OwoKICAgIHZhciB1bnN0dWZmID0gZnVuY3Rpb24oc3JjLCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgb2Zmc2V0LCBzY2FsZSwgZGVzdCwgbWF4VmFsdWUpIHsKICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgdmFyIGkgPSAwLCBvOwogICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICB2YXIgbiwgYnVmZmVyOwogICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgIHZhciBudW1JbnZhbGlkVGFpbEJ5dGVzID0gc3JjLmxlbmd0aCAqIDQgLSBNYXRoLmNlaWwoYml0c1BlclBpeGVsICogbnVtUGl4ZWxzIC8gOCk7CiAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwoKICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgfQogICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiAoYml0c0xlZnQgLSBiaXRzUGVyUGl4ZWwpKSAmIGJpdE1hc2s7CiAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICB9CiAgICAgICAgLy9waXhlbCB2YWx1ZXMgbWF5IGV4Y2VlZCBtYXggZHVlIHRvIHF1YW50aXphdGlvbgogICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBkZXN0OwogICAgfTsKCiAgICByZXR1cm4gQ250WkltYWdlOwogIH0pKCk7CgogIC8vdmVyc2lvbiAyLiBTdXBwb3J0cyAyLjEsIDIuMiwgMi4zCiAgdmFyIExlcmMyRGVjb2RlID0gKGZ1bmN0aW9uKCkgewogICAgLy8gTm90ZTogY3VycmVudGx5LCB0aGlzIG1vZHVsZSBvbmx5IGhhcyBhbiBpbXBsZW1lbnRhdGlvbiBmb3IgZGVjb2RpbmcgTEVSQyBkYXRhLCBub3QgZW5jb2RpbmcuIFRoZSBuYW1lIG9mCiAgICAvLyB0aGUgY2xhc3Mgd2FzIGNob3NlbiB0byBiZSBmdXR1cmUgcHJvb2YsIGZvbGxvd2luZyBMZXJjRGVjb2RlLgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgKiBwcml2YXRlIHN0YXRpYyBjbGFzcyBiaXRzdXRmZmVyIHVzZWQgYnkgTGVyYzJEZWNvZGUKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICB2YXIgQml0U3R1ZmZlciA9IHsKICAgICAgLy9tZXRob2RzIGVuZGluZyB3aXRoIDIgYXJlIGZvciB0aGUgbmV3IGJ5dGUgb3JkZXIgdXNlZCBieSBMZXJjMi4zIGFuZCBhYm92ZS4KICAgICAgLy9vcmlnaW5hbFVuc3R1ZmYgaXMgdXNlZCB0byB1bnBhY2sgSHVmZm1hbiBjb2RlIHRhYmxlLiBjb2RlIGlzIGR1cGxpY2F0ZWQgdG8gdW5zdHVmZnggZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuCiAgICAgIHVuc3R1ZmY6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMsIGx1dEFyciwgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICB2YXIgYml0TWFzayA9ICgxIDw8IGJpdHNQZXJQaXhlbCkgLSAxOwogICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICAgIHZhciBuLCBidWZmZXIsIG1pc3NpbmdCaXRzLCBubWF4OwoKICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgdmFyIG51bUludmFsaWRUYWlsQnl0ZXMgPSBzcmMubGVuZ3RoICogNCAtIE1hdGguY2VpbChiaXRzUGVyUGl4ZWwgKiBudW1QaXhlbHMgLyA4KTsKICAgICAgICBzcmNbc3JjLmxlbmd0aCAtIDFdIDw8PSA4ICogbnVtSW52YWxpZFRhaWxCeXRlczsKICAgICAgICBpZiAobHV0QXJyKSB7CiAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgbWlzc2luZ0JpdHMgPSAoYml0c1BlclBpeGVsIC0gYml0c0xlZnQpOwogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gKz0gKGJ1ZmZlciA+Pj4gYml0c0xlZnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3Rbb10gPSBsdXRBcnJbbl07Ly9vZmZzZXQgKyBsdXRBcnJbbl0gKiBzY2FsZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBubWF4ID0gTWF0aC5jZWlsKChtYXhWYWx1ZSAtIG9mZnNldCkgLyBzY2FsZSk7CiAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgbWlzc2luZ0JpdHMgPSAoYml0c1BlclBpeGVsIC0gYml0c0xlZnQpOwogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gKz0gKGJ1ZmZlciA+Pj4gYml0c0xlZnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vcGl4ZWwgdmFsdWVzIG1heSBleGNlZWQgbWF4IGR1ZSB0byBxdWFudGl6YXRpb24KICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgdW5zdHVmZkxVVDogZnVuY3Rpb24oc3JjLCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICB2YXIgYml0TWFzayA9ICgxIDw8IGJpdHNQZXJQaXhlbCkgLSAxOwogICAgICAgIHZhciBpID0gMCwgbyA9IDAsIG1pc3NpbmdCaXRzID0gMCwgYml0c0xlZnQgPSAwLCBuID0gMDsKICAgICAgICB2YXIgYnVmZmVyOwogICAgICAgIHZhciBkZXN0ID0gW107CgogICAgICAgIC8vIGdldCByaWQgb2YgdHJhaWxpbmcgYnl0ZXMgdGhhdCBhcmUgYWxyZWFkeSBwYXJ0IG9mIG5leHQgYmxvY2sKICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwoKICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gKGJpdHNMZWZ0IC0gYml0c1BlclBpeGVsKSkgJiBiaXRNYXNrOwogICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgIG4gKz0gKGJ1ZmZlciA+Pj4gYml0c0xlZnQpOwogICAgICAgICAgfQogICAgICAgICAgLy9kZXN0LnB1c2gobik7CiAgICAgICAgICBkZXN0W29dID0gbiA8IG5tYXggPyBvZmZzZXQgKyBuICogc2NhbGUgOiBtYXhWYWx1ZTsKICAgICAgICB9CiAgICAgICAgZGVzdC51bnNoaWZ0KG9mZnNldCk7Ly8xc3Qgb25lCiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH0sCgogICAgICB1bnN0dWZmMjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgbHV0QXJyLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvOwogICAgICAgIHZhciBiaXRzTGVmdCA9IDAsIGJpdFBvcyA9IDA7CiAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHM7CiAgICAgICAgaWYgKGx1dEFycikgewogICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgICAgYml0UG9zID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzayk7CiAgICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgICAgIGJpdFBvcyArPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWlzc2luZ0JpdHMgPSAoYml0c1BlclBpeGVsIC0gYml0c0xlZnQpOwogICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzazsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgbiB8PSAoYnVmZmVyICYgKCgxIDw8IG1pc3NpbmdCaXRzKSAtIDEpKSA8PCAoYml0c1BlclBpeGVsIC0gbWlzc2luZ0JpdHMpOwogICAgICAgICAgICAgIGJpdFBvcyA9IG1pc3NpbmdCaXRzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3Rbb10gPSBsdXRBcnJbbl07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVzdDsKICAgICAgfSwKCiAgICAgIHVuc3R1ZmZMVVQyOiBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvID0gMCwgbWlzc2luZ0JpdHMgPSAwLCBiaXRzTGVmdCA9IDAsIG4gPSAwLCBiaXRQb3MgPSAwOwogICAgICAgIHZhciBidWZmZXI7CiAgICAgICAgdmFyIGRlc3QgPSBbXTsKICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAvL25vIHVuc2lnbmVkIGxlZnQgc2hpZnQKICAgICAgICAgICAgbiA9ICgoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzayk7CiAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgYml0UG9zICs9IGJpdHNQZXJQaXhlbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IGJpdFBvcykgJiBiaXRNYXNrOy8vKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICBuIHw9IChidWZmZXIgJiAoKDEgPDwgbWlzc2luZ0JpdHMpIC0gMSkpIDw8IChiaXRzUGVyUGl4ZWwgLSBtaXNzaW5nQml0cyk7CiAgICAgICAgICAgIGJpdFBvcyA9IG1pc3NpbmdCaXRzOwogICAgICAgICAgfQogICAgICAgICAgLy9kZXN0LnB1c2gobik7CiAgICAgICAgICBkZXN0W29dID0gbiA8IG5tYXggPyBvZmZzZXQgKyBuICogc2NhbGUgOiBtYXhWYWx1ZTsKICAgICAgICB9CiAgICAgICAgZGVzdC51bnNoaWZ0KG9mZnNldCk7CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH0sCgogICAgICBvcmlnaW5hbFVuc3R1ZmY6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMpIHsKICAgICAgICB2YXIgYml0TWFzayA9ICgxIDw8IGJpdHNQZXJQaXhlbCkgLSAxOwogICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICAgIHZhciBuLCBidWZmZXIsIG1pc3NpbmdCaXRzOwoKICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgdmFyIG51bUludmFsaWRUYWlsQnl0ZXMgPSBzcmMubGVuZ3RoICogNCAtIE1hdGguY2VpbChiaXRzUGVyUGl4ZWwgKiBudW1QaXhlbHMgLyA4KTsKICAgICAgICBzcmNbc3JjLmxlbmd0aCAtIDFdIDw8PSA4ICogbnVtSW52YWxpZFRhaWxCeXRlczsKCiAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiAoYml0c0xlZnQgLSBiaXRzUGVyUGl4ZWwpKSAmIGJpdE1hc2s7CiAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgIG4gKz0gKGJ1ZmZlciA+Pj4gYml0c0xlZnQpOwogICAgICAgICAgfQogICAgICAgICAgZGVzdFtvXSA9IG47CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXN0OwogICAgICB9LAoKICAgICAgb3JpZ2luYWxVbnN0dWZmMjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscykgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvOwogICAgICAgIHZhciBiaXRzTGVmdCA9IDAsIGJpdFBvcyA9IDA7CiAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHM7CiAgICAgICAgLy9taWNyby1vcHRpbWl6YXRpb25zCiAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICBuID0gKChidWZmZXIgPj4+IGJpdFBvcykgJiBiaXRNYXNrKTsKICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWlzc2luZ0JpdHMgPSAoYml0c1BlclBpeGVsIC0gYml0c0xlZnQpOwogICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgYml0UG9zID0gbWlzc2luZ0JpdHM7CiAgICAgICAgICB9CiAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH0KICAgIH07CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAqcHJpdmF0ZSBzdGF0aWMgY2xhc3MgdXNlZCBieSBMZXJjMkRlY29kZQogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgdmFyIExlcmMySGVscGVycyA9IHsKICAgICAgSFVGRk1BTl9MVVRfQklUU19NQVg6IDEyLCAvL3VzZSAyXjEyIGx1dCwgdHJlYXQgaXQgbGlrZSBjb25zdGFudAogICAgICBjb21wdXRlQ2hlY2tzdW1GbGV0Y2hlcjMyOiBmdW5jdGlvbihpbnB1dCkgewoKICAgICAgICB2YXIgc3VtMSA9IDB4ZmZmZiwgc3VtMiA9IDB4ZmZmZjsKICAgICAgICB2YXIgbGVuID0gaW5wdXQubGVuZ3RoOwogICAgICAgIHZhciB3b3JkcyA9IE1hdGguZmxvb3IobGVuIC8gMik7CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIHdoaWxlICh3b3JkcykgewogICAgICAgICAgdmFyIHRsZW4gPSAod29yZHMgPj0gMzU5KSA/IDM1OSA6IHdvcmRzOwogICAgICAgICAgd29yZHMgLT0gdGxlbjsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgc3VtMSArPSAoaW5wdXRbaSsrXSA8PCA4KTsKICAgICAgICAgICAgc3VtMiArPSBzdW0xICs9IGlucHV0W2krK107CiAgICAgICAgICB9IHdoaWxlICgtLXRsZW4pOwoKICAgICAgICAgIHN1bTEgPSAoc3VtMSAmIDB4ZmZmZikgKyAoc3VtMSA+Pj4gMTYpOwogICAgICAgICAgc3VtMiA9IChzdW0yICYgMHhmZmZmKSArIChzdW0yID4+PiAxNik7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIHN0cmFnZ2xlciBieXRlIGlmIGl0IGV4aXN0cwogICAgICAgIGlmIChsZW4gJiAxKSB7CiAgICAgICAgICBzdW0yICs9IHN1bTEgKz0gKGlucHV0W2ldIDw8IDgpOwogICAgICAgIH0KICAgICAgICAvLyBzZWNvbmQgcmVkdWN0aW9uIHN0ZXAgdG8gcmVkdWNlIHN1bXMgdG8gMTYgYml0cwogICAgICAgIHN1bTEgPSAoc3VtMSAmIDB4ZmZmZikgKyAoc3VtMSA+Pj4gMTYpOwogICAgICAgIHN1bTIgPSAoc3VtMiAmIDB4ZmZmZikgKyAoc3VtMiA+Pj4gMTYpOwoKICAgICAgICByZXR1cm4gKHN1bTIgPDwgMTYgfCBzdW0xKSA+Pj4gMDsKICAgICAgfSwKCiAgICAgIHJlYWRIZWFkZXJJbmZvOiBmdW5jdGlvbihpbnB1dCwgZGF0YSkgewogICAgICAgIHZhciBwdHIgPSBkYXRhLnB0cjsKICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBwdHIsIDYpOwogICAgICAgIHZhciBoZWFkZXJJbmZvID0ge307CiAgICAgICAgaGVhZGVySW5mby5maWxlSWRlbnRpZmllclN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZmlsZUlkVmlldyk7CiAgICAgICAgaWYgKGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcubGFzdEluZGV4T2YoIkxlcmMyIiwgMCkgIT09IDApIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmcgKGV4cGVjdCBMZXJjMiApOiAiICsgaGVhZGVySW5mby5maWxlSWRlbnRpZmllclN0cmluZzsKICAgICAgICB9CiAgICAgICAgcHRyICs9IDY7CiAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIHB0ciwgOCk7CiAgICAgICAgdmFyIGZpbGVWZXJzaW9uID0gdmlldy5nZXRJbnQzMigwLCB0cnVlKTsKICAgICAgICBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uID0gZmlsZVZlcnNpb247CiAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgaWYgKGZpbGVWZXJzaW9uID49IDMpIHsKICAgICAgICAgIGhlYWRlckluZm8uY2hlY2tzdW0gPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9ucm93cwogICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgfQoKICAgICAgICAvL2tleXMgc3RhcnQgZnJvbSBoZXJlCiAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgcHRyLCAxMik7CiAgICAgICAgaGVhZGVySW5mby5oZWlnaHQgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsgLy9ucm93cwogICAgICAgIGhlYWRlckluZm8ud2lkdGggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9uY29scwogICAgICAgIHB0ciArPSA4OwogICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSA0KSB7CiAgICAgICAgICBoZWFkZXJJbmZvLm51bURpbXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICAgIHB0ciArPSA0OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIGhlYWRlckluZm8ubnVtRGltcyA9IDE7CiAgICAgICAgfQoKICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQwKTsKICAgICAgICBoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICBoZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplID0gdmlldy5nZXRJbnQzMig0LCB0cnVlKTsKICAgICAgICBoZWFkZXJJbmZvLmJsb2JTaXplID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICBoZWFkZXJJbmZvLmltYWdlVHlwZSA9IHZpZXcuZ2V0SW50MzIoMTIsIHRydWUpOwoKICAgICAgICBoZWFkZXJJbmZvLm1heFpFcnJvciA9IHZpZXcuZ2V0RmxvYXQ2NCgxNiwgdHJ1ZSk7CiAgICAgICAgaGVhZGVySW5mby56TWluID0gdmlldy5nZXRGbG9hdDY0KDI0LCB0cnVlKTsKICAgICAgICBoZWFkZXJJbmZvLnpNYXggPSB2aWV3LmdldEZsb2F0NjQoMzIsIHRydWUpOwogICAgICAgIHB0ciArPSA0MDsKICAgICAgICBkYXRhLmhlYWRlckluZm8gPSBoZWFkZXJJbmZvOwogICAgICAgIGRhdGEucHRyID0gcHRyOwoKICAgICAgICB2YXIgY2hlY2tzdW0sIGtleUxlbmd0aDsKICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAga2V5TGVuZ3RoID0gZmlsZVZlcnNpb24gPj0gNCA/IDUyIDogNDg7CiAgICAgICAgICBjaGVja3N1bSA9IHRoaXMuY29tcHV0ZUNoZWNrc3VtRmxldGNoZXIzMihuZXcgVWludDhBcnJheShpbnB1dCwgcHRyIC0ga2V5TGVuZ3RoLCBoZWFkZXJJbmZvLmJsb2JTaXplIC0gMTQpKTsKICAgICAgICAgIGlmIChjaGVja3N1bSAhPT0gaGVhZGVySW5mby5jaGVja3N1bSkgewogICAgICAgICAgICB0aHJvdyAiQ2hlY2tzdW0gZmFpbGVkLiI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LAoKICAgICAgY2hlY2tNaW5NYXhSYW5nZXM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgdmFyIGhlYWRlckluZm8gPSBkYXRhLmhlYWRlckluZm87CiAgICAgICAgdmFyIE91dFBpeGVsVHlwZUFycmF5ID0gdGhpcy5nZXREYXRhVHlwZUFycmF5KGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKICAgICAgICB2YXIgcmFuZ2VCeXRlcyA9IGhlYWRlckluZm8ubnVtRGltcyAqIHRoaXMuZ2V0RGF0YVR5cGVTaXplKGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKICAgICAgICB2YXIgbWluVmFsdWVzID0gdGhpcy5yZWFkU3ViQXJyYXkoaW5wdXQsIGRhdGEucHRyLCBPdXRQaXhlbFR5cGVBcnJheSwgcmFuZ2VCeXRlcyk7CiAgICAgICAgdmFyIG1heFZhbHVlcyA9IHRoaXMucmVhZFN1YkFycmF5KGlucHV0LCBkYXRhLnB0ciArIHJhbmdlQnl0ZXMsIE91dFBpeGVsVHlwZUFycmF5LCByYW5nZUJ5dGVzKTsKICAgICAgICBkYXRhLnB0ciArPSAoMiAqIHJhbmdlQnl0ZXMpOwogICAgICAgIHZhciBpLCBlcXVhbCA9IHRydWU7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGhlYWRlckluZm8ubnVtRGltczsgaSsrKSB7CiAgICAgICAgICBpZiAobWluVmFsdWVzW2ldICE9PSBtYXhWYWx1ZXNbaV0pIHsKICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGhlYWRlckluZm8ubWluVmFsdWVzID0gbWluVmFsdWVzOwogICAgICAgIGhlYWRlckluZm8ubWF4VmFsdWVzID0gbWF4VmFsdWVzOwogICAgICAgIHJldHVybiBlcXVhbDsKICAgICAgfSwKCiAgICAgIHJlYWRTdWJBcnJheTogZnVuY3Rpb24oaW5wdXQsIHB0ciwgT3V0UGl4ZWxUeXBlQXJyYXksIG51bUJ5dGVzKSB7CiAgICAgICAgdmFyIHJhd0RhdGE7CiAgICAgICAgaWYgKE91dFBpeGVsVHlwZUFycmF5ID09PSBVaW50OEFycmF5KSB7CiAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICB2YXIgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgcHRyLCBudW1CeXRlcykpOwogICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgfQogICAgICAgIHJldHVybiByYXdEYXRhOwogICAgICB9LAoKICAgICAgcmVhZE1hc2s6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgdmFyIHB0ciA9IGRhdGEucHRyOwogICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgIHZhciBudW1QaXhlbHMgPSBoZWFkZXJJbmZvLndpZHRoICogaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgdmFyIG51bVZhbGlkUGl4ZWwgPSBoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWw7CgogICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQpOwogICAgICAgIHZhciBtYXNrID0ge307CiAgICAgICAgbWFzay5udW1CeXRlcyA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgIHB0ciArPSA0OwoKICAgICAgICAvLyBNYXNrIERhdGEKICAgICAgICBpZiAoKDAgPT09IG51bVZhbGlkUGl4ZWwgfHwgbnVtUGl4ZWxzID09PSBudW1WYWxpZFBpeGVsKSAmJiAwICE9PSBtYXNrLm51bUJ5dGVzKSB7CiAgICAgICAgICB0aHJvdyAoImludmFsaWQgbWFzayIpOwogICAgICAgIH0KICAgICAgICB2YXIgYml0c2V0LCByZXN1bHRNYXNrOwogICAgICAgIGlmIChudW1WYWxpZFBpeGVsID09PSAwKSB7CiAgICAgICAgICBiaXRzZXQgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwobnVtUGl4ZWxzIC8gOCkpOwogICAgICAgICAgbWFzay5iaXRzZXQgPSBiaXRzZXQ7CiAgICAgICAgICByZXN1bHRNYXNrID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sgPSByZXN1bHRNYXNrOwogICAgICAgICAgcHRyICs9IG1hc2subnVtQnl0ZXM7CiAgICAgICAgfS8vID8/Pz8/IGVsc2UgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDAgJiYgZGF0YS5tYXNrLm51bUJ5dGVzPCBkYXRhLm51bVZhbGlkUGl4ZWwpIHsKICAgICAgICBlbHNlIGlmIChtYXNrLm51bUJ5dGVzID4gMCkgewogICAgICAgICAgYml0c2V0ID0gbmV3IFVpbnQ4QXJyYXkoTWF0aC5jZWlsKG51bVBpeGVscyAvIDgpKTsKICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIHB0ciwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICB2YXIgY250ID0gdmlldy5nZXRJbnQxNigwLCB0cnVlKTsKICAgICAgICAgIHZhciBpcCA9IDIsIG9wID0gMCwgdmFsID0gMDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKGNudCA+IDApIHsKICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmlldy5nZXRVaW50OChpcCsrKTsgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhbCA9IHZpZXcuZ2V0VWludDgoaXArKyk7CiAgICAgICAgICAgICAgY250ID0gLWNudDsKICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmFsOyB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY250ID0gdmlldy5nZXRJbnQxNihpcCwgdHJ1ZSk7CiAgICAgICAgICAgIGlwICs9IDI7CiAgICAgICAgICB9IHdoaWxlIChpcCA8IG1hc2subnVtQnl0ZXMpOwogICAgICAgICAgaWYgKChjbnQgIT09IC0zMjc2OCkgfHwgKG9wIDwgYml0c2V0Lmxlbmd0aCkpIHsKICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZW5kIG9mIG1hc2sgUkxFIGVuY29kaW5nIjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXN1bHRNYXNrID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgIHZhciBtYiA9IDAsIGsgPSAwOwoKICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICBpZiAoayAmIDcpIHsKICAgICAgICAgICAgICBtYiA9IGJpdHNldFtrID4+IDNdOwogICAgICAgICAgICAgIG1iIDw8PSBrICYgNzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBtYiA9IGJpdHNldFtrID4+IDNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtYiAmIDEyOCkgewogICAgICAgICAgICAgIHJlc3VsdE1hc2tba10gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRNYXNrID0gcmVzdWx0TWFzazsKCiAgICAgICAgICBtYXNrLmJpdHNldCA9IGJpdHNldDsKICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgIH0KICAgICAgICBkYXRhLnB0ciA9IHB0cjsKICAgICAgICBkYXRhLm1hc2sgPSBtYXNrOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LAoKICAgICAgcmVhZERhdGFPbmVTd2VlcDogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5LCB1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgdmFyIGhlYWRlckluZm8gPSBkYXRhLmhlYWRlckluZm87CiAgICAgICAgdmFyIG51bURpbXMgPSBoZWFkZXJJbmZvLm51bURpbXM7CiAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICB2YXIgaW1hZ2VUeXBlID0gaGVhZGVySW5mby5pbWFnZVR5cGU7CiAgICAgICAgdmFyIG51bUJ5dGVzID0gaGVhZGVySW5mby5udW1WYWxpZFBpeGVsICogTGVyYzJIZWxwZXJzLmdldERhdGFUeXBlU2l6ZShpbWFnZVR5cGUpICogbnVtRGltczsKICAgICAgICAvL2RhdGEucGl4ZWxzLm51bUJ5dGVzID0gbnVtQnl0ZXM7CiAgICAgICAgdmFyIHJhd0RhdGE7CiAgICAgICAgdmFyIG1hc2sgPSBkYXRhLnBpeGVscy5yZXN1bHRNYXNrOwogICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgcmF3RGF0YSA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBwdHIsIG51bUJ5dGVzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIobnVtQnl0ZXMpOwogICAgICAgICAgdmFyIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgIHJhd0RhdGEgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkoYXJyYXlCdWYpOwogICAgICAgIH0KICAgICAgICBpZiAocmF3RGF0YS5sZW5ndGggPT09IG51bVBpeGVscyAqIG51bURpbXMpIHsKICAgICAgICAgIGlmICh1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gTGVyYzJIZWxwZXJzLnN3YXBEaW1lbnNpb25PcmRlcihyYXdEYXRhLCBudW1QaXhlbHMsIG51bURpbXMsIE91dFBpeGVsVHlwZUFycmF5LCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSByYXdEYXRhOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlICAvL21hc2sKICAgICAgICB7CiAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogbnVtRGltcyk7CiAgICAgICAgICB2YXIgeiA9IDAsIGsgPSAwLCBpID0gMCwgblN0YXJ0ID0gMDsKICAgICAgICAgIGlmIChudW1EaW1zID4gMSkgewogICAgICAgICAgICBpZiAodXNlQlNRRm9yT3V0cHV0RGltKSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgICBuU3RhcnQgPSBrOwogICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtRGltczsgaSsrLCBuU3RhcnQrPW51bVBpeGVscykgewogICAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1tuU3RhcnRdID0gcmF3RGF0YVt6KytdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc2tba10pIHsKICAgICAgICAgICAgICAgICAgblN0YXJ0ID0gayAqIG51bURpbXM7CiAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1EaW1zOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHNbblN0YXJ0ICsgaV0gPSByYXdEYXRhW3orK107CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbnVtUGl4ZWxzOyBrKyspIHsKICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW2tdID0gcmF3RGF0YVt6KytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdHIgKz0gbnVtQnl0ZXM7CiAgICAgICAgZGF0YS5wdHIgPSBwdHI7ICAgICAgIC8vcmV0dXJuIGRhdGE7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sCgogICAgICByZWFkSHVmZm1hblRyZWU6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgdmFyIEJJVFNfTUFYID0gdGhpcy5IVUZGTUFOX0xVVF9CSVRTX01BWDsgLy84IGlzIHNsb3cgZm9yIHRoZSBsYXJnZSB0ZXN0IGltYWdlCiAgICAgICAgLy92YXIgc2l6ZV9tYXggPSAxIDw8IEJJVFNfTUFYOwogICAgICAgIC8qICoqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICogcmVhZGluZyBjb2RlIHRhYmxlCiAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDE2KTsKICAgICAgICBkYXRhLnB0ciArPSAxNjsKICAgICAgICB2YXIgdmVyc2lvbiA9IHZpZXcuZ2V0SW50MzIoMCwgdHJ1ZSk7CiAgICAgICAgaWYgKHZlcnNpb24gPCAyKSB7CiAgICAgICAgICB0aHJvdyAidW5zdXBwb3J0ZWQgSHVmZm1hbiB2ZXJzaW9uIjsKICAgICAgICB9CiAgICAgICAgdmFyIHNpemUgPSB2aWV3LmdldEludDMyKDQsIHRydWUpOwogICAgICAgIHZhciBpMCA9IHZpZXcuZ2V0SW50MzIoOCwgdHJ1ZSk7CiAgICAgICAgdmFyIGkxID0gdmlldy5nZXRJbnQzMigxMiwgdHJ1ZSk7CiAgICAgICAgaWYgKGkwID49IGkxKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoaTEgLSBpMCk7CiAgICAgICAgTGVyYzJIZWxwZXJzLmRlY29kZUJpdHMoaW5wdXQsIGRhdGEsIGJsb2NrRGF0YUJ1ZmZlcik7CiAgICAgICAgdmFyIGNvZGVUYWJsZSA9IFtdOyAvL3NpemUKICAgICAgICB2YXIgaSwgaiwgaywgbGVuOwoKICAgICAgICBmb3IgKGkgPSBpMDsgaSA8IGkxOyBpKyspIHsKICAgICAgICAgIGogPSBpIC0gKGkgPCBzaXplID8gMCA6IHNpemUpOy8vd3JhcCBhcm91bmQKICAgICAgICAgIGNvZGVUYWJsZVtqXSA9IHsgZmlyc3Q6IGJsb2NrRGF0YUJ1ZmZlcltpIC0gaTBdLCBzZWNvbmQ6IG51bGwgfTsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhQnl0ZXMgPSBpbnB1dC5ieXRlTGVuZ3RoIC0gZGF0YS5wdHI7CiAgICAgICAgdmFyIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICB2YXIgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgdmFyIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgdmFyIHN0dWZmZWREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsgLy9tdXN0IHN0YXJ0IGZyb20geCo0CiAgICAgICAgdmFyIGJpdFBvcyA9IDAsIHdvcmQsIHNyY1B0ciA9IDA7CiAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhWzBdOwogICAgICAgIGZvciAoaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICAgICAgaiA9IGkgLSAoaSA8IHNpemUgPyAwIDogc2l6ZSk7Ly93cmFwIGFyb3VuZAogICAgICAgICAgbGVuID0gY29kZVRhYmxlW2pdLmZpcnN0OwogICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgY29kZVRhYmxlW2pdLnNlY29uZCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIGxlbik7CgogICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPj0gbGVuKSB7CiAgICAgICAgICAgICAgYml0UG9zICs9IGxlbjsKICAgICAgICAgICAgICBpZiAoYml0UG9zID09PSAzMikgewogICAgICAgICAgICAgICAgYml0UG9zID0gMDsKICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGJpdFBvcyArPSBsZW4gLSAzMjsKICAgICAgICAgICAgICBzcmNQdHIrKzsKICAgICAgICAgICAgICB3b3JkID0gc3R1ZmZlZERhdGFbc3JjUHRyXTsKICAgICAgICAgICAgICBjb2RlVGFibGVbal0uc2Vjb25kIHw9IHdvcmQgPj4+ICgzMiAtIGJpdFBvcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vZmluaXNoZWQgcmVhZGluZyBjb2RlIHRhYmxlCgogICAgICAgIC8qICoqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICogYnVpbGRpbmcgbHV0CiAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICB2YXIgbnVtQml0c0xVVCA9IDAsIG51bUJpdHNMVVRRaWNrID0gMDsKICAgICAgICB2YXIgdHJlZSA9IG5ldyBUcmVlTm9kZSgpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2RlVGFibGUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChjb2RlVGFibGVbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBudW1CaXRzTFVUID0gTWF0aC5tYXgobnVtQml0c0xVVCwgY29kZVRhYmxlW2ldLmZpcnN0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG51bUJpdHNMVVQgPj0gQklUU19NQVgpIHsKICAgICAgICAgIG51bUJpdHNMVVRRaWNrID0gQklUU19NQVg7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgbnVtQml0c0xVVFFpY2sgPSBudW1CaXRzTFVUOwogICAgICAgIH0KICAgICAgICAvLyBmb3IgZGVidWdnaW5nIHB1cnBvc2UKICAgICAgICAvLyBpZiAobnVtQml0c0xVVCA+PSAzMCkgewogICAgICAgIC8vICAgY29uc29sZS5sb2coIldBUm5pbmcsIGxhcmdlIE5VTSBMVVQgQklUUyBJUyAiICsgbnVtQml0c0xVVCk7CiAgICAgICAgLy8gfQogICAgICAgIHZhciBkZWNvZGVMdXQgPSBbXSwgZW50cnksIGNvZGUsIG51bUVudHJpZXMsIGpqLCBjdXJyZW50Qml0LCBub2RlOwogICAgICAgIGZvciAoaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICAgICAgaiA9IGkgLSAoaSA8IHNpemUgPyAwIDogc2l6ZSk7Ly93cmFwIGFyb3VuZAogICAgICAgICAgbGVuID0gY29kZVRhYmxlW2pdLmZpcnN0OwogICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgZW50cnkgPSBbbGVuLCBqXTsKICAgICAgICAgICAgaWYgKGxlbiA8PSBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgIGNvZGUgPSBjb2RlVGFibGVbal0uc2Vjb25kIDw8IChudW1CaXRzTFVUUWljayAtIGxlbik7CiAgICAgICAgICAgICAgbnVtRW50cmllcyA9IDEgPDwgKG51bUJpdHNMVVRRaWNrIC0gbGVuKTsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbnVtRW50cmllczsgaysrKSB7CiAgICAgICAgICAgICAgICBkZWNvZGVMdXRbY29kZSB8IGtdID0gZW50cnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vYnVpbGQgdHJlZQogICAgICAgICAgICAgIGNvZGUgPSBjb2RlVGFibGVbal0uc2Vjb25kOwogICAgICAgICAgICAgIG5vZGUgPSB0cmVlOwogICAgICAgICAgICAgIGZvciAoamogPSBsZW4gLSAxOyBqaiA+PSAwOyBqai0tKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50Qml0ID0gY29kZSA+Pj4gamogJiAxOyAvL25vIGxlZnQgc2hpZnQgYXMgbGVuZ3RoIGNvdWxkIGJlIDMwLDMxCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEJpdCkgewogICAgICAgICAgICAgICAgICBpZiAoIW5vZGUucmlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLnJpZ2h0ID0gbmV3IFRyZWVOb2RlKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlZnQpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLmxlZnQgPSBuZXcgVHJlZU5vZGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGpqID09PSAwICYmICFub2RlLnZhbCkgewogICAgICAgICAgICAgICAgICBub2RlLnZhbCA9IGVudHJ5WzFdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgZGVjb2RlTHV0OiBkZWNvZGVMdXQsCiAgICAgICAgICBudW1CaXRzTFVUUWljazogbnVtQml0c0xVVFFpY2ssCiAgICAgICAgICBudW1CaXRzTFVUOiBudW1CaXRzTFVULAogICAgICAgICAgdHJlZTogdHJlZSwKICAgICAgICAgIHN0dWZmZWREYXRhOiBzdHVmZmVkRGF0YSwKICAgICAgICAgIHNyY1B0cjogc3JjUHRyLAogICAgICAgICAgYml0UG9zOiBiaXRQb3MKICAgICAgICB9OwogICAgICB9LAoKICAgICAgcmVhZEh1ZmZtYW46IGZ1bmN0aW9uKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSwgdXNlQlNRRm9yT3V0cHV0RGltKSB7CiAgICAgICAgdmFyIGhlYWRlckluZm8gPSBkYXRhLmhlYWRlckluZm87CiAgICAgICAgdmFyIG51bURpbXMgPSBoZWFkZXJJbmZvLm51bURpbXM7CiAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgdmFyIHdpZHRoID0gZGF0YS5oZWFkZXJJbmZvLndpZHRoOwogICAgICAgIHZhciBudW1QaXhlbHMgPSB3aWR0aCAqIGhlaWdodDsKICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgLyogKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgKiByZWFkaW5nIGh1ZmZtYW4gc3RydWN0dXJlIGluZm8KICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAgIHZhciBodWZmbWFuSW5mbyA9IHRoaXMucmVhZEh1ZmZtYW5UcmVlKGlucHV0LCBkYXRhKTsKICAgICAgICB2YXIgZGVjb2RlTHV0ID0gaHVmZm1hbkluZm8uZGVjb2RlTHV0OwogICAgICAgIHZhciB0cmVlID0gaHVmZm1hbkluZm8udHJlZTsKICAgICAgICAvL3N0dWZmZWREYXRhIGluY2x1ZGVzIGh1ZmZtYW4gaGVhZGVycwogICAgICAgIHZhciBzdHVmZmVkRGF0YSA9IGh1ZmZtYW5JbmZvLnN0dWZmZWREYXRhOwogICAgICAgIHZhciBzcmNQdHIgPSBodWZmbWFuSW5mby5zcmNQdHI7CiAgICAgICAgdmFyIGJpdFBvcyA9IGh1ZmZtYW5JbmZvLmJpdFBvczsKICAgICAgICB2YXIgbnVtQml0c0xVVFFpY2sgPSBodWZmbWFuSW5mby5udW1CaXRzTFVUUWljazsKICAgICAgICB2YXIgbnVtQml0c0xVVCA9IGh1ZmZtYW5JbmZvLm51bUJpdHNMVVQ7CiAgICAgICAgdmFyIG9mZnNldCA9IGRhdGEuaGVhZGVySW5mby5pbWFnZVR5cGUgPT09IDAgPyAxMjggOiAwOwogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgZGVjb2RlCiAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAgIHZhciBub2RlLCB2YWwsIGRlbHRhLCBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzaywgdmFsVG1wLCB2YWxUbXBRdWljaywgY3VycmVudEJpdDsKICAgICAgICB2YXIgaSwgaiwgaywgaWk7CiAgICAgICAgdmFyIHByZXZWYWwgPSAwOwogICAgICAgIGlmIChiaXRQb3MgPiAwKSB7CiAgICAgICAgICBzcmNQdHIrKzsKICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgfQogICAgICAgIHZhciB3b3JkID0gc3R1ZmZlZERhdGFbc3JjUHRyXTsKICAgICAgICB2YXIgZGVsdGFFbmNvZGUgPSBkYXRhLmVuY29kZU1vZGUgPT09IDE7CiAgICAgICAgdmFyIHJlc3VsdFBpeGVsc0FsbERpbSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShudW1QaXhlbHMgKiBudW1EaW1zKTsKICAgICAgICB2YXIgcmVzdWx0UGl4ZWxzID0gcmVzdWx0UGl4ZWxzQWxsRGltOwogICAgICAgIHZhciBpRGltOwogICAgICAgIC8vIFRPRE86IHJlZXZhbHVhdGUgdGhlIG5lZWQgdG8ga2VlcCBpbmxpbmVkIGRlY29kaW5nIGNvZGUgYXMgSUUgc3VwcG9ydCBpcyBwaGFzaW5nIG91dAogICAgICAgIGlmIChudW1EaW1zIDwgMiB8fCBkZWx0YUVuY29kZSkgewogICAgICAgICAgZm9yIChpRGltID0gMDsgaURpbSA8IG51bURpbXM7IGlEaW0rKykgewogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAvL2dldCB0aGUgbWVtIGJsb2NrIG9mIGN1cnJlbnQgZGltZW5zaW9uCiAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KHJlc3VsdFBpeGVsc0FsbERpbS5idWZmZXIsIG51bVBpeGVscyAqIGlEaW0sIG51bVBpeGVscyk7CiAgICAgICAgICAgICAgcHJldlZhbCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEuaGVhZGVySW5mby5udW1WYWxpZFBpeGVsID09PSB3aWR0aCAqIGhlaWdodCkgeyAvL2FsbCB2YWxpZAogICAgICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrLCBrKyspIHsKICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgdmFsVG1wID0gKHdvcmQgPDwgYml0UG9zKSA+Pj4gKDMyIC0gbnVtQml0c0xVVFFpY2spOwogICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVFFpY2spKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZWNvZGVMdXRbdmFsVG1wUXVpY2tdKSAgICAvLyBpZiB0aGVyZSwgbW92ZSB0aGUgY29ycmVjdCBudW1iZXIgb2YgYml0cyBhbmQgZG9uZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgKz0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVswXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVCkpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHRyZWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbnVtQml0c0xVVDsgaWkrKykgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50Qml0ID8gbm9kZS5yaWdodCA6IG5vZGUubGVmdDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5vZGUubGVmdCB8fCBub2RlLnJpZ2h0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgYml0UG9zID0gYml0UG9zICsgaWkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICBpZiAoYml0UG9zID49IDMyKSB7CiAgICAgICAgICAgICAgICAgICAgYml0UG9zIC09IDMyOwogICAgICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgICAgIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgZGVsdGEgPSB2YWwgLSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgIGlmIChkZWx0YUVuY29kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChqID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsgICAgLy8gdXNlIG92ZXJmbG93CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSByZXN1bHRQaXhlbHNbayAtIHdpZHRoXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkZWx0YSAmPSAweEZGOyAvL292ZXJmbG93CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW2tdID0gZGVsdGE7Ly9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIHByZXZWYWwgPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsgLy9ub3QgYWxsIHZhbGlkLCB1c2UgbWFzawogICAgICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrLCBrKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG1hc2tba10pIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSAwOwogICAgICAgICAgICAgICAgICAgIHZhbFRtcCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIG51bUJpdHNMVVRRaWNrKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVRRaWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWxUbXAgfD0gKChzdHVmZmVkRGF0YVtzcmNQdHIgKyAxXSkgPj4+ICg2NCAtIGJpdFBvcyAtIG51bUJpdHNMVVRRaWNrKSk7CiAgICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXSkgICAgLy8gaWYgdGhlcmUsIG1vdmUgdGhlIGNvcnJlY3QgbnVtYmVyIG9mIGJpdHMgYW5kIGRvbmUKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBkZWNvZGVMdXRbdmFsVG1wUXVpY2tdWzFdOwogICAgICAgICAgICAgICAgICAgICAgYml0UG9zICs9IGRlY29kZUx1dFt2YWxUbXBRdWlja11bMF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wID0gKHdvcmQgPDwgYml0UG9zKSA+Pj4gKDMyIC0gbnVtQml0c0xVVCk7CiAgICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgICAgaWYgKDMyIC0gYml0UG9zIDwgbnVtQml0c0xVVCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWxUbXAgfD0gKChzdHVmZmVkRGF0YVtzcmNQdHIgKyAxXSkgPj4+ICg2NCAtIGJpdFBvcyAtIG51bUJpdHNMVVQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSB0cmVlOwogICAgICAgICAgICAgICAgICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbnVtQml0c0xVVDsgaWkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Qml0ID0gdmFsVG1wID4+PiAobnVtQml0c0xVVCAtIGlpIC0gMSkgJiAxOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gY3VycmVudEJpdCA/IG5vZGUucmlnaHQgOiBub2RlLmxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5vZGUubGVmdCB8fCBub2RlLnJpZ2h0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IG5vZGUudmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyA9IGJpdFBvcyArIGlpICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyAtPSAzMjsKICAgICAgICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgZGVsdGEgPSB2YWwgLSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbHRhRW5jb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDAgJiYgbWFza1trIC0gMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsgICAgLy8gdXNlIG92ZXJmbG93CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gMCAmJiBtYXNrW2sgLSB3aWR0aF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcmVzdWx0UGl4ZWxzW2sgLSB3aWR0aF07CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgJj0gMHhGRjsgLy9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW2tdID0gZGVsdGE7Ly9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgICAgcHJldlZhbCA9IGRlbHRhOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgICBrID0gaSAqIHdpZHRoICsgajsKICAgICAgICAgICAgICBpZiAoIW1hc2sgfHwgbWFza1trXSkgewogICAgICAgICAgICAgICAgZm9yIChpRGltID0gMDsgaURpbSA8IG51bURpbXM7IGlEaW0rKywgays9bnVtUGl4ZWxzKSB7CiAgICAgICAgICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgICAgICAgICAgIHZhbFRtcCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIG51bUJpdHNMVVRRaWNrKTsKICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7CiAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVRRaWNrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUUWljaykpOwogICAgICAgICAgICAgICAgICAgIHZhbFRtcFF1aWNrID0gdmFsVG1wOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZWNvZGVMdXRbdmFsVG1wUXVpY2tdKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgKz0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVswXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsKICAgICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWxUbXAgfD0gKChzdHVmZmVkRGF0YVtzcmNQdHIgKyAxXSkgPj4+ICg2NCAtIGJpdFBvcyAtIG51bUJpdHNMVVQpKTsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcFF1aWNrID0gdmFsVG1wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGlpID0gMDsgaWkgPCBudW1CaXRzTFVUOyBpaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Qml0ID0gdmFsVG1wID4+PiAobnVtQml0c0xVVCAtIGlpIC0gMSkgJiAxOwogICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGN1cnJlbnRCaXQgPyBub2RlLnJpZ2h0IDogbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgaWYgKCEobm9kZS5sZWZ0IHx8IG5vZGUucmlnaHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IG5vZGUudmFsOwogICAgICAgICAgICAgICAgICAgICAgICBiaXRQb3MgPSBiaXRQb3MgKyBpaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGJpdFBvcyA+PSAzMikgewogICAgICAgICAgICAgICAgICAgIGJpdFBvcyAtPSAzMjsKICAgICAgICAgICAgICAgICAgICBzcmNQdHIrKzsKICAgICAgICAgICAgICAgICAgICB3b3JkID0gc3R1ZmZlZERhdGFbc3JjUHRyXTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGVsdGEgPSB2YWwgLSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLnB0ciA9IGRhdGEucHRyICsgKHNyY1B0ciArIDEpICogNCArIChiaXRQb3MgPiAwID8gNCA6IDApOwogICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscyA9IHJlc3VsdFBpeGVsc0FsbERpbTsKICAgICAgICAvL3N3YXAgZm9yIEJJUCBsYXlvdXQKICAgICAgICBpZiAobnVtRGltcyA+IDEgJiYgIXVzZUJTUUZvck91dHB1dERpbSkgewogICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gTGVyYzJIZWxwZXJzLnN3YXBEaW1lbnNpb25PcmRlcihyZXN1bHRQaXhlbHNBbGxEaW0sIG51bVBpeGVscywgbnVtRGltcywgT3V0UGl4ZWxUeXBlQXJyYXkpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGRlY29kZUJpdHM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhLCBibG9ja0RhdGFCdWZmZXIsIG9mZnNldCwgaURpbSkgewogICAgICAgIHsKICAgICAgICAgIC8vYml0c3R1ZmYgZW5jb2RpbmcgaXMgMwogICAgICAgICAgdmFyIGhlYWRlckluZm8gPSBkYXRhLmhlYWRlckluZm87CiAgICAgICAgICB2YXIgZmlsZVZlcnNpb24gPSBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uOwogICAgICAgICAgLy92YXIgYmxvY2sgPSB7fTsKICAgICAgICAgIHZhciBibG9ja1B0ciA9IDA7CiAgICAgICAgICB2YXIgdmlld0J5dGVMZW5ndGggPSAoKGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cikgPj0gNSkgPyA1IDogKGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cik7CiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIHZpZXdCeXRlTGVuZ3RoKTsKICAgICAgICAgIHZhciBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OCgwKTsKICAgICAgICAgIGJsb2NrUHRyKys7CiAgICAgICAgICB2YXIgYml0czY3ID0gaGVhZGVyQnl0ZSA+PiA2OwogICAgICAgICAgdmFyIG4gPSAoYml0czY3ID09PSAwKSA/IDQgOiAzIC0gYml0czY3OwogICAgICAgICAgdmFyIGRvTHV0ID0gKGhlYWRlckJ5dGUgJiAzMikgPiAwID8gdHJ1ZSA6IGZhbHNlOy8vNXRoIGJpdAogICAgICAgICAgdmFyIG51bUJpdHMgPSBoZWFkZXJCeXRlICYgMzE7CiAgICAgICAgICB2YXIgbnVtRWxlbWVudHMgPSAwOwogICAgICAgICAgaWYgKG4gPT09IDEpIHsKICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQ4KGJsb2NrUHRyKTsgYmxvY2tQdHIrKzsKICAgICAgICAgIH0gZWxzZSBpZiAobiA9PT0gMikgewogICAgICAgICAgICBudW1FbGVtZW50cyA9IHZpZXcuZ2V0VWludDE2KGJsb2NrUHRyLCB0cnVlKTsgYmxvY2tQdHIgKz0gMjsKICAgICAgICAgIH0gZWxzZSBpZiAobiA9PT0gNCkgewogICAgICAgICAgICBudW1FbGVtZW50cyA9IHZpZXcuZ2V0VWludDMyKGJsb2NrUHRyLCB0cnVlKTsgYmxvY2tQdHIgKz0gNDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93ICJJbnZhbGlkIHZhbGlkIHBpeGVsIGNvdW50IHR5cGUiOwogICAgICAgICAgfQogICAgICAgICAgLy9maXg6IGh1ZmZtYW4gY29kZXMgYXJlIGJpdCBzdHVmZmVkLCBidXQgbm90IGJvdW5kIGJ5IGRhdGEncyBtYXggdmFsdWUsIHNvIG5lZWQgdG8gdXNlIG9yaWdpbmFsVW5zdHVmZgogICAgICAgICAgLy9vZmZzZXQgPSBvZmZzZXQgfHwgMDsKICAgICAgICAgIHZhciBzY2FsZSA9IDIgKiBoZWFkZXJJbmZvLm1heFpFcnJvcjsKICAgICAgICAgIHZhciBzdHVmZmVkRGF0YSwgYXJyYXlCdWYsIHN0b3JlOCwgZGF0YUJ5dGVzLCBkYXRhV29yZHM7CiAgICAgICAgICB2YXIgbHV0QXJyLCBsdXREYXRhLCBsdXRCeXRlcywgYml0c1BlclBpeGVsOwogICAgICAgICAgdmFyIHpNYXggPSBoZWFkZXJJbmZvLm51bURpbXMgPiAxID8gaGVhZGVySW5mby5tYXhWYWx1ZXNbaURpbV0gOiBoZWFkZXJJbmZvLnpNYXg7CiAgICAgICAgICBpZiAoZG9MdXQpIHsKICAgICAgICAgICAgZGF0YS5jb3VudGVyLmx1dCsrOwogICAgICAgICAgICBsdXRCeXRlcyA9IHZpZXcuZ2V0VWludDgoYmxvY2tQdHIpOwogICAgICAgICAgICBibG9ja1B0cisrOwogICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoKGx1dEJ5dGVzIC0gMSkgKiBudW1CaXRzIC8gOCk7CiAgICAgICAgICAgIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKCiAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CgogICAgICAgICAgICBsdXREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwoKICAgICAgICAgICAgYml0c1BlclBpeGVsID0gMDsKICAgICAgICAgICAgd2hpbGUgKChsdXRCeXRlcyAtIDEpID4+PiBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICBiaXRzUGVyUGl4ZWwrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwobnVtRWxlbWVudHMgKiBiaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihkYXRhV29yZHMgKiA0KTsKICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgIHN0dWZmZWREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwogICAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICAgIGx1dEFyciA9IEJpdFN0dWZmZXIudW5zdHVmZkxVVDIobHV0RGF0YSwgbnVtQml0cywgbHV0Qnl0ZXMgLSAxLCBvZmZzZXQsIHNjYWxlLCB6TWF4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBsdXRBcnIgPSBCaXRTdHVmZmVyLnVuc3R1ZmZMVVQobHV0RGF0YSwgbnVtQml0cywgbHV0Qnl0ZXMgLSAxLCBvZmZzZXQsIHNjYWxlLCB6TWF4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2x1dEFyci51bnNoaWZ0KDApOwogICAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICAgIC8vQml0U3R1ZmZlci51bnN0dWZmMihibG9jaywgYmxvY2tEYXRhQnVmZmVyLCBoZWFkZXJJbmZvLnpNYXgpOwogICAgICAgICAgICAgIEJpdFN0dWZmZXIudW5zdHVmZjIoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgbHV0QXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBCaXRTdHVmZmVyLnVuc3R1ZmYoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgbHV0QXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vY29uc29sZS5kZWJ1ZygiYml0c3R1ZmZlciIpOwogICAgICAgICAgICBkYXRhLmNvdW50ZXIuYml0c3R1ZmZlcisrOwogICAgICAgICAgICBiaXRzUGVyUGl4ZWwgPSBudW1CaXRzOwogICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgaWYgKGJpdHNQZXJQaXhlbCA+IDApIHsKICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwobnVtRWxlbWVudHMgKiBiaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICBkYXRhV29yZHMgPSBNYXRoLmNlaWwoZGF0YUJ5dGVzIC8gNCk7CiAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIGRhdGEucHRyLCBkYXRhQnl0ZXMpKTsKICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwogICAgICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgQml0U3R1ZmZlci5vcmlnaW5hbFVuc3R1ZmYyKHN0dWZmZWREYXRhLCBibG9ja0RhdGFCdWZmZXIsIGJpdHNQZXJQaXhlbCwgbnVtRWxlbWVudHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIEJpdFN0dWZmZXIudW5zdHVmZjIoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgZmFsc2UsIG9mZnNldCwgc2NhbGUsIHpNYXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLnVuc3R1ZmYoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgZmFsc2UsIG9mZnNldCwgc2NhbGUsIHpNYXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgIH0sCgogICAgICByZWFkVGlsZXM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSwgdXNlQlNRRm9yT3V0cHV0RGltKSB7CiAgICAgICAgdmFyIGhlYWRlckluZm8gPSBkYXRhLmhlYWRlckluZm87CiAgICAgICAgdmFyIHdpZHRoID0gaGVhZGVySW5mby53aWR0aDsKICAgICAgICB2YXIgaGVpZ2h0ID0gaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgdmFyIG51bVBpeGVscyA9IHdpZHRoICogaGVpZ2h0OwogICAgICAgIHZhciBtaWNyb0Jsb2NrU2l6ZSA9IGhlYWRlckluZm8ubWljcm9CbG9ja1NpemU7CiAgICAgICAgdmFyIGltYWdlVHlwZSA9IGhlYWRlckluZm8uaW1hZ2VUeXBlOwogICAgICAgIHZhciBkYXRhVHlwZVNpemUgPSBMZXJjMkhlbHBlcnMuZ2V0RGF0YVR5cGVTaXplKGltYWdlVHlwZSk7CiAgICAgICAgdmFyIG51bUJsb2Nrc1ggPSBNYXRoLmNlaWwod2lkdGggLyBtaWNyb0Jsb2NrU2l6ZSk7CiAgICAgICAgdmFyIG51bUJsb2Nrc1kgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1kgPSBudW1CbG9ja3NZOwogICAgICAgIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ggPSBudW1CbG9ja3NYOwogICAgICAgIGRhdGEucGl4ZWxzLnB0ciA9IDA7CiAgICAgICAgdmFyIHJvdyA9IDAsIGNvbCA9IDAsIGJsb2NrWSA9IDAsIGJsb2NrWCA9IDAsIHRoaXNCbG9ja0hlaWdodCA9IDAsIHRoaXNCbG9ja1dpZHRoID0gMCwgYnl0ZXNMZWZ0ID0gMCwgaGVhZGVyQnl0ZSA9IDAsIGJpdHM2NyA9IDAsIHRlc3RDb2RlID0gMCwgb3V0UHRyID0gMCwgb3V0U3RyaWRlID0gMCwgbnVtQnl0ZXMgPSAwLCBieXRlc2xlZnQgPSAwLCB6ID0gMCwgYmxvY2tQdHIgPSAwOwogICAgICAgIHZhciB2aWV3LCBibG9jaywgYXJyYXlCdWYsIHN0b3JlOCwgcmF3RGF0YTsKICAgICAgICB2YXIgYmxvY2tFbmNvZGluZzsKICAgICAgICB2YXIgYmxvY2tEYXRhQnVmZmVyID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KG1pY3JvQmxvY2tTaXplICogbWljcm9CbG9ja1NpemUpOwogICAgICAgIHZhciBsYXN0QmxvY2tIZWlnaHQgPSAoaGVpZ2h0ICUgbWljcm9CbG9ja1NpemUpIHx8IG1pY3JvQmxvY2tTaXplOwogICAgICAgIHZhciBsYXN0QmxvY2tXaWR0aCA9ICh3aWR0aCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICB2YXIgb2Zmc2V0VHlwZSwgb2Zmc2V0OwogICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zLCBpRGltOwogICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICB2YXIgcmVzdWx0UGl4ZWxzID0gZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzOwogICAgICAgIHZhciBmaWxlVmVyc2lvbiA9IGhlYWRlckluZm8uZmlsZVZlcnNpb247CiAgICAgICAgdmFyIGZpbGVWZXJzaW9uQ2hlY2tOdW0gPSBmaWxlVmVyc2lvbiA+PSA1ID8gMTQgOiAxNTsKICAgICAgICB2YXIgaXNEaWZmRW5jb2Rpbmc7CiAgICAgICAgdmFyIHpNYXggPSBoZWFkZXJJbmZvLnpNYXg7CiAgICAgICAgLy92YXIgcmVzdWx0UGl4ZWxzQWxsRGltID0gcmVzdWx0UGl4ZWxzOwogICAgICAgIHZhciByZXN1bHRQaXhlbHNQcmV2RGltOwogICAgICAgIGZvciAoYmxvY2tZID0gMDsgYmxvY2tZIDwgbnVtQmxvY2tzWTsgYmxvY2tZKyspIHsKICAgICAgICAgIHRoaXNCbG9ja0hlaWdodCA9IChibG9ja1kgIT09IG51bUJsb2Nrc1kgLSAxKSA/IG1pY3JvQmxvY2tTaXplIDogbGFzdEJsb2NrSGVpZ2h0OwogICAgICAgICAgZm9yIChibG9ja1ggPSAwOyBibG9ja1ggPCBudW1CbG9ja3NYOyBibG9ja1grKykgewogICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoInkiICsgYmxvY2tZICsgIiB4IiArIGJsb2NrWCk7CiAgICAgICAgICAgIHRoaXNCbG9ja1dpZHRoID0gKGJsb2NrWCAhPT0gbnVtQmxvY2tzWCAtIDEpID8gbWljcm9CbG9ja1NpemUgOiBsYXN0QmxvY2tXaWR0aDsKCiAgICAgICAgICAgIG91dFB0ciA9IGJsb2NrWSAqIHdpZHRoICogbWljcm9CbG9ja1NpemUgKyBibG9ja1ggKiBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgICAgb3V0U3RyaWRlID0gd2lkdGggLSB0aGlzQmxvY2tXaWR0aDsKCiAgICAgICAgICAgIGZvciAoaURpbSA9IDA7IGlEaW0gPCBudW1EaW1zOyBpRGltKyspIHsKICAgICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1ByZXZEaW0gPSByZXN1bHRQaXhlbHM7CiAgICAgICAgICAgICAgICBvdXRQdHIgPSBibG9ja1kgKiB3aWR0aCAqIG1pY3JvQmxvY2tTaXplICsgYmxvY2tYICogbWljcm9CbG9ja1NpemU7CiAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkoZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzLmJ1ZmZlciwgbnVtUGl4ZWxzICogaURpbSAqIGRhdGFUeXBlU2l6ZSwgbnVtUGl4ZWxzKTsKICAgICAgICAgICAgICAgIHpNYXggPSBoZWFkZXJJbmZvLm1heFZhbHVlc1tpRGltXTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzUHJldkRpbSA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJ5dGVzTGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cjsKICAgICAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBkYXRhLnB0ciwgTWF0aC5taW4oMTAsIGJ5dGVzTGVmdCkpOwogICAgICAgICAgICAgIGJsb2NrID0ge307CiAgICAgICAgICAgICAgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICAgIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICAgIGJsb2NrUHRyKys7CiAgICAgICAgICAgICAgaXNEaWZmRW5jb2RpbmcgPSBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uID49IDUgPyBoZWFkZXJCeXRlICYgNCA6IDA7CiAgICAgICAgICAgICAgYml0czY3ID0gKGhlYWRlckJ5dGUgPj4gNikgJiAweEZGOwogICAgICAgICAgICAgIHRlc3RDb2RlID0gKGhlYWRlckJ5dGUgPj4gMikgJiBmaWxlVmVyc2lvbkNoZWNrTnVtOyAgICAvLyB1c2UgYml0cyAyMzQ1IGZvciBpbnRlZ3JpdHkgY2hlY2sKICAgICAgICAgICAgICBpZiAodGVzdENvZGUgIT09ICgoKGJsb2NrWCAqIG1pY3JvQmxvY2tTaXplKSA+PiAzKSAmIGZpbGVWZXJzaW9uQ2hlY2tOdW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiaW50ZWdyaXR5IGlzc3VlIjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpc0RpZmZFbmNvZGluZyAmJiBpRGltID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiaW50ZWdyaXR5IGlzc3VlIjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJsb2NrRW5jb2RpbmcgPSBoZWFkZXJCeXRlICYgMzsKICAgICAgICAgICAgICBpZiAoYmxvY2tFbmNvZGluZyA+IDMpIHsKICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9ja0VuY29kaW5nICsgIikiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmIChibG9ja0VuY29kaW5nID09PSAyKSB7IC8vY29uc3RhbnQgMAogICAgICAgICAgICAgICAgaWYgKGlzRGlmZkVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChyb3cgPSAwOyByb3cgPCB0aGlzQmxvY2tIZWlnaHQ7IHJvdysrKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFza1tvdXRQdHJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cl0gPSByZXN1bHRQaXhlbHNQcmV2RGltW291dFB0cl07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyKys7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cl0gPSByZXN1bHRQaXhlbHNQcmV2RGltW291dFB0cl07CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50Kys7CiAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmIChibG9ja0VuY29kaW5nID09PSAwKSB7ICAvL3VuY29tcHJlc3NlZAogICAgICAgICAgICAgICAgaWYgKGlzRGlmZkVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbWFrZSBzZW5zZSwgc2hvdWxkIG5vdCBoYXBwZW4KICAgICAgICAgICAgICAgICAgdGhyb3cgImludGVncml0eSBpc3N1ZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhLmNvdW50ZXIudW5jb21wcmVzc2VkKys7CiAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgIG51bUJ5dGVzID0gdGhpc0Jsb2NrSGVpZ2h0ICogdGhpc0Jsb2NrV2lkdGggKiBkYXRhVHlwZVNpemU7CiAgICAgICAgICAgICAgICBieXRlc2xlZnQgPSBpbnB1dC5ieXRlTGVuZ3RoIC0gZGF0YS5wdHI7CiAgICAgICAgICAgICAgICBudW1CeXRlcyA9IG51bUJ5dGVzIDwgYnl0ZXNsZWZ0ID8gbnVtQnl0ZXMgOiBieXRlc2xlZnQ7CiAgICAgICAgICAgICAgICAvL2JpdCBhbGlnbm1lbnQKICAgICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKChudW1CeXRlcyAlIGRhdGFUeXBlU2l6ZSkgPT09IDAgPyBudW1CeXRlcyA6IChudW1CeXRlcyArIGRhdGFUeXBlU2l6ZSAtIG51bUJ5dGVzICUgZGF0YVR5cGVTaXplKSk7CiAgICAgICAgICAgICAgICBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgICAgIHJhd0RhdGEgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgICAgeiA9IDA7CiAgICAgICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tbb3V0UHRyXSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsvL2FsbCB2YWxpZAogICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0geiAqIGRhdGFUeXBlU2l6ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7IC8vMSBvciAzCiAgICAgICAgICAgICAgICBvZmZzZXRUeXBlID0gTGVyYzJIZWxwZXJzLmdldERhdGFUeXBlVXNlZCgoaXNEaWZmRW5jb2RpbmcgJiYgaW1hZ2VUeXBlIDwgNikgPyA0IDogaW1hZ2VUeXBlLCBiaXRzNjcpOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gTGVyYzJIZWxwZXJzLmdldE9uZVBpeGVsKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldyk7CiAgICAgICAgICAgICAgICBibG9ja1B0ciArPSBMZXJjMkhlbHBlcnMuZ2V0RGF0YVR5cGVTaXplKG9mZnNldFR5cGUpOwogICAgICAgICAgICAgICAgaWYgKGJsb2NrRW5jb2RpbmcgPT09IDMpIC8vY29uc3RhbnQgb2Zmc2V0IHZhbHVlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICBkYXRhLmNvdW50ZXIuY29uc3RhbnRvZmZzZXQrKzsKICAgICAgICAgICAgICAgICAgLy95b3UgY2FuIGRlbGV0ZSB0aGUgZm9sbG93aW5nIHJlc3VsdE1hc2sgY2FzZSBpbiBmYXZvciBvZiBwZXJmb3JtYW5jZSBiZWNhdXNlIHZhbCBpcyBjb25zdGFudCBhbmQgdXNlcnMgdXNlIG5vZGF0YSBtYXNrLCBvdGhlcndpc2Ugbm9kYXRhdmFsdWUgcG9zdCBwcm9jZXNzaW5nIGhhbmRsZXMgaXQgdG9vLgogICAgICAgICAgICAgICAgICAvL3doaWxlIHRoZSBhYm92ZSBzdGF0ZW1lbnQgaXMgdHJ1ZSwgd2UncmUgbm90IGRvaW5nIGl0IGFzIHdlIHdhbnQgdG8ga2VlcCBpbnZhbGlkIHBpeGVsIHZhbHVlIGF0IDAgcmF0aGVyIHRoYW4gYXJiaXRyYXJ5IHZhbHVlcwogICAgICAgICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tbb3V0UHRyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gaXNEaWZmRW5jb2RpbmcgPyBNYXRoLm1pbih6TWF4LCByZXN1bHRQaXhlbHNQcmV2RGltW291dFB0cl0gKyBvZmZzZXQpIDogb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChyb3cgPSAwOyByb3cgPCB0aGlzQmxvY2tIZWlnaHQ7IHJvdysrKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IGlzRGlmZkVuY29kaW5nID8gTWF0aC5taW4oek1heCwgcmVzdWx0UGl4ZWxzUHJldkRpbVtvdXRQdHJdICsgb2Zmc2V0KSA6IG9mZnNldDsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyKys7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vYml0c3R1ZmYgZW5jb2RpbmcgaXMgMwogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgICAgLy9oZWF2eSBsaWZ0aW5nCiAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5kZWNvZGVCaXRzKGlucHV0LCBkYXRhLCBibG9ja0RhdGFCdWZmZXIsIG9mZnNldCwgaURpbSk7CiAgICAgICAgICAgICAgICAgIGJsb2NrUHRyID0gMDsKICAgICAgICAgICAgICAgICAgLy8gZHVwbGljYXRlIGNvZGUgdG8gZmF2b3IgcGVyZm9ybWFuY2UsIGRpZmYgZW5jb2RpbmcgaXMgZm9yIG11bHRpZGltZW5zaW9uIG9ubHkKICAgICAgICAgICAgICAgICAgaWYgKGlzRGlmZkVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2spIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXNrW291dFB0cl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gYmxvY2tEYXRhQnVmZmVyW2Jsb2NrUHRyKytdICsgcmVzdWx0UGl4ZWxzUHJldkRpbVtvdXRQdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gYmxvY2tEYXRhQnVmZmVyW2Jsb2NrUHRyKytdICsgcmVzdWx0UGl4ZWxzUHJldkRpbVtvdXRQdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hc2spIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29sID0gMDsgY29sIDwgdGhpc0Jsb2NrV2lkdGg7IGNvbCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXNrW291dFB0cl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IGJsb2NrRGF0YUJ1ZmZlcltibG9ja1B0cisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIrKzsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IGJsb2NrRGF0YUJ1ZmZlcltibG9ja1B0cisrXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vc3dhcCBmb3IgQklQOiBpdCdzIGFsd2F5cyBlYXNpZXIgZm9yIGNsaWVudHMgdG8gaGFuZGxlIEJTUSBzbyB3ZSBrZWVwIGV4aXN0aW5nIGxvZ2ljIGFuZCBpbnRyb2R1Y2UgYSBzd2FwIGhlcmUgdG8gbWluaW16ZSBjaGFuZ2VzCiAgICAgICAgaWYgKG51bURpbXMgPiAxICYmICF1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscyA9IExlcmMySGVscGVycy5zd2FwRGltZW5zaW9uT3JkZXIoZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzLCBudW1QaXhlbHMsIG51bURpbXMsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioqKioqKioqKioqKioqKioKICAgICAgKiAgcHJpdmF0ZSBtZXRob2RzIChoZWxwZXIgbWV0aG9kcykKICAgICAgKioqKioqKioqKioqKioqKiovCgogICAgICBmb3JtYXRGaWxlSW5mbzogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiZmlsZUlkZW50aWZpZXJTdHJpbmciOiBkYXRhLmhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcsCiAgICAgICAgICAiZmlsZVZlcnNpb24iOiBkYXRhLmhlYWRlckluZm8uZmlsZVZlcnNpb24sCiAgICAgICAgICAiaW1hZ2VUeXBlIjogZGF0YS5oZWFkZXJJbmZvLmltYWdlVHlwZSwKICAgICAgICAgICJoZWlnaHQiOiBkYXRhLmhlYWRlckluZm8uaGVpZ2h0LAogICAgICAgICAgIndpZHRoIjogZGF0YS5oZWFkZXJJbmZvLndpZHRoLAogICAgICAgICAgIm51bVZhbGlkUGl4ZWwiOiBkYXRhLmhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCwKICAgICAgICAgICJtaWNyb0Jsb2NrU2l6ZSI6IGRhdGEuaGVhZGVySW5mby5taWNyb0Jsb2NrU2l6ZSwKICAgICAgICAgICJibG9iU2l6ZSI6IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSwKICAgICAgICAgICJtYXhaRXJyb3IiOiBkYXRhLmhlYWRlckluZm8ubWF4WkVycm9yLAogICAgICAgICAgInBpeGVsVHlwZSI6IExlcmMySGVscGVycy5nZXRQaXhlbFR5cGUoZGF0YS5oZWFkZXJJbmZvLmltYWdlVHlwZSksCiAgICAgICAgICAiZW9mT2Zmc2V0IjogZGF0YS5lb2ZPZmZzZXQsCiAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgIm51bUJ5dGVzIjogZGF0YS5tYXNrLm51bUJ5dGVzCiAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICJwaXhlbHMiOiB7CiAgICAgICAgICAgICJudW1CbG9ja3NYIjogZGF0YS5waXhlbHMubnVtQmxvY2tzWCwKICAgICAgICAgICAgIm51bUJsb2Nrc1kiOiBkYXRhLnBpeGVscy5udW1CbG9ja3NZLAogICAgICAgICAgICAvLyJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLmhlYWRlckluZm8uek1heCwKICAgICAgICAgICAgIm1pblZhbHVlIjogZGF0YS5oZWFkZXJJbmZvLnpNaW4sCiAgICAgICAgICAgICJub0RhdGFWYWx1ZSI6IGRhdGEubm9EYXRhVmFsdWUKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9LAoKICAgICAgY29uc3RydWN0Q29uc3RhbnRTdXJmYWNlOiBmdW5jdGlvbihkYXRhLCB1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICB2YXIgdmFsID0gZGF0YS5oZWFkZXJJbmZvLnpNYXg7CiAgICAgICAgdmFyIHZhbE1pbiA9IGRhdGEuaGVhZGVySW5mby56TWluOwogICAgICAgIHZhciBtYXhWYWx1ZXMgPSBkYXRhLmhlYWRlckluZm8ubWF4VmFsdWVzOwogICAgICAgIHZhciBudW1EaW1zID0gZGF0YS5oZWFkZXJJbmZvLm51bURpbXM7CiAgICAgICAgdmFyIG51bVBpeGVscyA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQgKiBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgdmFyIGkgPSAwLCBrID0gMCwgblN0YXJ0ID0gMDsKICAgICAgICB2YXIgbWFzayA9IGRhdGEucGl4ZWxzLnJlc3VsdE1hc2s7CiAgICAgICAgdmFyIHJlc3VsdFBpeGVscyA9IGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsczsKICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgaWYgKG51bURpbXMgPiAxKSB7CiAgICAgICAgICAgIGlmICh1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtRGltczsgaSsrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBpICogbnVtUGl4ZWxzOwogICAgICAgICAgICAgICAgdmFsID0gbWF4VmFsdWVzW2ldOwogICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW25TdGFydCArIGtdID0gdmFsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgICBuU3RhcnQgPSBrICogbnVtRGltczsKICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bURpbXM7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tuU3RhcnQgKyBudW1EaW1zXSA9IG1heFZhbHVlc1tpXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKG51bURpbXMgPiAxICYmIHZhbE1pbiAhPT0gdmFsKSB7CiAgICAgICAgICAgIGlmICh1c2VCU1FGb3JPdXRwdXREaW0pIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtRGltczsgaSsrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBpICogbnVtUGl4ZWxzOwogICAgICAgICAgICAgICAgdmFsID0gbWF4VmFsdWVzW2ldOwogICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tuU3RhcnQgKyBrXSA9IHZhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBrICogbnVtRGltczsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1EaW1zOyBpKyspIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW25TdGFydCArIGldID0gbWF4VmFsdWVzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHMgKiBudW1EaW1zOyBrKyspIHsKICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSB2YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9LAoKICAgICAgZ2V0RGF0YVR5cGVBcnJheTogZnVuY3Rpb24odCkgewogICAgICAgIHZhciB0cDsKICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgIHRwID0gSW50OEFycmF5OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgIHRwID0gVWludDhBcnJheTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgdHAgPSBJbnQxNkFycmF5OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzogLy91c2hvcnQKICAgICAgICAgICAgdHAgPSBVaW50MTZBcnJheTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHRwID0gSW50MzJBcnJheTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHRwID0gVWludDMyQXJyYXk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICB0cCA9IEZsb2F0MzJBcnJheTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIHRwID0gRmxvYXQ2NEFycmF5OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRwID0gRmxvYXQzMkFycmF5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHA7CiAgICAgIH0sCgogICAgICBnZXRQaXhlbFR5cGU6IGZ1bmN0aW9uKHQpIHsKICAgICAgICB2YXIgdHA7CiAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICBjYXNlIDA6IC8vY2hhcgogICAgICAgICAgICB0cCA9ICJTOCI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOiAvL2J5dGUKICAgICAgICAgICAgdHAgPSAiVTgiOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgICB0cCA9ICJTMTYiOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzogLy91c2hvcnQKICAgICAgICAgICAgdHAgPSAiVTE2IjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHRwID0gIlMzMiI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICB0cCA9ICJVMzIiOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgdHAgPSAiRjMyIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIHRwID0gIkY2NCI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdHAgPSAiRjMyIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRwOwogICAgICB9LAoKICAgICAgaXNWYWxpZFBpeGVsVmFsdWU6IGZ1bmN0aW9uKHQsIHZhbCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgaXNWYWxpZDsKICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTEyOCAmJiB2YWwgPD0gMTI3OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTogLy9ieXRlICAodW5zaWduZWQgY2hhcikKICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAwICYmIHZhbCA8PSAyNTU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOiAvL3Nob3J0CiAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTMyNzY4ICYmIHZhbCA8PSAzMjc2NzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gMCAmJiB2YWwgPD0gNjU1MzY7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA0OiAvL2ludCAzMgogICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IC0yMTQ3NDgzNjQ4ICYmIHZhbCA8PSAyMTQ3NDgzNjQ3OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNTogLy91aW5pdCAzMgogICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDAgJiYgdmFsIDw9IDQyOTQ5NjcyOTY7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IC0zLjQwMjc5OTkzODc5MDE0ODRlKzM4ICYmIHZhbCA8PSAzLjQwMjc5OTkzODc5MDE0ODRlKzM4OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDggJiYgdmFsIDw9IDEuNzk3NjkzMTM0ODYyMzE1N2UrMzA4OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlzVmFsaWQ7CiAgICAgIH0sCgogICAgICBnZXREYXRhVHlwZVNpemU6IGZ1bmN0aW9uKHQpIHsKICAgICAgICB2YXIgcyA9IDA7CiAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICBjYXNlIDA6IC8vdWJ5dGUKICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgIHMgPSAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgY2FzZSAzOiAvL3VzaG9ydAogICAgICAgICAgICBzID0gMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIHMgPSA0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgcyA9IDg7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcyA9IHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzOwogICAgICB9LAoKICAgICAgZ2V0RGF0YVR5cGVVc2VkOiBmdW5jdGlvbihkdCwgdGMpIHsKICAgICAgICB2YXIgdCA9IGR0OwogICAgICAgIHN3aXRjaCAoZHQpIHsKICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgY2FzZSA0OiAvL2xvbmcKICAgICAgICAgICAgdCA9IGR0IC0gdGM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOiAvL3VzaG9ydAogICAgICAgICAgY2FzZSA1OiAvL3Vsb25nCiAgICAgICAgICAgIHQgPSBkdCAtIDIgKiB0YzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDY6IC8vZmxvYXQKICAgICAgICAgICAgaWYgKDAgPT09IHRjKSB7CiAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKDEgPT09IHRjKSB7CiAgICAgICAgICAgICAgdCA9IDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdCA9IDE7Ly9ieXRlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDc6IC8vZG91YmxlCiAgICAgICAgICAgIGlmICgwID09PSB0YykgewogICAgICAgICAgICAgIHQgPSBkdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB0ID0gZHQgLSAyICogdGMgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0sCgogICAgICBnZXRPbmVQaXhlbDogZnVuY3Rpb24oYmxvY2ssIGJsb2NrUHRyLCBvZmZzZXRUeXBlLCB2aWV3KSB7CiAgICAgICAgdmFyIHRlbXAgPSAwOwogICAgICAgIHN3aXRjaCAob2Zmc2V0VHlwZSkgewogICAgICAgICAgY2FzZSAwOiAvL2NoYXIKICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50OChibG9ja1B0cik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOiAvL2J5dGUKICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDgoYmxvY2tQdHIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50MTYoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDE2KGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEludDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldFVJbnQzMihibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICB0ZW1wID0gdmlldy5nZXRGbG9hdDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEZsb2F0NjQoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93ICgidGhlIGRlY29kZXIgZG9lcyBub3QgdW5kZXJzdGFuZCB0aGlzIHBpeGVsIHR5cGUiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRlbXA7CiAgICAgIH0sCgogICAgICBzd2FwRGltZW5zaW9uT3JkZXI6IGZ1bmN0aW9uKHBpeGVscywgbnVtUGl4ZWxzLCBudW1EaW1zLCBPdXRQaXhlbFR5cGVBcnJheSwgaW5wdXRJc0JJUCkgewogICAgICAgIHZhciBpID0gMCwgaiA9IDAsIGlEaW0gPSAwLCB0ZW1wID0gMCwgc3dhcCA9IHBpeGVsczsKICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgIHN3YXAgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogbnVtRGltcyk7CiAgICAgICAgICBpZiAoaW5wdXRJc0JJUCkgewogICAgICAgICAgICBmb3IgKGk9MDsgaTxudW1QaXhlbHM7IGkrKykgewogICAgICAgICAgICAgIHRlbXAgPSBpOwogICAgICAgICAgICAgIGZvciAoaURpbT0wOyBpRGltIDwgbnVtRGltczsgaURpbSsrLCB0ZW1wICs9IG51bVBpeGVscykgewogICAgICAgICAgICAgICAgc3dhcFt0ZW1wXSA9IHBpeGVsc1tqKytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgCiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChpPTA7IGk8bnVtUGl4ZWxzOyBpKyspIHsKICAgICAgICAgICAgICB0ZW1wID0gaTsKICAgICAgICAgICAgICBmb3IgKGlEaW09MDsgaURpbSA8IG51bURpbXM7IGlEaW0rKywgdGVtcCArPSBudW1QaXhlbHMpIHsKICAgICAgICAgICAgICAgIHN3YXBbaisrXSA9IHBpeGVsc1t0ZW1wXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN3YXA7CiAgICAgIH0KICAgIH07CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgKnByaXZhdGUgY2xhc3MgZm9yIGEgdHJlZSBub2RlLiBIdWZmbWFuIGNvZGUgaXMgaW4gTGVyYzJIZWxwZXJzCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgdmFyIFRyZWVOb2RlID0gZnVuY3Rpb24odmFsLCBsZWZ0LCByaWdodCkgewogICAgICB0aGlzLnZhbCA9IHZhbDsKICAgICAgdGhpcy5sZWZ0ID0gbGVmdDsKICAgICAgdGhpcy5yaWdodCA9IHJpZ2h0OwogICAgfTsKCiAgICB2YXIgTGVyYzJEZWNvZGUgPSB7CiAgICAgIC8qCiAgICAgICogKioqKioqKipyZW1vdmVkIG9wdGlvbnMgY29tcGFyZWQgdG8gTEVSQzEuIFdlIGNhbiBicmluZyBzb21lIG9mIHRoZW0gYmFjayBpZiBuZWVkZWQuCiAgICAgICAqIHJlbW92ZWQgcGl4ZWwgdHlwZS4gTEVSQzIgaXMgdHlwZWQgYW5kIGRvZXNuJ3QgcmVxdWlyZSB1c2VyIHRvIGdpdmUgcGl4ZWwgdHlwZQogICAgICAgKiBjaGFuZ2VkIGVuY29kZWRNYXNrRGF0YSB0byBtYXNrRGF0YS4gTEVSQzIgJ3MganMgdmVyc2lvbiBtYWtlIGl0IGZhc3RlciB0byB1c2UgbWFza0RhdGEgZGlyZWN0bHkuCiAgICAgICAqIHJlbW92ZWQgcmV0dXJuTWFzay4gbWFzayBpcyB1c2VkIGJ5IExFUkMyIGludGVybmFsbHkgYW5kIGlzIGNvc3QgZnJlZS4gSW4gY2FzZSBvZiB1c2VyIGlucHV0IG1hc2ssIGl0J3MgcmV0dXJuZWQgYXMgd2VsbCBhbmQgaGFzIG5lZ2xpYmxlIGNvc3QuCiAgICAgICAqIHJlbW92ZWQgbm9kYXRhdmFsdWUuIEJlY2F1c2UgTEVSQzIgcGl4ZWxzIGFyZSB0eXBlZCwgbm9kYXRhdmFsdWUgd2lsbCBzYWNyaWZ5IGEgdXNlZnVsIHZhbHVlIGZvciBtYW55IHR5cGVzICg4Yml0LCAxNmJpdCkgZXRjLAogICAgICAgKiAgICAgICB1c2VyIGhhcyB0byBiZSBrbm93bGVkZ2FibGUgZW5vdWdoIGFib3V0IHJhc3RlciBhbmQgdGhlaXIgZGF0YSB0byBhdm9pZCB1c2FiaWxpdHkgaXNzdWVzLiBzbyBub2RhdGEgdmFsdWUgaXMgc2ltcGx5IHJlbW92ZWQgbm93LgogICAgICAgKiAgICAgICBXZSBjYW4gYWRkIGl0IGJhY2sgbGF0ZXIgaWYgdGhlaXIncyBhIGNsZWFyIHJlcXVpcmVtZW50LgogICAgICAgKiByZW1vdmVkIGVuY29kZWRNYXNrLiBUaGlzIG9wdGlvbiB3YXMgbm90IGltcGxlbWVudGVkIGluIExlcmNEZWNvZGUuIEl0IGNhbiBiZSBkb25lIGFmdGVyIGRlY29kaW5nIChsZXNzIGVmZmljaWVudCkKICAgICAgICogcmVtb3ZlZCBjb21wdXRlVXNlZEJpdERlcHRocy4KICAgICAgICoKICAgICAgICoKICAgICAgICogcmVzcG9uc2UgY2hhbmdlcyBjb21wYXJlZCB0byBMRVJDMQogICAgICAgKiAxLiBlbmNvZGVkTWFza0RhdGEgaXMgbm90IGF2YWlsYWJsZQogICAgICAgKiAyLiBub0RhdGFWYWx1ZSBpcyBvcHRpb25hbCAocmV0dXJucyBvbmx5IGlmIHVzZXIncyBub0RhdGFWYWx1ZSBpcyB3aXRoIGluIHRoZSB2YWxpZCBkYXRhIHR5cGUgcmFuZ2UpCiAgICAgICAqIDMuIG1hc2tEYXRhIGlzIGFsd2F5cyBhdmFpbGFibGUKICAgICAgKi8KICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICogIHB1YmxpYyBwcm9wZXJ0aWVzCiAgICAgICoqKioqKioqKioqKioqKioqKi8KICAgICAgLy9IVUZGTUFOX0xVVF9CSVRTX01BWDogMTIsIC8vdXNlIDJeMTIgbHV0LCBub3QgY29uZmlndXJhYmxlCgogICAgICAvKioqKioqKioqKioqKioqKioKICAgICAgKiAgcHVibGljIG1ldGhvZHMKICAgICAgKioqKioqKioqKioqKioqKiovCgogICAgICAvKioKICAgICAgICogRGVjb2RlIGEgTEVSQzIgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgb3B0aW9uYWwgbWV0YWRhdGEuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGlucHV0IFRoZSBMRVJDIGlucHV0IGJ5dGUgc3RyZWFtCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gb3B0aW9ucyBEZWNvZGluZyBvcHRpb25zCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5pbnB1dE9mZnNldF0gVGhlIG51bWJlciBvZiBieXRlcyB0byBza2lwIGluIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMRVJDIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbgogICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnJldHVybkZpbGVJbmZvXSBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgaGF2ZSBhIGZpbGVJbmZvIHByb3BlcnR5IHRoYXQgY29udGFpbnMgbWV0YWRhdGEgb2J0YWluZWQgZnJvbSB0aGUgTEVSQyBoZWFkZXJzIGFuZCB0aGUgZGVjb2RpbmcgcHJvY2VzcwogICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnJldHVyblBpeGVsSW50ZXJsZWF2ZWREaW1zXSAgSWYgdHJ1ZSwgcmV0dXJuZWQgZGltZW5zaW9ucyBhcmUgcGl4ZWwtaW50ZXJsZWF2ZWQsIGEuay5hIFtwMV9kaW0wLCBwMV9kaW0xLCBwMV9kaW1uLCBwMl9kaW0wLi4uXSwgZGVmYXVsdCBpcyBbcDFfZGltMCwgcDJfZGltMCwgLi4uLCBwMV9kaW0xLCBwMl9kaW0xLi4uXQogICAgICAgKi8KICAgICAgZGVjb2RlOiBmdW5jdGlvbigvKmJ5dGUgYXJyYXkqLyBpbnB1dCwgLypvYmplY3QqLyBvcHRpb25zKSB7CiAgICAgICAgLy9jdXJyZW50bHkgdGhlcmUncyBhIGJ1ZyBpbiB0aGUgc3BhcnNlIGFycmF5LCBzbyBwbGVhc2UgZG8gbm90IHNldCB0byBmYWxzZQogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgIHZhciBub0RhdGFWYWx1ZSA9IG9wdGlvbnMubm9EYXRhVmFsdWU7CgogICAgICAgIC8vaW5pdGlhbGl6ZQogICAgICAgIHZhciBpID0gMCwgZGF0YSA9IHt9OwogICAgICAgIGRhdGEucHRyID0gb3B0aW9ucy5pbnB1dE9mZnNldCB8fCAwOwogICAgICAgIGRhdGEucGl4ZWxzID0ge307CgogICAgICAgIC8vIEZpbGUgaGVhZGVyCiAgICAgICAgaWYgKCFMZXJjMkhlbHBlcnMucmVhZEhlYWRlckluZm8oaW5wdXQsIGRhdGEpKSA7CgogICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgIHZhciBmaWxlVmVyc2lvbiA9IGhlYWRlckluZm8uZmlsZVZlcnNpb247CiAgICAgICAgdmFyIE91dFBpeGVsVHlwZUFycmF5ID0gTGVyYzJIZWxwZXJzLmdldERhdGFUeXBlQXJyYXkoaGVhZGVySW5mby5pbWFnZVR5cGUpOwoKICAgICAgICAvLyB2ZXJzaW9uIGNoZWNrCiAgICAgICAgaWYgKGZpbGVWZXJzaW9uID4gNSkgewogICAgICAgICAgdGhyb3cgInVuc3VwcG9ydGVkIGxlcmMgdmVyc2lvbiAyLiIgKyBmaWxlVmVyc2lvbjsKICAgICAgICB9CgogICAgICAgIC8vIE1hc2sgSGVhZGVyCiAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRNYXNrKGlucHV0LCBkYXRhKTsKICAgICAgICBpZiAoaGVhZGVySW5mby5udW1WYWxpZFBpeGVsICE9PSBoZWFkZXJJbmZvLndpZHRoICogaGVhZGVySW5mby5oZWlnaHQgJiYgIWRhdGEucGl4ZWxzLnJlc3VsdE1hc2spIHsKICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sgPSBvcHRpb25zLm1hc2tEYXRhOwogICAgICAgIH0KCiAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogaGVhZGVySW5mby5udW1EaW1zKTsKCiAgICAgICAgZGF0YS5jb3VudGVyID0gewogICAgICAgICAgb25lc3dlZXA6IDAsCiAgICAgICAgICB1bmNvbXByZXNzZWQ6IDAsCiAgICAgICAgICBsdXQ6IDAsCiAgICAgICAgICBiaXRzdHVmZmVyOiAwLAogICAgICAgICAgY29uc3RhbnQ6IDAsCiAgICAgICAgICBjb25zdGFudG9mZnNldDogMAogICAgICAgIH07CiAgICAgICAgdmFyIHVzZUJTUUZvck91dHB1dERpbSA9ICFvcHRpb25zLnJldHVyblBpeGVsSW50ZXJsZWF2ZWREaW1zOwogICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IDApIHsKICAgICAgICAgIC8vbm90IHRlc3RlZAogICAgICAgICAgaWYgKGhlYWRlckluZm8uek1heCA9PT0gaGVhZGVySW5mby56TWluKSAvL2NvbnN0YW50IHN1cmZhY2UKICAgICAgICAgIHsKICAgICAgICAgICAgTGVyYzJIZWxwZXJzLmNvbnN0cnVjdENvbnN0YW50U3VyZmFjZShkYXRhLCB1c2VCU1FGb3JPdXRwdXREaW0pOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoZmlsZVZlcnNpb24gPj0gNCAmJiBMZXJjMkhlbHBlcnMuY2hlY2tNaW5NYXhSYW5nZXMoaW5wdXQsIGRhdGEpKSB7CiAgICAgICAgICAgIExlcmMySGVscGVycy5jb25zdHJ1Y3RDb25zdGFudFN1cmZhY2UoZGF0YSwgdXNlQlNRRm9yT3V0cHV0RGltKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDIpOwogICAgICAgICAgICB2YXIgYlJlYWREYXRhT25lU3dlZXAgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICBkYXRhLnB0cisrOwogICAgICAgICAgICBpZiAoYlJlYWREYXRhT25lU3dlZXApIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoIk9uZVN3ZWVwIik7CiAgICAgICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWREYXRhT25lU3dlZXAoaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5LCB1c2VCU1FGb3JPdXRwdXREaW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vbGVyYzIuMTogLy9iaXRzdHVmZmluZyArIGx1dAogICAgICAgICAgICAgIC8vbGVyYzIuMjogLy9iaXRzdHVmZmluZyArIGx1dCArIGh1ZmZtYW4KICAgICAgICAgICAgICAvL2xlcmMyLjM6IG5ldyBiaXRzdHVmZmVyCiAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID4gMSAmJiBoZWFkZXJJbmZvLmltYWdlVHlwZSA8PSAxICYmIE1hdGguYWJzKGhlYWRlckluZm8ubWF4WkVycm9yIC0gMC41KSA8IDAuMDAwMDEpIHsKICAgICAgICAgICAgICAgIC8vdGhpcyBpcyAyLnggcGx1cyA4IGJpdCAodW5zaWduZWQgYW5kIHNpZ25lZCkgZGF0YSwgcG9zc2libGl0eSBvZiBIdWZmbWFuCiAgICAgICAgICAgICAgICB2YXIgZmxhZ0h1ZmZtYW4gPSB2aWV3LmdldFVpbnQ4KDEpOwogICAgICAgICAgICAgICAgZGF0YS5wdHIrKzsKICAgICAgICAgICAgICAgIGRhdGEuZW5jb2RlTW9kZSA9IGZsYWdIdWZmbWFuOwogICAgICAgICAgICAgICAgaWYgKGZsYWdIdWZmbWFuID4gMiB8fCAoZmlsZVZlcnNpb24gPCA0ICYmIGZsYWdIdWZmbWFuID4gMSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgSHVmZm1hbiBmbGFnICIgKyBmbGFnSHVmZm1hbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChmbGFnSHVmZm1hbikgey8vMSAtIGRlbHRhIEh1ZmZtYW4sIDIgLSBIdWZmbWFuCiAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkh1ZmZtYW4iKTsKICAgICAgICAgICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRIdWZmbWFuKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSwgdXNlQlNRRm9yT3V0cHV0RGltKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZFRpbGVzKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSwgdXNlQlNRRm9yT3V0cHV0RGltKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7IC8vbGVyYzIueCBub24tOCBiaXQgZGF0YQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiVGlsZXMiKTsKICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5yZWFkVGlsZXMoaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5LCB1c2VCU1FGb3JPdXRwdXREaW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLnB0cjsKICAgICAgICB2YXIgZGlmZjsKICAgICAgICBpZiAob3B0aW9ucy5pbnB1dE9mZnNldCkgewogICAgICAgICAgZGlmZiA9IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSArIG9wdGlvbnMuaW5wdXRPZmZzZXQgLSBkYXRhLnB0cjsKICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmKSA+PSAxKSB7CiAgICAgICAgICAgIC8vY29uc29sZS5kZWJ1ZygiaW5jb3JyZWN0IGVvZjogZGF0YXB0ciAiICsgZGF0YS5wdHIgKyAiIG9mZnNldCAiICsgb3B0aW9ucy5pbnB1dE9mZnNldCArICIgYmxvYnNpemUgIiArIGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSArICIgZGlmZjogIiArIGRpZmYpOwogICAgICAgICAgICBkYXRhLmVvZk9mZnNldCA9IG9wdGlvbnMuaW5wdXRPZmZzZXQgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgZGlmZiA9IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSAtIGRhdGEucHRyOwogICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmYpID49IDEpIHsKICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJpbmNvcnJlY3QgZmlyc3QgYmFuZCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBibG9ic2l6ZSAiICsgZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplICsgIiBkaWZmOiAiICsgZGlmZik7CiAgICAgICAgICAgIGRhdGEuZW9mT2Zmc2V0ID0gZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHJlc3VsdCA9IHsKICAgICAgICAgIHdpZHRoOiBoZWFkZXJJbmZvLndpZHRoLAogICAgICAgICAgaGVpZ2h0OiBoZWFkZXJJbmZvLmhlaWdodCwKICAgICAgICAgIHBpeGVsRGF0YTogZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzLAogICAgICAgICAgbWluVmFsdWU6IGhlYWRlckluZm8uek1pbiwKICAgICAgICAgIG1heFZhbHVlOiBoZWFkZXJJbmZvLnpNYXgsCiAgICAgICAgICB2YWxpZFBpeGVsQ291bnQ6IGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCwKICAgICAgICAgIGRpbUNvdW50OiBoZWFkZXJJbmZvLm51bURpbXMsCiAgICAgICAgICBkaW1TdGF0czogewogICAgICAgICAgICBtaW5WYWx1ZXM6IGhlYWRlckluZm8ubWluVmFsdWVzLAogICAgICAgICAgICBtYXhWYWx1ZXM6IGhlYWRlckluZm8ubWF4VmFsdWVzCiAgICAgICAgICB9LAogICAgICAgICAgbWFza0RhdGE6IGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sKICAgICAgICAgIC8vbm9EYXRhVmFsdWU6IG5vRGF0YVZhbHVlCiAgICAgICAgfTsKCiAgICAgICAgLy93ZSBzaG91bGQgcmVtb3ZlIHRoaXMgaWYgdGhlcmUncyBubyBleGlzdGluZyBjbGllbnQKICAgICAgICAvL29wdGlvbmFsIG5vRGF0YVZhbHVlIHByb2Nlc3NpbmcsIGl0J3MgdXNlcidzIHJlc3BvbnNpYmxpdHkKICAgICAgICBpZiAoZGF0YS5waXhlbHMucmVzdWx0TWFzayAmJiBMZXJjMkhlbHBlcnMuaXNWYWxpZFBpeGVsVmFsdWUoaGVhZGVySW5mby5pbWFnZVR5cGUsIG5vRGF0YVZhbHVlKSkgewogICAgICAgICAgdmFyIG1hc2sgPSBkYXRhLnBpeGVscy5yZXN1bHRNYXNrOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bVBpeGVsczsgaSsrKSB7CiAgICAgICAgICAgIGlmICghbWFza1tpXSkgewogICAgICAgICAgICAgIHJlc3VsdC5waXhlbERhdGFbaV0gPSBub0RhdGFWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0Lm5vRGF0YVZhbHVlID0gbm9EYXRhVmFsdWU7CiAgICAgICAgfQogICAgICAgIGRhdGEubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5GaWxlSW5mbykgewogICAgICAgICAgcmVzdWx0LmZpbGVJbmZvID0gTGVyYzJIZWxwZXJzLmZvcm1hdEZpbGVJbmZvKGRhdGEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LAoKICAgICAgZ2V0QmFuZENvdW50OiBmdW5jdGlvbigvKmJ5dGUgYXJyYXkqLyBpbnB1dCkgewogICAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIHZhciB0ZW1wID0ge307CiAgICAgICAgdGVtcC5wdHIgPSAwOwogICAgICAgIHRlbXAucGl4ZWxzID0ge307CiAgICAgICAgd2hpbGUgKGkgPCBpbnB1dC5ieXRlTGVuZ3RoIC0gNTgpIHsKICAgICAgICAgIExlcmMySGVscGVycy5yZWFkSGVhZGVySW5mbyhpbnB1dCwgdGVtcCk7CiAgICAgICAgICBpICs9IHRlbXAuaGVhZGVySW5mby5ibG9iU2l6ZTsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICB0ZW1wLnB0ciA9IGk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudDsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gTGVyYzJEZWNvZGU7CiAgfSkoKTsKCiAgdmFyIGlzUGxhdGZvcm1MaXR0bGVFbmRpYW4gPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgYSA9IG5ldyBBcnJheUJ1ZmZlcig0KTsKICAgIHZhciBiID0gbmV3IFVpbnQ4QXJyYXkoYSk7CiAgICB2YXIgYyA9IG5ldyBVaW50MzJBcnJheShhKTsKICAgIGNbMF0gPSAxOwogICAgcmV0dXJuIGJbMF0gPT09IDE7CiAgfSkoKTsKCiAgdmFyIExlcmMgPSB7CiAgICAvKioqKioqKioqKioqd3JhcHBlcioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAvKioKICAgICAqIEEgd3JhcHBlciBmb3IgZGVjb2RpbmcgYm90aCBMRVJDMSBhbmQgTEVSQzIgYnl0ZSBzdHJlYW1zIGNhcGFibGUgb2YgaGFuZGxpbmcgbXVsdGliYW5kIHBpeGVsIGJsb2NrcyBmb3IgdmFyaW91cyBwaXhlbCB0eXBlcy4KICAgICAqCiAgICAgKiBAYWxpYXMgbW9kdWxlOkxlcmMKICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGlucHV0IFRoZSBMRVJDIGlucHV0IGJ5dGUgc3RyZWFtCiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIFRoZSBkZWNvZGluZyBvcHRpb25zIGJlbG93IGFyZSBvcHRpb25hbC4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5pbnB1dE9mZnNldF0gVGhlIG51bWJlciBvZiBieXRlcyB0byBza2lwIGluIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMZXJjIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbi4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5waXhlbFR5cGVdIChMRVJDMSBvbmx5KSBEZWZhdWx0IHZhbHVlIGlzIEYzMi4gVmFsaWQgcGl4ZWwgdHlwZXMgZm9yIGlucHV0IGFyZSBVOC9TOC9TMTYvVTE2L1MzMi9VMzIvRjMyLgogICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm5vRGF0YVZhbHVlXSAoTEVSQzEgb25seSkuIEl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSB0aGUgcmV0dXJuZWQgbWFzayBpbnN0ZWFkIG9mIHNldHRpbmcgdGhpcyB2YWx1ZS4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMucmV0dXJuUGl4ZWxJbnRlcmxlYXZlZERpbXNdIChuRGltIExFUkMyIG9ubHkpIElmIHRydWUsIHJldHVybmVkIGRpbWVuc2lvbnMgYXJlIHBpeGVsLWludGVybGVhdmVkLCBhLmsuYSBbcDFfZGltMCwgcDFfZGltMSwgcDFfZGltbiwgcDJfZGltMC4uLl0sIGRlZmF1bHQgaXMgW3AxX2RpbTAsIHAyX2RpbTAsIC4uLiwgcDFfZGltMSwgcDJfZGltMS4uLl0KICAgICAqIEByZXR1cm5zIHt7d2lkdGgsIGhlaWdodCwgcGl4ZWxzLCBwaXhlbFR5cGUsIG1hc2ssIHN0YXRpc3RpY3N9fQogICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggV2lkdGggb2YgZGVjb2RlZCBpbWFnZS4KICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCBIZWlnaHQgb2YgZGVjb2RlZCBpbWFnZS4KICAgICAgICogQHByb3BlcnR5IHthcnJheX0gcGl4ZWxzIFtiYW5kMSwgYmFuZDIsIOKApl0gRWFjaCBiYW5kIGlzIGEgdHlwZWQgYXJyYXkgb2Ygd2lkdGgqaGVpZ2h0LgogICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGl4ZWxUeXBlIFRoZSB0eXBlIG9mIHBpeGVscyByZXByZXNlbnRlZCBpbiB0aGUgb3V0cHV0LgogICAgICAgKiBAcHJvcGVydHkge21hc2t9IG1hc2sgVHlwZWQgYXJyYXkgd2l0aCBhIHNpemUgb2Ygd2lkdGgqaGVpZ2h0LCBvciBudWxsIGlmIGFsbCBwaXhlbHMgYXJlIHZhbGlkLgogICAgICAgKiBAcHJvcGVydHkge2FycmF5fSBzdGF0aXN0aWNzIFtzdGF0aXN0aWNzX2JhbmQxLCBzdGF0aXN0aWNzX2JhbmQyLCDigKZdIEVhY2ggZWxlbWVudCBpcyBhIHN0YXRpc3RpY3Mgb2JqZWN0IHJlcHJlc2VudGluZyBtaW4gYW5kIG1heCB2YWx1ZXMKICAgICoqLwogICAgZGVjb2RlOiBmdW5jdGlvbihlbmNvZGVkRGF0YSwgb3B0aW9ucykgewogICAgICBpZiAoIWlzUGxhdGZvcm1MaXR0bGVFbmRpYW4pIHsKICAgICAgICB0aHJvdyAiQmlnIGVuZGlhbiBzeXN0ZW0gaXMgbm90IHN1cHBvcnRlZC4iOwogICAgICB9CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB2YXIgaW5wdXRPZmZzZXQgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgIHZhciBmaWxlSWRWaWV3ID0gbmV3IFVpbnQ4QXJyYXkoZW5jb2RlZERhdGEsIGlucHV0T2Zmc2V0LCAxMCk7CiAgICAgIHZhciBmaWxlSWRlbnRpZmllclN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZmlsZUlkVmlldyk7CiAgICAgIHZhciBsZXJjLCBtYWpvclZlcnNpb247CiAgICAgIGlmIChmaWxlSWRlbnRpZmllclN0cmluZy50cmltKCkgPT09ICJDbnRaSW1hZ2UiKSB7CiAgICAgICAgbGVyYyA9IExlcmNEZWNvZGU7CiAgICAgICAgbWFqb3JWZXJzaW9uID0gMTsKICAgICAgfQogICAgICBlbHNlIGlmIChmaWxlSWRlbnRpZmllclN0cmluZy5zdWJzdHJpbmcoMCwgNSkgPT09ICJMZXJjMiIpIHsKICAgICAgICBsZXJjID0gTGVyYzJEZWNvZGU7CiAgICAgICAgbWFqb3JWZXJzaW9uID0gMjsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB0aHJvdyAiVW5leHBlY3RlZCBmaWxlIGlkZW50aWZpZXIgc3RyaW5nOiAiICsgZmlsZUlkZW50aWZpZXJTdHJpbmc7CiAgICAgIH0KCiAgICAgIHZhciBpUGxhbmUgPSAwLCBlb2YgPSBlbmNvZGVkRGF0YS5ieXRlTGVuZ3RoIC0gMTAsIGVuY29kZWRNYXNrRGF0YSwgYmFuZE1hc2tzID0gW10sIGJhbmRNYXNrLCBtYXNrRGF0YTsKICAgICAgdmFyIGRlY29kZWRQaXhlbEJsb2NrID0gewogICAgICAgIHdpZHRoOiAwLAogICAgICAgIGhlaWdodDogMCwKICAgICAgICBwaXhlbHM6IFtdLAogICAgICAgIHBpeGVsVHlwZTogb3B0aW9ucy5waXhlbFR5cGUsCiAgICAgICAgbWFzazogbnVsbCwKICAgICAgICBzdGF0aXN0aWNzOiBbXQogICAgICB9OwogICAgICB2YXIgdW5pcXVlQmFuZE1hc2tDb3VudCA9IDA7CgogICAgICB3aGlsZSAoaW5wdXRPZmZzZXQgPCBlb2YpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbGVyYy5kZWNvZGUoZW5jb2RlZERhdGEsIHsKICAgICAgICAgIGlucHV0T2Zmc2V0OiBpbnB1dE9mZnNldCwvL2ZvciBib3RoIGxlcmMxIGFuZCBsZXJjMgogICAgICAgICAgZW5jb2RlZE1hc2tEYXRhOiBlbmNvZGVkTWFza0RhdGEsLy9sZXJjMSBvbmx5CiAgICAgICAgICBtYXNrRGF0YTogbWFza0RhdGEsLy9sZXJjMiBvbmx5CiAgICAgICAgICByZXR1cm5NYXNrOiBpUGxhbmUgPT09IDAgPyB0cnVlIDogZmFsc2UsLy9sZXJjMSBvbmx5CiAgICAgICAgICByZXR1cm5FbmNvZGVkTWFzazogaVBsYW5lID09PSAwID8gdHJ1ZSA6IGZhbHNlLC8vbGVyYzEgb25seQogICAgICAgICAgcmV0dXJuRmlsZUluZm86IHRydWUsLy9mb3IgYm90aCBsZXJjMSBhbmQgbGVyYzIKICAgICAgICAgIHJldHVyblBpeGVsSW50ZXJsZWF2ZWREaW1zOiBvcHRpb25zLnJldHVyblBpeGVsSW50ZXJsZWF2ZWREaW1zLC8vZm9yIG5kaW0gbGVyYzIgb25seQogICAgICAgICAgcGl4ZWxUeXBlOiBvcHRpb25zLnBpeGVsVHlwZSB8fCBudWxsLC8vbGVyYzEgb25seQogICAgICAgICAgbm9EYXRhVmFsdWU6IG9wdGlvbnMubm9EYXRhVmFsdWUgfHwgbnVsbC8vbGVyYzEgb25seQogICAgICAgIH0pOwoKICAgICAgICBpbnB1dE9mZnNldCA9IHJlc3VsdC5maWxlSW5mby5lb2ZPZmZzZXQ7CiAgICAgICAgbWFza0RhdGEgPSByZXN1bHQubWFza0RhdGE7Ly9sZXJjMgogICAgICAgIGlmIChpUGxhbmUgPT09IDApIHsKICAgICAgICAgIGVuY29kZWRNYXNrRGF0YSA9IHJlc3VsdC5lbmNvZGVkTWFza0RhdGE7Ly9sZXJjMQogICAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2sud2lkdGggPSByZXN1bHQud2lkdGg7CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5oZWlnaHQgPSByZXN1bHQuaGVpZ2h0OwogICAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2suZGltQ291bnQgPSByZXN1bHQuZGltQ291bnQgfHwgMTsKICAgICAgICAgIC8vZGVjb2RlZFBpeGVsQmxvY2suZGltU3RhdHMgPSBkZWNvZGVkUGl4ZWxCbG9jay5kaW1TdGF0czsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnBpeGVsVHlwZSA9IHJlc3VsdC5waXhlbFR5cGUgfHwgcmVzdWx0LmZpbGVJbmZvLnBpeGVsVHlwZTsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLm1hc2sgPSBtYXNrRGF0YTsKICAgICAgICB9CiAgICAgICAgaWYgKG1ham9yVmVyc2lvbiA+IDEpIHsKICAgICAgICAgIGlmIChtYXNrRGF0YSkgewogICAgICAgICAgICBiYW5kTWFza3MucHVzaChtYXNrRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzdWx0LmZpbGVJbmZvLm1hc2sgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIHVuaXF1ZUJhbmRNYXNrQ291bnQrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlQbGFuZSsrOwogICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnBpeGVscy5wdXNoKHJlc3VsdC5waXhlbERhdGEpOwogICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnN0YXRpc3RpY3MucHVzaCh7CiAgICAgICAgICBtaW5WYWx1ZTogcmVzdWx0Lm1pblZhbHVlLAogICAgICAgICAgbWF4VmFsdWU6IHJlc3VsdC5tYXhWYWx1ZSwKICAgICAgICAgIG5vRGF0YVZhbHVlOiByZXN1bHQubm9EYXRhVmFsdWUsCiAgICAgICAgICBkaW1TdGF0czogcmVzdWx0LmRpbVN0YXRzCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdmFyIGksIGosIG51bVBpeGVsczsKICAgICAgaWYgKG1ham9yVmVyc2lvbiA+IDEgJiYgdW5pcXVlQmFuZE1hc2tDb3VudCA+IDEpIHsKICAgICAgICBudW1QaXhlbHMgPSBkZWNvZGVkUGl4ZWxCbG9jay53aWR0aCAqIGRlY29kZWRQaXhlbEJsb2NrLmhlaWdodDsKICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5iYW5kTWFza3MgPSBiYW5kTWFza3M7CiAgICAgICAgbWFza0RhdGEgPSBuZXcgVWludDhBcnJheShudW1QaXhlbHMpOwogICAgICAgIG1hc2tEYXRhLnNldChiYW5kTWFza3NbMF0pOwogICAgICAgIGZvciAoaSA9IDE7IGkgPCBiYW5kTWFza3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJhbmRNYXNrID0gYmFuZE1hc2tzW2ldOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bVBpeGVsczsgaisrKSB7CiAgICAgICAgICAgIG1hc2tEYXRhW2pdID0gbWFza0RhdGFbal0gJiBiYW5kTWFza1tqXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2subWFza0RhdGEgPSBtYXNrRGF0YTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRlY29kZWRQaXhlbEJsb2NrOwogICAgfQogIH07CgogIGlmIChtb2R1bGUuZXhwb3J0cykgey8qIGpzaGludCBpZ25vcmU6bGluZSAqLwogICAgLy9jb21tb25KUyBtb2R1bGUgMS4wLzEuMS8xLjEuMSBzeXN0ZW1zLCBzdWNoIGFzIG5vZGVKUwogICAgLy9odHRwOi8vd2lraS5jb21tb25qcy5vcmcvd2lraS9Nb2R1bGVzCiAgICBtb2R1bGUuZXhwb3J0cyA9IExlcmM7LyoganNoaW50IGlnbm9yZTpsaW5lICovCiAgfQogIGVsc2UgewogICAgLy9hc3NpZ24gdG8gdGhpcywgbW9zdCBsaWtlbHkgd2luZG93CiAgICB0aGlzLkxlcmMgPSBMZXJjOwogIH0KCn0pKCk7Cn0oTGVyY0RlY29kZSkpOwoKdmFyIExlcmMgPSBMZXJjRGVjb2RlLmV4cG9ydHM7CgpjbGFzcyBMZXJjRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICBjb25zdHJ1Y3RvcihmaWxlRGlyZWN0b3J5KSB7CiAgICBzdXBlcigpOwoKICAgIHRoaXMucGxhbmFyQ29uZmlndXJhdGlvbiA9IHR5cGVvZiBmaWxlRGlyZWN0b3J5LlBsYW5hckNvbmZpZ3VyYXRpb24gIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5QbGFuYXJDb25maWd1cmF0aW9uIDogMTsKICAgIHRoaXMuc2FtcGxlc1BlclBpeGVsID0gdHlwZW9mIGZpbGVEaXJlY3RvcnkuU2FtcGxlc1BlclBpeGVsICE9PSAndW5kZWZpbmVkJyA/IGZpbGVEaXJlY3RvcnkuU2FtcGxlc1BlclBpeGVsIDogMTsKCiAgICB0aGlzLmFkZENvbXByZXNzaW9uID0gZmlsZURpcmVjdG9yeS5MZXJjUGFyYW1ldGVyc1tMZXJjUGFyYW1ldGVycy5BZGRDb21wcmVzc2lvbl07CiAgfQoKICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgIHN3aXRjaCAodGhpcy5hZGRDb21wcmVzc2lvbikgewogICAgICBjYXNlIExlcmNBZGRDb21wcmVzc2lvbi5Ob25lOgogICAgICAgIGJyZWFrOwogICAgICBjYXNlIExlcmNBZGRDb21wcmVzc2lvbi5EZWZsYXRlOgogICAgICAgIGJ1ZmZlciA9IGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24sIHByZWZlci1kZXN0cnVjdHVyaW5nCiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBMRVJDIGFkZGl0aW9uYWwgY29tcHJlc3Npb24gbWV0aG9kIGlkZW50aWZpZXI6ICR7dGhpcy5hZGRDb21wcmVzc2lvbn1gKTsKICAgIH0KCiAgICBjb25zdCBsZXJjUmVzdWx0ID0gTGVyYy5kZWNvZGUoYnVmZmVyLCB7IHJldHVyblBpeGVsSW50ZXJsZWF2ZWREaW1zOiB0aGlzLnBsYW5hckNvbmZpZ3VyYXRpb24gPT09IDEgfSk7CiAgICBjb25zdCBsZXJjRGF0YSA9IGxlcmNSZXN1bHQucGl4ZWxzWzBdOwogICAgcmV0dXJuIGxlcmNEYXRhLmJ1ZmZlcjsKICB9Cn0KCnZhciBsZXJjID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogIF9fcHJvdG9fXzogbnVsbCwKICAnZGVmYXVsdCc6IExlcmNEZWNvZGVyCn0pOwoKLyoqCiAqIGNsYXNzIFdlYkltYWdlRGVjb2RlcgogKgogKiBUaGlzIGRlY29kZXIgdXNlcyB0aGUgYnJvd3NlcnMgaW1hZ2UgZGVjb2RpbmcgZmFjaWxpdGllcyB0byByZWFkIGltYWdlCiAqIGZvcm1hdHMgbGlrZSBXZWJQIHdoZW4gc3VwcG9ydGVkLgogKi8KY2xhc3MgV2ViSW1hZ2VEZWNvZGVyIGV4dGVuZHMgQmFzZURlY29kZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKTsKICAgIGlmICh0eXBlb2YgY3JlYXRlSW1hZ2VCaXRtYXAgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGRlY29kZSBXZWJJbWFnZSBhcyBgY3JlYXRlSW1hZ2VCaXRtYXBgIGlzIG5vdCBhdmFpbGFibGUnKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzID09PSAndW5kZWZpbmVkJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBkZWNvZGUgV2ViSW1hZ2UgYXMgbmVpdGhlciBgZG9jdW1lbnRgIG5vciBgT2Zmc2NyZWVuQ2FudmFzYCBpcyBub3QgYXZhaWxhYmxlJyk7CiAgICB9CiAgfQoKICBhc3luYyBkZWNvZGUoZmlsZURpcmVjdG9yeSwgYnVmZmVyKSB7CiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J1ZmZlcl0pOwogICAgY29uc3QgaW1hZ2VCaXRtYXAgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChibG9iKTsKCiAgICBsZXQgY2FudmFzOwogICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlQml0bWFwLndpZHRoOwogICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2VCaXRtYXAuaGVpZ2h0OwogICAgfSBlbHNlIHsKICAgICAgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhpbWFnZUJpdG1hcC53aWR0aCwgaW1hZ2VCaXRtYXAuaGVpZ2h0KTsKICAgIH0KCiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2VCaXRtYXAsIDAsIDApOwoKICAgIC8vIFRPRE86IGNoZWNrIGhvdyBtYW55IHNhbXBsZXMgcGVyIHBpeGVsIHdlIGhhdmUsIGFuZCByZXR1cm4gUkdCL1JHQkEgYWNjb3JkaW5nbHkKICAgIC8vIGl0IHNlZW1zIGxpa2UgR0RBTCBhbHdheXMgZW5jb2RlcyB2aWEgUkdCQSB3aGljaCBkb2VzIG5vdCByZXF1aXJlIGEgdHJhbnNsYXRpb24KCiAgICByZXR1cm4gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZUJpdG1hcC53aWR0aCwgaW1hZ2VCaXRtYXAuaGVpZ2h0KS5kYXRhLmJ1ZmZlcjsKICB9Cn0KCnZhciB3ZWJpbWFnZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICBfX3Byb3RvX186IG51bGwsCiAgJ2RlZmF1bHQnOiBXZWJJbWFnZURlY29kZXIKfSk7Cg==";var blob=typeof window!=="undefined"&&window.Blob&&new Blob([atob(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(){var objURL=blob&&(window.URL||window.webkitURL).createObjectURL(blob);try{return objURL?new Worker(objURL,{type:"module"}):new Worker("data:application/javascript;base64,"+encodedJs,{type:"module"});}finally{objURL&&(window.URL||window.webkitURL).revokeObjectURL(objURL);}}var defaultPoolSize=(_globalThis$navigator=globalThis===null||globalThis===void 0?void 0:(_globalThis$navigator2=globalThis.navigator)===null||_globalThis$navigator2===void 0?void 0:_globalThis$navigator2.hardwareConcurrency)!==null&&_globalThis$navigator!==void 0?_globalThis$navigator:4;function createWorker(){return new WorkerWrapper();}var Pool=/*#__PURE__*/function(_Pool$){(0,_inherits2["default"])(Pool,_Pool$);var _super29=_createSuper(Pool);function Pool(){(0,_classCallCheck2["default"])(this,Pool);return _super29.call(this,defaultPoolSize,createWorker);}return(0,_createClass2["default"])(Pool);}(_geotiff.Pool);var PARSER_OPTIONS={attributeNamePrefix:"",attrNodeName:"attr",parseNodeValue:true,parseAttributeValue:true,ignoreAttributes:false};var parse=function parse(str){return _fastXmlParser["default"].parse(str,PARSER_OPTIONS);};function fromString(str){var res=parse(str);if(!res.OME){throw Error("Failed to parse OME-XML metadata.");}return ensureArray(res.OME.Image).map(function(img){var Channels=ensureArray(img.Pixels.Channel).map(function(c){if("Color"in c.attr){return _objectSpread(_objectSpread({},c.attr),{},{Color:intToRgba(c.attr.Color)});}return _objectSpread({},c.attr);});var _img$AquisitionDate=img.AquisitionDate,AquisitionDate=_img$AquisitionDate===void 0?"":_img$AquisitionDate,_img$Description=img.Description,Description=_img$Description===void 0?"":_img$Description;var image=_objectSpread(_objectSpread({},img.attr),{},{AquisitionDate:AquisitionDate,Description:Description,Pixels:_objectSpread(_objectSpread({},img.Pixels.attr),{},{Channels:Channels})});return _objectSpread(_objectSpread({},image),{},{format:function format(){var Pixels=image.Pixels;var sizes=["X","Y","Z"].map(function(name){var size=Pixels["PhysicalSize".concat(name)];var unit=Pixels["PhysicalSize".concat(name,"Unit")];return size&&unit?"".concat(size," ").concat(unit):"-";}).join(" x ");return{"Acquisition Date":image.AquisitionDate,"Dimensions (XY)":"".concat(Pixels.SizeX," x ").concat(Pixels.SizeY),"Pixels Type":Pixels.Type,"Pixels Size (XYZ)":sizes,"Z-sections/Timepoints":"".concat(Pixels.SizeZ," x ").concat(Pixels.SizeT),Channels:Pixels.SizeC};}});});}var TiffPixelSource=/*#__PURE__*/function(){function TiffPixelSource(indexer,dtype,tileSize,shape,labels,meta,pool){(0,_classCallCheck2["default"])(this,TiffPixelSource);(0,_defineProperty2["default"])(this,"_indexer",void 0);this.dtype=dtype;this.tileSize=tileSize;this.shape=shape;this.labels=labels;this.meta=meta;this.pool=pool;this._indexer=indexer;}(0,_createClass2["default"])(TiffPixelSource,[{key:"getRaster",value:function(){var _getRaster4=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee6(_ref34){var selection,signal,image;return _regenerator["default"].wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:selection=_ref34.selection,signal=_ref34.signal;_context6.next=3;return this._indexer(selection);case 3:image=_context6.sent;return _context6.abrupt("return",this._readRasters(image,{signal:signal}));case 5:case"end":return _context6.stop();}}},_callee6,this);}));function getRaster(_x4){return _getRaster4.apply(this,arguments);}return getRaster;}()},{key:"getTile",value:function(){var _getTile=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee7(_ref35){var x,y,selection,signal,_this$_getTileExtent,height,width,x0,y0,window,image;return _regenerator["default"].wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:x=_ref35.x,y=_ref35.y,selection=_ref35.selection,signal=_ref35.signal;_this$_getTileExtent=this._getTileExtent(x,y),height=_this$_getTileExtent.height,width=_this$_getTileExtent.width;x0=x*this.tileSize;y0=y*this.tileSize;window=[x0,y0,x0+width,y0+height];_context7.next=7;return this._indexer(selection);case 7:image=_context7.sent;return _context7.abrupt("return",this._readRasters(image,{window:window,width:width,height:height,signal:signal}));case 9:case"end":return _context7.stop();}}},_callee7,this);}));function getTile(_x5){return _getTile.apply(this,arguments);}return getTile;}()},{key:"_readRasters",value:function(){var _readRasters2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee8(image,props){var _props$signal;var interleave,raster,data;return _regenerator["default"].wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:interleave=isInterleaved(this.shape);_context8.next=3;return image.readRasters(_objectSpread(_objectSpread({interleave:interleave},props),{},{pool:this.pool}));case 3:raster=_context8.sent;if(!(props!==null&&props!==void 0&&(_props$signal=props.signal)!==null&&_props$signal!==void 0&&_props$signal.aborted)){_context8.next=6;break;}throw SIGNAL_ABORTED;case 6:data=interleave?raster:raster[0];return _context8.abrupt("return",{data:data,width:raster.width,height:raster.height});case 8:case"end":return _context8.stop();}}},_callee8,this);}));function _readRasters(_x6,_x7){return _readRasters2.apply(this,arguments);}return _readRasters;}()},{key:"_getTileExtent",value:function _getTileExtent(x,y){var _getImageSize6=getImageSize(this),zoomLevelHeight=_getImageSize6.height,zoomLevelWidth=_getImageSize6.width;var height=this.tileSize;var width=this.tileSize;var maxXTileCoord=Math.floor(zoomLevelWidth/this.tileSize);var maxYTileCoord=Math.floor(zoomLevelHeight/this.tileSize);if(x===maxXTileCoord){width=zoomLevelWidth%this.tileSize;}if(y===maxYTileCoord){height=zoomLevelHeight%this.tileSize;}return{height:height,width:width};}},{key:"onTileError",value:function onTileError(err){console.error(err);}}]);return TiffPixelSource;}();exports.TiffPixelSource=TiffPixelSource;function getOmeLegacyIndexer(tiff,rootMeta){var _rootMeta$0$Pixels=rootMeta[0].Pixels,SizeT=_rootMeta$0$Pixels.SizeT,SizeC=_rootMeta$0$Pixels.SizeC,SizeZ=_rootMeta$0$Pixels.SizeZ;var ifdIndexer=getOmeIFDIndexer(rootMeta,0);return function(sel,pyramidLevel){var index=ifdIndexer(sel);var pyramidIndex=pyramidLevel*SizeZ*SizeT*SizeC;return tiff.getImage(index+pyramidIndex);};}function getOmeSubIFDIndexer(tiff,rootMeta){var image=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var ifdIndexer=getOmeIFDIndexer(rootMeta,image);var ifdCache=/* @__PURE__ */new Map();return/*#__PURE__*/function(){var _ref36=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee9(sel,pyramidLevel){var index,baseImage,SubIFDs,key,subIfdOffset,ifd;return _regenerator["default"].wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:index=ifdIndexer(sel);_context9.next=3;return tiff.getImage(index);case 3:baseImage=_context9.sent;if(!(pyramidLevel===0)){_context9.next=6;break;}return _context9.abrupt("return",baseImage);case 6:SubIFDs=baseImage.fileDirectory.SubIFDs;if(SubIFDs){_context9.next=9;break;}throw Error("Indexing Error: OME-TIFF is missing SubIFDs.");case 9:key="".concat(sel.t,"-").concat(sel.c,"-").concat(sel.z,"-").concat(pyramidLevel);if(!ifdCache.has(key)){subIfdOffset=SubIFDs[pyramidLevel-1];ifdCache.set(key,tiff.parseFileDirectoryAt(subIfdOffset));}_context9.next=13;return ifdCache.get(key);case 13:ifd=_context9.sent;return _context9.abrupt("return",new _geotiff.GeoTIFFImage(ifd.fileDirectory,ifd.geoKeyDirectory,baseImage.dataView,tiff.littleEndian,tiff.cache,tiff.source));case 15:case"end":return _context9.stop();}}},_callee9);}));return function(_x8,_x9){return _ref36.apply(this,arguments);};}();}function getOmeIFDIndexer(rootMeta){var image=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _rootMeta$image$Pixel=rootMeta[image].Pixels,SizeC=_rootMeta$image$Pixel.SizeC,SizeZ=_rootMeta$image$Pixel.SizeZ,SizeT=_rootMeta$image$Pixel.SizeT,DimensionOrder=_rootMeta$image$Pixel.DimensionOrder;var imageOffset=0;if(image>0){for(var i=0;i<image;i+=1){var _rootMeta$i$Pixels=rootMeta[i].Pixels,prevSizeC=_rootMeta$i$Pixels.SizeC,prevSizeZ=_rootMeta$i$Pixels.SizeZ,prevSizeT=_rootMeta$i$Pixels.SizeT;imageOffset+=prevSizeC*prevSizeZ*prevSizeT;}}switch(DimensionOrder){case"XYZCT":{return function(_ref37){var t=_ref37.t,c=_ref37.c,z=_ref37.z;return imageOffset+t*SizeZ*SizeC+c*SizeZ+z;};}case"XYZTC":{return function(_ref38){var t=_ref38.t,c=_ref38.c,z=_ref38.z;return imageOffset+c*SizeZ*SizeT+t*SizeZ+z;};}case"XYCTZ":{return function(_ref39){var t=_ref39.t,c=_ref39.c,z=_ref39.z;return imageOffset+z*SizeC*SizeT+t*SizeC+c;};}case"XYCZT":{return function(_ref40){var t=_ref40.t,c=_ref40.c,z=_ref40.z;return imageOffset+t*SizeC*SizeZ+z*SizeC+c;};}case"XYTCZ":{return function(_ref41){var t=_ref41.t,c=_ref41.c,z=_ref41.z;return imageOffset+z*SizeT*SizeC+c*SizeT+t;};}case"XYTZC":{return function(_ref42){var t=_ref42.t,c=_ref42.c,z=_ref42.z;return imageOffset+c*SizeT*SizeZ+z*SizeT+t;};}default:{throw new Error("Invalid OME-XML DimensionOrder, got ".concat(DimensionOrder,"."));}}}var DTYPE_LOOKUP$1={uint8:"Uint8",uint16:"Uint16",uint32:"Uint32","float":"Float32","double":"Float64",int8:"Int8",int16:"Int16",int32:"Int32"};function getOmePixelSourceMeta(_ref43){var Pixels=_ref43.Pixels;var labels=getLabels(Pixels.DimensionOrder);var dims=getDims(labels);var shape=Array(labels.length).fill(0);shape[dims("t")]=Pixels.SizeT;shape[dims("c")]=Pixels.SizeC;shape[dims("z")]=Pixels.SizeZ;if(Pixels.Interleaved){labels.push("_c");shape.push(3);}var getShape=function getShape(level){var s=(0,_toConsumableArray2["default"])(shape);s[dims("x")]=Pixels.SizeX>>level;s[dims("y")]=Pixels.SizeY>>level;return s;};if(!(Pixels.Type in DTYPE_LOOKUP$1)){throw Error("Pixel type ".concat(Pixels.Type," not supported."));}var dtype=DTYPE_LOOKUP$1[Pixels.Type];if(Pixels.PhysicalSizeX&&Pixels.PhysicalSizeY){var physicalSizes={x:{size:Pixels.PhysicalSizeX,unit:Pixels.PhysicalSizeXUnit},y:{size:Pixels.PhysicalSizeY,unit:Pixels.PhysicalSizeYUnit}};if(Pixels.PhysicalSizeZ){physicalSizes.z={size:Pixels.PhysicalSizeZ,unit:Pixels.PhysicalSizeZUnit};}return{labels:labels,getShape:getShape,physicalSizes:physicalSizes,dtype:dtype};}return{labels:labels,getShape:getShape,dtype:dtype};}function guessTileSize$1(image){var tileWidth=image.getTileWidth();var tileHeight=image.getTileHeight();var size=Math.min(tileWidth,tileHeight);return prevPowerOf2(size);}function getIndexer$1(tiff,omexml,SubIFDs,image){if(SubIFDs){return getOmeSubIFDIndexer(tiff,omexml,image);}return getOmeLegacyIndexer(tiff,omexml);}function load$2(_x10,_x11){return _load$.apply(this,arguments);}function _load$(){_load$=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee19(tiff,pool){var firstImage,_firstImage$fileDirec,ImageDescription,SubIFDs,photometricInterpretation,omexml,rootMeta,levels,getSource;return _regenerator["default"].wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.next=2;return tiff.getImage(0);case 2:firstImage=_context19.sent;_firstImage$fileDirec=firstImage.fileDirectory,ImageDescription=_firstImage$fileDirec.ImageDescription,SubIFDs=_firstImage$fileDirec.SubIFDs,photometricInterpretation=_firstImage$fileDirec.PhotometricInterpretation;omexml=fromString(ImageDescription);rootMeta=omexml;if(SubIFDs){levels=SubIFDs.length+1;}else{levels=omexml.length;rootMeta=[omexml[0]];}getSource=function getSource(resolution,pyramidIndexer,imgMeta){var _getOmePixelSourceMet=getOmePixelSourceMeta(imgMeta),labels=_getOmePixelSourceMet.labels,getShape=_getOmePixelSourceMet.getShape,physicalSizes=_getOmePixelSourceMet.physicalSizes,dtype=_getOmePixelSourceMet.dtype;var tileSize=guessTileSize$1(firstImage);var meta={photometricInterpretation:photometricInterpretation,physicalSizes:physicalSizes};var shape=getShape(resolution);var indexer=function indexer(sel){return pyramidIndexer(sel,resolution);};var source=new TiffPixelSource(indexer,dtype,tileSize,shape,labels,meta,pool);return source;};return _context19.abrupt("return",rootMeta.map(function(imgMeta,image){var pyramidIndexer=getIndexer$1(tiff,omexml,SubIFDs,image);var data=Array.from({length:levels}).map(function(_,resolution){return getSource(resolution,pyramidIndexer,imgMeta);});return{data:data,metadata:imgMeta};}));case 9:case"end":return _context19.stop();}}},_callee19);}));return _load$.apply(this,arguments);}(0,_geotiff.addDecoder)(5,function(){return LZWDecoder;});function loadOmeTiff(_x12){return _loadOmeTiff.apply(this,arguments);}function _loadOmeTiff(){_loadOmeTiff=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee20(source){var opts,headers,offsets,_opts$pool,pool,_opts$images,images,tiff,loaders,_args20=arguments;return _regenerator["default"].wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:opts=_args20.length>1&&_args20[1]!==undefined?_args20[1]:{};headers=opts.headers,offsets=opts.offsets,_opts$pool=opts.pool,pool=_opts$pool===void 0?true:_opts$pool,_opts$images=opts.images,images=_opts$images===void 0?"first":_opts$images;if(!(typeof source==="string")){_context20.next=8;break;}_context20.next=5;return(0,_geotiff.fromUrl)(source,_objectSpread(_objectSpread({},headers),{},{cacheSize:Infinity}));case 5:tiff=_context20.sent;_context20.next=11;break;case 8:_context20.next=10;return(0,_geotiff.fromBlob)(source);case 10:tiff=_context20.sent;case 11:if(offsets){tiff=createOffsetsProxy(tiff,offsets);}checkProxies(tiff);if(!pool){_context20.next=19;break;}_context20.next=16;return load$2(tiff,new Pool());case 16:_context20.t0=_context20.sent;_context20.next=22;break;case 19:_context20.next=21;return load$2(tiff);case 21:_context20.t0=_context20.sent;case 22:loaders=_context20.t0;return _context20.abrupt("return",images==="all"?loaders:loaders[0]);case 24:case"end":return _context20.stop();}}},_callee20);}));return _loadOmeTiff.apply(this,arguments);}function joinUrlParts(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return args.map(function(part,i){if(i===0)return part.trim().replace(/[/]*$/g,"");return part.trim().replace(/(^[/]*|[/]*$)/g,"");}).filter(function(x){return x.length;}).join("/");}var ReadOnlyStore=/*#__PURE__*/function(){function ReadOnlyStore(){(0,_classCallCheck2["default"])(this,ReadOnlyStore);}(0,_createClass2["default"])(ReadOnlyStore,[{key:"keys",value:function(){var _keys=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee10(){return _regenerator["default"].wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:return _context10.abrupt("return",[]);case 1:case"end":return _context10.stop();}}},_callee10);}));function keys(){return _keys.apply(this,arguments);}return keys;}()},{key:"deleteItem",value:function(){var _deleteItem=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee11(){return _regenerator["default"].wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:return _context11.abrupt("return",false);case 1:case"end":return _context11.stop();}}},_callee11);}));function deleteItem(){return _deleteItem.apply(this,arguments);}return deleteItem;}()},{key:"setItem",value:function(){var _setItem=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee12(){return _regenerator["default"].wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:console.warn("Cannot write to read-only store.");return _context12.abrupt("return",false);case 2:case"end":return _context12.stop();}}},_callee12);}));function setItem(){return _setItem.apply(this,arguments);}return setItem;}()}]);return ReadOnlyStore;}();var FileStore=/*#__PURE__*/function(_ReadOnlyStore){(0,_inherits2["default"])(FileStore,_ReadOnlyStore);var _super30=_createSuper(FileStore);function FileStore(fileMap){var _this19;var rootPrefix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";(0,_classCallCheck2["default"])(this,FileStore);_this19=_super30.call(this);(0,_defineProperty2["default"])((0,_assertThisInitialized2["default"])(_this19),"_map",void 0);(0,_defineProperty2["default"])((0,_assertThisInitialized2["default"])(_this19),"_rootPrefix",void 0);_this19._map=fileMap;_this19._rootPrefix=rootPrefix;return _this19;}(0,_createClass2["default"])(FileStore,[{key:"_key",value:function _key(key){return joinUrlParts(this._rootPrefix,key);}},{key:"getItem",value:function(){var _getItem=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee13(key){var file,buffer;return _regenerator["default"].wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:file=this._map.get(this._key(key));if(file){_context13.next=3;break;}throw new _zarr.KeyError(key);case 3:_context13.next=5;return file.arrayBuffer();case 5:buffer=_context13.sent;return _context13.abrupt("return",buffer);case 7:case"end":return _context13.stop();}}},_callee13,this);}));function getItem(_x13){return _getItem.apply(this,arguments);}return getItem;}()},{key:"containsItem",value:function(){var _containsItem=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee14(key){var path;return _regenerator["default"].wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:path=this._key(key);return _context14.abrupt("return",this._map.has(path));case 2:case"end":return _context14.stop();}}},_callee14,this);}));function containsItem(_x14){return _containsItem.apply(this,arguments);}return containsItem;}()}]);return FileStore;}(ReadOnlyStore);function isOmeZarr(dataShape,Pixels){var SizeT=Pixels.SizeT,SizeC=Pixels.SizeC,SizeZ=Pixels.SizeZ,SizeY=Pixels.SizeY,SizeX=Pixels.SizeX;var omeZarrShape=[SizeT,SizeC,SizeZ,SizeY,SizeX];return dataShape.every(function(size,i){return omeZarrShape[i]===size;});}function guessBioformatsLabels(_ref44,_ref45){var shape=_ref44.shape;var Pixels=_ref45.Pixels;if(isOmeZarr(shape,Pixels)){return getLabels("XYZCT");}var labels=getLabels(Pixels.DimensionOrder);labels.forEach(function(lower,i){var label=lower.toUpperCase();var xmlSize=Pixels["Size".concat(label)];if(!xmlSize){throw Error("Dimension ".concat(label," is invalid for OME-XML."));}if(shape[i]!==xmlSize){throw Error("Dimension mismatch between zarr source and OME-XML.");}});return labels;}function getRootPrefix(files,rootName){var first=files.find(function(f){return f.path.indexOf(rootName)>0;});if(!first){throw Error("Could not find root in store.");}var prefixLength=first.path.indexOf(rootName)+rootName.length;return first.path.slice(0,prefixLength);}function loadMultiscales(_x15){return _loadMultiscales.apply(this,arguments);}function _loadMultiscales(){_loadMultiscales=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee21(store){var path,grp,rootAttrs,paths,labels,_rootAttrs$multiscale,datasets,axes,data,_args21=arguments;return _regenerator["default"].wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:path=_args21.length>1&&_args21[1]!==undefined?_args21[1]:"";_context21.next=3;return(0,_zarr.openGroup)(store,path);case 3:grp=_context21.sent;_context21.next=6;return grp.attrs.asObject();case 6:rootAttrs=_context21.sent;paths=["0"];labels=["t","c","z","y","x"];if("multiscales"in rootAttrs){_rootAttrs$multiscale=rootAttrs.multiscales[0],datasets=_rootAttrs$multiscale.datasets,axes=_rootAttrs$multiscale.axes;paths=datasets.map(function(d){return d.path;});if(axes){labels=axes;}}data=paths.map(function(path2){return grp.getItem(path2);});_context21.next=13;return Promise.all(data);case 13:_context21.t0=_context21.sent;_context21.t1=rootAttrs;_context21.t2=labels;return _context21.abrupt("return",{data:_context21.t0,rootAttrs:_context21.t1,labels:_context21.t2});case 17:case"end":return _context21.stop();}}},_callee21);}));return _loadMultiscales.apply(this,arguments);}function guessTileSize(arr){var interleaved=isInterleaved(arr.shape);var _arr$chunks$slice=arr.chunks.slice(interleaved?-3:-2),_arr$chunks$slice2=(0,_slicedToArray2["default"])(_arr$chunks$slice,2),yChunk=_arr$chunks$slice2[0],xChunk=_arr$chunks$slice2[1];var size=Math.min(yChunk,xChunk);return prevPowerOf2(size);}function getIndexer(labels){var size=labels.length;var dims=getDims(labels.map(function(label,i){return(0,_typeof2["default"])(label)==="object"?label.name:label;}).map(function(name,i){return name;}));return function(sel){if(Array.isArray(sel)){return(0,_toConsumableArray2["default"])(sel);}var selection=Array(size).fill(0);for(var _i=0,_Object$entries=Object.entries(sel);_i<_Object$entries.length;_i++){var _Object$entries$_i=(0,_slicedToArray2["default"])(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];selection[dims(key)]=value;}return selection;};}var DTYPE_LOOKUP={u1:"Uint8",u2:"Uint16",u4:"Uint32",f4:"Float32",f8:"Float64",i1:"Int8",i2:"Int16",i4:"Int32"};var ZarrPixelSource=/*#__PURE__*/function(){function ZarrPixelSource(data,labels,tileSize){(0,_classCallCheck2["default"])(this,ZarrPixelSource);(0,_defineProperty2["default"])(this,"_data",void 0);(0,_defineProperty2["default"])(this,"_indexer",void 0);(0,_defineProperty2["default"])(this,"_readChunks",void 0);this.labels=labels;this.tileSize=tileSize;this._indexer=getIndexer(labels);this._data=data;var xChunkSize=data.chunks[this._xIndex];var yChunkSize=data.chunks[this._xIndex-1];this._readChunks=tileSize===xChunkSize&&tileSize===yChunkSize;}(0,_createClass2["default"])(ZarrPixelSource,[{key:"shape",get:function get(){return this._data.shape;}},{key:"dtype",get:function get(){var suffix=this._data.dtype.slice(1);if(!(suffix in DTYPE_LOOKUP)){throw Error("Zarr dtype not supported, got ".concat(suffix,"."));}return DTYPE_LOOKUP[suffix];}},{key:"_xIndex",get:function get(){var interleave=isInterleaved(this._data.shape);return this._data.shape.length-(interleave?2:1);}},{key:"_chunkIndex",value:function _chunkIndex(selection,x,y){var sel=this._indexer(selection);sel[this._xIndex]=x;sel[this._xIndex-1]=y;return sel;}},{key:"_getSlices",value:function _getSlices(x,y){var _getImageSize7=getImageSize(this),height=_getImageSize7.height,width=_getImageSize7.width;var _ref46=[x*this.tileSize,Math.min((x+1)*this.tileSize,width)],xStart=_ref46[0],xStop=_ref46[1];var _ref47=[y*this.tileSize,Math.min((y+1)*this.tileSize,height)],yStart=_ref47[0],yStop=_ref47[1];if(xStart===xStop||yStart===yStop){throw new _zarr.BoundsCheckError("Tile slice is zero-sized.");}return[(0,_zarr.slice)(xStart,xStop),(0,_zarr.slice)(yStart,yStop)];}},{key:"getRaster",value:function(){var _getRaster5=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee15(_ref48){var selection,sel,_yield$this$_data$get,data,shape,_shape,height,width;return _regenerator["default"].wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:selection=_ref48.selection;sel=this._chunkIndex(selection,null,null);_context15.next=4;return this._data.getRaw(sel);case 4:_yield$this$_data$get=_context15.sent;data=_yield$this$_data$get.data;shape=_yield$this$_data$get.shape;_shape=(0,_slicedToArray2["default"])(shape,2),height=_shape[0],width=_shape[1];return _context15.abrupt("return",{data:data,width:width,height:height});case 9:case"end":return _context15.stop();}}},_callee15,this);}));function getRaster(_x16){return _getRaster5.apply(this,arguments);}return getRaster;}()},{key:"getTile",value:function(){var _getTile2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee16(props){var x,y,selection,signal,res,sel,_this$_getSlices,_this$_getSlices2,xSlice,ySlice,_sel,_res,data,_res$shape,height,width;return _regenerator["default"].wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:x=props.x,y=props.y,selection=props.selection,signal=props.signal;if(!this._readChunks){_context16.next=8;break;}sel=this._chunkIndex(selection,x,y);_context16.next=5;return this._data.getRawChunk(sel,{storeOptions:{signal:signal}});case 5:res=_context16.sent;_context16.next=13;break;case 8:_this$_getSlices=this._getSlices(x,y),_this$_getSlices2=(0,_slicedToArray2["default"])(_this$_getSlices,2),xSlice=_this$_getSlices2[0],ySlice=_this$_getSlices2[1];_sel=this._chunkIndex(selection,xSlice,ySlice);_context16.next=12;return this._data.getRaw(_sel);case 12:res=_context16.sent;case 13:_res=res,data=_res.data,_res$shape=(0,_slicedToArray2["default"])(_res.shape,2),height=_res$shape[0],width=_res$shape[1];return _context16.abrupt("return",{data:data,width:width,height:height});case 15:case"end":return _context16.stop();}}},_callee16,this);}));function getTile(_x17){return _getTile2.apply(this,arguments);}return getTile;}()},{key:"onTileError",value:function onTileError(err){if(!(err instanceof _zarr.BoundsCheckError)){throw err;}}}]);return ZarrPixelSource;}();exports.ZarrPixelSource=ZarrPixelSource;function load$1(_x18,_x19){return _load$2.apply(this,arguments);}function _load$2(){_load$2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee22(root,xmlSource){var imgMeta,_yield$loadMultiscale,data,labels,tileSize,pyramid;return _regenerator["default"].wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:if(!(typeof xmlSource!=="string")){_context22.next=4;break;}_context22.next=3;return xmlSource.text();case 3:xmlSource=_context22.sent;case 4:imgMeta=fromString(xmlSource)[0];_context22.next=7;return loadMultiscales(root,"0");case 7:_yield$loadMultiscale=_context22.sent;data=_yield$loadMultiscale.data;labels=guessBioformatsLabels(data[0],imgMeta);tileSize=guessTileSize(data[0]);pyramid=data.map(function(arr){return new ZarrPixelSource(arr,labels,tileSize);});return _context22.abrupt("return",{data:pyramid,metadata:imgMeta});case 13:case"end":return _context22.stop();}}},_callee22);}));return _load$2.apply(this,arguments);}function load(_x20){return _load.apply(this,arguments);}function _load(){_load=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee23(store){var _yield$loadMultiscale2,data,rootAttrs,labels,tileSize,pyramid;return _regenerator["default"].wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:_context23.next=2;return loadMultiscales(store);case 2:_yield$loadMultiscale2=_context23.sent;data=_yield$loadMultiscale2.data;rootAttrs=_yield$loadMultiscale2.rootAttrs;labels=_yield$loadMultiscale2.labels;tileSize=guessTileSize(data[0]);pyramid=data.map(function(arr){return new ZarrPixelSource(arr,labels,tileSize);});return _context23.abrupt("return",{data:pyramid,metadata:rootAttrs});case 9:case"end":return _context23.stop();}}},_callee23);}));return _load.apply(this,arguments);}function loadBioformatsZarr(_x21){return _loadBioformatsZarr.apply(this,arguments);}function _loadBioformatsZarr(){_loadBioformatsZarr=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee24(source){var options,METADATA,ZARR_DIR,url,store2,xmlSource,fMap,xmlFile,_iterator,_step,file,store,_args24=arguments;return _regenerator["default"].wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:options=_args24.length>1&&_args24[1]!==undefined?_args24[1]:{};METADATA="METADATA.ome.xml";ZARR_DIR="data.zarr";if(!(typeof source==="string")){_context24.next=10;break;}url=source.endsWith("/")?source.slice(0,-1):source;store2=new _zarr.HTTPStore(url+"/"+ZARR_DIR,options);_context24.next=8;return fetch(url+"/"+METADATA,options.fetchOptions);case 8:xmlSource=_context24.sent;return _context24.abrupt("return",load$1(store2,xmlSource));case 10:fMap=/* @__PURE__ */new Map();_iterator=_createForOfIteratorHelper(source);try{for(_iterator.s();!(_step=_iterator.n()).done;){file=_step.value;if(file.name===METADATA){xmlFile=file;}else{fMap.set(file.path,file);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(xmlFile){_context24.next=15;break;}throw Error("No OME-XML metadata found for store.");case 15:store=new FileStore(fMap,getRootPrefix(source,ZARR_DIR));return _context24.abrupt("return",load$1(store,xmlFile));case 17:case"end":return _context24.stop();}}},_callee24);}));return _loadBioformatsZarr.apply(this,arguments);}function loadOmeZarr(_x22){return _loadOmeZarr.apply(this,arguments);}function _loadOmeZarr(){_loadOmeZarr=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee25(source){var options,store,_args25=arguments;return _regenerator["default"].wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:options=_args25.length>1&&_args25[1]!==undefined?_args25[1]:{};store=new _zarr.HTTPStore(source,options);if(!((options===null||options===void 0?void 0:options.type)!=="multiscales")){_context25.next=4;break;}throw Error("Only multiscale OME-Zarr is supported.");case 4:return _context25.abrupt("return",load(store));case 5:case"end":return _context25.stop();}}},_callee25);}));return _loadOmeZarr.apply(this,arguments);}